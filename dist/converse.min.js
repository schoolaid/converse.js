/*! For license information please see converse.min.js.LICENSE.txt */
(()=>{var e,t,s,n,i={169:(e,t,s)=>{var n;!function(){"use strict";var i={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function r(e){return function(e,t){var s,n,o,a,c,l,d,u,h,m=1,g=e.length,p="";for(n=0;n<g;n++)if("string"==typeof e[n])p+=e[n];else if("object"==typeof e[n]){if((a=e[n]).keys)for(s=t[m],o=0;o<a.keys.length;o++){if(null==s)throw new Error(r('[sprintf] Cannot access property "%s" of undefined value "%s"',a.keys[o],a.keys[o-1]));s=s[a.keys[o]]}else s=a.param_no?t[a.param_no]:t[m++];if(i.not_type.test(a.type)&&i.not_primitive.test(a.type)&&s instanceof Function&&(s=s()),i.numeric_arg.test(a.type)&&"number"!=typeof s&&isNaN(s))throw new TypeError(r("[sprintf] expecting number but found %T",s));switch(i.number.test(a.type)&&(u=s>=0),a.type){case"b":s=parseInt(s,10).toString(2);break;case"c":s=String.fromCharCode(parseInt(s,10));break;case"d":case"i":s=parseInt(s,10);break;case"j":s=JSON.stringify(s,null,a.width?parseInt(a.width):0);break;case"e":s=a.precision?parseFloat(s).toExponential(a.precision):parseFloat(s).toExponential();break;case"f":s=a.precision?parseFloat(s).toFixed(a.precision):parseFloat(s);break;case"g":s=a.precision?String(Number(s.toPrecision(a.precision))):parseFloat(s);break;case"o":s=(parseInt(s,10)>>>0).toString(8);break;case"s":s=String(s),s=a.precision?s.substring(0,a.precision):s;break;case"t":s=String(!!s),s=a.precision?s.substring(0,a.precision):s;break;case"T":s=Object.prototype.toString.call(s).slice(8,-1).toLowerCase(),s=a.precision?s.substring(0,a.precision):s;break;case"u":s=parseInt(s,10)>>>0;break;case"v":s=s.valueOf(),s=a.precision?s.substring(0,a.precision):s;break;case"x":s=(parseInt(s,10)>>>0).toString(16);break;case"X":s=(parseInt(s,10)>>>0).toString(16).toUpperCase()}i.json.test(a.type)?p+=s:(!i.number.test(a.type)||u&&!a.sign?h="":(h=u?"+":"-",s=s.toString().replace(i.sign,"")),l=a.pad_char?"0"===a.pad_char?"0":a.pad_char.charAt(1):" ",d=a.width-(h+s).length,c=a.width&&d>0?l.repeat(d):"",p+=a.align?h+s+c:"0"===l?h+c+s:c+h+s)}return p}(function(e){if(a[e])return a[e];var t,s=e,n=[],r=0;for(;s;){if(null!==(t=i.text.exec(s)))n.push(t[0]);else if(null!==(t=i.modulo.exec(s)))n.push("%");else{if(null===(t=i.placeholder.exec(s)))throw new SyntaxError("[sprintf] unexpected placeholder");if(t[2]){r|=1;var o=[],c=t[2],l=[];if(null===(l=i.key.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o.push(l[1]);""!==(c=c.substring(l[0].length));)if(null!==(l=i.key_access.exec(c)))o.push(l[1]);else{if(null===(l=i.index_access.exec(c)))throw new SyntaxError("[sprintf] failed to parse named argument key");o.push(l[1])}t[2]=o}else r|=2;if(3===r)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");n.push({placeholder:t[0],param_no:t[1],keys:t[2],sign:t[3],pad_char:t[4],align:t[5],width:t[6],precision:t[7],type:t[8]})}s=s.substring(t[0].length)}return a[e]=n}(e),arguments)}function o(e,t){return r.apply(null,[e].concat(t||[]))}var a=Object.create(null);t.sprintf=r,t.vsprintf=o,"undefined"!=typeof window&&(window.sprintf=r,window.vsprintf=o,void 0===(n=function(){return{sprintf:r,vsprintf:o}}.call(t,s,t,e))||(e.exports=n))}()},4335:function(e,t,s){var n,i;!function(r,o){"use strict";e.exports?e.exports=o():void 0===(i="function"==typeof(n=o)?n.call(t,s,t,e):n)||(e.exports=i)}(0,(function(e){"use strict";var t=e&&e.IPv6;return{best:function(e){var t,s,n=e.toLowerCase().split(":"),i=n.length,r=8;for(""===n[0]&&""===n[1]&&""===n[2]?(n.shift(),n.shift()):""===n[0]&&""===n[1]?n.shift():""===n[i-1]&&""===n[i-2]&&n.pop(),-1!==n[(i=n.length)-1].indexOf(".")&&(r=7),t=0;t<i&&""!==n[t];t++);if(t<r)for(n.splice(t,1,"0000");n.length<r;)n.splice(t,0,"0000");for(var o=0;o<r;o++){s=n[o].split("");for(var a=0;a<3&&("0"===s[0]&&s.length>1);a++)s.splice(0,1);n[o]=s.join("")}var c=-1,l=0,d=0,u=-1,h=!1;for(o=0;o<r;o++)h?"0"===n[o]?d+=1:(h=!1,d>l&&(c=u,l=d)):"0"===n[o]&&(h=!0,u=o,d=1);d>l&&(c=u,l=d),l>1&&n.splice(c,l,""),i=n.length;var m="";for(""===n[0]&&(m=":"),o=0;o<i&&(m+=n[o],o!==i-1);o++)m+=":";return""===n[i-1]&&(m+=":"),m},noConflict:function(){return e.IPv6===this&&(e.IPv6=t),this}}}))},4817:function(e,t,s){var n,i;!function(r,o){"use strict";e.exports?e.exports=o():void 0===(i="function"==typeof(n=o)?n.call(t,s,t,e):n)||(e.exports=i)}(0,(function(e){"use strict";var t=e&&e.SecondLevelDomains,s={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var n=e.lastIndexOf(".",t-1);if(n<=0||n>=t-1)return!1;var i=s.list[e.slice(t+1)];return!!i&&i.indexOf(" "+e.slice(n+1,t)+" ")>=0},is:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;if(e.lastIndexOf(".",t-1)>=0)return!1;var n=s.list[e.slice(t+1)];return!!n&&n.indexOf(" "+e.slice(0,t)+" ")>=0},get:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return null;var n=e.lastIndexOf(".",t-1);if(n<=0||n>=t-1)return null;var i=s.list[e.slice(t+1)];return i?i.indexOf(" "+e.slice(n+1,t)+" ")<0?null:e.slice(n+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return s}))},9542:function(e,t,s){var n,i,r;!function(o,a){"use strict";e.exports?e.exports=a(s(5413),s(4335),s(4817)):(i=[s(5413),s(4335),s(4817)],void 0===(r="function"==typeof(n=a)?n.apply(t,i):n)||(e.exports=r))}(0,(function(e,t,s,n){"use strict";var i=n&&n.URI;function r(e,t){var s=arguments.length>=1;if(!(this instanceof r))return s?arguments.length>=2?new r(e,t):new r(e):new r;if(void 0===e){if(s)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!=typeof location?location.href+"":""}if(null===e&&s)throw new TypeError("null is not a valid argument for URI");return this.href(e),void 0!==t?this.absoluteTo(t):this}r.version="1.19.11";var o=r.prototype,a=Object.prototype.hasOwnProperty;function c(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function l(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function d(e){return"Array"===l(e)}function u(e,t){var s,n,i={};if("RegExp"===l(t))i=null;else if(d(t))for(s=0,n=t.length;s<n;s++)i[t[s]]=!0;else i[t]=!0;for(s=0,n=e.length;s<n;s++){(i&&void 0!==i[e[s]]||!i&&t.test(e[s]))&&(e.splice(s,1),n--,s--)}return e}function h(e,t){var s,n;if(d(t)){for(s=0,n=t.length;s<n;s++)if(!h(e,t[s]))return!1;return!0}var i=l(t);for(s=0,n=e.length;s<n;s++)if("RegExp"===i){if("string"==typeof e[s]&&e[s].match(t))return!0}else if(e[s]===t)return!0;return!1}function m(e,t){if(!d(e)||!d(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var s=0,n=e.length;s<n;s++)if(e[s]!==t[s])return!1;return!0}function g(e){return e.replace(/^\/+|\/+$/g,"")}function p(e){return escape(e)}function f(e){return encodeURIComponent(e).replace(/[!'()*]/g,p).replace(/\*/g,"%2A")}r._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:r.preventInvalidHostname,duplicateQueryParameters:r.duplicateQueryParameters,escapeQuerySpace:r.escapeQuerySpace}},r.preventInvalidHostname=!1,r.duplicateQueryParameters=!1,r.escapeQuerySpace=!0,r.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,r.idn_expression=/[^a-z0-9\._-]/i,r.punycode_expression=/(xn--)/i,r.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,r.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,r.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,r.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},r.leading_whitespace_expression=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,r.ascii_tab_whitespace=/[\u0009\u000A\u000D]+/g,r.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},r.hostProtocols=["http","https"],r.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,r.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},r.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return r.domAttributes[t]}},r.encode=f,r.decode=decodeURIComponent,r.iso8859=function(){r.encode=escape,r.decode=unescape},r.unicode=function(){r.encode=f,r.decode=decodeURIComponent},r.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},r.encodeQuery=function(e,t){var s=r.encode(e+"");return void 0===t&&(t=r.escapeQuerySpace),t?s.replace(/%20/g,"+"):s},r.decodeQuery=function(e,t){e+="",void 0===t&&(t=r.escapeQuerySpace);try{return r.decode(t?e.replace(/\+/g,"%20"):e)}catch(t){return e}};var v,_={encode:"encode",decode:"decode"},b=function(e,t){return function(s){try{return r[t](s+"").replace(r.characters[e][t].expression,(function(s){return r.characters[e][t].map[s]}))}catch(e){return s}}};for(v in _)r[v+"PathSegment"]=b("pathname",_[v]),r[v+"UrnPathSegment"]=b("urnpath",_[v]);var y=function(e,t,s){return function(n){var i;i=s?function(e){return r[t](r[s](e))}:r[t];for(var o=(n+"").split(e),a=0,c=o.length;a<c;a++)o[a]=i(o[a]);return o.join(e)}};function w(e){return function(t,s){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!s),this)}}function S(e,t){return function(s,n){return void 0===s?this._parts[e]||"":(null!==s&&(s+="").charAt(0)===t&&(s=s.substring(1)),this._parts[e]=s,this.build(!n),this)}}r.decodePath=y("/","decodePathSegment"),r.decodeUrnPath=y(":","decodeUrnPathSegment"),r.recodePath=y("/","encodePathSegment","decode"),r.recodeUrnPath=y(":","encodeUrnPathSegment","decode"),r.encodeReserved=b("reserved","encode"),r.parse=function(e,t){var s;return t||(t={preventInvalidHostname:r.preventInvalidHostname}),(s=(e=(e=e.replace(r.leading_whitespace_expression,"")).replace(r.ascii_tab_whitespace,"")).indexOf("#"))>-1&&(t.fragment=e.substring(s+1)||null,e=e.substring(0,s)),(s=e.indexOf("?"))>-1&&(t.query=e.substring(s+1)||null,e=e.substring(0,s)),"//"===(e=(e=e.replace(/^(https?|ftp|wss?)?:+[/\\]*/i,"$1://")).replace(/^[/\\]{2,}/i,"//")).substring(0,2)?(t.protocol=null,e=e.substring(2),e=r.parseAuthority(e,t)):(s=e.indexOf(":"))>-1&&(t.protocol=e.substring(0,s)||null,t.protocol&&!t.protocol.match(r.protocol_expression)?t.protocol=void 0:"//"===e.substring(s+1,s+3).replace(/\\/g,"/")?(e=e.substring(s+3),e=r.parseAuthority(e,t)):(e=e.substring(s+1),t.urn=!0)),t.path=e,t},r.parseHost=function(e,t){e||(e="");var s,n,i=(e=e.replace(/\\/g,"/")).indexOf("/");if(-1===i&&(i=e.length),"["===e.charAt(0))s=e.indexOf("]"),t.hostname=e.substring(1,s)||null,t.port=e.substring(s+2,i)||null,"/"===t.port&&(t.port=null);else{var o=e.indexOf(":"),a=e.indexOf("/"),c=e.indexOf(":",o+1);-1!==c&&(-1===a||c<a)?(t.hostname=e.substring(0,i)||null,t.port=null):(n=e.substring(0,i).split(":"),t.hostname=n[0]||null,t.port=n[1]||null)}return t.hostname&&"/"!==e.substring(i).charAt(0)&&(i++,e="/"+e),t.preventInvalidHostname&&r.ensureValidHostname(t.hostname,t.protocol),t.port&&r.ensureValidPort(t.port),e.substring(i)||"/"},r.parseAuthority=function(e,t){return e=r.parseUserinfo(e,t),r.parseHost(e,t)},r.parseUserinfo=function(e,t){var s=e;-1!==e.indexOf("\\")&&(e=e.replace(/\\/g,"/"));var n,i=e.indexOf("/"),o=e.lastIndexOf("@",i>-1?i:e.length-1);return o>-1&&(-1===i||o<i)?(n=e.substring(0,o).split(":"),t.username=n[0]?r.decode(n[0]):null,n.shift(),t.password=n[0]?r.decode(n.join(":")):null,e=s.substring(o+1)):(t.username=null,t.password=null),e},r.parseQuery=function(e,t){if(!e)return{};if(!(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var s,n,i,o={},c=e.split("&"),l=c.length,d=0;d<l;d++)s=c[d].split("="),n=r.decodeQuery(s.shift(),t),i=s.length?r.decodeQuery(s.join("="),t):null,"__proto__"!==n&&(a.call(o,n)?("string"!=typeof o[n]&&null!==o[n]||(o[n]=[o[n]]),o[n].push(i)):o[n]=i);return o},r.build=function(e){var t="",s=!1;return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//",s=!0),t+=r.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&s&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},r.buildHost=function(e){var t="";return e.hostname?(r.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname,e.port&&(t+=":"+e.port),t):""},r.buildAuthority=function(e){return r.buildUserinfo(e)+r.buildHost(e)},r.buildUserinfo=function(e){var t="";return e.username&&(t+=r.encode(e.username)),e.password&&(t+=":"+r.encode(e.password)),t&&(t+="@"),t},r.buildQuery=function(e,t,s){var n,i,o,c,l="";for(i in e)if("__proto__"!==i&&a.call(e,i))if(d(e[i]))for(n={},o=0,c=e[i].length;o<c;o++)void 0!==e[i][o]&&void 0===n[e[i][o]+""]&&(l+="&"+r.buildQueryParameter(i,e[i][o],s),!0!==t&&(n[e[i][o]+""]=!0));else void 0!==e[i]&&(l+="&"+r.buildQueryParameter(i,e[i],s));return l.substring(1)},r.buildQueryParameter=function(e,t,s){return r.encodeQuery(e,s)+(null!==t?"="+r.encodeQuery(t,s):"")},r.addQuery=function(e,t,s){if("object"==typeof t)for(var n in t)a.call(t,n)&&r.addQuery(e,n,t[n]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=s);"string"==typeof e[t]&&(e[t]=[e[t]]),d(s)||(s=[s]),e[t]=(e[t]||[]).concat(s)}},r.setQuery=function(e,t,s){if("object"==typeof t)for(var n in t)a.call(t,n)&&r.setQuery(e,n,t[n]);else{if("string"!=typeof t)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");e[t]=void 0===s?null:s}},r.removeQuery=function(e,t,s){var n,i,o;if(d(t))for(n=0,i=t.length;n<i;n++)e[t[n]]=void 0;else if("RegExp"===l(t))for(o in e)t.test(o)&&(e[o]=void 0);else if("object"==typeof t)for(o in t)a.call(t,o)&&r.removeQuery(e,o,t[o]);else{if("string"!=typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==s?"RegExp"===l(s)?!d(e[t])&&s.test(e[t])?e[t]=void 0:e[t]=u(e[t],s):e[t]!==String(s)||d(s)&&1!==s.length?d(e[t])&&(e[t]=u(e[t],s)):e[t]=void 0:e[t]=void 0}},r.hasQuery=function(e,t,s,n){switch(l(t)){case"String":break;case"RegExp":for(var i in e)if(a.call(e,i)&&t.test(i)&&(void 0===s||r.hasQuery(e,i,s)))return!0;return!1;case"Object":for(var o in t)if(a.call(t,o)&&!r.hasQuery(e,o,t[o]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(l(s)){case"Undefined":return t in e;case"Boolean":return s===Boolean(d(e[t])?e[t].length:e[t]);case"Function":return!!s(e[t],t,e);case"Array":return!!d(e[t])&&(n?h:m)(e[t],s);case"RegExp":return d(e[t])?!!n&&h(e[t],s):Boolean(e[t]&&e[t].match(s));case"Number":s=String(s);case"String":return d(e[t])?!!n&&h(e[t],s):e[t]===s;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},r.joinPaths=function(){for(var e=[],t=[],s=0,n=0;n<arguments.length;n++){var i=new r(arguments[n]);e.push(i);for(var o=i.segment(),a=0;a<o.length;a++)"string"==typeof o[a]&&t.push(o[a]),o[a]&&s++}if(!t.length||!s)return new r("");var c=new r("").segment(t);return""!==e[0].path()&&"/"!==e[0].path().slice(0,1)||c.path("/"+c.path()),c.normalize()},r.commonPath=function(e,t){var s,n=Math.min(e.length,t.length);for(s=0;s<n;s++)if(e.charAt(s)!==t.charAt(s)){s--;break}return s<1?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":("/"===e.charAt(s)&&"/"===t.charAt(s)||(s=e.substring(0,s).lastIndexOf("/")),e.substring(0,s+1))},r.withinString=function(e,t,s){s||(s={});var n=s.start||r.findUri.start,i=s.end||r.findUri.end,o=s.trim||r.findUri.trim,a=s.parens||r.findUri.parens,c=/[a-z0-9-]=["']?$/i;for(n.lastIndex=0;;){var l=n.exec(e);if(!l)break;var d=l.index;if(s.ignoreHtml){var u=e.slice(Math.max(d-3,0),d);if(u&&c.test(u))continue}for(var h=d+e.slice(d).search(i),m=e.slice(d,h),g=-1;;){var p=a.exec(m);if(!p)break;var f=p.index+p[0].length;g=Math.max(g,f)}if(!((m=g>-1?m.slice(0,g)+m.slice(g).replace(o,""):m.replace(o,"")).length<=l[0].length||s.ignore&&s.ignore.test(m))){var v=t(m,d,h=d+m.length,e);void 0!==v?(v=String(v),e=e.slice(0,d)+v+e.slice(h),n.lastIndex=d+v.length):n.lastIndex=h}}return n.lastIndex=0,e},r.ensureValidHostname=function(t,s){var n=!!t,i=!1;if(!!s&&(i=h(r.hostProtocols,s)),i&&!n)throw new TypeError("Hostname cannot be empty, if protocol is "+s);if(t&&t.match(r.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(r.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}},r.ensureValidPort=function(e){if(e){var t=Number(e);if(!(/^[0-9]+$/.test(t)&&t>0&&t<65536))throw new TypeError('Port "'+e+'" is not a valid port')}},r.noConflict=function(e){if(e){var t={URI:this.noConflict()};return n.URITemplate&&"function"==typeof n.URITemplate.noConflict&&(t.URITemplate=n.URITemplate.noConflict()),n.IPv6&&"function"==typeof n.IPv6.noConflict&&(t.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&"function"==typeof n.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=n.SecondLevelDomains.noConflict()),t}return n.URI===this&&(n.URI=i),this},o.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=r.build(this._parts),this._deferred_build=!1),this},o.clone=function(){return new r(this)},o.valueOf=o.toString=function(){return this.build(!1)._string},o.protocol=w("protocol"),o.username=w("username"),o.password=w("password"),o.hostname=w("hostname"),o.port=w("port"),o.query=S("query","?"),o.fragment=S("fragment","#"),o.search=function(e,t){var s=this.query(e,t);return"string"==typeof s&&s.length?"?"+s:s},o.hash=function(e,t){var s=this.fragment(e,t);return"string"==typeof s&&s.length?"#"+s:s},o.pathname=function(e,t){if(void 0===e||!0===e){var s=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?r.decodeUrnPath:r.decodePath)(s):s}return this._parts.urn?this._parts.path=e?r.recodeUrnPath(e):"":this._parts.path=e?r.recodePath(e):"/",this.build(!t),this},o.path=o.pathname,o.href=function(e,t){var s;if(void 0===e)return this.toString();this._string="",this._parts=r._parts();var n=e instanceof r,i="object"==typeof e&&(e.hostname||e.path||e.pathname);e.nodeName&&(e=e[r.getDomAttribute(e)]||"",i=!1);if(!n&&i&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=r.parse(String(e),this._parts);else{if(!n&&!i)throw new TypeError("invalid input");var o=n?e._parts:e;for(s in o)"query"!==s&&a.call(this._parts,s)&&(this._parts[s]=o[s]);o.query&&this.query(o.query,!1)}return this.build(!t),this},o.is=function(e){var t=!1,n=!1,i=!1,o=!1,a=!1,c=!1,l=!1,d=!this._parts.urn;switch(this._parts.hostname&&(d=!1,n=r.ip4_expression.test(this._parts.hostname),i=r.ip6_expression.test(this._parts.hostname),a=(o=!(t=n||i))&&s&&s.has(this._parts.hostname),c=o&&r.idn_expression.test(this._parts.hostname),l=o&&r.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return d;case"absolute":return!d;case"domain":case"name":return o;case"sld":return a;case"ip":return t;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return i;case"idn":return c;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return l}return null};var A=o.protocol,x=o.port,E=o.hostname;o.protocol=function(e,t){if(e&&!(e=e.replace(/:(\/\/)?$/,"")).match(r.protocol_expression))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return A.call(this,e,t)},o.scheme=o.protocol,o.port=function(e,t){return this._parts.urn?void 0===e?"":this:(void 0!==e&&(0===e&&(e=null),e&&(":"===(e+="").charAt(0)&&(e=e.substring(1)),r.ensureValidPort(e))),x.call(this,e,t))},o.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var s={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==r.parseHost(e,s))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=s.hostname,this._parts.preventInvalidHostname&&r.ensureValidHostname(e,this._parts.protocol)}return E.call(this,e,t)},o.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var s=this.protocol();return this.authority()?(s?s+"://":"")+this.authority():""}var n=r(e);return this.protocol(n.protocol()).authority(n.authority()).build(!t),this},o.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?r.buildHost(this._parts):"";if("/"!==r.parseHost(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?r.buildAuthority(this._parts):"";if("/"!==r.parseAuthority(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},o.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var s=r.buildUserinfo(this._parts);return s?s.substring(0,s.length-1):s}return"@"!==e[e.length-1]&&(e+="@"),r.parseUserinfo(e,this._parts),this.build(!t),this},o.resource=function(e,t){var s;return void 0===e?this.path()+this.search()+this.hash():(s=r.parse(e),this._parts.path=s.path,this._parts.query=s.query,this._parts.fragment=s.fragment,this.build(!t),this)},o.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var s=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,s)||""}var n=this._parts.hostname.length-this.domain().length,i=this._parts.hostname.substring(0,n),o=new RegExp("^"+c(i));if(e&&"."!==e.charAt(e.length-1)&&(e+="."),-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");return e&&r.ensureValidHostname(e,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(o,e),this.build(!t),this},o.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var s=this._parts.hostname.match(/\./g);if(s&&s.length<2)return this._parts.hostname;var n=this._parts.hostname.length-this.tld(t).length-1;return n=this._parts.hostname.lastIndexOf(".",n-1)+1,this._parts.hostname.substring(n)||""}if(!e)throw new TypeError("cannot set domain empty");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(r.ensureValidHostname(e,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var i=new RegExp(c(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(i,e)}return this.build(!t),this},o.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.lastIndexOf("."),i=this._parts.hostname.substring(n+1);return!0!==t&&s&&s.list[i.toLowerCase()]&&s.get(this._parts.hostname)||i}var r;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!s||!s.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');r=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");r=new RegExp(c(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,e)}return this.build(!t),this},o.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var s=this._parts.path.length-this.filename().length-1,n=this._parts.path.substring(0,s)||(this._parts.hostname?"/":"");return e?r.decodePath(n):n}var i=this._parts.path.length-this.filename().length,o=this._parts.path.substring(0,i),a=new RegExp("^"+c(o));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=r.recodePath(e),this._parts.path=this._parts.path.replace(a,e),this.build(!t),this},o.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("string"!=typeof e){if(!this._parts.path||"/"===this._parts.path)return"";var s=this._parts.path.lastIndexOf("/"),n=this._parts.path.substring(s+1);return e?r.decodePathSegment(n):n}var i=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(i=!0);var o=new RegExp(c(this.filename())+"$");return e=r.recodePath(e),this._parts.path=this._parts.path.replace(o,e),i?this.normalizePath(t):this.build(!t),this},o.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var s,n,i=this.filename(),o=i.lastIndexOf(".");return-1===o?"":(s=i.substring(o+1),n=/^[a-z0-9%]+$/i.test(s)?s:"",e?r.decodePathSegment(n):n)}"."===e.charAt(0)&&(e=e.substring(1));var a,l=this.suffix();if(l)a=e?new RegExp(c(l)+"$"):new RegExp(c("."+l)+"$");else{if(!e)return this;this._parts.path+="."+r.recodePath(e)}return a&&(e=r.recodePath(e),this._parts.path=this._parts.path.replace(a,e)),this.build(!t),this},o.segment=function(e,t,s){var n=this._parts.urn?":":"/",i=this.path(),r="/"===i.substring(0,1),o=i.split(n);if(void 0!==e&&"number"!=typeof e&&(s=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(r&&o.shift(),e<0&&(e=Math.max(o.length+e,0)),void 0===t)return void 0===e?o:o[e];if(null===e||void 0===o[e])if(d(t)){o=[];for(var a=0,c=t.length;a<c;a++)(t[a].length||o.length&&o[o.length-1].length)&&(o.length&&!o[o.length-1].length&&o.pop(),o.push(g(t[a])))}else(t||"string"==typeof t)&&(t=g(t),""===o[o.length-1]?o[o.length-1]=t:o.push(t));else t?o[e]=g(t):o.splice(e,1);return r&&o.unshift(""),this.path(o.join(n),s)},o.segmentCoded=function(e,t,s){var n,i,o;if("number"!=typeof e&&(s=t,t=e,e=void 0),void 0===t){if(d(n=this.segment(e,t,s)))for(i=0,o=n.length;i<o;i++)n[i]=r.decode(n[i]);else n=void 0!==n?r.decode(n):void 0;return n}if(d(t))for(i=0,o=t.length;i<o;i++)t[i]=r.encode(t[i]);else t="string"==typeof t||t instanceof String?r.encode(t):t;return this.segment(e,t,s)};var $=o.query;return o.query=function(e,t){if(!0===e)return r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var s=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace),n=e.call(this,s);return this._parts.query=r.buildQuery(n||s,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=r.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):$.call(this,e,t)},o.setQuery=function(e,t,s){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)n[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in e)a.call(e,i)&&(n[i]=e[i])}return this._parts.query=r.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(s=t),this.build(!s),this},o.addQuery=function(e,t,s){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.addQuery(n,e,void 0===t?null:t),this._parts.query=r.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(s=t),this.build(!s),this},o.removeQuery=function(e,t,s){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.removeQuery(n,e,t),this._parts.query=r.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(s=t),this.build(!s),this},o.hasQuery=function(e,t,s){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.hasQuery(n,e,t,s)},o.setSearch=o.setQuery,o.addSearch=o.addQuery,o.removeSearch=o.removeQuery,o.hasSearch=o.hasQuery,o.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},o.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},o.normalizeHostname=function(s){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!s)),this},o.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===r.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},o.normalizePath=function(e){var t,s=this._parts.path;if(!s)return this;if(this._parts.urn)return this._parts.path=r.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;var n,i,o="";for("/"!==(s=r.recodePath(s)).charAt(0)&&(t=!0,s="/"+s),"/.."!==s.slice(-3)&&"/."!==s.slice(-2)||(s+="/"),s=s.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),t&&(o=s.substring(1).match(/^(\.\.\/)+/)||"")&&(o=o[0]);-1!==(n=s.search(/\/\.\.(\/|$)/));)0!==n?(-1===(i=s.substring(0,n).lastIndexOf("/"))&&(i=n),s=s.substring(0,i)+s.substring(n+3)):s=s.substring(3);return t&&this.is("relative")&&(s=o+s.substring(1)),this._parts.path=s,this.build(!e),this},o.normalizePathname=o.normalizePath,o.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(r.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},o.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},o.normalizeSearch=o.normalizeQuery,o.normalizeHash=o.normalizeFragment,o.iso8859=function(){var e=r.encode,t=r.decode;r.encode=escape,r.decode=decodeURIComponent;try{this.normalize()}finally{r.encode=e,r.decode=t}return this},o.unicode=function(){var e=r.encode,t=r.decode;r.encode=f,r.decode=unescape;try{this.normalize()}finally{r.encode=e,r.decode=t}return this},o.readable=function(){var t=this.clone();t.username("").password("").normalize();var s="";if(t._parts.protocol&&(s+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(s+=e.toUnicode(t._parts.hostname),t._parts.port&&(s+=":"+t._parts.port)):s+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(s+="/"),s+=t.path(!0),t._parts.query){for(var n="",i=0,o=t._parts.query.split("&"),a=o.length;i<a;i++){var c=(o[i]||"").split("=");n+="&"+r.decodeQuery(c[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==c[1]&&(n+="="+r.decodeQuery(c[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}s+="?"+n.substring(1)}return s+=r.decodeQuery(t.hash(),!0)},o.absoluteTo=function(e){var t,s,n,i=this.clone(),o=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof r||(e=new r(e)),i._parts.protocol)return i;if(i._parts.protocol=e._parts.protocol,this._parts.hostname)return i;for(s=0;n=o[s];s++)i._parts[n]=e._parts[n];return i._parts.path?(".."===i._parts.path.substring(-2)&&(i._parts.path+="/"),"/"!==i.path().charAt(0)&&(t=(t=e.directory())||(0===e.path().indexOf("/")?"/":""),i._parts.path=(t?t+"/":"")+i._parts.path,i.normalizePath())):(i._parts.path=e._parts.path,i._parts.query||(i._parts.query=e._parts.query)),i.build(),i},o.relativeTo=function(e){var t,s,n,i,o,a=this.clone().normalize();if(a._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new r(e).normalize(),t=a._parts,s=e._parts,i=a.path(),o=e.path(),"/"!==i.charAt(0))throw new Error("URI is already relative");if("/"!==o.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===s.protocol&&(t.protocol=null),t.username!==s.username||t.password!==s.password)return a.build();if(null!==t.protocol||null!==t.username||null!==t.password)return a.build();if(t.hostname!==s.hostname||t.port!==s.port)return a.build();if(t.hostname=null,t.port=null,i===o)return t.path="",a.build();if(!(n=r.commonPath(i,o)))return a.build();var c=s.path.substring(n.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=c+t.path.substring(n.length)||"./",a.build()},o.equals=function(e){var t,s,n,i,o,c=this.clone(),l=new r(e),u={};if(c.normalize(),l.normalize(),c.toString()===l.toString())return!0;if(n=c.query(),i=l.query(),c.query(""),l.query(""),c.toString()!==l.toString())return!1;if(n.length!==i.length)return!1;for(o in t=r.parseQuery(n,this._parts.escapeQuerySpace),s=r.parseQuery(i,this._parts.escapeQuerySpace),t)if(a.call(t,o)){if(d(t[o])){if(!m(t[o],s[o]))return!1}else if(t[o]!==s[o])return!1;u[o]=!0}for(o in s)if(a.call(s,o)&&!u[o])return!1;return!0},o.preventInvalidHostname=function(e){return this._parts.preventInvalidHostname=!!e,this},o.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},o.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},r}))},5413:function(e,t,s){var n;e=s.nmd(e),function(i){t&&t.nodeType,e&&e.nodeType;var r="object"==typeof s.g&&s.g;r.global!==r&&r.window!==r&&r.self;var o,a=2147483647,c=36,l=1,d=26,u=38,h=700,m=72,g=128,p="-",f=/^xn--/,v=/[^\x20-\x7E]/,_=/[\x2E\u3002\uFF0E\uFF61]/g,b={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},y=c-l,w=Math.floor,S=String.fromCharCode;function A(e){throw new RangeError(b[e])}function x(e,t){for(var s=e.length,n=[];s--;)n[s]=t(e[s]);return n}function E(e,t){var s=e.split("@"),n="";return s.length>1&&(n=s[0]+"@",e=s[1]),n+x((e=e.replace(_,".")).split("."),t).join(".")}function $(e){for(var t,s,n=[],i=0,r=e.length;i<r;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<r?56320==(64512&(s=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&s)+65536):(n.push(t),i--):n.push(t);return n}function C(e){return x(e,(function(e){var t="";return e>65535&&(t+=S((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=S(e)})).join("")}function k(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function j(e,t,s){var n=0;for(e=s?w(e/h):e>>1,e+=w(e/t);e>y*d>>1;n+=c)e=w(e/y);return w(n+(y+1)*e/(e+u))}function T(e){var t,s,n,i,r,o,u,h,f,v,_,b=[],y=e.length,S=0,x=g,E=m;for((s=e.lastIndexOf(p))<0&&(s=0),n=0;n<s;++n)e.charCodeAt(n)>=128&&A("not-basic"),b.push(e.charCodeAt(n));for(i=s>0?s+1:0;i<y;){for(r=S,o=1,u=c;i>=y&&A("invalid-input"),((h=(_=e.charCodeAt(i++))-48<10?_-22:_-65<26?_-65:_-97<26?_-97:c)>=c||h>w((a-S)/o))&&A("overflow"),S+=h*o,!(h<(f=u<=E?l:u>=E+d?d:u-E));u+=c)o>w(a/(v=c-f))&&A("overflow"),o*=v;E=j(S-r,t=b.length+1,0==r),w(S/t)>a-x&&A("overflow"),x+=w(S/t),S%=t,b.splice(S++,0,x)}return C(b)}function O(e){var t,s,n,i,r,o,u,h,f,v,_,b,y,x,E,C=[];for(b=(e=$(e)).length,t=g,s=0,r=m,o=0;o<b;++o)(_=e[o])<128&&C.push(S(_));for(n=i=C.length,i&&C.push(p);n<b;){for(u=a,o=0;o<b;++o)(_=e[o])>=t&&_<u&&(u=_);for(u-t>w((a-s)/(y=n+1))&&A("overflow"),s+=(u-t)*y,t=u,o=0;o<b;++o)if((_=e[o])<t&&++s>a&&A("overflow"),_==t){for(h=s,f=c;!(h<(v=f<=r?l:f>=r+d?d:f-r));f+=c)E=h-v,x=c-v,C.push(S(k(v+E%x,0))),h=w(E/x);C.push(S(k(h,0))),r=j(s,y,n==i),s=0,++n}++s,++t}return C.join("")}o={version:"1.3.2",ucs2:{decode:$,encode:C},decode:T,encode:O,toASCII:function(e){return E(e,(function(e){return v.test(e)?"xn--"+O(e):e}))},toUnicode:function(e){return E(e,(function(e){return f.test(e)?T(e.slice(4).toLowerCase()):e}))}},void 0===(n=function(){return o}.call(t,s,t,e))||(e.exports=n)}()},3086:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>nU});var n={};s.r(n),s.d(n,{DOMParser:()=>V,WebSocket:()=>W,getDummyXMLDOMDocument:()=>Q});var i={};s.r(i),s.d(i,{addCookies:()=>ue,arrayBufToBase64:()=>ce,base64ToArrayBuf:()=>le,copyElement:()=>xe,createHtml:()=>Ae,default:()=>De,escapeNode:()=>Te,forEachChild:()=>Ce,getBareJidFromJid:()=>Re,getDomainFromJid:()=>Ie,getFirstElementChild:()=>_e,getNodeFromJid:()=>Ne,getParserError:()=>ve,getResourceFromJid:()=>Me,getText:()=>je,handleError:()=>re,isTagEqual:()=>ke,stringToArrayBuf:()=>de,stripWhitespace:()=>pe,toElement:()=>ie,unescapeNode:()=>Oe,utf16to8:()=>oe,validAttribute:()=>we,validCSS:()=>Se,validTag:()=>ye,xmlElement:()=>be,xmlGenerator:()=>me,xmlHtmlNode:()=>fe,xmlTextNode:()=>ge,xmlescape:()=>Ee,xmlunescape:()=>$e,xorArrayBuffers:()=>ae});var r={};s.r(r),s.d(r,{decodeHTMLEntities:()=>xt,isElement:()=>_t,isTagEqual:()=>bt,queryChildren:()=>wt,siblingIndex:()=>St,stringToElement:()=>yt});var o={};s.r(o),s.d(o,{isError:()=>Jd,isFunction:()=>Yd,merge:()=>Kd});var a={};s.r(a),s.d(a,{clearSession:()=>lu,getUnloadEvent:()=>ru,isTestEnv:()=>iu,isUniView:()=>nu,replacePromise:()=>ou,shouldClearCache:()=>au,tearDown:()=>cu});var c={};s.r(c),s.d(c,{ACTIVE:()=>xu,ANONYMOUS:()=>gu,BOSH_WAIT:()=>du,CHATROOMS_TYPE:()=>ju,CHAT_STATES:()=>Ru,CLOSED:()=>pu,COMPOSING:()=>Eu,CONNECTION_STATUS:()=>Nu,CONTROLBOX_TYPE:()=>Ou,CORE_PLUGINS:()=>Iu,EXTERNAL:()=>fu,FAILURE:()=>Su,GONE:()=>Cu,HEADLINES_TYPE:()=>Tu,INACTIVE:()=>Au,KEYCODES:()=>Du,LOGIN:()=>vu,LOGOUT:()=>_u,METADATA_ATTRIBUTES:()=>mu,OPENED:()=>bu,PAUSED:()=>$u,PREBIND:()=>yu,PRIVATE_CHAT_TYPE:()=>ku,STATUS_WEIGHTS:()=>hu,SUCCESS:()=>wu,URL_PARSE_OPTIONS:()=>Mu,VERSION_NAME:()=>uu,XFORM_TYPE_MAP:()=>zu,XFORM_VALIDATE_TYPE_MAP:()=>Lu});var l={};s.r(l),s.d(l,{createStore:()=>Xu,getDefaultStore:()=>Ju,initStorage:()=>Zu});var d={};s.r(d),s.d(d,{getJIDFromURI:()=>rh,isSameBareJID:()=>nh,isSameDomain:()=>ih,isValidJID:()=>th,isValidMUCJID:()=>sh});var u={};s.r(u),s.d(u,{getOpenPromise:()=>hc,waitUntil:()=>bh});var h={};s.r(h),s.d(h,{BadRequestError:()=>Eh,ConflictError:()=>$h,FeatureNotImplementedError:()=>Ch,ForbiddenError:()=>kh,GoneError:()=>jh,InternalServerError:()=>Th,ItemNotFoundError:()=>Oh,JIDMalformedError:()=>Nh,MethodNotImplementedError:()=>wh,NotAcceptableError:()=>Ih,NotAllowedError:()=>Mh,NotAuthorizedError:()=>Rh,PaymentRequiredError:()=>Dh,RecipientUnavailableError:()=>zh,RedirectError:()=>Lh,RegistrationRequiredError:()=>Ph,RemoteServerNotFoundError:()=>Fh,RemoteServerTimeoutError:()=>Uh,ResourceConstraintError:()=>Bh,ServiceUnavailableError:()=>qh,StanzaError:()=>Ah,StanzaParseError:()=>xh,SubscriptionRequiredError:()=>Hh,TimeoutError:()=>Sh,UndefinedConditionError:()=>Gh,UnexpectedRequestError:()=>Wh});var m={};s.r(m),s.d(m,{getAttributes:()=>fm,isErrorStanza:()=>mm,isForbiddenError:()=>gm,isServiceUnavailableError:()=>pm,toStanza:()=>vt});var g={};s.r(g),s.d(g,{unique:()=>zp});var p={};s.r(p),s.d(p,{appendArrayBuffer:()=>Lp,arrayBufferToBase64:()=>Bp,arrayBufferToHex:()=>Pp,arrayBufferToString:()=>Fp,base64ToArrayBuffer:()=>qp,hexToArrayBuffer:()=>Hp,stringToArrayBuffer:()=>Up});var f={};s.r(f),s.d(f,{colorize:()=>Vp});var v={};s.r(v),s.d(v,{getCurrentWord:()=>Xp,getSelectValues:()=>Jp,isMentionBoundary:()=>Zp,placeCaretAtEnd:()=>tf,replaceCurrentWord:()=>ef,webForm2xForm:()=>Yp});var _={};s.r(_),s.d(_,{firstCharToUpperCase:()=>sf,getLongestSubstring:()=>nf,isString:()=>rf});var b={};s.r(b),s.d(b,{checkFileTypes:()=>lf,filterQueryParamsFromURL:()=>df,getMediaURLs:()=>_f,getMediaURLsMetadata:()=>vf,getURI:()=>cf,isAudioURL:()=>mf,isEncryptedFileURL:()=>ff,isGIFURL:()=>hf,isImageURL:()=>pf,isURLWithImageExtension:()=>uf,isValidURL:()=>af,isVideoURL:()=>gf});var y={};s.r(y),s.d(y,{ACTION_INFO_CODES:()=>Tv,ADMIN_COMMANDS:()=>Nv,AFFILIATIONS:()=>Iv,AFFILIATION_CHANGES:()=>Uv,AFFILIATION_CHANGES_LIST:()=>Bv,DISCONNECT_CODES:()=>Mv,INFO_CODES:()=>Vv,MODERATOR_COMMANDS:()=>Rv,MUC_NICK_CHANGED_CODE:()=>Jv,MUC_ROLE_CHANGES:()=>Gv,MUC_ROLE_CHANGES_LIST:()=>Wv,MUC_ROLE_WEIGHTS:()=>Fv,MUC_TRAFFIC_STATES:()=>qv,MUC_TRAFFIC_STATES_LIST:()=>Hv,NEW_NICK_CODES:()=>Ov,OWNER_COMMANDS:()=>Dv,ROLES:()=>zv,ROOMSTATUS:()=>Qv,ROOM_FEATURES:()=>Kv,STATUS_CODE_STANZAS:()=>Pv,VISITOR_COMMANDS:()=>Lv});var w={};s.r(w),s.d(w,{afterMain:()=>gA,afterRead:()=>uA,afterWrite:()=>vA,applyStyles:()=>xA,arrow:()=>HA,auto:()=>ZS,basePlacements:()=>eA,beforeMain:()=>hA,beforeRead:()=>lA,beforeWrite:()=>pA,bottom:()=>JS,clippingParents:()=>nA,computeStyles:()=>QA,createPopper:()=>xx,createPopperBase:()=>Ax,createPopperLite:()=>Ex,detectOverflow:()=>dx,end:()=>sA,eventListeners:()=>JA,flip:()=>ux,hide:()=>gx,left:()=>XS,main:()=>mA,modifierPhases:()=>_A,offset:()=>px,placements:()=>cA,popper:()=>rA,popperGenerator:()=>Sx,popperOffsets:()=>fx,preventOverflow:()=>vx,read:()=>dA,reference:()=>oA,right:()=>YS,start:()=>tA,top:()=>KS,variationPlacements:()=>aA,viewport:()=>iA,write:()=>fA});var S=s(5072),A=s.n(S),x=s(7825),E=s.n(x),$=s(7659),C=s.n($),k=s(5056),j=s.n(k),T=s(540),O=s.n(T),N=s(1113),I=s.n(N),M=s(845),R={};R.styleTagTransform=I(),R.setAttributes=j(),R.insert=C().bind(null,"head"),R.domAPI=E(),R.insertStyleElement=O();A()(M.A,R);M.A&&M.A.locals&&M.A.locals;var D=s(1615),z=s.n(D),L=s(5569),P=s.n(L),F=s(9807),U=s.n(F),B=s(4360),q=s.n(B),H=s(8870),G=s.n(H);const W=window.WebSocket,V=window.DOMParser;function Q(){return document.implementation.createDocument("jabber:client","strophe",null)}const K={HTTPBIND:"http://jabber.org/protocol/httpbind",BOSH:"urn:xmpp:xbosh",CLIENT:"jabber:client",SERVER:"jabber:server",AUTH:"jabber:iq:auth",ROSTER:"jabber:iq:roster",PROFILE:"jabber:iq:profile",DISCO_INFO:"http://jabber.org/protocol/disco#info",DISCO_ITEMS:"http://jabber.org/protocol/disco#items",MUC:"http://jabber.org/protocol/muc",SASL:"urn:ietf:params:xml:ns:xmpp-sasl",STREAM:"http://etherx.jabber.org/streams",FRAMING:"urn:ietf:params:xml:ns:xmpp-framing",BIND:"urn:ietf:params:xml:ns:xmpp-bind",SESSION:"urn:ietf:params:xml:ns:xmpp-session",VERSION:"jabber:iq:version",STANZAS:"urn:ietf:params:xml:ns:xmpp-stanzas",XHTML_IM:"http://jabber.org/protocol/xhtml-im",XHTML:"http://www.w3.org/1999/xhtml"},J="http://www.w3.org/1999/xhtml",Y={tags:["a","blockquote","br","cite","em","img","li","ol","p","span","strong","ul","body"],attributes:{a:["href"],blockquote:["style"],br:[],cite:["style"],em:[],img:["src","alt","style","height","width"],li:["style"],ol:["style"],p:["style"],span:["style"],strong:[],ul:["style"],body:[]},css:["background-color","color","font-family","font-size","font-style","font-weight","margin-left","margin-right","text-align","text-decoration"]},X={ERROR:0,CONNECTING:1,CONNFAIL:2,AUTHENTICATING:3,AUTHFAIL:4,CONNECTED:5,DISCONNECTED:6,DISCONNECTING:7,ATTACHED:8,REDIRECT:9,CONNTIMEOUT:10,BINDREQUIRED:11,ATTACHFAIL:12,RECONNECTING:13},Z={BAD_FORMAT:"bad-format",CONFLICT:"conflict",MISSING_JID_NODE:"x-strophe-bad-non-anon-jid",NO_AUTH_MECH:"no-auth-mech",UNKNOWN_REASON:"unknown"},ee={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},te={NORMAL:1,TEXT:3,CDATA:4,FRAGMENT:11};let se=ee.DEBUG;const ne={setLogLevel(e){if(e<ee.DEBUG||e>ee.FATAL)throw new Error("Invalid log level supplied to setLogLevel");se=e},log(e,t){e<se||(e>=ee.ERROR?console?.error(t):e===ee.INFO?console?.info(t):e===ee.WARN?console?.warn(t):e===ee.DEBUG&&console?.debug(t))},debug(e){this.log(ee.DEBUG,e)},info(e){this.log(ee.INFO,e)},warn(e){this.log(ee.WARN,e)},error(e){this.log(ee.ERROR,e)},fatal(e){this.log(ee.FATAL,e)}};function ie(e,t){const s=fe(e),n=ve(s);if(n)throw new Error(`Parser Error: ${n}`);const i=_e(s);if(["message","iq","presence"].includes(i.nodeName.toLowerCase())&&"jabber:client"!==i.namespaceURI&&"jabber:server"!==i.namespaceURI){const e=`Invalid namespaceURI ${i.namespaceURI}`;if(t)throw new Error(e);ne.error(e)}return i}function re(e){void 0!==e.stack&&ne.fatal(e.stack),ne.fatal("error: "+e.message)}function oe(e){let t="";const s=e.length;for(let n=0;n<s;n++){const s=e.charCodeAt(n);s>=0&&s<=127?t+=e.charAt(n):s>2047?(t+=String.fromCharCode(224|s>>12&15),t+=String.fromCharCode(128|s>>6&63),t+=String.fromCharCode(128|63&s)):(t+=String.fromCharCode(192|s>>6&31),t+=String.fromCharCode(128|63&s))}return t}function ae(e,t){const s=new Uint8Array(e),n=new Uint8Array(t),i=new Uint8Array(e.byteLength);for(let t=0;t<e.byteLength;t++)i[t]=s[t]^n[t];return i.buffer}function ce(e){let t="";const s=new Uint8Array(e),n=s.byteLength;for(let e=0;e<n;e++)t+=String.fromCharCode(s[e]);return btoa(t)}function le(e){return Uint8Array.from(atob(e),(e=>e.charCodeAt(0)))?.buffer}function de(e){return(new TextEncoder).encode(e).buffer}function ue(e){"undefined"==typeof document&&ne.error("addCookies: not adding any cookies, since there's no document object"),e=e||{};for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){let s="",n="",i="";const r=e[t],o="object"==typeof r,a=escape(unescape(o?r.value:r));o&&(s=r.expires?";expires="+r.expires:"",n=r.domain?";domain="+r.domain:"",i=r.path?";path="+r.path:""),document.cookie=t+"="+a+s+n+i}}let he=null;function me(){return he||(he=Q()),he}function ge(e){return me().createTextNode(e)}function pe(e){const t=Array.from(e.childNodes);return 1===t.length&&t[0].nodeType===te.TEXT||t.forEach((t=>{"body"!==t.nodeName.toLowerCase()&&(t.nodeType!==te.TEXT||/\S/.test(t.nodeValue)?t.nodeType===te.NORMAL&&pe(t):e.removeChild(t))})),e}function fe(e){return(new V).parseFromString(e,"text/xml")}function ve(e){const t="parsererror"===e.firstElementChild?.nodeName?e.firstElementChild:e.getElementsByTagNameNS(J,"parsererror")[0];return"parsererror"===t?.nodeName?t?.textContent:null}function _e(e){if(e.firstElementChild)return e.firstElementChild;let t,s=0;const n=e.childNodes;for(;t=n[s++];)if(1===t.nodeType)return t;return null}function be(e,t,s){if(!e)return null;const n=me().createElement(e);if(!s||"string"!=typeof s&&"number"!=typeof s){if("string"==typeof t||"number"==typeof t)return n.appendChild(ge(t.toString())),n}else n.appendChild(ge(s.toString()));if(!t)return n;if(Array.isArray(t))for(const e of t)Array.isArray(e)&&null!=e[0]&&null!=e[1]&&n.setAttribute(e[0],e[1]);else if("object"==typeof t)for(const e of Object.keys(t))e&&null!=t[e]&&n.setAttribute(e,t[e].toString());return n}function ye(e){for(let t=0;t<Y.tags.length;t++)if(e===Y.tags[t])return!0;return!1}function we(e,t){const s=Y.attributes[e];if(s?.length>0)for(let e=0;e<s.length;e++)if(t===s[e])return!0;return!1}function Se(e){for(let t=0;t<Y.css.length;t++)if(e===Y.css[t])return!0;return!1}function Ae(e){if(e.nodeType===te.NORMAL)return function(e){let t;const s=e.nodeName.toLowerCase();if(ye(s))try{if(t=be(s),s in Y.attributes){const n=Y.attributes[s];for(let s=0;s<n.length;s++){const i=n[s];let r=e.getAttribute(i);if(null!=r&&""!==r)if("style"===i&&"object"==typeof r&&(r=r.cssText??r),"style"===i){const e=[],s=r.split(";");for(let t=0;t<s.length;t++){const n=s[t].split(":"),i=n[0].replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();if(Se(i)){const t=n[1].replace(/^\s*/,"").replace(/\s*$/,"");e.push(i+": "+t)}}e.length>0&&(r=e.join("; "),t.setAttribute(i,r))}else t.setAttribute(i,r)}for(let s=0;s<e.childNodes.length;s++)t.appendChild(Ae(e.childNodes[s]))}}catch(e){t=ge("")}else{t=me().createDocumentFragment();for(let s=0;s<e.childNodes.length;s++)t.appendChild(Ae(e.childNodes[s]))}return t}(e);if(e.nodeType===te.FRAGMENT){const t=me().createDocumentFragment();for(let s=0;s<e.childNodes.length;s++)t.appendChild(Ae(e.childNodes[s]));return t}return e.nodeType===te.TEXT?ge(e.nodeValue):void 0}function xe(e){let t;if(e.nodeType===te.NORMAL){const s=e;t=be(s.tagName);for(let e=0;e<s.attributes.length;e++)t.setAttribute(s.attributes[e].nodeName,s.attributes[e].value);for(let e=0;e<s.childNodes.length;e++)t.appendChild(xe(s.childNodes[e]))}else e.nodeType===te.TEXT&&(t=me().createTextNode(e.nodeValue));return t}function Ee(e){return e=(e=(e=(e=(e=e.replace(/\&/g,"&amp;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;")).replace(/'/g,"&apos;")).replace(/"/g,"&quot;")}function $e(e){return e=(e=(e=(e=(e=e.replace(/\&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&apos;/g,"'")).replace(/&quot;/g,'"')}function Ce(e,t,s){for(let n=0;n<e.childNodes.length;n++){const i=e.childNodes[n];i.nodeType!==te.NORMAL||t&&!this.isTagEqual(i,t)||s(i)}}function ke(e,t){return e.tagName===t}function je(e){if(!e)return null;let t="";e.childNodes.length||e.nodeType!==te.TEXT||(t+=e.nodeValue);for(const s of e.childNodes)s.nodeType===te.TEXT&&(t+=s.nodeValue);return Ee(t)}function Te(e){return"string"!=typeof e?e:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/\"/g,"\\22").replace(/\&/g,"\\26").replace(/\'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")}function Oe(e){return"string"!=typeof e?e:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")}function Ne(e){return e.indexOf("@")<0?null:e.split("@")[0]}function Ie(e){const t=Re(e);if(t.indexOf("@")<0)return t;{const e=t.split("@");return e.splice(0,1),e.join("@")}}function Me(e){if(!e)return null;const t=e.split("/");return t.length<2?null:(t.splice(0,1),t.join("/"))}function Re(e){return e?e.split("/")[0]:null}const De={utf16to8:oe,xorArrayBuffers:ae,arrayBufToBase64:ce,base64ToArrayBuf:le,stringToArrayBuf:de,addCookies:ue};function ze(e,t){return new Ue(e,t)}function Le(e){return new Ue("message",e)}function Pe(e){return new Ue("iq",e)}function Fe(e){return new Ue("presence",e)}class Ue{#e;#t;#s;#n;constructor(e,t){"presence"!==e&&"message"!==e&&"iq"!==e||(t&&!t.xmlns?t.xmlns=K.CLIENT:t||(t={xmlns:K.CLIENT})),this.#s=e,this.#n=t}static fromString(e){const t=ie(e,!0),s=new Ue("");return s.#e=t,s}buildTree(){return be(this.#s,this.#n)}get nodeTree(){return this.#e||(this.#e=this.buildTree()),this.#e}get node(){return this.#t||(this.#t=this.tree()),this.#t}set node(e){this.#t=e}static serialize(e){if(!e)return null;const t=e instanceof Ue?e.tree():e,s=[...Array(t.attributes.length).keys()].map((e=>t.attributes[e].nodeName));s.sort();let n=s.reduce(((e,s)=>`${e} ${s}="${Ee(t.attributes.getNamedItem(s).value)}"`),`<${t.nodeName}`);if(t.childNodes.length>0){n+=">";for(let e=0;e<t.childNodes.length;e++){const s=t.childNodes[e];switch(s.nodeType){case te.NORMAL:n+=Ue.serialize(s);break;case te.TEXT:n+=Ee(s.nodeValue);break;case te.CDATA:n+="<![CDATA["+s.nodeValue+"]]>"}}n+="</"+t.nodeName+">"}else n+="/>";return n}tree(){return this.nodeTree}toString(){return Ue.serialize(this.tree())}up(){return this.node=this.node.parentElement?this.node.parentElement:this.node.parentNode,this}root(){return this.node=this.tree(),this}attrs(e){for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(null!=e[t]?this.node.setAttribute(t,e[t].toString()):this.node.removeAttribute(t));return this}c(e,t,s){const n=be(e,t,s);return this.node.appendChild(n),"string"!=typeof s&&"number"!=typeof s&&(this.node=n),this}cnode(e){let t;e instanceof Ue&&(e=e.tree());const s=me();try{t=void 0!==s.importNode}catch(e){t=!1}const n=t?s.importNode(e,!0):xe(e);return this.node.appendChild(n),this.node=n,this}t(e){const t=ge(e);return this.node.appendChild(t),this}h(e){const t=me().createElement("body");t.innerHTML=e;const s=Ae(t);for(;s.childNodes.length>0;)this.node.appendChild(s.childNodes[0]);return this}}const Be=Ue;let qe=0;const He=class{constructor(e,t,s,n=0){this.id=++qe,this.xmlData=e,this.data=Be.serialize(e),this.origFunc=t,this.func=t,this.rid=s,this.date=NaN,this.sends=n,this.abort=!1,this.dead=null,this.age=()=>this.date?((new Date).valueOf()-this.date.valueOf())/1e3:0,this.timeDead=()=>this.dead?((new Date).valueOf()-this.dead.valueOf())/1e3:0,this.xhr=this._newXHR()}getResponse(){const e=this.xhr.responseXML?.documentElement;if(e){if("parsererror"===e.tagName)throw ne.error("invalid response received"),ne.error("responseText: "+this.xhr.responseText),ne.error("responseXML: "+Be.serialize(e)),new Error("parsererror")}else if(this.xhr.responseText){ne.debug("Got responseText but no responseXML; attempting to parse it with DOMParser...");const e=fe(this.xhr.responseText),t=ve(e);if(!e||t){t&&(ne.error("invalid response received: "+t),ne.error("responseText: "+this.xhr.responseText));const e=new Error;throw e.name=Z.BAD_FORMAT,e}}return e}_newXHR(){const e=new XMLHttpRequest;return e.overrideMimeType&&e.overrideMimeType("text/xml; charset=utf-8"),e.onreadystatechange=this.func.bind(null,this),e}};let Ge=1.1,We=.1;class Ve{constructor(e){this._conn=e,this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.hold=1,this.wait=60,this.window=5,this.errors=0,this.inactivity=null,this.strip=Ve.prototype.strip??!1,this.lastResponseHeaders=null,this._requests=[]}static setTimeoutMultiplier(e){Ge=e}static getTimeoutMultplier(){return Ge}static setSecondaryTimeoutMultiplier(e){We=e}static getSecondaryTimeoutMultplier(){return We}_buildBody(){const e=ze("body",{rid:this.rid++,xmlns:K.HTTPBIND});return null!==this.sid&&e.attrs({sid:this.sid}),this._conn.options.keepalive&&this._conn._sessionCachingSupported()&&this._cacheSession(),e}_reset(){this.rid=Math.floor(4294967295*Math.random()),this.sid=null,this.errors=0,this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_connect(e,t,s){this.wait=e||this.wait,this.hold=t||this.hold,this.errors=0;const n=this._buildBody().attrs({to:this._conn.domain,"xml:lang":"en",wait:this.wait,hold:this.hold,content:"text/xml; charset=utf-8",ver:"1.6","xmpp:version":"1.0","xmlns:xmpp":K.BOSH});s&&n.attrs({route:s});const i=this._conn._connect_cb;this._requests.push(new He(n.tree(),this._onRequestStateChange.bind(this,i.bind(this._conn)),Number(n.tree().getAttribute("rid")))),this._throttledRequestHandler()}_attach(e,t,s,n,i,r,o){this._conn.jid=e,this.sid=t,this.rid=s,this._conn.connect_callback=n,this._conn.domain=Ie(this._conn.jid),this._conn.authenticated=!0,this._conn.connected=!0,this.wait=i||this.wait,this.hold=r||this.hold,this.window=o||this.window,this._conn._changeConnectStatus(X.ATTACHED,null)}_restore(e,t,s,n,i){const r=JSON.parse(sessionStorage.getItem("strophe-bosh-session"));if(!(null!=r&&r.rid&&r.sid&&r.jid&&(null==e||Re(r.jid)===Re(e)||null===Ne(e)&&Ie(r.jid)===e))){const e=new Error("_restore: no restoreable session.");throw e.name="StropheSessionError",e}this._conn.restored=!0,this._attach(r.jid,r.sid,r.rid,t,s,n,i)}_cacheSession(){this._conn.authenticated?this._conn.jid&&this.rid&&this.sid&&sessionStorage.setItem("strophe-bosh-session",JSON.stringify({jid:this._conn.jid,rid:this.rid,sid:this.sid})):sessionStorage.removeItem("strophe-bosh-session")}_connect_cb(e){const t=e.getAttribute("type");if(null!==t&&"terminate"===t){let t=e.getAttribute("condition");ne.error("BOSH-Connection failed: "+t);const s=e.getElementsByTagName("conflict");return null!==t?("remote-stream-error"===t&&s.length>0&&(t="conflict"),this._conn._changeConnectStatus(X.CONNFAIL,t)):this._conn._changeConnectStatus(X.CONNFAIL,"unknown"),this._conn._doDisconnect(t),X.CONNFAIL}this.sid||(this.sid=e.getAttribute("sid"));const s=e.getAttribute("requests");s&&(this.window=parseInt(s,10));const n=e.getAttribute("hold");n&&(this.hold=parseInt(n,10));const i=e.getAttribute("wait");i&&(this.wait=parseInt(i,10));const r=e.getAttribute("inactivity");r&&(this.inactivity=parseInt(r,10))}_disconnect(e){this._sendTerminate(e)}_doDisconnect(){this.sid=null,this.rid=Math.floor(4294967295*Math.random()),this._conn._sessionCachingSupported()&&sessionStorage.removeItem("strophe-bosh-session"),this._conn.nextValidRid(this.rid)}_emptyQueue(){return 0===this._requests.length}_callProtocolErrorHandlers(e){const t=Ve._getRequestStatus(e),s=this._conn.protocolErrorHandlers.HTTP[t];s&&s.call(this,t)}_hitError(e){this.errors++,ne.warn("request errored, status: "+e+", number of errors: "+this.errors),this.errors>4&&this._conn._onDisconnectTimeout()}_no_auth_received(e){ne.warn("Server did not yet offer a supported authentication mechanism. Sending a blank poll request."),e=e?e.bind(this._conn):this._conn._connect_cb.bind(this._conn);const t=this._buildBody();this._requests.push(new He(t.tree(),this._onRequestStateChange.bind(this,e),Number(t.tree().getAttribute("rid")))),this._throttledRequestHandler()}_onDisconnectTimeout(){this._abortAllRequests()}_abortAllRequests(){for(;this._requests.length>0;){const e=this._requests.pop();e.abort=!0,e.xhr.abort(),e.xhr.onreadystatechange=function(){}}}_onIdle(){const e=this._conn._data;if(this._conn.authenticated&&0===this._requests.length&&0===e.length&&!this._conn.disconnecting&&(ne.debug("no requests during idle cycle, sending blank request"),e.push(null)),!this._conn.paused){if(this._requests.length<2&&e.length>0){const t=this._buildBody();for(let s=0;s<e.length;s++)null!==e[s]&&("restart"===e[s]?t.attrs({to:this._conn.domain,"xml:lang":"en","xmpp:restart":"true","xmlns:xmpp":K.BOSH}):t.cnode(e[s]).up());delete this._conn._data,this._conn._data=[],this._requests.push(new He(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Number(t.tree().getAttribute("rid")))),this._throttledRequestHandler()}if(this._requests.length>0){const e=this._requests[0].age();null!==this._requests[0].dead&&this._requests[0].timeDead()>Math.floor(Ge*this.wait)&&this._throttledRequestHandler(),e>Math.floor(Ge*this.wait)&&(ne.warn("Request "+this._requests[0].id+" timed out, over "+Math.floor(Ge*this.wait)+" seconds since last activity"),this._throttledRequestHandler())}}}static _getRequestStatus(e,t){let s;if(4===e.xhr.readyState)try{s=e.xhr.status}catch(e){ne.error(`Caught an error while retrieving a request's status, reqStatus: ${s}, message: ${e.message}`)}return void 0===s&&(s="number"==typeof t?t:0),s}_onRequestStateChange(e,t){if(ne.debug("request id "+t.id+"."+t.sends+" state changed to "+t.xhr.readyState),t.abort)return void(t.abort=!1);if(4!==t.xhr.readyState)return;const s=Ve._getRequestStatus(t);if(this.lastResponseHeaders=t.xhr.getAllResponseHeaders(),this._conn.disconnecting&&s>=400)return this._hitError(s),void this._callProtocolErrorHandlers(t);const n=this._requests[0]===t,i=this._requests[1]===t,r=s>0&&s<500,o=t.sends>this._conn.maxRetries;(r||o)&&(this._removeRequest(t),ne.debug("request id "+t.id+" should now be removed")),200===s?((i||n&&this._requests.length>0&&this._requests[0].age()>Math.floor(Ge*this.wait))&&this._restartRequest(0),this._conn.nextValidRid(t.rid+1),ne.debug("request id "+t.id+"."+t.sends+" got 200"),e(t),this.errors=0):0===s||s>=400&&s<600||s>=12e3?(ne.error("request id "+t.id+"."+t.sends+" error "+s+" happened"),this._hitError(s),this._callProtocolErrorHandlers(t),s>=400&&s<500&&(this._conn._changeConnectStatus(X.DISCONNECTING,null),this._conn._doDisconnect())):ne.error("request id "+t.id+"."+t.sends+" error "+s+" happened"),r||o?o&&!this._conn.connected&&this._conn._changeConnectStatus(X.CONNFAIL,"giving-up"):this._throttledRequestHandler()}_processRequest(e){let t=this._requests[e];const s=Ve._getRequestStatus(t,-1);if(t.sends>this._conn.maxRetries)return void this._conn._onDisconnectTimeout();const n=t.age(),i=!isNaN(n)&&n>Math.floor(Ge*this.wait),r=null!==t.dead&&t.timeDead()>Math.floor(We*this.wait),o=4===t.xhr.readyState&&(s<1||s>=500);if((i||r||o)&&(r&&ne.error(`Request ${this._requests[e].id} timed out (secondary), restarting`),t.abort=!0,t.xhr.abort(),t.xhr.onreadystatechange=function(){},this._requests[e]=new He(t.xmlData,t.origFunc,t.rid,t.sends),t=this._requests[e]),0===t.xhr.readyState){ne.debug("request id "+t.id+"."+t.sends+" posting");try{const e=this._conn.options.contentType||"text/xml; charset=utf-8";t.xhr.open("POST",this._conn.service,!this._conn.options.sync),void 0!==t.xhr.setRequestHeader&&t.xhr.setRequestHeader("Content-Type",e),this._conn.options.withCredentials&&(t.xhr.withCredentials=!0)}catch(e){return ne.error("XHR open failed: "+e.toString()),this._conn.connected||this._conn._changeConnectStatus(X.CONNFAIL,"bad-service"),void this._conn.disconnect()}const e=()=>{if(t.date=(new Date).valueOf(),this._conn.options.customHeaders){const e=this._conn.options.customHeaders;for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.xhr.setRequestHeader(s,e[s])}t.xhr.send(t.data)};if(t.sends>1){const s=1e3*Math.min(Math.floor(Ge*this.wait),Math.pow(t.sends,3));setTimeout((function(){e()}),s)}else e();t.sends++,this.strip&&"body"===t.xmlData.nodeName&&t.xmlData.childNodes.length?this._conn.xmlOutput?.(t.xmlData.children[0]):this._conn.xmlOutput?.(t.xmlData),this._conn.rawOutput?.(t.data)}else ne.debug("_processRequest: "+(0===e?"first":"second")+" request has readyState of "+t.xhr.readyState)}_removeRequest(e){ne.debug("removing request");for(let t=this._requests.length-1;t>=0;t--)e===this._requests[t]&&this._requests.splice(t,1);e.xhr.onreadystatechange=function(){},this._throttledRequestHandler()}_restartRequest(e){const t=this._requests[e];null===t.dead&&(t.dead=new Date),this._processRequest(e)}_reqToData(e){try{return e.getResponse()}catch(e){if("parsererror"!==e.message)throw e;this._conn.disconnect("strophe-parsererror")}}_sendTerminate(e){ne.debug("_sendTerminate was called");const t=this._buildBody().attrs({type:"terminate"}),s=e instanceof Be?e.tree():e;e&&t.cnode(s);const n=new He(t.tree(),this._onRequestStateChange.bind(this,this._conn._dataRecv.bind(this._conn)),Number(t.tree().getAttribute("rid")));this._requests.push(n),this._throttledRequestHandler()}_send(){clearTimeout(this._conn._idleTimeout),this._throttledRequestHandler(),this._conn._idleTimeout=setTimeout((()=>this._conn._onIdle()),100)}_sendRestart(){this._throttledRequestHandler(),clearTimeout(this._conn._idleTimeout)}_throttledRequestHandler(){this._requests?ne.debug("_throttledRequestHandler called with "+this._requests.length+" requests"):ne.debug("_throttledRequestHandler called with undefined requests"),this._requests&&0!==this._requests.length&&(this._requests.length>0&&this._processRequest(0),this._requests.length>1&&Math.abs(this._requests[0].rid-this._requests[1].rid)<this.window&&this._processRequest(1))}}const Qe=Ve;const Ke=class{constructor(e,t,s,n,i,r,o){this.handler=e,this.ns=t,this.name=s,this.type=n,this.id=i,this.options=o||{matchBareFromJid:!1,ignoreNamespaceFragment:!1},this.options.matchBareFromJid?this.from=r?Re(r):null:this.from=r,this.user=!0}getNamespace(e){let t=e.getAttribute("xmlns");return t&&this.options.ignoreNamespaceFragment&&(t=t.split("#")[0]),t}namespaceMatch(e){if(!this.ns||this.getNamespace(e)===this.ns)return!0;for(const t of e.children??[]){if(this.getNamespace(t)===this.ns)return!0;if(this.namespaceMatch(t))return!0}return!1}isMatch(e){let t=e.getAttribute("from");this.options.matchBareFromJid&&(t=Re(t));const s=e.getAttribute("type");return!(!this.namespaceMatch(e)||this.name&&!ke(e,this.name)||this.type&&(Array.isArray(this.type)?-1===this.type.indexOf(s):s!==this.type)||this.id&&e.getAttribute("id")!==this.id||this.from&&t!==this.from)}run(e){let t=null;try{t=this.handler(e)}catch(e){throw re(e),e}return t}toString(){return"{Handler: "+this.handler+"("+this.name+","+this.id+","+this.ns+")}"}};const Je=class{constructor(e,t){this.period=e,this.handler=t,this.lastCalled=(new Date).getTime(),this.user=!0}run(){return this.lastCalled=(new Date).getTime(),this.handler()}reset(){this.lastCalled=(new Date).getTime()}toString(){return"{TimedHandler: "+this.handler+"("+this.period+")}"}};const Ye=class{constructor(e,t,s){this.mechname=e,this.isClientFirst=t,this.priority=s}test(e){return!0}onStart(e){this._connection=e}onChallenge(e,t){throw new Error("You should implement challenge handling!")}clientChallenge(e){if(!this.isClientFirst)throw new Error("clientChallenge should not be called if isClientFirst is false!");return this.onChallenge(e)}onFailure(){this._connection=null}onSuccess(){this._connection=null}};const Xe=class extends Ye{constructor(e="ANONYMOUS",t=!1,s=20){super(e,t,s)}test(e){return null===e.authcid}};const Ze=class extends Ye{constructor(e="EXTERNAL",t=!0,s=10){super(e,t,s)}onChallenge(e){return e.authcid===e.authzid?"":e.authzid}};const et=class extends Ye{constructor(e="OAUTHBEARER",t=!0,s=40){super(e,t,s)}test(e){return null!==e.pass}onChallenge(e){let t="n,";return null!==e.authcid&&(t=t+"a="+e.authzid),t+=",",t+="",t+="auth=Bearer ",t+=e.pass,t+="",t+="",De.utf16to8(t)}};const tt=class extends Ye{constructor(e="PLAIN",t=!0,s=50){super(e,t,s)}test(e){return null!==e.authcid}onChallenge(e){const{authcid:t,authzid:s,domain:n,pass:i}=e;if(!n)throw new Error("SASLPlain onChallenge: domain is not defined!");let r=s!==`${t}@${n}`?s:"";return r+="\0",r+=t,r+="\0",r+=i,De.utf16to8(r)}};const st={async scramResponse(e,t,s,n){const i=e._sasl_data.cnonce,r=function(e){let t,s,n;const i=/([a-z]+)=([^,]+)(,|$)/;for(;e.match(i);){const r=e.match(i);switch(e=e.replace(r[0],""),r[1]){case"r":t=r[2];break;case"s":s=De.base64ToArrayBuf(r[2]);break;case"i":n=parseInt(r[2],10);break;case"m":return}}if(isNaN(n)||n<4096)ne.warn("Failing SCRAM authentication because server supplied iteration count < 4096.");else{if(s)return{nonce:t,salt:s,iter:n};ne.warn("Failing SCRAM authentication because server supplied incorrect salt.")}}(t);if(!r&&r?.nonce.slice(0,i.length)!==i)return ne.warn("Failing SCRAM authentication because server supplied incorrect nonce."),e._sasl_data={},e._sasl_failure_cb();let o,a;const{pass:c}=e;if("string"==typeof e.pass||e.pass instanceof String){const e=await async function(e,t,s,n,i){const r=await crypto.subtle.deriveBits({name:"PBKDF2",salt:t,iterations:s,hash:{name:n}},await crypto.subtle.importKey("raw",De.stringToArrayBuf(e),"PBKDF2",!1,["deriveBits"]),i),o=await crypto.subtle.importKey("raw",r,{name:"HMAC",hash:n},!1,["sign"]);return{ck:await crypto.subtle.sign("HMAC",o,De.stringToArrayBuf("Client Key")),sk:await crypto.subtle.sign("HMAC",o,De.stringToArrayBuf("Server Key"))}}(c,r.salt,r.iter,s,n);o=e.ck,a=e.sk}else{if(c?.name!==s||c?.salt!==De.arrayBufToBase64(r.salt)||c?.iter!==r.iter)return e._sasl_failure_cb();{const{ck:e,sk:t}=c;o=De.base64ToArrayBuf(e),a=De.base64ToArrayBuf(t)}}const l=e._sasl_data["client-first-message-bare"],d=t,u=`c=biws,r=${r.nonce}`,h=`${l},${d},${u}`,m=await async function(e,t,s){const n=await crypto.subtle.importKey("raw",await crypto.subtle.digest(s,t),{name:"HMAC",hash:s},!1,["sign"]),i=await crypto.subtle.sign("HMAC",n,De.stringToArrayBuf(e));return De.xorArrayBuffers(t,i)}(h,o,s),g=await async function(e,t,s){const n=await crypto.subtle.importKey("raw",t,{name:"HMAC",hash:s},!1,["sign"]);return crypto.subtle.sign("HMAC",n,De.stringToArrayBuf(e))}(h,a,s);return e._sasl_data["server-signature"]=De.arrayBufToBase64(g),e._sasl_data.keys={name:s,iter:r.iter,salt:De.arrayBufToBase64(r.salt),ck:De.arrayBufToBase64(o),sk:De.arrayBufToBase64(a)},`${u},p=${De.arrayBufToBase64(m)}`},clientChallenge(e,t){const s=t||function(){const e=new Uint8Array(16);return De.arrayBufToBase64(crypto.getRandomValues(e).buffer)}(),n=`n=${e.authcid},r=${s}`;return e._sasl_data.cnonce=s,e._sasl_data["client-first-message-bare"]=n,`n,,${n}`}};const nt=class extends Ye{constructor(e="SCRAM-SHA-1",t=!0,s=60){super(e,t,s)}test(e){return null!==e.authcid}async onChallenge(e,t){return await st.scramResponse(e,t,"SHA-1",160)}clientChallenge(e,t){return st.clientChallenge(e,t)}};const it=class extends Ye{constructor(e="SCRAM-SHA-256",t=!0,s=70){super(e,t,s)}test(e){return null!==e.authcid}async onChallenge(e,t){return await st.scramResponse(e,t,"SHA-256",256)}clientChallenge(e,t){return st.clientChallenge(e,t)}};const rt=class extends Ye{constructor(e="SCRAM-SHA-384",t=!0,s=71){super(e,t,s)}test(e){return null!==e.authcid}async onChallenge(e,t){return await st.scramResponse(e,t,"SHA-384",384)}clientChallenge(e,t){return st.clientChallenge(e,t)}};const ot=class extends Ye{constructor(e="SCRAM-SHA-512",t=!0,s=72){super(e,t,s)}test(e){return null!==e.authcid}async onChallenge(e,t){return await st.scramResponse(e,t,"SHA-512",512)}clientChallenge(e,t){return st.clientChallenge(e,t)}};const at=class extends Ye{constructor(e="X-OAUTH2",t=!0,s=30){super(e,t,s)}test(e){return null!==e.pass}onChallenge(e){let t="\0";return null!==e.authcid&&(t+=e.authzid),t+="\0",t+=e.pass,De.utf16to8(t)}};class ct extends Error{constructor(e){super(e),this.name="StropheSessionError"}}const lt=class{constructor(e){this._conn=e,this.strip="wrapper";const t=e.service;if(0!==t.indexOf("ws:")&&0!==t.indexOf("wss:")){let s="";"ws"===e.options.protocol&&"https:"!==location.protocol?s+="ws":s+="wss",s+="://"+location.host,0!==t.indexOf("/")?s+=location.pathname+t:s+=t,e.service=s}}_buildStream(){return ze("open",{xmlns:K.FRAMING,to:this._conn.domain,version:"1.0"})}_checkStreamError(e,t){let s;if(s=e.getElementsByTagNameNS?e.getElementsByTagNameNS(K.STREAM,"error"):e.getElementsByTagName("stream:error"),0===s.length)return!1;const n=s[0];let i="",r="";for(let e=0;e<n.childNodes.length;e++){const t=n.childNodes[e];if(t.nodeType===t.ELEMENT_NODE){if("urn:ietf:params:xml:ns:xmpp-streams"!==t.getAttribute("xmlns"))break}"text"===t.nodeName?r=t.textContent:i=t.nodeName}let o="WebSocket stream error: ";return o+=i||"unknown",r&&(o+=" - "+r),ne.error(o),this._conn._changeConnectStatus(t,i),this._conn._doDisconnect(),!0}_reset(){}_connect(){this._closeSocket(),this.socket=new W(this._conn.service,"xmpp"),this.socket.onopen=()=>this._onOpen(),this.socket.onerror=e=>this._onError(e),this.socket.onclose=e=>this._onClose(e),this.socket.onmessage=e=>this._onInitialMessage(e)}_connect_cb(e){if(this._checkStreamError(e,X.CONNFAIL))return X.CONNFAIL}_handleStreamStart(e){let t=null;const s=e.getAttribute("xmlns");"string"!=typeof s?t="Missing xmlns in <open />":s!==K.FRAMING&&(t="Wrong xmlns in <open />: "+s);const n=e.getAttribute("version");return"string"!=typeof n?t="Missing version in <open />":"1.0"!==n&&(t="Wrong version in <open />: "+n),!t||(this._conn._changeConnectStatus(X.CONNFAIL,t),this._conn._doDisconnect(),!1)}_onInitialMessage(e){if(0===e.data.indexOf("<open ")||0===e.data.indexOf("<?xml")){const t=e.data.replace(/^(<\?.*?\?>\s*)*/,"");if(""===t)return;const s=(new V).parseFromString(t,"text/xml").documentElement;this._conn.xmlInput(s),this._conn.rawInput(e.data),this._handleStreamStart(s)&&this._connect_cb(s)}else if(0===e.data.indexOf("<close ")){const t=(new V).parseFromString(e.data,"text/xml").documentElement;this._conn.xmlInput(t),this._conn.rawInput(e.data);const s=t.getAttribute("see-other-uri");if(s){const e=this._conn.service;(e.indexOf("wss:")>=0&&s.indexOf("wss:")>=0||e.indexOf("ws:")>=0)&&(this._conn._changeConnectStatus(X.REDIRECT,"Received see-other-uri, resetting connection"),this._conn.reset(),this._conn.service=s,this._connect())}else this._conn._changeConnectStatus(X.CONNFAIL,"Received closing stream"),this._conn._doDisconnect()}else{this._replaceMessageHandler();const t=this._streamWrap(e.data),s=(new V).parseFromString(t,"text/xml").documentElement;this._conn._connect_cb(s,null,e.data)}}_replaceMessageHandler(){this.socket.onmessage=e=>this._onMessage(e)}_disconnect(e){if(this.socket&&this.socket.readyState!==W.CLOSED){e&&this._conn.send(e);const t=ze("close",{xmlns:K.FRAMING});this._conn.xmlOutput(t.tree());const s=Be.serialize(t);this._conn.rawOutput(s);try{this.socket.send(s)}catch(e){ne.warn(`Couldn't send <close /> tag. "${e.message}"`)}}setTimeout((()=>this._conn._doDisconnect()),0)}_doDisconnect(){ne.debug("WebSockets _doDisconnect was called"),this._closeSocket()}_streamWrap(e){return"<wrapper>"+e+"</wrapper>"}_closeSocket(){if(this.socket)try{this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null,this.socket.close()}catch(e){ne.debug(e.message)}this.socket=null}_emptyQueue(){return!0}_onClose(e){this._conn.connected&&!this._conn.disconnecting?(ne.error("Websocket closed unexpectedly"),this._conn._doDisconnect()):e&&1006===e.code&&!this._conn.connected&&this.socket?(ne.error("Websocket closed unexcectedly"),this._conn._changeConnectStatus(X.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._conn._doDisconnect()):ne.debug("Websocket closed")}_no_auth_received(e){ne.error("Server did not offer a supported authentication mechanism"),this._conn._changeConnectStatus(X.CONNFAIL,Z.NO_AUTH_MECH),e?.call(this._conn),this._conn._doDisconnect()}_onDisconnectTimeout(){}_abortAllRequests(){}_onError(e){ne.error("Websocket error "+JSON.stringify(e)),this._conn._changeConnectStatus(X.CONNFAIL,"The WebSocket connection could not be established or was disconnected."),this._disconnect()}_onIdle(){const e=this._conn._data;if(e.length>0&&!this._conn.paused){for(let t=0;t<e.length;t++)if(null!==e[t]){const s="restart"===e[t]?this._buildStream().tree():e[t];if("restart"===s)throw new Error("Wrong type for stanza");const n=Be.serialize(s);this._conn.xmlOutput(s),this._conn.rawOutput(n),this.socket.send(n)}this._conn._data=[]}}_onMessage(e){let t;const s='<close xmlns="urn:ietf:params:xml:ns:xmpp-framing" />';if(e.data===s)return this._conn.rawInput(s),this._conn.xmlInput(e),void(this._conn.disconnecting||this._conn._doDisconnect());if(0===e.data.search("<open ")){if(t=(new V).parseFromString(e.data,"text/xml").documentElement,!this._handleStreamStart(t))return}else{const s=this._streamWrap(e.data);t=(new V).parseFromString(s,"text/xml").documentElement}return this._checkStreamError(t,X.ERROR)?void 0:this._conn.disconnecting&&"presence"===t.firstElementChild.nodeName&&"unavailable"===t.firstElementChild.getAttribute("type")?(this._conn.xmlInput(t),void this._conn.rawInput(Be.serialize(t))):void this._conn._dataRecv(t,e.data)}_onOpen(){ne.debug("Websocket open");const e=this._buildStream();this._conn.xmlOutput(e.tree());const t=Be.serialize(e);this._conn.rawOutput(t),this.socket.send(t)}_send(){this._conn.flush()}_sendRestart(){clearTimeout(this._conn._idleTimeout),this._conn._onIdle.bind(this._conn)()}};const dt=class extends lt{constructor(e){super(e),this._conn=e,this.worker=new SharedWorker(this._conn.options.worker,"Strophe XMPP Connection"),this.worker.onerror=e=>{console?.error(e),ne.error(`Shared Worker Error: ${e}`)}}_setSocket(){this.socket={send:e=>this.worker.port.postMessage(["send",e]),close:()=>this.worker.port.postMessage(["_closeSocket"]),onopen:()=>{},onerror:e=>this._onError(e),onclose:e=>this._onClose(e),onmessage:()=>{},readyState:null}}_connect(){this._setSocket(),this._messageHandler=e=>this._onInitialMessage(e),this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_connect",this._conn.service,this._conn.jid])}_attach(e){this._setSocket(),this._messageHandler=e=>this._onMessage(e),this._conn.connect_callback=e,this.worker.port.start(),this.worker.port.onmessage=e=>this._onWorkerMessage(e),this.worker.port.postMessage(["_attach",this._conn.service])}_attachCallback(e,t){e===X.ATTACHED?(this._conn.jid=t,this._conn.authenticated=!0,this._conn.connected=!0,this._conn.restored=!0,this._conn._changeConnectStatus(X.ATTACHED)):e===X.ATTACHFAIL&&(this._conn.authenticated=!1,this._conn.connected=!1,this._conn.restored=!1,this._conn._changeConnectStatus(X.ATTACHFAIL))}_disconnect(e){e&&this._conn.send(e);const t=ze("close",{xmlns:K.FRAMING});this._conn.xmlOutput(t.tree());const s=Be.serialize(t);this._conn.rawOutput(s),this.worker.port.postMessage(["send",s]),this._conn._doDisconnect()}_closeSocket(){this.socket.close()}_replaceMessageHandler(){this._messageHandler=e=>this._onMessage(e)}_onWorkerMessage(e){const{data:t}=e,s=t[0];if("_onMessage"===s)this._messageHandler(t[1]);else if(s in this)try{this[s].apply(this,e.data.slice(1))}catch(e){ne.error(e)}else if("log"===s){const e={debug:ee.DEBUG,info:ee.INFO,warn:ee.WARN,error:ee.ERROR,fatal:ee.FATAL},s=t[1],n=t[2];ne.log(e[s],n)}else ne.error(`Found unhandled service worker message: ${t}`)}},ut={};class ht{constructor(e,t={}){this.service=e,this.options=t,this.setProtocol(),this.jid="",this.domain=null,this.features=null,this._sasl_data={},this.do_bind=!1,this.do_session=!1,this.mechanisms={},this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.protocolErrorHandlers={HTTP:{},websocket:{}},this._idleTimeout=null,this._disconnectTimeout=null,this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.do_authentication=!0,this.paused=!1,this.restored=!1,this._data=[],this._uniqueId=0,this._sasl_success_handler=null,this._sasl_failure_handler=null,this._sasl_challenge_handler=null,this.maxRetries=5,this._idleTimeout=setTimeout((()=>this._onIdle()),100),ue(this.options.cookies),this.registerSASLMechanisms(this.options.mechanisms),this.iqFallbackHandler=new Ke((e=>this.send(Pe({type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("service-unavailable",{xmlns:K.STANZAS}))),null,"iq",["get","set"]);for(const e in ut)if(Object.prototype.hasOwnProperty.call(ut,e)){const t=function(){};t.prototype=ut[e],this[e]=new t,this[e].init(this)}}static addConnectionPlugin(e,t){ut[e]=t}setProtocol(){const e=this.options.protocol||"";this.options.worker?this._proto=new dt(this):0===this.service.indexOf("ws:")||0===this.service.indexOf("wss:")||0===e.indexOf("ws")?this._proto=new lt(this):this._proto=new Qe(this)}reset(){this._proto._reset(),this.do_session=!1,this.do_bind=!1,this.timedHandlers=[],this.handlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this.authenticated=!1,this.connected=!1,this.disconnecting=!1,this.restored=!1,this._data=[],this._requests=[],this._uniqueId=0}pause(){this.paused=!0}resume(){this.paused=!1}getUniqueId(e){const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}addProtocolErrorHandler(e,t,s){this.protocolErrorHandlers[e][t]=s}connect(e,t,s,n,i,r,o,a=3e3){this.jid=e,this.authzid=Re(this.jid),this.authcid=o||Ne(this.jid),this.pass=t,this.scram_keys=null,this.connect_callback=s,this.disconnecting=!1,this.connected=!1,this.authenticated=!1,this.restored=!1,this.disconnection_timeout=a,this.domain=Ie(this.jid),this._changeConnectStatus(X.CONNECTING,null),this._proto._connect(n,i,r)}attach(e,t,s,n,i,r,o){if(this._proto instanceof Qe&&"string"==typeof e)return this._proto._attach(e,t,s,n,i,r,o);if(this._proto instanceof dt&&"function"==typeof e){const t=e;return this._proto._attach(t)}throw new ct('The "attach" method is not available for your connection protocol')}restore(e,t,s,n,i){if(!(this._proto instanceof Qe&&this._sessionCachingSupported()))throw new ct('The "restore" method can only be used with a BOSH connection.');this._sessionCachingSupported()&&this._proto._restore(e,t,s,n,i)}_sessionCachingSupported(){if(this._proto instanceof Qe){if(!JSON)return!1;try{sessionStorage.setItem("_strophe_","_strophe_"),sessionStorage.removeItem("_strophe_")}catch(e){return!1}return!0}return!1}xmlInput(e){}xmlOutput(e){}rawInput(e){}rawOutput(e){}nextValidRid(e){}send(e){if(null!==e){if(Array.isArray(e))e.forEach((e=>this._queueData(e instanceof Be?e.tree():e)));else{const t=e instanceof Be?e.tree():e;this._queueData(t)}this._proto._send()}}flush(){clearTimeout(this._idleTimeout),this._onIdle()}sendPresence(e,t,s,n){let i=null;const r=e instanceof Be?e.tree():e;let o=r.getAttribute("id");if(o||(o=this.getUniqueId("sendPresence"),r.setAttribute("id",o)),"function"==typeof t||"function"==typeof s){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i),"error"===e.getAttribute("type")?s?.(e):t&&t(e)}),null,"presence",null,o);n&&(i=this.addTimedHandler(n,(()=>(this.deleteHandler(e),s?.(null),!1))))}return this.send(r),o}sendIQ(e,t,s,n){let i=null;const r=e instanceof Be?e.tree():e;let o=r.getAttribute("id");if(o||(o=this.getUniqueId("sendIQ"),r.setAttribute("id",o)),"function"==typeof t||"function"==typeof s){const e=this.addHandler((e=>{i&&this.deleteTimedHandler(i);const n=e.getAttribute("type");if("result"===n)t?.(e);else{if("error"!==n){const e=new Error(`Got bad IQ type of ${n}`);throw e.name="StropheError",e}s?.(e)}}),null,"iq",["error","result"],o);n&&(i=this.addTimedHandler(n,(()=>(this.deleteHandler(e),s?.(null),!1))))}return this.send(r),o}_queueData(e){if(null===e||!e.tagName||!e.childNodes){const e=new Error("Cannot queue non-DOMElement.");throw e.name="StropheError",e}this._data.push(e)}_sendRestart(){this._data.push("restart"),this._proto._sendRestart(),this._idleTimeout=setTimeout((()=>this._onIdle()),100)}addTimedHandler(e,t){const s=new Je(e,t);return this.addTimeds.push(s),s}deleteTimedHandler(e){this.removeTimeds.push(e)}addHandler(e,t,s,n,i,r,o){const a=new Ke(e,t,s,n,i,r,o);return this.addHandlers.push(a),a}deleteHandler(e){this.removeHandlers.push(e);const t=this.addHandlers.indexOf(e);t>=0&&this.addHandlers.splice(t,1)}registerSASLMechanisms(e){this.mechanisms={},(e||[Xe,Ze,et,at,tt,nt,it,rt,ot]).forEach((e=>this.registerSASLMechanism(e)))}registerSASLMechanism(e){const t=new e;this.mechanisms[t.mechname]=t}disconnect(e){if(this._changeConnectStatus(X.DISCONNECTING,e),e?ne.info("Disconnect was called because: "+e):ne.debug("Disconnect was called"),this.connected){let e=null;this.disconnecting=!0,this.authenticated&&(e=Fe({xmlns:K.CLIENT,type:"unavailable"})),this._disconnectTimeout=this._addSysTimedHandler(this.disconnection_timeout,this._onDisconnectTimeout.bind(this)),this._proto._disconnect(e)}else ne.debug("Disconnect was called before Strophe connected to the server"),this._proto._abortAllRequests(),this._doDisconnect()}_changeConnectStatus(e,t,s){for(const s in ut)if(Object.prototype.hasOwnProperty.call(ut,s)){const n=this[s];if(n.statusChanged)try{n.statusChanged(e,t)}catch(e){ne.error(`${s} plugin caused an exception changing status: ${e}`)}}if(this.connect_callback)try{this.connect_callback(e,t,s)}catch(e){re(e),ne.error(`User connection callback caused an exception: ${e}`)}}_doDisconnect(e){"number"==typeof this._idleTimeout&&clearTimeout(this._idleTimeout),null!==this._disconnectTimeout&&(this.deleteTimedHandler(this._disconnectTimeout),this._disconnectTimeout=null),ne.debug("_doDisconnect was called"),this._proto._doDisconnect(),this.authenticated=!1,this.disconnecting=!1,this.restored=!1,this.handlers=[],this.timedHandlers=[],this.removeTimeds=[],this.removeHandlers=[],this.addTimeds=[],this.addHandlers=[],this._changeConnectStatus(X.DISCONNECTED,e),this.connected=!1}_dataRecv(e,t){const s="_reqToData"in this._proto?this._proto._reqToData(e):e;if(null===s)return;for(this.xmlInput!==ht.prototype.xmlInput&&(s.nodeName===this._proto.strip&&s.childNodes.length?this.xmlInput(s.childNodes[0]):this.xmlInput(s)),this.rawInput!==ht.prototype.rawInput&&(t?this.rawInput(t):this.rawInput(Be.serialize(s)));this.removeHandlers.length>0;){const e=this.removeHandlers.pop(),t=this.handlers.indexOf(e);t>=0&&this.handlers.splice(t,1)}for(;this.addHandlers.length>0;)this.handlers.push(this.addHandlers.pop());if(this.disconnecting&&this._proto._emptyQueue())return void this._doDisconnect();const n=s.getAttribute("type");if(null!==n&&"terminate"===n){if(this.disconnecting)return;let e=s.getAttribute("condition");const t=s.getElementsByTagName("conflict");return null!==e?("remote-stream-error"===e&&t.length>0&&(e="conflict"),this._changeConnectStatus(X.CONNFAIL,e)):this._changeConnectStatus(X.CONNFAIL,Z.UNKNOWN_REASON),void this._doDisconnect(e)}Ce(s,null,(e=>{const t=[];this.handlers=this.handlers.reduce(((s,n)=>{try{!n.isMatch(e)||!this.authenticated&&n.user?s.push(n):(n.run(e)&&s.push(n),t.push(n))}catch(e){ne.warn("Removing Strophe handlers due to uncaught exception: "+e.message)}return s}),[]),!t.length&&this.iqFallbackHandler.isMatch(e)&&this.iqFallbackHandler.run(e)}))}_connect_cb(e,t,s){let n;ne.debug("_connect_cb was called"),this.connected=!0;try{n="_reqToData"in this._proto?this._proto._reqToData(e):e}catch(e){if(e.name!==Z.BAD_FORMAT)throw e;this._changeConnectStatus(X.CONNFAIL,Z.BAD_FORMAT),this._doDisconnect(Z.BAD_FORMAT)}if(!n)return;this.xmlInput!==ht.prototype.xmlInput&&(n.nodeName===this._proto.strip&&n.childNodes.length?this.xmlInput(n.childNodes[0]):this.xmlInput(n)),this.rawInput!==ht.prototype.rawInput&&(s?this.rawInput(s):this.rawInput(Be.serialize(n)));if(this._proto._connect_cb(n)===X.CONNFAIL)return;let i;if(i=n.getElementsByTagNameNS?n.getElementsByTagNameNS(K.STREAM,"features").length>0:n.getElementsByTagName("stream:features").length>0||n.getElementsByTagName("features").length>0,!i)return void this._proto._no_auth_received(t);const r=Array.from(n.getElementsByTagName("mechanism")).map((e=>this.mechanisms[e.textContent])).filter((e=>e));0!==r.length||0!==n.getElementsByTagName("auth").length?!1!==this.do_authentication&&this.authenticate(r):this._proto._no_auth_received(t)}sortMechanismsByPriority(e){for(let t=0;t<e.length-1;++t){let s=t;for(let n=t+1;n<e.length;++n)e[n].priority>e[s].priority&&(s=n);if(s!==t){const n=e[t];e[t]=e[s],e[s]=n}}return e}authenticate(e){this._attemptSASLAuth(e)||this._attemptLegacyAuth()}_attemptSASLAuth(e){e=this.sortMechanismsByPriority(e||[]);let t=!1;for(let s=0;s<e.length;++s){if(!e[s].test(this))continue;this._sasl_success_handler=this._addSysHandler(this._sasl_success_cb.bind(this),null,"success",null,null),this._sasl_failure_handler=this._addSysHandler(this._sasl_failure_cb.bind(this),null,"failure",null,null),this._sasl_challenge_handler=this._addSysHandler(this._sasl_challenge_cb.bind(this),null,"challenge",null,null),this._sasl_mechanism=e[s],this._sasl_mechanism.onStart(this);const n=ze("auth",{xmlns:K.SASL,mechanism:this._sasl_mechanism.mechname});if(this._sasl_mechanism.isClientFirst){const e=this._sasl_mechanism.clientChallenge(this);n.t(btoa(e))}this.send(n.tree()),t=!0;break}return t}async _sasl_challenge_cb(e){const t=atob(je(e)),s=await this._sasl_mechanism.onChallenge(this,t),n=ze("response",{xmlns:K.SASL});return s&&n.t(btoa(s)),this.send(n.tree()),!0}_attemptLegacyAuth(){null===Ne(this.jid)?(this._changeConnectStatus(X.CONNFAIL,Z.MISSING_JID_NODE),this.disconnect(Z.MISSING_JID_NODE)):(this._changeConnectStatus(X.AUTHENTICATING,null),this._addSysHandler(this._onLegacyAuthIQResult.bind(this),null,null,null,"_auth_1"),this.send(Pe({type:"get",to:this.domain,id:"_auth_1"}).c("query",{xmlns:K.AUTH}).c("username",{}).t(Ne(this.jid)).tree()))}_onLegacyAuthIQResult(){const e="string"==typeof this.pass?this.pass:"",t=Pe({type:"set",id:"_auth_2"}).c("query",{xmlns:K.AUTH}).c("username",{}).t(Ne(this.jid)).up().c("password").t(e);return Me(this.jid)||(this.jid=Re(this.jid)+"/strophe"),t.up().c("resource",{}).t(Me(this.jid)),this._addSysHandler(this._auth2_cb.bind(this),null,null,null,"_auth_2"),this.send(t.tree()),!1}_sasl_success_cb(e){if(this._sasl_data["server-signature"]){let t;const s=/([a-z]+)=([^,]+)(,|$)/,n=atob(je(e)).match(s);if("v"===n[1]&&(t=n[2]),t!==this._sasl_data["server-signature"])return this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_data={},this._sasl_failure_cb(null)}ne.info("SASL authentication succeeded."),this._sasl_data.keys&&(this.scram_keys=this._sasl_data.keys),this._sasl_mechanism&&this._sasl_mechanism.onSuccess(),this.deleteHandler(this._sasl_failure_handler),this._sasl_failure_handler=null,this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null);const t=[],s=(e,t)=>{for(;e.length;)this.deleteHandler(e.pop());return this._onStreamFeaturesAfterSASL(t),!1};return t.push(this._addSysHandler((e=>s(t,e)),null,"stream:features",null,null)),t.push(this._addSysHandler((e=>s(t,e)),K.STREAM,"features",null,null)),this._sendRestart(),!1}_onStreamFeaturesAfterSASL(e){this.features=e;for(let t=0;t<e.childNodes.length;t++){const s=e.childNodes[t];"bind"===s.nodeName&&(this.do_bind=!0),"session"===s.nodeName&&(this.do_session=!0)}return this.do_bind?(this.options.explicitResourceBinding?this._changeConnectStatus(X.BINDREQUIRED,null):this.bind(),!1):(this._changeConnectStatus(X.AUTHFAIL,null),!1)}bind(){if(!this.do_bind)return void ne.info('Connection.prototype.bind called but "do_bind" is false');this._addSysHandler(this._onResourceBindResultIQ.bind(this),null,null,null,"_bind_auth_2");const e=Me(this.jid);e?this.send(Pe({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:K.BIND}).c("resource",{}).t(e).tree()):this.send(Pe({type:"set",id:"_bind_auth_2"}).c("bind",{xmlns:K.BIND}).tree())}_onResourceBindResultIQ(e){if("error"===e.getAttribute("type")){ne.warn("Resource binding failed.");let t;return e.getElementsByTagName("conflict").length>0&&(t=Z.CONFLICT),this._changeConnectStatus(X.AUTHFAIL,t,e),!1}const t=e.getElementsByTagName("bind");if(!(t.length>0))return ne.warn("Resource binding failed."),this._changeConnectStatus(X.AUTHFAIL,null,e),!1;{const e=t[0].getElementsByTagName("jid");e.length>0&&(this.authenticated=!0,this.jid=je(e[0]),this.do_session?this._establishSession():this._changeConnectStatus(X.CONNECTED,null))}}_establishSession(){if(!this.do_session)throw new Error(`Connection.prototype._establishSession called but apparently ${K.SESSION} wasn't advertised by the server`);this._addSysHandler(this._onSessionResultIQ.bind(this),null,null,null,"_session_auth_2"),this.send(Pe({type:"set",id:"_session_auth_2"}).c("session",{xmlns:K.SESSION}).tree())}_onSessionResultIQ(e){if("result"===e.getAttribute("type"))this.authenticated=!0,this._changeConnectStatus(X.CONNECTED,null);else if("error"===e.getAttribute("type"))return this.authenticated=!1,ne.warn("Session creation failed."),this._changeConnectStatus(X.AUTHFAIL,null,e),!1;return!1}_sasl_failure_cb(e){return this._sasl_success_handler&&(this.deleteHandler(this._sasl_success_handler),this._sasl_success_handler=null),this._sasl_challenge_handler&&(this.deleteHandler(this._sasl_challenge_handler),this._sasl_challenge_handler=null),this._sasl_mechanism&&this._sasl_mechanism.onFailure(),this._changeConnectStatus(X.AUTHFAIL,null,e),!1}_auth2_cb(e){return"result"===e.getAttribute("type")?(this.authenticated=!0,this._changeConnectStatus(X.CONNECTED,null)):"error"===e.getAttribute("type")&&(this._changeConnectStatus(X.AUTHFAIL,null,e),this.disconnect("authentication failed")),!1}_addSysTimedHandler(e,t){const s=new Je(e,t);return s.user=!1,this.addTimeds.push(s),s}_addSysHandler(e,t,s,n,i){const r=new Ke(e,t,s,n,i);return r.user=!1,this.addHandlers.push(r),r}_onDisconnectTimeout(){return ne.debug("_onDisconnectTimeout was called"),this._changeConnectStatus(X.CONNTIMEOUT,null),this._proto._onDisconnectTimeout(),this._doDisconnect(),!1}_onIdle(){for(;this.addTimeds.length>0;)this.timedHandlers.push(this.addTimeds.pop());for(;this.removeTimeds.length>0;){const e=this.removeTimeds.pop(),t=this.timedHandlers.indexOf(e);t>=0&&this.timedHandlers.splice(t,1)}const e=(new Date).getTime(),t=[];for(let s=0;s<this.timedHandlers.length;s++){const n=this.timedHandlers[s];if(this.authenticated||!n.user){n.lastCalled+n.period-e<=0?n.run()&&t.push(n):t.push(n)}}this.timedHandlers=t,clearTimeout(this._idleTimeout),this._proto._onIdle(),this.connected&&(this._idleTimeout=setTimeout((()=>this._onIdle()),100))}}const mt=ht;class gt extends Be{#i;#r;#o;constructor(e,t){super("stanza"),this.#r=e,this.#o=t}static unsafeXML(e){return Be.fromString(e)}static toElement(e,t){const s=fe(e),n=ve(s);if(n)throw new Error(`Parser Error: ${n}`);const i=pe(_e(s));if(["message","iq","presence"].includes(i.nodeName.toLowerCase())&&"jabber:client"!==i.namespaceURI&&"jabber:server"!==i.namespaceURI){const e=`Invalid namespaceURI ${i.namespaceURI}`;if(t)throw new Error(e);ne.error(e)}return i}buildTree(){return gt.toElement(this.toString(),!0)}toString(){return this.#i=this.#i||this.#r.reduce(((e,t,s)=>{const n=this.#o.length>s?this.#o[s]:"";return e+t+(Array.isArray(n)?n.map((e=>e instanceof gt||e instanceof Be?e:Ee(e.toString()))).join(""):n instanceof gt||n instanceof Be?n:Ee((n??"").toString()))}),"").trim(),this.#i}}function pt(e,...t){return new gt(e,t)}const ft={VERSION:"3.0.0",get TIMEOUT(){return Qe.getTimeoutMultplier()},set TIMEOUT(e){Qe.setTimeoutMultiplier(e)},get SECONDARY_TIMEOUT(){return Qe.getSecondaryTimeoutMultplier()},set SECONDARY_TIMEOUT(e){Qe.setSecondaryTimeoutMultiplier(e)},...i,...ne,shims:n,Request:He,Bosh:Qe,Websocket:lt,WorkerWebsocket:dt,Connection:mt,Handler:Ke,SASLAnonymous:Xe,SASLPlain:tt,SASLSHA1:nt,SASLSHA256:it,SASLSHA384:rt,SASLSHA512:ot,SASLOAuthBearer:et,SASLExternal:Ze,SASLXOAuth2:at,Stanza:gt,Builder:Be,ElementType:te,ErrorCondition:Z,LogLevel:ee,NS:K,SASLMechanism:Ye,Status:X,TimedHandler:Je,XHTML:{...Y,validTag:ye,validCSS:Se,validAttribute:we},serialize:e=>Be.serialize(e),setLogLevel(e){ne.setLogLevel(e)},addNamespace(e,t){ft.NS[e]=t},addConnectionPlugin(e,t){mt.addConnectionPlugin(e,t)}};globalThis.$build=ze,globalThis.$iq=Pe,globalThis.$msg=Le,globalThis.$pres=Fe,globalThis.Strophe=ft,globalThis.stx=pt;const vt=gt.toElement;function _t(e){return e instanceof Element||e instanceof HTMLDocument}function bt(e,t){if(e instanceof ft.Builder)return bt(e.tree(),t);if(e instanceof Element)return ft.isTagEqual(e,t);throw Error("isTagEqual called with value which isn't an element or Strophe.Builder instance")}function yt(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild}function wt(e,t){return Array.from(e.childNodes).filter((e=>e instanceof Element&&e.matches(t)))}function St(e){for(var t=0;e=e.previousElementSibling;t++);return t}globalThis.toStanza=gt.toElement;const At=document.createElement("div");function xt(e){return e&&"string"==typeof e&&(At.innerHTML=G().sanitize(e),e=At.textContent,At.textContent=""),e}const Et={debug:0,info:1,warn:2,error:3,fatal:4},$t=Object.assign({debug:console?.log?console.log.bind(console):function(){},error:console?.log?console.log.bind(console):function(){},info:console?.log?console.log.bind(console):function(){},warn:console?.log?console.log.bind(console):function(){}},console),Ct={setLogLevel(e){if(!["debug","info","warn","error","fatal"].includes(e))throw new Error(`Invalid loglevel: ${e}`);this.loglevel=e},log(e,t,s=""){if(Et[t]<Et[this.loglevel])return;"error"===t||"fatal"===t?s=s||"color: maroon":"debug"===t&&(s=s||"color: green"),e instanceof Error?e=e.stack:_t(e)&&(e=e.outerHTML);const n=s?"%c":"";"error"===t?$t.error(`${n} ERROR: ${e}`,s):"warn"===t?$t.warn(`${n} ${(new Date).toISOString()} WARNING: ${e}`,s):"fatal"===t?$t.error(`${n} FATAL: ${e}`,s):"debug"===t?$t.debug(`${n} ${(new Date).toISOString()} DEBUG: ${e}`,s):$t.info(`${n} ${(new Date).toISOString()} INFO: ${e}`,s)},debug(e,t){this.log(e,"debug",t)},error(e,t){this.log(e,"error",t)},info(e,t){this.log(e,"info",t)},warn(e,t){this.log(e,"warn",t)},fatal(e,t){this.log(e,"fatal",t)}};var kt=s(169);const jt={async initialize(){},__:(...e)=>(0,kt.sprintf)(...e)};function Tt(e,t,s,n,...i){return"function"==typeof s&&(void 0===this.__super__&&(this.__super__=n),this.__super__[e]=s.bind(this)),t.apply(this,i)}class Ot{constructor(e,t){this.name=t,this.plugged=e,void 0===this.plugged.__super__?this.plugged.__super__={}:"string"==typeof this.plugged.__super__&&(this.plugged.__super__={__string__:this.plugged.__super__}),this.plugged.__super__[t]=this.plugged,this.plugins={},this.initialized_plugins=[]}_overrideAttribute(e,t){const s=t.overrides[e];if("function"==typeof s){const t={};t[this.name]=this.plugged;const n=this.plugged[e];this.plugged[e]=function(...i){return Tt.apply(this,[e,s,n,t,...i])}}else this.plugged[e]=s}_extendObject(e,t){e.prototype.__super__||(e.prototype.__super__={},e.prototype.__super__[this.name]=this.plugged);for(const[s,n]of Object.entries(t))if("events"===s)e.prototype[s]=Object.assign(n,e.prototype[s]);else if("function"==typeof n){const t={};t[this.name]=this.plugged;const i=e.prototype[s];e.prototype[s]=function(...e){return Tt.apply(this,[s,n,i,t,...e])}}else e.prototype[s]=n}loadPluginDependencies(e){e.dependencies?.forEach((t=>{const s=this.plugins[t];if(s){if(s.dependencies?.includes(e.__name__))throw'Found a circular dependency between the plugins "'+e.__name__+'" and "'+t+'"';this.initializePlugin(s)}else this.throwUndefinedDependencyError('Could not find dependency "'+t+'" for the plugin "'+e.__name__+"\". If it's needed, make sure it's loaded by require.js")}))}throwUndefinedDependencyError(e){if(this.plugged.strict_plugin_dependencies)throw e;console.warn?console.warn(e):console.log(e)}applyOverrides(e){Object.keys(e.overrides||{}).forEach((t=>{const s=e.overrides[t];"object"==typeof s?void 0===this.plugged[t]?this.throwUndefinedDependencyError(`Plugin "${e.__name__}" tried to override "${t}" but it's not found.`):this._extendObject(this.plugged[t],s):this._overrideAttribute(t,e)}))}initializePlugin(e){Object.keys(this.allowed_plugins).includes(e.__name__)&&(this.initialized_plugins.includes(e.__name__)||("boolean"==typeof e.enabled&&e.enabled||e.enabled?.(this.plugged)||null==e.enabled)&&(Object.assign(e,this.properties),e.dependencies&&this.loadPluginDependencies(e),this.applyOverrides(e),"function"==typeof e.initialize&&e.initialize.bind(e)(this),this.initialized_plugins.push(e.__name__)))}registerPlugin(e,t){if(e in this.plugins)throw new Error("Error: Plugin name "+e+" is already taken");t.__name__=e,this.plugins[e]=t}initializePlugins(e={},t=[],s=[]){if(Object.keys(this.plugins).length){this.properties=e,this.allowed_plugins={};for(const[e,n]of Object.entries(this.plugins))t.length&&!t.includes(e)||s.includes(e)||(this.allowed_plugins[e]=n);Object.values(this.allowed_plugins).forEach((e=>this.initializePlugin(e)))}}}const Nt={enable:function(e,t,s){return void 0===s&&(s="pluginSocket"),void 0===t&&(t="plugged"),e[s]=new Ot(e,t),e}};const It="object"==typeof global&&global&&global.Object===Object&&global;var Mt="object"==typeof self&&self&&self.Object===Object&&self;const Rt=It||Mt||Function("return this")();const Dt=Rt.Symbol;const zt=function(e,t){for(var s=-1,n=null==e?0:e.length,i=Array(n);++s<n;)i[s]=t(e[s],s,e);return i};const Lt=Array.isArray;var Pt=Object.prototype,Ft=Pt.hasOwnProperty,Ut=Pt.toString,Bt=Dt?Dt.toStringTag:void 0;const qt=function(e){var t=Ft.call(e,Bt),s=e[Bt];try{e[Bt]=void 0;var n=!0}catch(e){}var i=Ut.call(e);return n&&(t?e[Bt]=s:delete e[Bt]),i};var Ht=Object.prototype.toString;const Gt=function(e){return Ht.call(e)};var Wt=Dt?Dt.toStringTag:void 0;const Vt=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Wt&&Wt in Object(e)?qt(e):Gt(e)};const Qt=function(e){return null!=e&&"object"==typeof e};const Kt=function(e){return"symbol"==typeof e||Qt(e)&&"[object Symbol]"==Vt(e)};var Jt=Dt?Dt.prototype:void 0,Yt=Jt?Jt.toString:void 0;const Xt=function e(t){if("string"==typeof t)return t;if(Lt(t))return zt(t,e)+"";if(Kt(t))return Yt?Yt.call(t):"";var s=t+"";return"0"==s&&1/t==-1/0?"-0":s};const Zt=function(e){return null==e?"":Xt(e)};var es=0;const ts=function(e){var t=++es;return Zt(e)+t};var ss;const ns=window,is=ns.trustedTypes,rs=is?is.createPolicy("lit-html",{createHTML:e=>e}):void 0,os="$lit$",as=`lit$${(Math.random()+"").slice(9)}$`,cs="?"+as,ls=`<${cs}>`,ds=document,us=()=>ds.createComment(""),hs=e=>null===e||"object"!=typeof e&&"function"!=typeof e,ms=Array.isArray,gs=e=>ms(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]),ps="[ \t\n\f\r]",fs=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,vs=/-->/g,_s=/>/g,bs=RegExp(`>|${ps}(?:([^\\s"'>=/]+)(${ps}*=${ps}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),ys=/'/g,ws=/"/g,Ss=/^(?:script|style|textarea|title)$/i,As=e=>(t,...s)=>({_$litType$:e,strings:t,values:s}),xs=(As(1),As(2),Symbol.for("lit-noChange")),Es=Symbol.for("lit-nothing"),$s=new WeakMap,Cs=ds.createTreeWalker(ds,129,null,!1);function ks(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==rs?rs.createHTML(t):t}const js=(e,t)=>{const s=e.length-1,n=[];let i,r=2===t?"<svg>":"",o=fs;for(let t=0;t<s;t++){const s=e[t];let a,c,l=-1,d=0;for(;d<s.length&&(o.lastIndex=d,c=o.exec(s),null!==c);)d=o.lastIndex,o===fs?"!--"===c[1]?o=vs:void 0!==c[1]?o=_s:void 0!==c[2]?(Ss.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=bs):void 0!==c[3]&&(o=bs):o===bs?">"===c[0]?(o=null!=i?i:fs,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?bs:'"'===c[3]?ws:ys):o===ws||o===ys?o=bs:o===vs||o===_s?o=fs:(o=bs,i=void 0);const u=o===bs&&e[t+1].startsWith("/>")?" ":"";r+=o===fs?s+ls:l>=0?(n.push(a),s.slice(0,l)+os+s.slice(l)+as+u):s+as+(-2===l?(n.push(void 0),t):u)}return[ks(e,r+(e[s]||"<?>")+(2===t?"</svg>":"")),n]};class Ts{constructor({strings:e,_$litType$:t},s){let n;this.parts=[];let i=0,r=0;const o=e.length-1,a=this.parts,[c,l]=js(e,t);if(this.el=Ts.createElement(c,s),Cs.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(n=Cs.nextNode())&&a.length<o;){if(1===n.nodeType){if(n.hasAttributes()){const e=[];for(const t of n.getAttributeNames())if(t.endsWith(os)||t.startsWith(as)){const s=l[r++];if(e.push(t),void 0!==s){const e=n.getAttribute(s.toLowerCase()+os).split(as),t=/([.?@])?(.*)/.exec(s);a.push({type:1,index:i,name:t[2],strings:e,ctor:"."===t[1]?Rs:"?"===t[1]?zs:"@"===t[1]?Ls:Ms})}else a.push({type:6,index:i})}for(const t of e)n.removeAttribute(t)}if(Ss.test(n.tagName)){const e=n.textContent.split(as),t=e.length-1;if(t>0){n.textContent=is?is.emptyScript:"";for(let s=0;s<t;s++)n.append(e[s],us()),Cs.nextNode(),a.push({type:2,index:++i});n.append(e[t],us())}}}else if(8===n.nodeType)if(n.data===cs)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=n.data.indexOf(as,e+1));)a.push({type:7,index:i}),e+=as.length-1}i++}}static createElement(e,t){const s=ds.createElement("template");return s.innerHTML=e,s}}function Os(e,t,s=e,n){var i,r,o,a;if(t===xs)return t;let c=void 0!==n?null===(i=s._$Co)||void 0===i?void 0:i[n]:s._$Cl;const l=hs(t)?void 0:t._$litDirective$;return(null==c?void 0:c.constructor)!==l&&(null===(r=null==c?void 0:c._$AO)||void 0===r||r.call(c,!1),void 0===l?c=void 0:(c=new l(e),c._$AT(e,s,n)),void 0!==n?(null!==(o=(a=s)._$Co)&&void 0!==o?o:a._$Co=[])[n]=c:s._$Cl=c),void 0!==c&&(t=Os(e,c._$AS(e,t.values),c,n)),t}class Ns{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){var t;const{el:{content:s},parts:n}=this._$AD,i=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:ds).importNode(s,!0);Cs.currentNode=i;let r=Cs.nextNode(),o=0,a=0,c=n[0];for(;void 0!==c;){if(o===c.index){let t;2===c.type?t=new Is(r,r.nextSibling,this,e):1===c.type?t=new c.ctor(r,c.name,c.strings,this,e):6===c.type&&(t=new Ps(r,this,e)),this._$AV.push(t),c=n[++a]}o!==(null==c?void 0:c.index)&&(r=Cs.nextNode(),o++)}return Cs.currentNode=ds,i}v(e){let t=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}class Is{constructor(e,t,s,n){var i;this.type=2,this._$AH=Es,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=n,this._$Cp=null===(i=null==n?void 0:n.isConnected)||void 0===i||i}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cp}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===(null==e?void 0:e.nodeType)&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Os(this,e,t),hs(e)?e===Es||null==e||""===e?(this._$AH!==Es&&this._$AR(),this._$AH=Es):e!==this._$AH&&e!==xs&&this._(e):void 0!==e._$litType$?this.g(e):void 0!==e.nodeType?this.$(e):gs(e)?this.T(e):this._(e)}k(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}$(e){this._$AH!==e&&(this._$AR(),this._$AH=this.k(e))}_(e){this._$AH!==Es&&hs(this._$AH)?this._$AA.nextSibling.data=e:this.$(ds.createTextNode(e)),this._$AH=e}g(e){var t;const{values:s,_$litType$:n}=e,i="number"==typeof n?this._$AC(e):(void 0===n.el&&(n.el=Ts.createElement(ks(n.h,n.h[0]),this.options)),n);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===i)this._$AH.v(s);else{const e=new Ns(i,this),t=e.u(this.options);e.v(s),this.$(t),this._$AH=e}}_$AC(e){let t=$s.get(e.strings);return void 0===t&&$s.set(e.strings,t=new Ts(e)),t}T(e){ms(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,n=0;for(const i of e)n===t.length?t.push(s=new Is(this.k(us()),this.k(us()),this,this.options)):s=t[n],s._$AI(i),n++;n<t.length&&(this._$AR(s&&s._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){var s;for(null===(s=this._$AP)||void 0===s||s.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cp=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class Ms{constructor(e,t,s,n,i){this.type=1,this._$AH=Es,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=i,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=Es}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,s,n){const i=this.strings;let r=!1;if(void 0===i)e=Os(this,e,t,0),r=!hs(e)||e!==this._$AH&&e!==xs,r&&(this._$AH=e);else{const n=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=Os(this,n[s+o],t,o),a===xs&&(a=this._$AH[o]),r||(r=!hs(a)||a!==this._$AH[o]),a===Es?e=Es:e!==Es&&(e+=(null!=a?a:"")+i[o+1]),this._$AH[o]=a}r&&!n&&this.j(e)}j(e){e===Es?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class Rs extends Ms{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Es?void 0:e}}const Ds=is?is.emptyScript:"";class zs extends Ms{constructor(){super(...arguments),this.type=4}j(e){e&&e!==Es?this.element.setAttribute(this.name,Ds):this.element.removeAttribute(this.name)}}class Ls extends Ms{constructor(e,t,s,n,i){super(e,t,s,n,i),this.type=5}_$AI(e,t=this){var s;if((e=null!==(s=Os(this,e,t,0))&&void 0!==s?s:Es)===xs)return;const n=this._$AH,i=e===Es&&n!==Es||e.capture!==n.capture||e.once!==n.once||e.passive!==n.passive,r=e!==Es&&(n===Es||i);i&&this.element.removeEventListener(this.name,this,n),r&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,s;"function"==typeof this._$AH?this._$AH.call(null!==(s=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==s?s:this.element,e):this._$AH.handleEvent(e)}}class Ps{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){Os(this,e)}}const Fs=ns.litHtmlPolyfillSupport;null==Fs||Fs(Ts,Is),(null!==(ss=ns.litHtmlVersions)&&void 0!==ss?ss:ns.litHtmlVersions=[]).push("2.8.0");var Us=/\s/;const Bs=function(e){for(var t=e.length;t--&&Us.test(e.charAt(t)););return t};var qs=/^\s+/;const Hs=function(e){return e?e.slice(0,Bs(e)+1).replace(qs,""):e};const Gs=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Ws=/^[-+]0x[0-9a-f]+$/i,Vs=/^0b[01]+$/i,Qs=/^0o[0-7]+$/i,Ks=parseInt;const Js=function(e){if("number"==typeof e)return e;if(Kt(e))return NaN;if(Gs(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Gs(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Hs(e);var s=Vs.test(e);return s||Qs.test(e)?Ks(e.slice(2),s?2:8):Ws.test(e)?NaN:+e};var Ys=1/0;const Xs=function(e){return e?(e=Js(e))===Ys||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const Zs=function(e){var t=Xs(e),s=t%1;return t==t?s?t-s:t:0};const en=function(e,t){var s;if("function"!=typeof t)throw new TypeError("Expected a function");return e=Zs(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=void 0),s}};const tn=function(e){return en(2,e)};const sn=function(e,t){for(var s=-1,n=Array(e);++s<e;)n[s]=t(s);return n};const nn=function(e){return Qt(e)&&"[object Arguments]"==Vt(e)};var rn=Object.prototype,on=rn.hasOwnProperty,an=rn.propertyIsEnumerable;const cn=nn(function(){return arguments}())?nn:function(e){return Qt(e)&&on.call(e,"callee")&&!an.call(e,"callee")};const ln=function(){return!1};var dn="object"==typeof exports&&exports&&!exports.nodeType&&exports,un=dn&&"object"==typeof module&&module&&!module.nodeType&&module,hn=un&&un.exports===dn?Rt.Buffer:void 0;const mn=(hn?hn.isBuffer:void 0)||ln;var gn=/^(?:0|[1-9]\d*)$/;const pn=function(e,t){var s=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==s||"symbol"!=s&&gn.test(e))&&e>-1&&e%1==0&&e<t};const fn=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var vn={};vn["[object Float32Array]"]=vn["[object Float64Array]"]=vn["[object Int8Array]"]=vn["[object Int16Array]"]=vn["[object Int32Array]"]=vn["[object Uint8Array]"]=vn["[object Uint8ClampedArray]"]=vn["[object Uint16Array]"]=vn["[object Uint32Array]"]=!0,vn["[object Arguments]"]=vn["[object Array]"]=vn["[object ArrayBuffer]"]=vn["[object Boolean]"]=vn["[object DataView]"]=vn["[object Date]"]=vn["[object Error]"]=vn["[object Function]"]=vn["[object Map]"]=vn["[object Number]"]=vn["[object Object]"]=vn["[object RegExp]"]=vn["[object Set]"]=vn["[object String]"]=vn["[object WeakMap]"]=!1;const _n=function(e){return Qt(e)&&fn(e.length)&&!!vn[Vt(e)]};const bn=function(e){return function(t){return e(t)}};var yn="object"==typeof exports&&exports&&!exports.nodeType&&exports,wn=yn&&"object"==typeof module&&module&&!module.nodeType&&module,Sn=wn&&wn.exports===yn&&It.process;const An=function(){try{var e=wn&&wn.require&&wn.require("util").types;return e||Sn&&Sn.binding&&Sn.binding("util")}catch(e){}}();var xn=An&&An.isTypedArray;const En=xn?bn(xn):_n;var $n=Object.prototype.hasOwnProperty;const Cn=function(e,t){var s=Lt(e),n=!s&&cn(e),i=!s&&!n&&mn(e),r=!s&&!n&&!i&&En(e),o=s||n||i||r,a=o?sn(e.length,String):[],c=a.length;for(var l in e)!t&&!$n.call(e,l)||o&&("length"==l||i&&("offset"==l||"parent"==l)||r&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||pn(l,c))||a.push(l);return a};var kn=Object.prototype;const jn=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||kn)};const Tn=function(e,t){return function(s){return e(t(s))}};const On=Tn(Object.keys,Object);var Nn=Object.prototype.hasOwnProperty;const In=function(e){if(!jn(e))return On(e);var t=[];for(var s in Object(e))Nn.call(e,s)&&"constructor"!=s&&t.push(s);return t};const Mn=function(e){if(!Gs(e))return!1;var t=Vt(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const Rn=function(e){return null!=e&&fn(e.length)&&!Mn(e)};const Dn=function(e){return Rn(e)?Cn(e):In(e)},zn=/\s+/;function Ln(e,t,s,n,i){let r,o=0;if(s&&"object"==typeof s){void 0!==n&&"context"in i&&void 0===i.context&&(i.context=n);for(r=Dn(s);o<r.length;o++)t=Ln(e,t,r[o],s[r[o]],i)}else if(s&&zn.test(s))for(r=s.split(zn);o<r.length;o++)t=e(t,r[o],n,i);else t=e(t,s,n,i);return t}function Pn(e,t,s,n){if(s){const i=e[t]||(e[t]=[]),r=n.context,o=n.ctx,a=n.listening;a&&a.count++,i.push({callback:s,context:r,ctx:r||o,listening:a})}return e}function Fn(e,t,s,n){if(!e)return;const i=n.context,r=n.listeners;let o,a=0;if(t||i||s){for(o=t?[t]:Dn(e);a<o.length;a++){const n=e[t=o[a]];if(!n)break;const r=[];for(let e=0;e<n.length;e++){const o=n[e];if(s&&s!==o.callback&&s!==o.callback._callback||i&&i!==o.context)r.push(o);else{const e=o.listening;e&&e.stop(t,s)}}r.length?e[t]=r:delete e[t]}return e}for(o=Dn(r);a<o.length;a++)r[o[a]].cleanup()}function Un(e,t,s,n){if(s){const i=e[t]=tn((function(){n(t,i),s.apply(this,arguments)}));i._callback=s}return e}function Bn(e,t,s,n){if(e){const s=e[t];let i=e.all;s&&i&&(i=i.slice()),s&&qn(s,n),i&&qn(i,[t].concat(n))}return e}function qn(e,t){let s,n=-1;const i=e.length,r=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++n<i;)(s=e[n]).callback.call(s.ctx);return;case 1:for(;++n<i;)(s=e[n]).callback.call(s.ctx,r);return;case 2:for(;++n<i;)(s=e[n]).callback.call(s.ctx,r,o);return;case 3:for(;++n<i;)(s=e[n]).callback.call(s.ctx,r,o,a);return;default:for(;++n<i;)(s=e[n]).callback.apply(s.ctx,t);return}}const Hn=class{constructor(e,t){this.id=e._listenId,this.listener=e,this.obj=t,this.interop=!0,this.count=0,this._events=void 0}start(e,t,s,n){if(this._events=Ln(Pn,this._events||{},e,t,{context:this.obj,ctx:s,listening:n}),n){(this.obj._listeners||(this.obj._listeners={}))[this.id]=this,this.interop=!1}return this}stop(e,t){let s;this.interop?(this._events=Ln(Fn,this._events,e,t,{context:void 0,listeners:void 0}),s=!this._events):(this.count--,s=0===this.count),s&&this.cleanup()}cleanup(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]}};const Gn=Rt["__core-js_shared__"];var Wn,Vn=(Wn=/[^.]+$/.exec(Gn&&Gn.keys&&Gn.keys.IE_PROTO||""))?"Symbol(src)_1."+Wn:"";const Qn=function(e){return!!Vn&&Vn in e};var Kn=Function.prototype.toString;const Jn=function(e){if(null!=e){try{return Kn.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Yn=/^\[object .+?Constructor\]$/,Xn=Function.prototype,Zn=Object.prototype,ei=Xn.toString,ti=Zn.hasOwnProperty,si=RegExp("^"+ei.call(ti).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const ni=function(e){return!(!Gs(e)||Qn(e))&&(Mn(e)?si:Yn).test(Jn(e))};const ii=function(e,t){return null==e?void 0:e[t]};const ri=function(e,t){var s=ii(e,t);return ni(s)?s:void 0};const oi=ri(Rt,"DataView");const ai=ri(Rt,"Map");const ci=ri(Rt,"Promise");const li=ri(Rt,"Set");const di=ri(Rt,"WeakMap");var ui="[object Map]",hi="[object Promise]",mi="[object Set]",gi="[object WeakMap]",pi="[object DataView]",fi=Jn(oi),vi=Jn(ai),_i=Jn(ci),bi=Jn(li),yi=Jn(di),wi=Vt;(oi&&wi(new oi(new ArrayBuffer(1)))!=pi||ai&&wi(new ai)!=ui||ci&&wi(ci.resolve())!=hi||li&&wi(new li)!=mi||di&&wi(new di)!=gi)&&(wi=function(e){var t=Vt(e),s="[object Object]"==t?e.constructor:void 0,n=s?Jn(s):"";if(n)switch(n){case fi:return pi;case vi:return ui;case _i:return hi;case bi:return mi;case yi:return gi}return t});const Si=wi;var Ai=Object.prototype.hasOwnProperty;const xi=function(e){if(null==e)return!0;if(Rn(e)&&(Lt(e)||"string"==typeof e||"function"==typeof e.splice||mn(e)||En(e)||cn(e)))return!e.length;var t=Si(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(jn(e))return!In(e).length;for(var s in e)if(Ai.call(e,s))return!1;return!0};let Ei;const $i=function(e){return class extends e{on(e,t,s){if(this._events=Ln(Pn,this._events||{},e,t,{context:s,ctx:this,listening:Ei}),Ei){(this._listeners||(this._listeners={}))[Ei.id]=Ei,Ei.interop=!1}return this}listenTo(e,t,s){if(!e)return this;const n=e._listenId||(e._listenId=ts("l")),i=this._listeningTo||(this._listeningTo={});let r=Ei=i[n];r||(this._listenId||(this._listenId=ts("l")),r=Ei=i[n]=new Hn(this,e));const o=function(e,t,s,n){try{e.on(t,s,n)}catch(e){return e}}(e,t,s,this);if(Ei=void 0,o)throw o;return r.interop&&r.start(t,s,this,Ei),this}off(e,t,s){return this._events?(this._events=Ln(Fn,this._events,e,t,{context:s,listeners:this._listeners}),this):this}stopListening(e,t,s){const n=this._listeningTo;if(!n)return this;const i=e?[e._listenId]:Dn(n);for(let e=0;e<i.length;e++){const r=n[i[e]];if(!r)break;r.obj.off(t,s,this),r.interop&&r.stop(t,s)}return xi(n)&&(this._listeningTo=void 0),this}once(e,t,s){const n=Ln(Un,{},e,t,this.off.bind(this));return"string"==typeof e&&null==s&&(t=void 0),this.on(n,t,s)}listenToOnce(e,t,s){const n=Ln(Un,{},t,s,this.stopListening.bind(this,e));return this.listenTo(e,n)}trigger(e,...t){return this._events?(Ln(Bn,this._events,e,void 0,t),this):this}}},Ci=/^(\S+)\s*(.*)$/;class ki extends($i(HTMLElement)){set events(e){this._declarativeEvents=e}get events(){return this._declarativeEvents}constructor(e={}){super(),this.stopListening=null,this.cid=ts("view"),this._declarativeEvents={},this._domEvents=[];const{model:t,collection:s,events:n}=e;Object.assign(this,{model:t,collection:s,events:n})}createRenderRoot(){return this}connectedCallback(){this._initialized||(this.preinitialize.apply(this,arguments),this.initialize.apply(this,arguments),this._initialized=!0),this.delegateEvents()}disconnectedCallback(){this.undelegateEvents(),this.stopListening?.()}preinitialize(){}initialize(){}beforeRender(){}afterRender(){}render(){return this.beforeRender(),((e,t,s)=>{var n,i;const r=null!==(n=null==s?void 0:s.renderBefore)&&void 0!==n?n:t;let o=r._$litPart$;if(void 0===o){const e=null!==(i=null==s?void 0:s.renderBefore)&&void 0!==i?i:null;r._$litPart$=o=new Is(t.insertBefore(us(),e),e,void 0,null!=s?s:{})}o._$AI(e)})(this.toHTML(),this),this.afterRender(),this}toHTML(){return""}delegateEvents(){if(!this.events)return this;this.undelegateEvents();for(const e in this.events){let t=this.events[e];if("function"!=typeof t&&(t=this[t]),!t)continue;const s=e.match(Ci);this.delegate(s[1],s[2],t.bind(this))}return this}delegate(e,t,s){const n=this;if(!n)return this;if("function"==typeof t&&(s=t,t=null),-1!==["focus","blur"].indexOf(e)){const n=this.querySelectorAll(t);for(let t=0,i=n.length;t<i;t++){const i=n[t];i.addEventListener(e,s,!1),this._domEvents.push({el:i,eventName:e,handler:s})}return s}const i=t?function(e){let i=e.target||e.srcElement;for(;i&&i!=n;i=i.parentNode)i.matches(t)&&(e.delegateTarget=i,s(e))}:s;return this.addEventListener(e,i,!1),this._domEvents.push({el:this,eventName:e,handler:i,listener:s,selector:t}),this}undelegateEvents(){if(this){for(let e=0,t=this._domEvents.length;e<t;e++){const t=this._domEvents[e];t.el.removeEventListener(t.eventName,t.handler,!1)}this._domEvents.length=0}return this}undelegate(e,t,s){if("function"==typeof t&&(s=t,t=null),this){const n=this._domEvents.slice();let i=n.length;for(;i--;){const r=n[i];!(r.eventName!==e||s&&r.listener!==s||t&&r.selector!==t)&&(r.el.removeEventListener(r.eventName,r.handler,!1),this._domEvents.splice(i,1))}}return this}}const ji=ki;var Ti=s(8781);const Oi=function(){this.__data__=[],this.size=0};const Ni=function(e,t){return e===t||e!=e&&t!=t};const Ii=function(e,t){for(var s=e.length;s--;)if(Ni(e[s][0],t))return s;return-1};var Mi=Array.prototype.splice;const Ri=function(e){var t=this.__data__,s=Ii(t,e);return!(s<0)&&(s==t.length-1?t.pop():Mi.call(t,s,1),--this.size,!0)};const Di=function(e){var t=this.__data__,s=Ii(t,e);return s<0?void 0:t[s][1]};const zi=function(e){return Ii(this.__data__,e)>-1};const Li=function(e,t){var s=this.__data__,n=Ii(s,e);return n<0?(++this.size,s.push([e,t])):s[n][1]=t,this};function Pi(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var n=e[t];this.set(n[0],n[1])}}Pi.prototype.clear=Oi,Pi.prototype.delete=Ri,Pi.prototype.get=Di,Pi.prototype.has=zi,Pi.prototype.set=Li;const Fi=Pi;const Ui=function(){this.__data__=new Fi,this.size=0};const Bi=function(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s};const qi=function(e){return this.__data__.get(e)};const Hi=function(e){return this.__data__.has(e)};const Gi=ri(Object,"create");const Wi=function(){this.__data__=Gi?Gi(null):{},this.size=0};const Vi=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var Qi=Object.prototype.hasOwnProperty;const Ki=function(e){var t=this.__data__;if(Gi){var s=t[e];return"__lodash_hash_undefined__"===s?void 0:s}return Qi.call(t,e)?t[e]:void 0};var Ji=Object.prototype.hasOwnProperty;const Yi=function(e){var t=this.__data__;return Gi?void 0!==t[e]:Ji.call(t,e)};const Xi=function(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Gi&&void 0===t?"__lodash_hash_undefined__":t,this};function Zi(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var n=e[t];this.set(n[0],n[1])}}Zi.prototype.clear=Wi,Zi.prototype.delete=Vi,Zi.prototype.get=Ki,Zi.prototype.has=Yi,Zi.prototype.set=Xi;const er=Zi;const tr=function(){this.size=0,this.__data__={hash:new er,map:new(ai||Fi),string:new er}};const sr=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const nr=function(e,t){var s=e.__data__;return sr(t)?s["string"==typeof t?"string":"hash"]:s.map};const ir=function(e){var t=nr(this,e).delete(e);return this.size-=t?1:0,t};const rr=function(e){return nr(this,e).get(e)};const or=function(e){return nr(this,e).has(e)};const ar=function(e,t){var s=nr(this,e),n=s.size;return s.set(e,t),this.size+=s.size==n?0:1,this};function cr(e){var t=-1,s=null==e?0:e.length;for(this.clear();++t<s;){var n=e[t];this.set(n[0],n[1])}}cr.prototype.clear=tr,cr.prototype.delete=ir,cr.prototype.get=rr,cr.prototype.has=or,cr.prototype.set=ar;const lr=cr;const dr=function(e,t){var s=this.__data__;if(s instanceof Fi){var n=s.__data__;if(!ai||n.length<199)return n.push([e,t]),this.size=++s.size,this;s=this.__data__=new lr(n)}return s.set(e,t),this.size=s.size,this};function ur(e){var t=this.__data__=new Fi(e);this.size=t.size}ur.prototype.clear=Ui,ur.prototype.delete=Bi,ur.prototype.get=qi,ur.prototype.has=Hi,ur.prototype.set=dr;const hr=ur;const mr=function(e,t){for(var s=-1,n=null==e?0:e.length;++s<n&&!1!==t(e[s],s,e););return e};const gr=function(){try{var e=ri(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const pr=function(e,t,s){"__proto__"==t&&gr?gr(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s};var fr=Object.prototype.hasOwnProperty;const vr=function(e,t,s){var n=e[t];fr.call(e,t)&&Ni(n,s)&&(void 0!==s||t in e)||pr(e,t,s)};const _r=function(e,t,s,n){var i=!s;s||(s={});for(var r=-1,o=t.length;++r<o;){var a=t[r],c=n?n(s[a],e[a],a,s,e):void 0;void 0===c&&(c=e[a]),i?pr(s,a,c):vr(s,a,c)}return s};const br=function(e,t){return e&&_r(t,Dn(t),e)};const yr=function(e){var t=[];if(null!=e)for(var s in Object(e))t.push(s);return t};var wr=Object.prototype.hasOwnProperty;const Sr=function(e){if(!Gs(e))return yr(e);var t=jn(e),s=[];for(var n in e)("constructor"!=n||!t&&wr.call(e,n))&&s.push(n);return s};const Ar=function(e){return Rn(e)?Cn(e,!0):Sr(e)};const xr=function(e,t){return e&&_r(t,Ar(t),e)};var Er="object"==typeof exports&&exports&&!exports.nodeType&&exports,$r=Er&&"object"==typeof module&&module&&!module.nodeType&&module,Cr=$r&&$r.exports===Er?Rt.Buffer:void 0,kr=Cr?Cr.allocUnsafe:void 0;const jr=function(e,t){if(t)return e.slice();var s=e.length,n=kr?kr(s):new e.constructor(s);return e.copy(n),n};const Tr=function(e,t){var s=-1,n=e.length;for(t||(t=Array(n));++s<n;)t[s]=e[s];return t};const Or=function(e,t){for(var s=-1,n=null==e?0:e.length,i=0,r=[];++s<n;){var o=e[s];t(o,s,e)&&(r[i++]=o)}return r};const Nr=function(){return[]};var Ir=Object.prototype.propertyIsEnumerable,Mr=Object.getOwnPropertySymbols;const Rr=Mr?function(e){return null==e?[]:(e=Object(e),Or(Mr(e),(function(t){return Ir.call(e,t)})))}:Nr;const Dr=function(e,t){return _r(e,Rr(e),t)};const zr=function(e,t){for(var s=-1,n=t.length,i=e.length;++s<n;)e[i+s]=t[s];return e};const Lr=Tn(Object.getPrototypeOf,Object);var Pr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)zr(t,Rr(e)),e=Lr(e);return t}:Nr;const Fr=Pr;const Ur=function(e,t){return _r(e,Fr(e),t)};const Br=function(e,t,s){var n=t(e);return Lt(e)?n:zr(n,s(e))};const qr=function(e){return Br(e,Dn,Rr)};const Hr=function(e){return Br(e,Ar,Fr)};var Gr=Object.prototype.hasOwnProperty;const Wr=function(e){var t=e.length,s=new e.constructor(t);return t&&"string"==typeof e[0]&&Gr.call(e,"index")&&(s.index=e.index,s.input=e.input),s};const Vr=Rt.Uint8Array;const Qr=function(e){var t=new e.constructor(e.byteLength);return new Vr(t).set(new Vr(e)),t};const Kr=function(e,t){var s=t?Qr(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)};var Jr=/\w*$/;const Yr=function(e){var t=new e.constructor(e.source,Jr.exec(e));return t.lastIndex=e.lastIndex,t};var Xr=Dt?Dt.prototype:void 0,Zr=Xr?Xr.valueOf:void 0;const eo=function(e){return Zr?Object(Zr.call(e)):{}};const to=function(e,t){var s=t?Qr(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)};const so=function(e,t,s){var n=e.constructor;switch(t){case"[object ArrayBuffer]":return Qr(e);case"[object Boolean]":case"[object Date]":return new n(+e);case"[object DataView]":return Kr(e,s);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return to(e,s);case"[object Map]":case"[object Set]":return new n;case"[object Number]":case"[object String]":return new n(e);case"[object RegExp]":return Yr(e);case"[object Symbol]":return eo(e)}};var no=Object.create,io=function(){function e(){}return function(t){if(!Gs(t))return{};if(no)return no(t);e.prototype=t;var s=new e;return e.prototype=void 0,s}}();const ro=io;const oo=function(e){return"function"!=typeof e.constructor||jn(e)?{}:ro(Lr(e))};const ao=function(e){return Qt(e)&&"[object Map]"==Si(e)};var co=An&&An.isMap;const lo=co?bn(co):ao;const uo=function(e){return Qt(e)&&"[object Set]"==Si(e)};var ho=An&&An.isSet;const mo=ho?bn(ho):uo;var go="[object Arguments]",po="[object Function]",fo="[object Object]",vo={};vo[go]=vo["[object Array]"]=vo["[object ArrayBuffer]"]=vo["[object DataView]"]=vo["[object Boolean]"]=vo["[object Date]"]=vo["[object Float32Array]"]=vo["[object Float64Array]"]=vo["[object Int8Array]"]=vo["[object Int16Array]"]=vo["[object Int32Array]"]=vo["[object Map]"]=vo["[object Number]"]=vo[fo]=vo["[object RegExp]"]=vo["[object Set]"]=vo["[object String]"]=vo["[object Symbol]"]=vo["[object Uint8Array]"]=vo["[object Uint8ClampedArray]"]=vo["[object Uint16Array]"]=vo["[object Uint32Array]"]=!0,vo["[object Error]"]=vo[po]=vo["[object WeakMap]"]=!1;const _o=function e(t,s,n,i,r,o){var a,c=1&s,l=2&s,d=4&s;if(n&&(a=r?n(t,i,r,o):n(t)),void 0!==a)return a;if(!Gs(t))return t;var u=Lt(t);if(u){if(a=Wr(t),!c)return Tr(t,a)}else{var h=Si(t),m=h==po||"[object GeneratorFunction]"==h;if(mn(t))return jr(t,c);if(h==fo||h==go||m&&!r){if(a=l||m?{}:oo(t),!c)return l?Ur(t,xr(a,t)):Dr(t,br(a,t))}else{if(!vo[h])return r?t:{};a=so(t,h,c)}}o||(o=new hr);var g=o.get(t);if(g)return g;o.set(t,a),mo(t)?t.forEach((function(i){a.add(e(i,s,n,i,t,o))})):lo(t)&&t.forEach((function(i,r){a.set(r,e(i,s,n,r,t,o))}));var p=u?void 0:(d?l?Hr:qr:l?Ar:Dn)(t);return mr(p||t,(function(i,r){p&&(i=t[r=i]),vr(a,r,e(i,s,n,r,t,o))})),a};const bo=function(e){return _o(e,5)};const yo=function(e){return"string"==typeof e||!Lt(e)&&Qt(e)&&"[object String]"==Vt(e)};const wo=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();const So=function(){try{if(!wo||!wo.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}};const Ao=function(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var s=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)s.append(e[n]);return s.getBlob(t.type)}};"undefined"==typeof Promise&&s(1078);const xo=Promise;const Eo=function(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))};const $o=function(e,t,s){"function"==typeof t&&e.then(t),"function"==typeof s&&e.catch(s)};function Co(e){return"string"!=typeof e&&(console.warn(`${e} used as a key, but it is not a string.`),e=String(e)),e}function ko(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}const jo="local-forage-detect-blob-support";let To;const Oo={},No=Object.prototype.toString,Io="readonly",Mo="readwrite";function Ro(e){return"boolean"==typeof To?xo.resolve(To):function(e){return new xo((function(t){var s=e.transaction(jo,Mo),n=Ao([""]);s.objectStore(jo).put(n,"key"),s.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},s.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),s=navigator.userAgent.match(/Edge\//);t(s||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}(e).then((function(e){return To=e,To}))}function Do(e){var t=Oo[e.name],s={};s.promise=new xo((function(e,t){s.resolve=e,s.reject=t})),t.deferredOperations.push(s),t.dbReady?t.dbReady=t.dbReady.then((function(){return s.promise})):t.dbReady=s.promise}function zo(e){var t=Oo[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function Lo(e,t){var s=Oo[e.name].deferredOperations.pop();if(s)return s.reject(t),s.promise}function Po(e,t){return new xo((function(s,n){if(Oo[e.name]=Oo[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return s(e.db);Do(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var r=wo.open.apply(wo,i);t&&(r.onupgradeneeded=function(t){var s=r.result;try{s.createObjectStore(e.storeName),t.oldVersion<=1&&s.createObjectStore(jo)}catch(s){if("ConstraintError"!==s.name)throw s;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),r.onerror=function(e){e.preventDefault(),n(r.error)},r.onsuccess=function(){var t=r.result;t.onversionchange=function(e){e.target.close()},s(t),zo(e)}}))}function Fo(e){return Po(e,!1)}function Uo(e){return Po(e,!0)}function Bo(e,t){if(!e.db)return!0;var s=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||s){if(s){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function qo(e){var t=function(e){for(var t=e.length,s=new ArrayBuffer(t),n=new Uint8Array(s),i=0;i<t;i++)n[i]=e.charCodeAt(i);return s}(atob(e.data));return Ao([t],{type:e.type})}function Ho(e){return e&&e.__local_forage_encoded_blob}function Go(e){var t=this,s=t._initReady().then((function(){var e=Oo[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return $o(s,e,e),s}function Wo(e,t,s,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);s(null,i)}catch(i){if(n>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return xo.resolve().then((()=>{if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),Uo(e)})).then((()=>function(e){Do(e);for(var t=Oo[e.name],s=t.forages,n=0;n<s.length;n++){const e=s[n];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null)}return e.db=null,Fo(e).then((t=>(e.db=t,Bo(e)?Uo(e):t))).then((n=>{e.db=t.db=n;for(var i=0;i<s.length;i++)s[i]._dbInfo.db=n})).catch((t=>{throw Lo(e,t),t}))}(e).then((function(){Wo(e,t,s,n-1)})))).catch(s);s(i)}}var Vo={_driver:"asyncStorage",_initStorage:function(e){var t=this,s={db:null};if(e)for(var n in e)s[n]=e[n];var i=Oo[s.name];i||(i={forages:[],db:null,dbReady:null,deferredOperations:[]},Oo[s.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=Go);var r=[];function o(){return xo.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&r.push(c._initReady().catch(o))}var l=i.forages.slice(0);return xo.all(r).then((function(){return s.db=i.db,Fo(s)})).then((function(e){return s.db=e,Bo(s,t._defaultConfig.version)?Uo(s):e})).then((function(e){s.db=i.db=e,t._dbInfo=s;for(var n=0;n<l.length;n++){var r=l[n];r!==t&&(r._dbInfo.db=s.db,r._dbInfo.version=s.version)}}))},_support:So(),iterate:function(e,t){var s=this,n=new xo((function(t,n){s.ready().then((function(){Wo(s._dbInfo,Io,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var s=o.result;if(s){var n=s.value;Ho(n)&&(n=qo(n));var i=e(n,s.key,a++);void 0!==i?t(i):s.continue()}else t()},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return Eo(n,t),n},getItem:function(e,t){var s=this;e=Co(e);var n=new xo((function(t,n){s.ready().then((function(){Wo(s._dbInfo,Io,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),Ho(e)&&(e=qo(e)),t(e)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return Eo(n,t),n},setItem:function(e,t,s){var n=this;e=Co(e);var i=new xo((function(s,i){var r;n.ready().then((function(){return r=n._dbInfo,"[object Blob]"===No.call(t)?Ro(r.db).then((function(e){return e?t:(s=t,new xo((function(e,t){var n=new FileReader;n.onerror=t,n.onloadend=function(t){var n=btoa(t.target.result||"");e({__local_forage_encoded_blob:!0,data:n,type:s.type})},n.readAsBinaryString(s)})));var s})):t})).then((function(t){Wo(n._dbInfo,Mo,(function(r,o){if(r)return i(r);try{var a=o.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),s(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return Eo(i,s),i},removeItem:function(e,t){var s=this;e=Co(e);var n=new xo((function(t,n){s.ready().then((function(){Wo(s._dbInfo,Mo,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).delete(e);r.oncomplete=function(){t()},r.onerror=function(){n(o.error)},r.onabort=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return Eo(n,t),n},clear:function(e){var t=this,s=new xo((function(e,s){t.ready().then((function(){Wo(t._dbInfo,Mo,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=r.error?r.error:r.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return Eo(s,e),s},length:function(e){var t=this,s=new xo((function(e,s){t.ready().then((function(){Wo(t._dbInfo,Io,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){s(r.error)}}catch(e){s(e)}}))})).catch(s)}));return Eo(s,e),s},key:function(e,t){var s=this,n=new xo((function(t,n){e<0?t(null):s.ready().then((function(){Wo(s._dbInfo,Io,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var s=c.result;s?0===e||a?t(s.key):(a=!0,s.advance(e)):t(null)},c.onerror=function(){n(c.error)}}catch(e){n(e)}}))})).catch(n)}));return Eo(n,t),n},keys:function(e){var t=this,s=new xo((function(e,s){t.ready().then((function(){Wo(t._dbInfo,Io,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];r.onsuccess=function(){var t=r.result;t?(o.push(t.key),t.continue()):e(o)},r.onerror=function(){s(r.error)}}catch(e){s(e)}}))})).catch(s)}));return Eo(s,e),s},dropInstance:function(e,t){t=ko.apply(this,arguments);var s,n=this.config();if((e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName),e.name){const t=e.name===n.name&&this._dbInfo.db?xo.resolve(this._dbInfo.db):Fo(e).then((t=>{const s=Oo[e.name],n=s.forages;s.db=t;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=t;return t}));s=e.storeName?t.then((t=>{if(!t.objectStoreNames.contains(e.storeName))return;const s=t.version+1;Do(e);const n=Oo[e.name],i=n.forages;t.close();for(let e=0;e<i.length;e++){const t=i[e];t._dbInfo.db=null,t._dbInfo.version=s}const r=new xo(((t,n)=>{const i=wo.open(e.name,s);i.onerror=e=>{i.result.close(),n(e)},i.onupgradeneeded=()=>{i.result.deleteObjectStore(e.storeName)},i.onsuccess=()=>{const e=i.result;e.close(),t(e)}}));return r.then((e=>{n.db=e;for(let t=0;t<i.length;t++){const s=i[t];s._dbInfo.db=e,zo(s._dbInfo)}})).catch((t=>{throw(Lo(e,t)||xo.resolve()).catch((()=>{})),t}))})):t.then((t=>{Do(e);const s=Oo[e.name],n=s.forages;t.close();for(var i=0;i<n.length;i++){n[i]._dbInfo.db=null}const r=new xo(((t,s)=>{var n=wo.deleteDatabase(e.name);n.onerror=()=>{const e=n.result;e&&e.close(),s(n.error)},n.onblocked=()=>{console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},n.onsuccess=()=>{const e=n.result;e&&e.close(),t(e)}}));return r.then((e=>{s.db=e;for(var t=0;t<n.length;t++){zo(n[t]._dbInfo)}})).catch((t=>{throw(Lo(e,t)||xo.resolve()).catch((()=>{})),t}))}))}else s=xo.reject("Invalid arguments");return Eo(s,t),s}};const Qo=Vo;const Ko=function(){return"function"==typeof openDatabase};var Jo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Yo=/^~~local_forage_type~([^~]+)~/,Xo="__lfsc__:",Zo="arbf",ea="blob",ta="si08",sa="ui08",na="uic8",ia="si16",ra="si32",oa="ur16",aa="ui32",ca="fl32",la="fl64",da=Object.prototype.toString;function ua(e){var t,s,n,i,r,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),d=new Uint8Array(l);for(t=0;t<a;t+=4)s=Jo.indexOf(e[t]),n=Jo.indexOf(e[t+1]),i=Jo.indexOf(e[t+2]),r=Jo.indexOf(e[t+3]),d[c++]=s<<2|n>>4,d[c++]=(15&n)<<4|i>>2,d[c++]=(3&i)<<6|63&r;return l}function ha(e){var t,s=new Uint8Array(e),n="";for(t=0;t<s.length;t+=3)n+=Jo[s[t]>>2],n+=Jo[(3&s[t])<<4|s[t+1]>>4],n+=Jo[(15&s[t+1])<<2|s[t+2]>>6],n+=Jo[63&s[t+2]];return s.length%3==2?n=n.substring(0,n.length-1)+"=":s.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var ma={serialize:function(e,t){var s="";if(e&&(s=da.call(e)),e&&("[object ArrayBuffer]"===s||e.buffer&&"[object ArrayBuffer]"===da.call(e.buffer))){var n,i=Xo;e instanceof ArrayBuffer?(n=e,i+=Zo):(n=e.buffer,"[object Int8Array]"===s?i+=ta:"[object Uint8Array]"===s?i+=sa:"[object Uint8ClampedArray]"===s?i+=na:"[object Int16Array]"===s?i+=ia:"[object Uint16Array]"===s?i+=oa:"[object Int32Array]"===s?i+=ra:"[object Uint32Array]"===s?i+=aa:"[object Float32Array]"===s?i+=ca:"[object Float64Array]"===s?i+=la:t(new Error("Failed to get type for BinaryArray"))),t(i+ha(n))}else if("[object Blob]"===s){var r=new FileReader;r.onload=function(){var s="~~local_forage_type~"+e.type+"~"+ha(this.result);t(Xo+ea+s)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(s){console.error("Couldn't convert value into a JSON string: ",e),t(null,s)}},deserialize:function(e){if(e.substring(0,9)!==Xo)return JSON.parse(e);var t,s=e.substring(13),n=e.substring(9,13);if(n===ea&&Yo.test(s)){var i=s.match(Yo);t=i[1],s=s.substring(i[0].length)}var r=ua(s);switch(n){case Zo:return r;case ea:return Ao([r],{type:t});case ta:return new Int8Array(r);case sa:return new Uint8Array(r);case na:return new Uint8ClampedArray(r);case ia:return new Int16Array(r);case oa:return new Uint16Array(r);case ra:return new Int32Array(r);case aa:return new Uint32Array(r);case ca:return new Float32Array(r);case la:return new Float64Array(r);default:throw new Error("Unkown type: "+n)}},stringToBuffer:ua,bufferToString:ha};const ga=ma;function pa(e,t,s,n){e.executeSql(`CREATE TABLE IF NOT EXISTS ${t.storeName} (id INTEGER PRIMARY KEY, key unique, value)`,[],s,n)}function fa(e,t,s,n,i,r){e.executeSql(s,n,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?r(e,o):pa(e,t,(function(){e.executeSql(s,n,i,r)}),r)}),r):r(e,o)}),r)}function va(e,t,s,n){var i=this;e=Co(e);var r=new xo((function(r,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?o(l):c.db.transaction((function(s){fa(s,c,`INSERT OR REPLACE INTO ${c.storeName} (key, value) VALUES (?, ?)`,[e,t],(function(){r(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void r(va.apply(i,[e,a,s,n-1]));o(t)}}))}))})).catch(o)}));return Eo(r,s),r}var _a={_driver:"webSQLStorage",_initStorage:function(e){var t=this,s={db:null};if(e)for(var n in e)s[n]="string"!=typeof e[n]?e[n].toString():e[n];var i=new xo((function(e,n){try{s.db=openDatabase(s.name,String(s.version),s.description,s.size)}catch(e){return n(e)}s.db.transaction((function(i){pa(i,s,(function(){t._dbInfo=s,e()}),(function(e,t){n(t)}))}),n)}));return s.serializer=ga,i},_support:Ko(),iterate:function(e,t){var s=this,n=new xo((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){fa(s,i,`SELECT * FROM ${i.storeName}`,[],(function(s,n){for(var r=n.rows,o=r.length,a=0;a<o;a++){var c=r.item(a),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){n(t)}))}))})).catch(n)}));return Eo(n,t),n},getItem:function(e,t){var s=this;e=Co(e);var n=new xo((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){fa(s,i,`SELECT * FROM ${i.storeName} WHERE key = ? LIMIT 1`,[e],(function(e,s){var n=s.rows.length?s.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return Eo(n,t),n},setItem:function(e,t,s){return va.apply(this,[e,t,s,1])},removeItem:function(e,t){var s=this;e=Co(e);var n=new xo((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){fa(s,i,`DELETE FROM ${i.storeName} WHERE key = ?`,[e],(function(){t()}),(function(e,t){n(t)}))}))})).catch(n)}));return Eo(n,t),n},clear:function(e){var t=this,s=new xo((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){fa(t,n,`DELETE FROM ${n.storeName}`,[],(function(){e()}),(function(e,t){s(t)}))}))})).catch(s)}));return Eo(s,e),s},length:function(e){var t=this,s=new xo((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){fa(t,n,`SELECT COUNT(key) as c FROM ${n.storeName}`,[],(function(t,s){var n=s.rows.item(0).c;e(n)}),(function(e,t){s(t)}))}))})).catch(s)}));return Eo(s,e),s},key:function(e,t){var s=this,n=new xo((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){fa(s,i,`SELECT key FROM ${i.storeName} WHERE id = ? LIMIT 1`,[e+1],(function(e,s){var n=s.rows.length?s.rows.item(0).key:null;t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return Eo(n,t),n},keys:function(e){var t=this,s=new xo((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){fa(t,n,`SELECT key FROM ${n.storeName}`,[],(function(t,s){for(var n=[],i=0;i<s.rows.length;i++)n.push(s.rows.item(i).key);e(n)}),(function(e,t){s(t)}))}))})).catch(s)}));return Eo(s,e),s},dropInstance:function(e,t){t=ko.apply(this,arguments);var s=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||s.name,e.storeName=e.storeName||s.storeName);var n,i=this;return n=e.name?new xo((function(t){var n;n=e.name===s.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:n,storeNames:[e.storeName]}):t(function(e){return new xo((function(t,s){e.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(s,n){for(var i=[],r=0;r<n.rows.length;r++)i.push(n.rows.item(r).name);t({db:e,storeNames:i})}),(function(e,t){s(t)}))}),(function(e){s(e)}))}))}(n))})).then((function(e){return new xo((function(t,s){e.db.transaction((function(n){function i(e){return new xo((function(t,s){n.executeSql(`DROP TABLE IF EXISTS ${e}`,[],(function(){t()}),(function(e,t){s(t)}))}))}for(var r=[],o=0,a=e.storeNames.length;o<a;o++)r.push(i(e.storeNames[o]));xo.all(r).then((function(){t()})).catch((function(e){s(e)}))}),(function(e){s(e)}))}))})):xo.reject("Invalid arguments"),Eo(n,t),n}};const ba=_a;function ya(e,t){var s=e.name+"/";return e.storeName!==t.storeName&&(s+=e.storeName+"/"),s}function wa(){return!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}()||localStorage.length>0}var Sa={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var s in e)t[s]=e[s];return t.keyPrefix=ya(e,this._defaultConfig),wa()?(this._dbInfo=t,t.serializer=ga,xo.resolve()):xo.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var s=this,n=s.ready().then((function(){for(var t=s._dbInfo,n=t.keyPrefix,i=n.length,r=localStorage.length,o=1,a=0;a<r;a++){var c=localStorage.key(a);if(0===c.indexOf(n)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),o++)))return l}}}));return Eo(n,t),n},getItem:function(e,t){var s=this;e=Co(e);var n=s.ready().then((function(){var t=s._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n}));return Eo(n,t),n},setItem:function(e,t,s){var n=this;e=Co(e);var i=n.ready().then((function(){void 0===t&&(t=null);var s=t;return new xo((function(i,r){var o=n._dbInfo;o.serializer.serialize(t,(function(t,n){if(n)r(n);else try{localStorage.setItem(o.keyPrefix+e,t),i(s)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}}))}))}));return Eo(i,s),i},removeItem:function(e,t){var s=this;e=Co(e);var n=s.ready().then((function(){var t=s._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return Eo(n,t),n},clear:function(e){var t=this,s=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,s=localStorage.length-1;s>=0;s--){var n=localStorage.key(s);0===n.indexOf(e)&&localStorage.removeItem(n)}}));return Eo(s,e),s},length:function(e){var t=this.keys().then((function(e){return e.length}));return Eo(t,e),t},key:function(e,t){var s=this,n=s.ready().then((function(){var t,n=s._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t}));return Eo(n,t),n},keys:function(e){var t=this,s=t.ready().then((function(){for(var e=t._dbInfo,s=localStorage.length,n=[],i=0;i<s;i++){var r=localStorage.key(i);0===r.indexOf(e.keyPrefix)&&n.push(r.substring(e.keyPrefix.length))}return n}));return Eo(s,e),s},dropInstance:function(e,t){if(t=ko.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var s=this.config();e.name=e.name||s.name,e.storeName=e.storeName||s.storeName}var n,i=this;return n=e.name?new xo((function(t){e.storeName?t(ya(e,i._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var s=localStorage.key(t);0===s.indexOf(e)&&localStorage.removeItem(s)}})):xo.reject("Invalid arguments"),Eo(n,t),n}};const Aa=Sa,xa=(e,t)=>e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t),Ea=(e,t)=>{const s=e.length;let n=0;for(;n<s;){if(xa(e[n],t))return!0;n++}return!1},$a=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Ca={},ka={},ja={INDEXEDDB:Qo,WEBSQL:ba,LOCALSTORAGE:Aa},Ta=[ja.INDEXEDDB._driver,ja.WEBSQL._driver,ja.LOCALSTORAGE._driver],Oa=["dropInstance"],Na=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(Oa),Ia={description:"",driver:Ta.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function Ma(e,t){e[t]=function(){const s=arguments;return e.ready().then((function(){return e[t].apply(e,s)}))}}function Ra(){for(let e=1;e<arguments.length;e++){const t=arguments[e];if(t)for(let e in t)t.hasOwnProperty(e)&&($a(t[e])?arguments[0][e]=t[e].slice():arguments[0][e]=t[e])}return arguments[0]}class Da{constructor(e){for(let e in ja)if(ja.hasOwnProperty(e)){const t=ja[e],s=t._driver;this[e]=s,Ca[s]||this.defineDriver(t)}this._defaultConfig=Ra({},Ia),this._config=Ra({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((()=>{}))}config(e){if("object"==typeof e){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(let t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config}defineDriver(e,t,s){const n=new xo((function(t,s){try{const n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void s(i);const r=Na.concat("_initStorage");for(let t=0,n=r.length;t<n;t++){const n=r[t];if((!Ea(Oa,n)||e[n])&&"function"!=typeof e[n])return void s(i)}const o=function(){const t=function(e){return function(){const t=new Error(`Method ${e} is not implemented by the current driver`),s=xo.reject(t);return Eo(s,arguments[arguments.length-1]),s}};for(let s=0,n=Oa.length;s<n;s++){const n=Oa[s];e[n]||(e[n]=t(n))}};o();const a=function(s){Ca[n]&&console.info(`Redefining LocalForage driver: ${n}`),Ca[n]=e,ka[n]=s,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(a,s):a(!!e._support):a(!0)}catch(e){s(e)}}));return $o(n,t,s),n}driver(){return this._driver||null}getDriver(e,t,s){const n=Ca[e]?xo.resolve(Ca[e]):xo.reject(new Error("Driver not found."));return $o(n,t,s),n}getSerializer(e){const t=xo.resolve(ga);return $o(t,e),t}ready(e){const t=this,s=t._driverSet.then((()=>(null===t._ready&&(t._ready=t._initDriver()),t._ready)));return $o(s,e,e),s}setDriver(e,t,s){const n=this;$a(e)||(e=[e]);const i=this._getSupportedDrivers(e);function r(){n._config.driver=n.driver()}function o(e){return n._extend(e),r(),n._ready=n._initStorage(n._config),n._ready}const a=null!==this._driverSet?this._driverSet.catch((()=>xo.resolve())):xo.resolve();return this._driverSet=a.then((()=>{const e=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then((e=>{n._driver=e._driver,r(),n._wrapLibraryMethodsWithReady(),n._initDriver=function(e){return function(){let t=0;return function s(){for(;t<e.length;){let i=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(i).then(o).catch(s)}r();const i=new Error("No available storage method found.");return n._driverSet=xo.reject(i),n._driverSet}()}}(i)}))})).catch((()=>{r();const e=new Error("No available storage method found.");return n._driverSet=xo.reject(e),n._driverSet})),$o(this._driverSet,t,s),this._driverSet}supports(e){return!!ka[e]}_extend(e){Ra(this,e)}_getSupportedDrivers(e){const t=[];for(let s=0,n=e.length;s<n;s++){const n=e[s];this.supports(n)&&t.push(n)}return t}_wrapLibraryMethodsWithReady(){for(let e=0,t=Na.length;e<t;e++)Ma(this,Na[e])}createInstance(e){return new Da(e)}}const za=new Da;const La=function(e,t,s){(void 0!==s&&!Ni(e[t],s)||void 0===s&&!(t in e))&&pr(e,t,s)};const Pa=function(e){return function(t,s,n){for(var i=-1,r=Object(t),o=n(t),a=o.length;a--;){var c=o[e?a:++i];if(!1===s(r[c],c,r))break}return t}};const Fa=Pa();const Ua=function(e){return Qt(e)&&Rn(e)};var Ba=Function.prototype,qa=Object.prototype,Ha=Ba.toString,Ga=qa.hasOwnProperty,Wa=Ha.call(Object);const Va=function(e){if(!Qt(e)||"[object Object]"!=Vt(e))return!1;var t=Lr(e);if(null===t)return!0;var s=Ga.call(t,"constructor")&&t.constructor;return"function"==typeof s&&s instanceof s&&Ha.call(s)==Wa};const Qa=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]};const Ka=function(e){return _r(e,Ar(e))};const Ja=function(e,t,s,n,i,r,o){var a=Qa(e,s),c=Qa(t,s),l=o.get(c);if(l)La(e,s,l);else{var d=r?r(a,c,s+"",e,t,o):void 0,u=void 0===d;if(u){var h=Lt(c),m=!h&&mn(c),g=!h&&!m&&En(c);d=c,h||m||g?Lt(a)?d=a:Ua(a)?d=Tr(a):m?(u=!1,d=jr(c,!0)):g?(u=!1,d=to(c,!0)):d=[]:Va(c)||cn(c)?(d=a,cn(a)?d=Ka(a):Gs(a)&&!Mn(a)||(d=oo(c))):u=!1}u&&(o.set(c,d),i(d,c,n,r,o),o.delete(c)),La(e,s,d)}};const Ya=function e(t,s,n,i,r){t!==s&&Fa(s,(function(o,a){if(r||(r=new hr),Gs(o))Ja(t,s,a,n,e,i,r);else{var c=i?i(Qa(t,a),o,a+"",t,s,r):void 0;void 0===c&&(c=o),La(t,a,c)}}),Ar)};const Xa=function(e){return e};const Za=function(e,t,s){switch(s.length){case 0:return e.call(t);case 1:return e.call(t,s[0]);case 2:return e.call(t,s[0],s[1]);case 3:return e.call(t,s[0],s[1],s[2])}return e.apply(t,s)};var ec=Math.max;const tc=function(e,t,s){return t=ec(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,r=ec(n.length-t,0),o=Array(r);++i<r;)o[i]=n[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=n[i];return a[t]=s(o),Za(e,this,a)}};const sc=function(e){return function(){return e}};const nc=gr?function(e,t){return gr(e,"toString",{configurable:!0,enumerable:!1,value:sc(t),writable:!0})}:Xa;var ic=Date.now;const rc=function(e){var t=0,s=0;return function(){var n=ic(),i=16-(n-s);if(s=n,i>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(nc);const oc=function(e,t){return rc(tc(e,t,Xa),e+"")};const ac=function(e,t,s){if(!Gs(s))return!1;var n=typeof t;return!!("number"==n?Rn(s)&&pn(t,s.length):"string"==n&&t in s)&&Ni(s[t],e)};const cc=function(e){return oc((function(t,s){var n=-1,i=s.length,r=i>1?s[i-1]:void 0,o=i>2?s[2]:void 0;for(r=e.length>3&&"function"==typeof r?(i--,r):void 0,o&&ac(s[0],s[1],o)&&(r=i<3?void 0:r,i=1),t=Object(t);++n<i;){var a=s[n];a&&e(t,a,n,r)}return t}))};const lc=cc((function(e,t,s){Ya(e,t,s)}));const dc=cc((function(e,t,s,n){Ya(e,t,s,n)}));const uc=function(){return Rt.Date.now()};function hc(){const e={isResolved:!1,isPending:!0,isRejected:!1},t=new Promise(((t,s)=>{e.resolve=t,e.reject=s}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}const mc=Math.max,gc=Math.min;const pc=function(e,t,s={}){let n,i,r,o,a,c,l=0,d=!1,u=s.promise?hc():null;if("function"!=typeof e)throw new TypeError("Expected a function");function h(t){const r=n,a=i,c=u;return n=i=void 0,l=t,o=e.apply(a,r),s.promise&&(c.resolve(o),u=hc()),s.promise?c:o}function m(e){const s=e-c;return void 0===c||s>=t||s<0||d&&e-l>=r}function g(){const e=uc();if(m(e))return p(e);a=setTimeout(g,function(e){const s=t-(e-c);return d?gc(s,r-(e-l)):s}(e))}function p(e){return a=void 0,n?h(e):(n=i=void 0,s.promise?u:o)}function f(e,t){if(Array.isArray(e)&&Array.isArray(t))return s?.dedupeArrays?e.concat(t.filter((t=>-1===e.indexOf(t)))):e.concat(t)}function v(){const e=uc(),r=m(e);var p;if(p=Array.from(arguments),n=n?.length?p.length?s?.concatArrays||s?.dedupeArrays?dc(n,p,f):lc(n,p):n:p||[],i=this,c=e,r){if(void 0===a)return function(e){return l=e,a=setTimeout(g,t),s.promise?u:o}(c);if(d)return clearTimeout(a),a=setTimeout(g,t),h(c)}return void 0===a&&(a=setTimeout(g,t)),s.promise?u:o}return t=Js(t)||0,Gs(s)&&(d="maxWait"in s,r=d?mc(Js(s.maxWait)||0,t):r),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,n=c=i=a=void 0},v.flush=function(){return void 0===a?o:p(uc())},v};function fc(e,t){let s=e.name+"/";return e.storeName!==t.storeName&&(s+=e.storeName+"/"),s}const vc={serializer:{serialize:ga.serialize,deserialize:ga.deserialize}};const _c={_driver:"sessionStorageWrapper",_initStorage:function(e){if(vc.keyPrefix=fc(e,this._defaultConfig),e)for(const t in e)vc[t]=e[t]},_support:function(){try{if(sessionStorage&&"setItem"in sessionStorage)return!0}catch(e){console.log(e)}return!1}(),iterate:function(e,t){const s=this.ready().then((function(){const t=vc.keyPrefix,s=t.length,n=sessionStorage.length;let i=1;for(let r=0;r<n;r++){const n=sessionStorage.key(r);if(0!==n.indexOf(t))continue;let o=sessionStorage.getItem(n);if(o&&(o=vc.serializer.deserialize(o)),o=e(o,n.substring(s),i++),void 0!==o)return o}}));return Eo(s,t),s},getItem:function(e,t){e=Co(e);const s=this.ready().then((function(){let t=sessionStorage.getItem(vc.keyPrefix+e);return t&&(t=vc.serializer.deserialize(t)),t}));return Eo(s,t),s},setItem:async function(e,t,s){e=Co(e),await this.ready();const n=t=t??null;vc.serializer.serialize(t,((t,i)=>{if(i)throw i;try{sessionStorage.setItem(vc.keyPrefix+e,t),Eo(Promise.resolve(n),s)}catch(e){if("QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)throw console.error("Your sesionStorage capacity is used up."),e;throw e}}))},removeItem:function(e,t){e=Co(e);const s=this.ready().then((function(){sessionStorage.removeItem(vc.keyPrefix+e)}));return Eo(s,t),s},clear:function(e){const t=this.ready().then((function(){const e=vc.keyPrefix;for(let t=sessionStorage.length-1;t>=0;t--){const s=sessionStorage.key(t);0===s.indexOf(e)&&sessionStorage.removeItem(s)}}));return Eo(t,e),t},length:function(e){const t=this.keys().then((function(e){return e.length}));return Eo(t,e),t},key:function(e,t){const s=this.ready().then((function(){let t;try{t=sessionStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(vc.keyPrefix.length)),t}));return Eo(s,t),s},keys:function(e){const t=this.ready().then((function(){const e=sessionStorage.length,t=[];for(let s=0;s<e;s++){const e=sessionStorage.key(s);0===e.indexOf(vc.keyPrefix)&&t.push(e.substring(vc.keyPrefix.length))}return t}));return Eo(t,e),t},dropInstance:function(e,t){if(t=ko.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){const t=this.config();e.name=e.name||t.name,e.storeName=e.storeName||t.storeName}const s=this;let n;return n=e.name?new Promise((function(t){e.storeName?t(fc(e,s._defaultConfig)):t(`${e.name}/`)})).then((function(e){for(let t=sessionStorage.length-1;t>=0;t--){const s=sessionStorage.key(t);0===s.indexOf(e)&&sessionStorage.removeItem(s)}})):Promise.reject(new Error("Invalid arguments")),Eo(n,t),n}},bc=_c;var yc=s(9212),wc=s(9214);function Sc(e){return Sc.result?Sc.result:e&&"function"==typeof e.getSerializer?(Sc.result=e.getSerializer(),Sc.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function Ac(e,t){return t&&e.then((function(e){t(null,e)}),(function(e){t(e)})),e}function xc(e,t){var s=this.getItem(e).then((function(t){return{key:e,value:t}}));return Ac(s,t),s}function Ec(e){var t=this,s=new Promise((function(s,n){for(var i=[],r=0,o=e.length;r<o;r++)i.push(xc.call(t,e[r]));Promise.all(i).then((function(e){for(var t={},n=0,i=e.length;n<i;n++){var r=e[n];t[r.key]=r.value}s(t)})).catch(n)}));return s}function $c(){var e={};return this.iterate((function(t,s){e[s]=t})).then((function(){return e}))}var Cc="undefined"!=typeof IDBKeyRange?IDBKeyRange:"undefined"!=typeof webkitIDBKeyRange?webkitIDBKeyRange:"undefined"!=typeof mozIDBKeyRange?mozIDBKeyRange:void 0;function kc(e){e=e.slice();var t=this;function s(e,t){return e<t?-1:e>t?1:0}var n=new Promise((function(n,i){t.ready().then((function(){var r,o=t._dbInfo,a=o.db.transaction(o.storeName,"readonly").objectStore(o.storeName),c=e.sort(s),l=Cc.bound(e[0],e[e.length-1],!1,!1);if("getAll"in a)(r=a.getAll(l)).onsuccess=function(){var e=r.result;void 0===e&&(e=null),n(e)};else{r=a.openCursor(l);var d={},u=0;r.onsuccess=function(){var e=r.result;if(e){for(var t=e.key;t>c[u];)if(++u===c.length)return void n(d);if(t===c[u]){var s=e.value;void 0===s&&(s=null),d[t]=s,e.continue()}else e.continue(c[u])}else n(d)}}r.onerror=function(){i(r.error)}})).catch(i)}));return n}function jc(e){var t=this,s=new Promise((function(s,n){t.ready().then((function(){return Sc(t)})).then((function(i){var r=t._dbInfo;r.db.transaction((function(t){for(var o=new Array(e.length),a=0,c=e.length;a<c;a++)o[a]="?";t.executeSql("SELECT * FROM "+r.storeName+" WHERE (key IN ("+o.join(",")+"))",e,(function(e,t){for(var n={},r=t.rows,o=0,a=r.length;o<a;o++){var c=r.item(o),l=c.value;l&&(l=i.deserialize(l)),n[c.key]=l}s(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return s}function Tc(e,t){var s,n=this;if(arguments.length&&null!==e){var i=n.driver();s=i===n.INDEXEDDB?kc.apply(n,arguments):i===n.WEBSQL?jc.apply(n,arguments):Ec.apply(n,arguments)}else s=$c.apply(n);return Ac(s,t),s}function Oc(e){var t=Object.getPrototypeOf(e);t&&(t.getItems=Tc,t.getItems.indexedDB=function(){return kc.apply(this,arguments)},t.getItems.websql=function(){return jc.apply(this,arguments)},t.getItems.generic=function(){return Ec.apply(this,arguments)})}Oc(s.n(wc)());var Nc=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ic=/^\w*$/;const Mc=function(e,t){if(Lt(e))return!1;var s=typeof e;return!("number"!=s&&"symbol"!=s&&"boolean"!=s&&null!=e&&!Kt(e))||(Ic.test(e)||!Nc.test(e)||null!=t&&e in Object(t))};function Rc(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var s=function(){var n=arguments,i=t?t.apply(this,n):n[0],r=s.cache;if(r.has(i))return r.get(i);var o=e.apply(this,n);return s.cache=r.set(i,o)||r,o};return s.cache=new(Rc.Cache||lr),s}Rc.Cache=lr;const Dc=Rc;const zc=function(e){var t=Dc(e,(function(e){return 500===s.size&&s.clear(),e})),s=t.cache;return t};var Lc=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Pc=/\\(\\)?/g,Fc=zc((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(Lc,(function(e,s,n,i){t.push(n?i.replace(Pc,"$1"):s||e)})),t}));const Uc=Fc;const Bc=function(e,t){return Lt(e)?e:Mc(e,t)?[e]:Uc(Zt(e))};const qc=function(e){if("string"==typeof e||Kt(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t};const Hc=function(e,t,s){var n=-1,i=(t=Bc(t,e)).length;for(i||(i=1,e=void 0);++n<i;){var r=null==e?void 0:e[qc(t[n])];void 0===r&&(n=i,r=s),e=Mn(r)?r.call(e):r}return e};function Gc(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function Wc(){const e={isResolved:!1,isPending:!0,isRejected:!1,resolve:null,reject:null},t=new Promise(((t,s)=>{e.resolve=t,e.reject=s}));return Object.assign(t,e),t.then((function(e){return t.isResolved=!0,t.isPending=!1,t.isRejected=!1,e}),(function(e){throw t.isResolved=!1,t.isPending=!1,t.isRejected=!0,e})),t}function Vc(){throw new Error('A "url" property or function must be specified')}function Qc(e,t){const s=t.error;t.error=function(n){s&&s.call(t.context,e,n,t),e.trigger("error",e,n,t)}}const Kc={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};function Jc(e){const t=Hc(e,"browserStorage")||Hc(e.collection,"browserStorage");return t?t.sync():Yc}function Yc(e,t,s={}){let n=s.data;null!=n||!t||"create"!==e&&"update"!==e&&"patch"!==e||(n=s.attrs||t.toJSON());const i={method:Kc[e],body:n?JSON.stringify(n):"",success:s.success,error:s.error},r=s.url||Hc(t,"url")||Vc(),o=s.xhr=fetch(r,i);return t.trigger("request",t,o,{...i,xhr:o}),o}const Xc=Ti._driver;za.defineDriver(Ti),(0,yc.extendPrototype)(za),Oc(za);class Zc{constructor(e,t,s=!1){if("local"===t&&!window.localStorage)throw new Error("Skeletor.storage: Environment does not support localStorage.");if("session"===t&&!window.sessionStorage)throw new Error("Skeletor.storage: Environment does not support sessionStorage.");yo(t)?this.storeInitialized=this.initStore(t,s):(this.store=t,s&&(this.store.debouncedSetItems=pc((e=>this.store.setItems(e)),50,{promise:!0})),this.storeInitialized=Promise.resolve()),this.name=e}async initStore(e,t){if("session"===e)await za.setDriver(bc._driver);else if("local"===e)await za.config({driver:za.LOCALSTORAGE});else if("in_memory"===e)await za.config({driver:Xc});else if("indexed"!==e)throw new Error("Skeletor.storage: No storage type was specified");this.store=za,t&&(this.store.debouncedSetItems=pc((e=>this.store.setItems(e)),50,{promise:!0}))}flush(){return this.store.debouncedSetItems?.flush()}async clear(){await this.store.removeItem(this.name).catch((e=>console.error(e)));const e=new RegExp(`^${this.name}-`),t=(await this.store.keys()).filter((t=>e.test(t)));await Promise.all(t.map((e=>this.store.removeItem(e).catch((e=>console.error(e))))))}sync(){const e=this;async function t(t,s,n){let i,r,o,a;const c=s.collection;["patch","update"].includes(t)&&(a=bo(s.attributes)),await e.storeInitialized;try{const r=s.attributes;switch(t){case"read":i=void 0!==s.id?await e.find(s):await e.findAll();break;case"create":i=await e.create(s,n);break;case"patch":case"update":n.wait&&(s.attributes=a),o=e.update(s),n.wait&&(s.attributes=r),i=await o;break;case"delete":i=await e.destroy(s,c)}}catch(t){r=22===t.code&&0===e.getStorageSize()?"Private browsing is unsupported":t.message}if(i){if(n&&n.success){const e="read"===t?i:null;n.success(e,n)}}else r=r||"Record Not Found",n&&n.error&&n.error(r)}return t.__name__="localSync",t}removeCollectionReference(e,t){if(!t)return;const s=t.filter((t=>t.id!==e.id)).map((e=>this.getItemName(e.id)));return this.store.setItem(this.name,s)}addCollectionReference(e,t){if(!t)return;const s=t.map((e=>this.getItemName(e.id))),n=this.getItemName(e.id);return s.includes(n)||s.push(n),this.store.setItem(this.name,s)}getCollectionReferenceData(e){if(!e.collection)return{};const t=e.collection.map((e=>this.getItemName(e.id))),s=this.getItemName(e.id);t.includes(s)||t.push(s);const n={};return n[this.name]=t,n}async save(e){if(this.store.setItems){const t={};return t[this.getItemName(e.id)]=e.toJSON(),Object.assign(t,this.getCollectionReferenceData(e)),this.store.debouncedSetItems?this.store.debouncedSetItems(t):this.store.setItems(t)}{const t=this.getItemName(e.id),s=await this.store.setItem(t,e.toJSON());return await this.addCollectionReference(e,e.collection),s}}create(e,t){return e.id||(e.id=Gc()+Gc()+"-"+Gc()+"-"+Gc()+"-"+Gc()+"-"+Gc()+Gc()+Gc(),e.set(e.idAttribute,e.id,t)),this.save(e)}update(e){return this.save(e)}find(e){return this.store.getItem(this.getItemName(e.id))}async findAll(){const e=await this.store.getItem(this.name);if(e?.length){const t=await this.store.getItems(e);return Object.values(t)}return[]}async destroy(e,t){return await this.flush(),await this.store.removeItem(this.getItemName(e.id)),await this.removeCollectionReference(e,t),e}getStorageSize(){return this.store.length}getItemName(e){return this.name+"-"+e}}Zc.sessionStorageInitialized=za.defineDriver(bc),Zc.localForage=za;const el=Zc;const tl=function(e){return _o(e,4)};var sl=Object.prototype,nl=sl.hasOwnProperty,il=oc((function(e,t){e=Object(e);var s=-1,n=t.length,i=n>2?t[2]:void 0;for(i&&ac(t[0],t[1],i)&&(n=1);++s<n;)for(var r=t[s],o=Ar(r),a=-1,c=o.length;++a<c;){var l=o[a],d=e[l];(void 0===d||Ni(d,sl[l])&&!nl.call(e,l))&&(e[l]=r[l])}return e}));const rl=il;const ol=function(e,t,s){if("function"!=typeof e)throw new TypeError("Expected a function");return setTimeout((function(){e.apply(void 0,s)}),t)};const al=oc((function(e,t){return ol(e,1,t)}));var cl=Object.prototype.hasOwnProperty;const ll=function(e,t){return null!=e&&cl.call(e,t)};const dl=function(e,t,s){for(var n=-1,i=(t=Bc(t,e)).length,r=!1;++n<i;){var o=qc(t[n]);if(!(r=null!=e&&s(e,o)))break;e=e[o]}return r||++n!=i?r:!!(i=null==e?0:e.length)&&fn(i)&&pn(o,i)&&(Lt(e)||cn(e))};const ul=function(e,t){return null!=e&&dl(e,t,ll)};const hl=function(e,t){return e&&Fa(e,t,Dn)};const ml=function(e,t,s,n){return hl(e,(function(e,i,r){t(n,s(e),i,r)})),n};const gl=function(e,t){return function(s,n){return ml(s,e,t(n),{})}};var pl=Object.prototype.toString,fl=gl((function(e,t,s){null!=t&&"function"!=typeof t.toString&&(t=pl.call(t)),e[t]=s}),sc(Xa));const vl=fl;const _l=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this};const bl=function(e){return this.__data__.has(e)};function yl(e){var t=-1,s=null==e?0:e.length;for(this.__data__=new lr;++t<s;)this.add(e[t])}yl.prototype.add=yl.prototype.push=_l,yl.prototype.has=bl;const wl=yl;const Sl=function(e,t){for(var s=-1,n=null==e?0:e.length;++s<n;)if(t(e[s],s,e))return!0;return!1};const Al=function(e,t){return e.has(t)};const xl=function(e,t,s,n,i,r){var o=1&s,a=e.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=r.get(e),d=r.get(t);if(l&&d)return l==t&&d==e;var u=-1,h=!0,m=2&s?new wl:void 0;for(r.set(e,t),r.set(t,e);++u<a;){var g=e[u],p=t[u];if(n)var f=o?n(p,g,u,t,e,r):n(g,p,u,e,t,r);if(void 0!==f){if(f)continue;h=!1;break}if(m){if(!Sl(t,(function(e,t){if(!Al(m,t)&&(g===e||i(g,e,s,n,r)))return m.push(t)}))){h=!1;break}}else if(g!==p&&!i(g,p,s,n,r)){h=!1;break}}return r.delete(e),r.delete(t),h};const El=function(e){var t=-1,s=Array(e.size);return e.forEach((function(e,n){s[++t]=[n,e]})),s};const $l=function(e){var t=-1,s=Array(e.size);return e.forEach((function(e){s[++t]=e})),s};var Cl=Dt?Dt.prototype:void 0,kl=Cl?Cl.valueOf:void 0;const jl=function(e,t,s,n,i,r,o){switch(s){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!r(new Vr(e),new Vr(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ni(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=El;case"[object Set]":var c=1&n;if(a||(a=$l),e.size!=t.size&&!c)return!1;var l=o.get(e);if(l)return l==t;n|=2,o.set(e,t);var d=xl(a(e),a(t),n,i,r,o);return o.delete(e),d;case"[object Symbol]":if(kl)return kl.call(e)==kl.call(t)}return!1};var Tl=Object.prototype.hasOwnProperty;const Ol=function(e,t,s,n,i,r){var o=1&s,a=qr(e),c=a.length;if(c!=qr(t).length&&!o)return!1;for(var l=c;l--;){var d=a[l];if(!(o?d in t:Tl.call(t,d)))return!1}var u=r.get(e),h=r.get(t);if(u&&h)return u==t&&h==e;var m=!0;r.set(e,t),r.set(t,e);for(var g=o;++l<c;){var p=e[d=a[l]],f=t[d];if(n)var v=o?n(f,p,d,t,e,r):n(p,f,d,e,t,r);if(!(void 0===v?p===f||i(p,f,s,n,r):v)){m=!1;break}g||(g="constructor"==d)}if(m&&!g){var _=e.constructor,b=t.constructor;_==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof _&&_ instanceof _&&"function"==typeof b&&b instanceof b||(m=!1)}return r.delete(e),r.delete(t),m};var Nl="[object Arguments]",Il="[object Array]",Ml="[object Object]",Rl=Object.prototype.hasOwnProperty;const Dl=function(e,t,s,n,i,r){var o=Lt(e),a=Lt(t),c=o?Il:Si(e),l=a?Il:Si(t),d=(c=c==Nl?Ml:c)==Ml,u=(l=l==Nl?Ml:l)==Ml,h=c==l;if(h&&mn(e)){if(!mn(t))return!1;o=!0,d=!1}if(h&&!d)return r||(r=new hr),o||En(e)?xl(e,t,s,n,i,r):jl(e,t,c,s,n,i,r);if(!(1&s)){var m=d&&Rl.call(e,"__wrapped__"),g=u&&Rl.call(t,"__wrapped__");if(m||g){var p=m?e.value():e,f=g?t.value():t;return r||(r=new hr),i(p,f,s,n,r)}}return!!h&&(r||(r=new hr),Ol(e,t,s,n,i,r))};const zl=function e(t,s,n,i,r){return t===s||(null==t||null==s||!Qt(t)&&!Qt(s)?t!=t&&s!=s:Dl(t,s,n,i,e,r))};const Ll=function(e,t){return zl(e,t)};const Pl=function(e,t,s,n){var i=s.length,r=i,o=!n;if(null==e)return!r;for(e=Object(e);i--;){var a=s[i];if(o&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<r;){var c=(a=s[i])[0],l=e[c],d=a[1];if(o&&a[2]){if(void 0===l&&!(c in e))return!1}else{var u=new hr;if(n)var h=n(l,d,c,e,t,u);if(!(void 0===h?zl(d,l,3,n,u):h))return!1}}return!0};const Fl=function(e){return e==e&&!Gs(e)};const Ul=function(e){for(var t=Dn(e),s=t.length;s--;){var n=t[s],i=e[n];t[s]=[n,i,Fl(i)]}return t};const Bl=function(e,t){return function(s){return null!=s&&(s[e]===t&&(void 0!==t||e in Object(s)))}};const ql=function(e){var t=Ul(e);return 1==t.length&&t[0][2]?Bl(t[0][0],t[0][1]):function(s){return s===e||Pl(s,e,t)}};const Hl=function(e,t){for(var s=0,n=(t=Bc(t,e)).length;null!=e&&s<n;)e=e[qc(t[s++])];return s&&s==n?e:void 0};const Gl=function(e,t,s){var n=null==e?void 0:Hl(e,t);return void 0===n?s:n};const Wl=function(e,t){return null!=e&&t in Object(e)};const Vl=function(e,t){return null!=e&&dl(e,t,Wl)};const Ql=function(e,t){return Mc(e)&&Fl(t)?Bl(qc(e),t):function(s){var n=Gl(s,e);return void 0===n&&n===t?Vl(s,e):zl(t,n,3)}};const Kl=function(e){return function(t){return null==t?void 0:t[e]}};const Jl=function(e){return function(t){return Hl(t,e)}};const Yl=function(e){return Mc(e)?Kl(qc(e)):Jl(e)};const Xl=function(e){return"function"==typeof e?e:null==e?Xa:"object"==typeof e?Lt(e)?Ql(e[0],e[1]):ql(e):Yl(e)};const Zl=function(e){return Xl("function"==typeof e?e:_o(e,1))};const ed=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0};const td=function(e,t,s){var n=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(s=s>i?i:s)<0&&(s+=i),i=t>s?0:s-t>>>0,t>>>=0;for(var r=Array(i);++n<i;)r[n]=e[n+t];return r};const sd=function(e,t){return t.length<2?e:Hl(e,td(t,0,-1))};const nd=function(e,t){return t=Bc(t,e),null==(e=sd(e,t))||delete e[qc(ed(t))]};const id=function(e){return Va(e)?void 0:e};var rd=Dt?Dt.isConcatSpreadable:void 0;const od=function(e){return Lt(e)||cn(e)||!!(rd&&e&&e[rd])};const ad=function e(t,s,n,i,r){var o=-1,a=t.length;for(n||(n=od),r||(r=[]);++o<a;){var c=t[o];s>0&&n(c)?s>1?e(c,s-1,n,i,r):zr(r,c):i||(r[r.length]=c)}return r};const cd=function(e){return(null==e?0:e.length)?ad(e,1):[]};const ld=function(e){return rc(tc(e,void 0,cd),e+"")};var dd=ld((function(e,t){var s={};if(null==e)return s;var n=!1;t=zt(t,(function(t){return t=Bc(t,e),n||(n=t.length>1),t})),_r(e,Hr(e),s),n&&(s=_o(s,7,id));for(var i=t.length;i--;)nd(s,t[i]);return s}));const ud=dd;const hd=function(e,t,s,n){if(!Gs(e))return e;for(var i=-1,r=(t=Bc(t,e)).length,o=r-1,a=e;null!=a&&++i<r;){var c=qc(t[i]),l=s;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(i!=o){var d=a[c];void 0===(l=n?n(d,c,a):void 0)&&(l=Gs(d)?d:pn(t[i+1])?[]:{})}vr(a,c,l),a=a[c]}return e};const md=function(e,t,s){for(var n=-1,i=t.length,r={};++n<i;){var o=t[n],a=Hl(e,o);s(a,o)&&hd(r,Bc(o,e),a)}return r};const gd=function(e,t){return md(e,t,(function(t,s){return Vl(e,s)}))};const pd=ld((function(e,t){return null==e?{}:gd(e,t)}));class fd extends($i(Object)){constructor(e,t){super();let s=e||{};t||(t={}),this.preinitialize.apply(this,arguments),this.cid=ts(this.cidPrefix),this.attributes={},this.validationError=null,t.collection&&(this.collection=t.collection),t.parse&&(s=this.parse(s,t)||{});const n=Hc(this,"defaults");s=rl(Object.assign({},n,s),n),this.set(s,t),this.initialize.apply(this,arguments),this.changed={}}set browserStorage(e){this._browserStorage=e}get browserStorage(){return this._browserStorage}get idAttribute(){return"id"}get cidPrefix(){return"c"}preinitialize(){}initialize(){}validate(e,t){return""}toJSON(){return tl(this.attributes)}sync(e,t,s){return Jc(t)(e,t,s)}get(e){return this.attributes[e]}keys(){return Object.keys(this.attributes)}values(){return Object.values(this.attributes)}pairs(){return this.entries()}entries(){return Object.entries(this.attributes)}invert(){return vl(this.attributes)}pick(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),pd(this.attributes,e)}omit(...e){return 1===e.length&&Array.isArray(e[0])&&(e=e[0]),ud(this.attributes,e)}isEmpty(){return xi(this.attributes)}has(e){return null!=this.get(e)}matches(e){return!!Zl(e,this)(this.attributes)}set(e,t,s){if(null==e)return this;let n;if("object"==typeof e?(n=e,s=t):(n={})[e]=t,s||(s={}),!this._validate(n,s))return!1;const i=s.unset,r=s.silent,o=[],a=this._changing;this._changing=!0,a||(this._previousAttributes=tl(this.attributes),this.changed={});const c=this.attributes,l=this.changed,d=this._previousAttributes;for(const e in n)t=n[e],Ll(c[e],t)||o.push(e),Ll(d[e],t)?delete l[e]:l[e]=t,i?delete c[e]:c[e]=t;if(this.idAttribute in n&&(this.id=this.get(this.idAttribute)),!r){o.length&&(this._pending=s);for(let e=0;e<o.length;e++)this.trigger("change:"+o[e],this,c[o[e]],s)}if(a)return this;if(!r)for(;this._pending;)s=this._pending,this._pending=!1,this.trigger("change",this,s);return this._pending=!1,this._changing=!1,this}unset(e,t){return this.set(e,void 0,Object.assign({},t,{unset:!0}))}clear(e){const t={};for(const e in this.attributes)t[e]=void 0;return this.set(t,Object.assign({},e,{unset:!0}))}hasChanged(e){return null==e?!xi(this.changed):ul(this.changed,e)}changedAttributes(e){if(!e)return!!this.hasChanged()&&tl(this.changed);const t=this._changing?this._previousAttributes:this.attributes,s={};let n;for(const i in e){const r=e[i];Ll(t[i],r)||(s[i]=r,n=!0)}return!!n&&s}previous(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null}previousAttributes(){return tl(this._previousAttributes)}fetch(e={}){const t=(e=Object.assign({parse:!0},e)).success;return e.success=s=>{const n=e.parse?this.parse(s,e):s;if(!this.set(n,e))return!1;t&&t.call(e.context,this,s,e),this.trigger("sync",this,s,e)},Qc(this,e),this.sync("read",this,e)}save(e,t,s){let n;null==e||"object"==typeof e?(n=e,s=t):(n={})[e]=t;const i=(s=Object.assign({validate:!0,parse:!0},s)).wait,r=s.promise,o=r&&Wc();if(n&&!i){if(!this.set(n,s))return!1}else if(!this._validate(n,s))return!1;const a=s.success,c=s.error,l=this.attributes;s.success=e=>{this.attributes=l;let t=s.parse?this.parse(e,s):e;if(i&&(t=Object.assign({},n,t)),t&&!this.set(t,s))return!1;a&&a.call(s.context,this,e,s),this.trigger("sync",this,e,s),r&&o.resolve()},s.error=(e,t,s)=>{c&&c.call(s.context,e,t,s),r&&o.reject(t)},Qc(this,s),n&&i&&(this.attributes=Object.assign({},l,n));const d=this.isNew()?"create":s.patch?"patch":"update";"patch"!==d||s.attrs||(s.attrs=n);const u=this.sync(d,this,s);return this.attributes=l,r?o:u}destroy(e){const t=(e=e?tl(e):{}).success,s=e.wait,n=()=>{this.stopListening(),this.trigger("destroy",this,this.collection,e)};e.success=i=>{s&&n(),t&&t.call(e.context,this,i,e),this.isNew()||this.trigger("sync",this,i,e)};let i=!1;return this.isNew()?al(e.success):(Qc(this,e),i=this.sync("delete",this,e)),s||n(),i}url(){const e=Hc(this,"urlRoot")||Hc(this.collection,"url")||Vc();if(this.isNew())return e;const t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)}parse(e,t){return e}isNew(){return!this.has(this.idAttribute)}isValid(e){return this._validate({},Object.assign({},e,{validate:!0}))}_validate(e,t){if(!t.validate||!this.validate)return!0;e=Object.assign({},this.attributes,e);const s=this.validationError=this.validate(e,t)||null;return!s||(this.trigger("invalid",this,s,Object.assign(t,{validationError:s})),!1)}}const vd=function(e,t,s,n){for(var i=-1,r=null==e?0:e.length;++i<r;){var o=e[i];t(n,o,s(o),e)}return n};const _d=function(e,t){return function(s,n){if(null==s)return s;if(!Rn(s))return e(s,n);for(var i=s.length,r=t?i:-1,o=Object(s);(t?r--:++r<i)&&!1!==n(o[r],r,o););return s}};const bd=_d(hl);const yd=function(e,t,s,n){return bd(e,(function(e,i,r){t(n,e,s(e),r)})),n};const wd=function(e,t){return function(s,n){var i=Lt(s)?vd:yd,r=t?t():{};return i(s,e,Xl(n,2),r)}};var Sd=Object.prototype.hasOwnProperty,Ad=wd((function(e,t,s){Sd.call(e,s)?++e[s]:pr(e,s,1)}));const xd=Ad;var Ed=Object.prototype.hasOwnProperty,$d=wd((function(e,t,s){Ed.call(e,s)?e[s].push(t):pr(e,s,[t])}));const Cd=$d;var kd=wd((function(e,t,s){pr(e,s,t)}));const jd=kd;const Td=function(e,t){var s=-1,n=Rn(e)?Array(e.length):[];return bd(e,(function(e,i,r){n[++s]=t(e,i,r)})),n};const Od=function(e,t){var s=e.length;for(e.sort(t);s--;)e[s]=e[s].value;return e};const Nd=function(e,t){if(e!==t){var s=void 0!==e,n=null===e,i=e==e,r=Kt(e),o=void 0!==t,a=null===t,c=t==t,l=Kt(t);if(!a&&!l&&!r&&e>t||r&&o&&c&&!a&&!l||n&&o&&c||!s&&c||!i)return 1;if(!n&&!r&&!l&&e<t||l&&s&&i&&!n&&!r||a&&s&&i||!o&&i||!c)return-1}return 0};const Id=function(e,t,s){for(var n=-1,i=e.criteria,r=t.criteria,o=i.length,a=s.length;++n<o;){var c=Nd(i[n],r[n]);if(c)return n>=a?c:c*("desc"==s[n]?-1:1)}return e.index-t.index};const Md=function(e,t,s){t=t.length?zt(t,(function(e){return Lt(e)?function(t){return Hl(t,1===e.length?e[0]:e)}:e})):[Xa];var n=-1;t=zt(t,bn(Xl));var i=Td(e,(function(e,s,i){var r=zt(t,(function(t){return t(e)}));return{criteria:r,index:++n,value:e}}));return Od(i,(function(e,t){return Id(e,t,s)}))};var Rd=oc((function(e,t){if(null==e)return[];var s=t.length;return s>1&&ac(e,t[0],t[1])?t=[]:s>2&&ac(t[0],t[1],t[2])&&(t=[t[0]]),Md(e,ad(t,1),[])}));const Dd=Rd,zd=Array.prototype.slice,Ld={add:!0,remove:!0,merge:!0},Pd={add:!0,remove:!1};class Fd extends($i(Object)){constructor(e,t){super(),t||(t={}),this.preinitialize.apply(this,arguments),t.model&&(this._model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,Object.assign({silent:!0},t)),this[Symbol.iterator]=this.values}set browserStorage(e){this._browserStorage=e}get browserStorage(){return this._browserStorage}get model(){return this._model??fd}set model(e){this._model=e}get length(){return this.models.length}preinitialize(){}initialize(){}toJSON(e){return this.map((function(t){return t.toJSON(e)}))}sync(e,t,s){return Jc(this)(e,t,s)}add(e,t){return this.set(e,Object.assign({merge:!1},t,Pd))}remove(e,t){t=Object.assign({},t);const s=!Array.isArray(e),n=s?[e]:e.slice(),i=this._removeModels(n,t);return!t.silent&&i.length&&(t.changes={added:[],merged:[],removed:i},this.trigger("update",this,t)),s?i[0]:i}set(e,t){if(null==e)return;(t=Object.assign({},Ld,t)).parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);const s=!Array.isArray(e);e=s?[e]:e.slice();let n=t.at;null!=n&&(n=+n),n>this.length&&(n=this.length),n<0&&(n+=this.length+1);const i=[],r=[],o=[],a=[],c={},l=t.add,d=t.merge,u=t.remove;let h=!1;const m=this.comparator&&null==n&&!1!==t.sort,g=yo(this.comparator)?this.comparator:null;let p,f;for(f=0;f<e.length;f++){p=e[f];const s=this.get(p);if(s){if(d&&p!==s){let e=this._isModel(p)?p.attributes:p;t.parse&&(e=s.parse(e,t)),s.set(e,t),o.push(s),m&&!h&&(h=s.hasChanged(g))}c[s.cid]||(c[s.cid]=!0,i.push(s)),e[f]=s}else l&&(p=e[f]=this._prepareModel(p,t),p&&(r.push(p),this._addReference(p,t),c[p.cid]=!0,i.push(p)))}if(u){for(f=0;f<this.length;f++)p=this.models[f],c[p.cid]||a.push(p);a.length&&this._removeModels(a,t)}let v=!1;const _=!m&&l&&u;if(i.length&&_)v=this.length!==i.length||this.models.some(((e,t)=>e!==i[t])),this.models.length=0,this.models.splice(0,0,...i);else if(r.length){m&&(h=!0);let e=null==n?this.length:n;e=Math.min(Math.max(e,0),this.models.length),this.models.splice(e,0,...r)}if(h&&this.sort({silent:!0}),!t.silent){for(f=0;f<r.length;f++)null!=n&&(t.index=n+f),p=r[f],p.trigger("add",p,this,t);(h||v)&&this.trigger("sort",this,t),(r.length||a.length||o.length)&&(t.changes={added:r,removed:a,merged:o},this.trigger("update",this,t))}return s?e[0]:e}async clearStore(e={},t=(e=>e)){await Promise.all(this.models.filter(t).map((t=>new Promise((s=>{t.destroy(Object.assign(e,{success:s,error:(e,t)=>{console.error(t),s()}}))}))))),await this.browserStorage.clear(),this.reset()}reset(e,t){t=t?tl(t):{};for(let e=0;e<this.models.length;e++)this._removeReference(this.models[e],t);return t.previousModels=this.models,this._reset(),e=this.add(e,Object.assign({silent:!0},t)),t.silent||this.trigger("reset",this,t),e}push(e,t){return this.add(e,Object.assign({at:this.length},t))}pop(e){const t=this.at(this.length-1);return this.remove(t,e)}unshift(e,t){return this.add(e,Object.assign({at:0},t))}shift(e){const t=this.at(0);return this.remove(t,e)}slice(){return zd.apply(this.models,arguments)}filter(e,t){return this.models.filter(Mn(e)?e:t=>t.matches(e),t)}every(e){return Mn(e)?this.models.map((e=>e.attributes)).every(e):this.models.every((t=>t.matches(e)))}difference(e){return this.models.filter((t=>!e.includes(t)))}max(){return Math.max.apply(Math,this.models)}min(){return Math.min.apply(Math,this.models)}drop(e=1){return this.models.slice(e)}some(e){return Mn(e)?this.models.map((e=>e.attributes)).some(e):this.models.some((t=>t.matches(e)))}sortBy(e){return Dd(this.models,Mn(e)?e:t=>yo(e)?t.get(e):t.matches(e))}isEmpty(){return!this.models.length}keyBy(e){return jd(this.models,e)}each(e,t){return this.forEach(e,t)}forEach(e,t){return this.models.forEach(e,t)}includes(e){return this.models.includes(e)}size(){return this.models.length}countBy(e){return xd(this.models,Mn(e)?e:t=>yo(e)?t.get(e):t.matches(e))}groupBy(e){return Cd(this.models,Mn(e)?e:t=>yo(e)?t.get(e):t.matches(e))}indexOf(e){return this.models.indexOf(e)}findLastIndex(e,t){return this.models.findLastIndex(Mn(e)?e:t=>yo(e)?t.get(e):t.matches(e),t)}lastIndexOf(e){return this.models.lastIndexOf(e)}findIndex(e){return this.models.findIndex(Mn(e)?e:t=>yo(e)?t.get(e):t.matches(e))}last(){const e=null==this.models?0:this.models.length;return e?this.models[e-1]:void 0}head(){return this.models[0]}first(){return this.head()}map(e,t){return this.models.map(Mn(e)?e:t=>yo(e)?t.get(e):t.matches(e),t)}reduce(e,t){return this.models.reduce(e,t||this.models[0])}reduceRight(e,t){return this.models.reduceRight(e,t||this.models[0])}toArray(){return Array.from(this.models)}get(e){if(null!=e)return this._byId[e]||this._byId[this.modelId(this._isModel(e)?e.attributes:e)]||e.cid&&this._byId[e.cid]}has(e){return null!=this.get(e)}at(e){return e<0&&(e+=this.length),this.models[e]}where(e,t){return this[t?"find":"filter"](e)}findWhere(e){return this.where(e,!0)}find(e,t){const s=Mn(e)?e:t=>t.matches(e);return this.models.find(s,t)}sort(e){let t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});const s=t.length;return Mn(t)&&(t=t.bind(this)),1===s||yo(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this}pluck(e){return this.map(e+"")}fetch(e){const t=(e=Object.assign({parse:!0},e)).success,s=this,n=e.promise&&Wc();return e.success=function(i){const r=e.reset?"reset":"set";s[r](i,e),t&&t.call(e.context,s,i,e),n&&n.resolve(),s.trigger("sync",s,i,e)},Qc(this,e),n||this.sync("read",this,e)}create(e,t){const s=(t=t?tl(t):{}).wait,n=t.promise,i=n&&Wc();if(!(e=this._prepareModel(e,t)))return!1;s||this.add(e,t);const r=this,o=t.success,a=t.error;return t.success=function(e,t,a){s&&r.add(e,a),o&&o.call(a.context,e,t,a),n&&i.resolve(e)},t.error=function(e,t,s){a&&a.call(s.context,e,t,s),n&&i.reject(t)},e.save(null,Object.assign(t,{promise:!1})),n?i:e}parse(e,t){return e}modelId(e){return e[this.model.prototype?.idAttribute||"id"]}values(){return new Hd(this,Ud)}keys(){return new Hd(this,Bd)}entries(){return new Hd(this,qd)}_reset(){this.models=[],this._byId={}}createModel(e,t){return new(0,this.model)(e,t)}_prepareModel(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;(t=t?tl(t):{}).collection=this;const s=this.createModel(e,t);return s.validationError?(this.trigger("invalid",this,s.validationError,t),null):s}_removeModels(e,t){const s=[];for(let n=0;n<e.length;n++){const i=this.get(e[n]);if(!i)continue;const r=this.indexOf(i);this.models.splice(r,1),delete this._byId[i.cid];const o=this.modelId(i.attributes);null!=o&&delete this._byId[o],t.silent||(t.index=r,i.trigger("remove",i,this,t)),s.push(i),this._removeReference(i,t)}return s}_isModel(e){return e instanceof fd}_addReference(e,t){this._byId[e.cid]=e;const s=this.modelId(e.attributes);null!=s&&(this._byId[s]=e),e.on("all",this._onModelEvent,this)}_removeReference(e,t){delete this._byId[e.cid];const s=this.modelId(e.attributes);null!=s&&delete this._byId[s],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)}_onModelEvent(e,t,s,n){if(t){if(("add"===e||"remove"===e)&&s!==this)return;if("destroy"===e&&this.remove(t,n),"change"===e){const e=this.modelId(t.previousAttributes()),s=this.modelId(t.attributes);e!==s&&(null!=e&&delete this._byId[e],null!=s&&(this._byId[s]=t))}}this.trigger.apply(this,arguments)}}const Ud=1,Bd=2,qd=3;class Hd{constructor(e,t){this._collection=e,this._kind=t,this._index=0}next(){if(this._collection){if(this._index<this._collection.length){const e=this._collection.at(this._index);let t;if(this._index++,this._kind===Ud)t=e;else{const s=this._collection.modelId(e.attributes);t=this._kind===Bd?s:[s,e]}return{value:t,done:!1}}this._collection=void 0}return{value:void 0,done:!0}}[Symbol.iterator](){return this}}const Gd={Collection:Fd,ElementView:ji,EventEmitter:$i,Model:fd,sync:Yc},Wd="object"==typeof self&&self.self===self&&self||"object"==typeof s.g&&s.g.global===s.g&&s.g;Gd.VERSION="0.0.1";const Vd=Wd.Skeletor;Gd.noConflict=function(){return Wd.Skeletor=Vd,this},Wd.Skeletor=Gd;const Qd={allow_non_roster_messaging:!0,allow_url_history_change:!0,assets_path:"/dist",authentication:"login",auto_login:!1,auto_reconnect:!0,blacklisted_plugins:[],clear_cache_on_logout:!1,connection_options:{},credentials_url:null,disable_effects:!1,discover_connection_methods:!0,embed_3rd_party_media_players:!0,geouri_regex:/https\:\/\/www.openstreetmap.org\/.*#map=[0-9]+\/([\-0-9.]+)\/([\-0-9.]+)\S*/g,geouri_replacement:"https://www.openstreetmap.org/?mlat=$1&mlon=$2#map=18/$1/$2",i18n:void 0,jid:void 0,reuse_scram_keys:!0,keepalive:!0,loglevel:"info",locales:["af","ar","bg","ca","cs","da","de","el","en","eo","es","eu","fa","fi","fr","gl","he","hi","hu","id","it","ja","lt","mr","nb","nl","oc","pl","pt","pt_BR","ro","ru","sv","ta","th","tr","ug","uk","vi","zh_CN","zh_TW"],nickname:void 0,password:void 0,persistent_store:"IndexedDB",rid:void 0,root:window.document,sid:void 0,singleton:!1,strict_plugin_dependencies:!1,stanza_timeout:6e4,view_mode:"fullscreen",websocket_url:void 0,whitelisted_plugins:[]};function Kd(e,t){for(const s in t)Object.prototype.hasOwnProperty.call(t,s)&&"__proto__"!==s&&"constructor"!==s&&(e[s]instanceof Object?Kd(e[s],t[s]):e[s]=t[s])}function Jd(e){return"[object Error]"===Object.prototype.toString.call(e)}function Yd(e){return"function"==typeof e}let Xd,Zd={};class eu extends($i(Object)){}const tu={extend:e=>function(e){Kd(Qd,e);const t=Object.keys(e).filter((e=>e in Qd)),s=pd(Zd,t),n=Object.assign(pd(e,t),s);Kd(Xd,n)}(e),get:e=>e?function(e){if(Object.keys(Qd).includes(e))return Xd[e]}(e):Xd,set(e,t){!function(e,t){if(null==e)return this;let s;e instanceof Object?s=e:"string"==typeof e&&(s={},s[e]=t);const n=Object.keys(s).filter((e=>e in Qd)),i={};n.forEach((e=>{const t=s[e];Ll(Xd[e],t)||(i[e]=t,Xd[e]=t)})),Object.keys(i).forEach((e=>Xd.trigger("change:"+e,i[e]))),Xd.trigger("change",i)}(e,t)},listen:{on(e,t,s){!function(e,t,s){Xd.on(e,t,s)}(e,t,s)},not(e,t){!function(e,t){Xd.off(e,t)}(e,t)}}},su=tu;function nu(){return["fullscreen","embedded"].includes(su.get("view_mode"))}function iu(){return"montague.lit/http-bind"===Zd.bosh_service_url}function ru(){return"onpagehide"in window?"pagehide":"onbeforeunload"in window?"beforeunload":"unload"}function ou(e,t){const s=e.promises[t];if(!s)throw new Error(`Tried to replace non-existing promise: ${t}`);if(s.replace){const n=hc();n.replace=s.replace,e.promises[t]=n}else Ct.debug(`Not replacing promise "${t}"`)}function au(e){const{api:t}=e;return!e.state.config.get("trusted")||t.settings.get("clear_cache_on_logout")||iu()}async function cu(e){const{api:t}=e;return await t.trigger("beforeTearDown",{synchronous:!0}),t.trigger("afterTearDown"),e}function lu(e){return au(e)&&e.api.user.settings.clear(),e.initSession(),e.api.trigger("clearSession",{synchronous:!0})}const du=59,uu="v11.0.0",hu={offline:6,unavailable:5,xa:4,away:3,dnd:2,chat:1,online:1},mu=["og:article:author","og:article:published_time","og:description","og:image","og:image:height","og:image:width","og:site_name","og:title","og:type","og:url","og:video:height","og:video:secure_url","og:video:tag","og:video:type","og:video:url","og:video:width"],gu="anonymous",pu="closed",fu="external",vu="login",_u="logout",bu="opened",yu="prebind",wu="success",Su="failure",Au="inactive",xu="active",Eu="composing",$u="paused",Cu="gone",ku="chatbox",ju="chatroom",Tu="headline",Ou="controlbox",Nu={};Nu[ft.Status.ATTACHED]="ATTACHED",Nu[ft.Status.AUTHENTICATING]="AUTHENTICATING",Nu[ft.Status.AUTHFAIL]="AUTHFAIL",Nu[ft.Status.CONNECTED]="CONNECTED",Nu[ft.Status.CONNECTING]="CONNECTING",Nu[ft.Status.CONNFAIL]="CONNFAIL",Nu[ft.Status.DISCONNECTED]="DISCONNECTED",Nu[ft.Status.DISCONNECTING]="DISCONNECTING",Nu[ft.Status.ERROR]="ERROR",Nu[ft.Status.RECONNECTING]="RECONNECTING",Nu[ft.Status.REDIRECT]="REDIRECT",ft.addNamespace("ACTIVITY","http://jabber.org/protocol/activity"),ft.addNamespace("CARBONS","urn:xmpp:carbons:2"),ft.addNamespace("CHATSTATES","http://jabber.org/protocol/chatstates"),ft.addNamespace("CSI","urn:xmpp:csi:0"),ft.addNamespace("DELAY","urn:xmpp:delay"),ft.addNamespace("EME","urn:xmpp:eme:0"),ft.addNamespace("FASTEN","urn:xmpp:fasten:0"),ft.addNamespace("FORWARD","urn:xmpp:forward:0"),ft.addNamespace("HINTS","urn:xmpp:hints"),ft.addNamespace("HTTPUPLOAD","urn:xmpp:http:upload:0"),ft.addNamespace("MAM","urn:xmpp:mam:2"),ft.addNamespace("MARKERS","urn:xmpp:chat-markers:0"),ft.addNamespace("MENTIONS","urn:xmpp:mmn:0"),ft.addNamespace("MESSAGE_CORRECT","urn:xmpp:message-correct:0"),ft.addNamespace("MODERATE","urn:xmpp:message-moderate:0"),ft.addNamespace("NICK","http://jabber.org/protocol/nick"),ft.addNamespace("OCCUPANTID","urn:xmpp:occupant-id:0"),ft.addNamespace("OMEMO","eu.siacs.conversations.axolotl"),ft.addNamespace("OUTOFBAND","jabber:x:oob"),ft.addNamespace("PUBSUB","http://jabber.org/protocol/pubsub"),ft.addNamespace("RAI","urn:xmpp:rai:0"),ft.addNamespace("RECEIPTS","urn:xmpp:receipts"),ft.addNamespace("REFERENCE","urn:xmpp:reference:0"),ft.addNamespace("REGISTER","jabber:iq:register"),ft.addNamespace("RETRACT","urn:xmpp:message-retract:0"),ft.addNamespace("ROSTERX","http://jabber.org/protocol/rosterx"),ft.addNamespace("RSM","http://jabber.org/protocol/rsm"),ft.addNamespace("SID","urn:xmpp:sid:0"),ft.addNamespace("SPOILER","urn:xmpp:spoiler:0"),ft.addNamespace("STANZAS","urn:ietf:params:xml:ns:xmpp-stanzas"),ft.addNamespace("STYLING","urn:xmpp:styling:0"),ft.addNamespace("VCARD","vcard-temp"),ft.addNamespace("VCARDUPDATE","vcard-temp:x:update"),ft.addNamespace("XFORM","jabber:x:data"),ft.addNamespace("XHTML","http://www.w3.org/1999/xhtml");const Iu=["converse-adhoc","converse-bookmarks","converse-blocklist","converse-bosh","converse-caps","converse-chat","converse-chatboxes","converse-disco","converse-emoji","converse-headlines","converse-mam","converse-muc","converse-ping","converse-pubsub","converse-roster","converse-smacks","converse-status","converse-vcard"],Mu={start:/(\b|_)(?:([a-z][a-z0-9.+-]*:\/\/)|xmpp:|mailto:|www\.)/gi},Ru=["active","composing","gone","inactive","paused"],Du={TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESCAPE:27,LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,FORWARD_SLASH:47,AT:50,META:91,META_RIGHT:93},zu={"text-private":"password","text-single":"text",fixed:"label",boolean:"checkbox",hidden:"hidden","jid-multi":"textarea","list-single":"dropdown","list-multi":"dropdown"},Lu={"xs:anyURI":"url","xs:byte":"number","xs:date":"date","xs:dateTime":"datetime","xs:int":"number","xs:integer":"number","xs:time":"time"},Pu={chatboxes:null,bookmarks:null,ANONYMOUS:gu,CLOSED:pu,EXTERNAL:fu,LOGIN:vu,LOGOUT:_u,OPENED:bu,PREBIND:yu,SUCCESS:wu,FAILURE:Su,INACTIVE:Au,ACTIVE:xu,COMPOSING:Eu,PAUSED:$u,GONE:Cu};class Fu extends($i(Object)){constructor(){super();const e=new Proxy(this,{get:(e,t)=>(iu()||"string"!=typeof t||Object.keys(Pu).includes(t)&&Ct.warn(`Accessing ${t} on _converse is DEPRECATED`),Reflect.get(e,t))});return e.initialize(),e}initialize(){this.VERSION_NAME=uu,this.strict_plugin_dependencies=!1,this.pluggable=null,this.templates={},this.storage={},this.promises={initialized:hc()},this.NUM_PREKEYS=100,this.TIMEOUTS={PAUSED:1e4,INACTIVE:9e4},Object.assign(this,Pu),this.api=null,this.labels={},this.exports={},this.constants={},this.state={},this.initSession()}initSession(){this.session?.destroy(),this.session=new fd,Object.assign(this,{jid:void 0,bare_jid:void 0,domain:void 0,resource:void 0})}__(...e){return jt.__(...e)}___(e){return e}}const Uu=new Fu;Nt.enable(Uu,"_converse","pluggable");const Bu=Uu,qu={async trigger(e){if(!Bu._events)return;const t=Array.from(arguments),s=t.pop();if(s&&s.synchronous){const s=Bu._events[e]||[],n=t.splice(1);await Promise.all(s.map((e=>e.callback.apply(e.ctx,n))))}else Bu.trigger.apply(Bu,arguments);const n=Bu.promises[e];void 0!==n&&n.resolve(arguments[1])},hook(e,t,s){const n=Bu._events[e]||[];return n.length?n.reduce(((e,s)=>e.then((e=>s.callback(t,e)))),Promise.resolve(s)):s},listen:{once:Bu.once.bind(Bu),on:Bu.on.bind(Bu),not:Bu.off.bind(Bu),stanza(e,t,s){Yd(t)?(s=t,t={}):t=t||{},Bu.api.connection.get().addHandler(s,t.ns,e,t.type,t.id,t.from,t)}}};var Hu=Math.max,Gu=Math.min;const Wu=function(e,t,s){var n,i,r,o,a,c,l=0,d=!1,u=!1,h=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var s=n,r=i;return n=i=void 0,l=t,o=e.apply(r,s)}function g(e){var s=e-c;return void 0===c||s>=t||s<0||u&&e-l>=r}function p(){var e=uc();if(g(e))return f(e);a=setTimeout(p,function(e){var s=t-(e-c);return u?Gu(s,r-(e-l)):s}(e))}function f(e){return a=void 0,h&&n?m(e):(n=i=void 0,o)}function v(){var e=uc(),s=g(e);if(n=arguments,i=this,c=e,s){if(void 0===a)return function(e){return l=e,a=setTimeout(p,t),d?m(e):o}(c);if(u)return clearTimeout(a),a=setTimeout(p,t),m(c)}return void 0===a&&(a=setTimeout(p,t)),o}return t=Js(t)||0,Gs(s)&&(d=!!s.leading,r=(u="maxWait"in s)?Hu(Js(s.maxWait)||0,t):r,h="trailing"in s?!!s.trailing:h),v.cancel=function(){void 0!==a&&clearTimeout(a),l=0,n=c=i=a=void 0},v.flush=function(){return void 0===a?o:f(uc())},v};var Vu=s(4103),Qu=s(6245);const Ku=tu;function Ju(){if(Bu.state.config.get("trusted")){return"sessionStorage"===Ku.get("persistent_store")?"session":"persistent"}return"session"}function Yu(e){return"persistent"===e&&"IndexedDB"===Ku.get("persistent_store")}function Xu(e,t){const s=t||Ju(),n=Bu.storage[s];if(void 0===n)throw new TypeError(`createStore: Could not find store for ${e}`);return new el(e,n,Yu(t))}function Zu(e,t,s){const n=s||Ju();if(e.browserStorage=Xu(t,n),Yu(n)){const t=()=>e.browserStorage.flush(),s=ru();window.addEventListener(s,t),e.on("destroy",(()=>window.removeEventListener(s,t))),e.listenTo(Bu,"beforeLogout",t)}}function eh(){return("WebSocket"in window||"MozWebSocket"in window)&&tu.get("websocket_url")?tu.get("websocket_url"):tu.get("bosh_service_url")?tu.get("bosh_service_url"):""}function th(e){return"string"==typeof e&&(2===e.split("@").filter((e=>!!e)).length&&!e.startsWith("@")&&!e.endsWith("@"))}function sh(e){return!e.startsWith("@")&&!e.endsWith("@")}function nh(e,t){return"string"==typeof e&&"string"==typeof t&&ft.getBareJidFromJid(e).toLowerCase()===ft.getBareJidFromJid(t).toLowerCase()}function ih(e,t){return"string"==typeof e&&"string"==typeof t&&ft.getDomainFromJid(e).toLowerCase()===ft.getDomainFromJid(t).toLowerCase()}function rh(e){return e.startsWith("xmpp:")&&e.endsWith("?join")?e.replace(/^xmpp:/,"").replace(/\?join$/,""):e}function oh(e,t){const{api:s}=e;s.settings.get("authentication")===gu||ft.getResourceFromJid(t)||(t=t.toLowerCase()+`/converse.js-${Math.floor(139749528*Math.random()).toString()}`);const n=ft.getBareJidFromJid(t),i=ft.getResourceFromJid(t),r=ft.getDomainFromJid(t);Object.assign(e,{jid:t,bare_jid:n,resource:i,domain:r}),e.session.save({jid:t,bare_jid:n,resource:i,domain:r,active:!0}),s.connection.get().jid=t}async function ah(e){return await async function(e,t){const s=e.api.settings.get("connection_options").worker,n=ft.getBareJidFromJid(t).toLowerCase(),i=`converse.session-${n}`;e.session?.get("id")!==i?(!function(e,t){if("sessionStorage"===e.api.settings.get("persistent_store"))return;if("BrowserExtLocal"===e.api.settings.get("persistent_store"))return el.localForage.defineDriver(Vu.A).then((()=>el.localForage.setDriver("webExtensionLocalStorage"))),void(e.storage.persistent=el.localForage);if("BrowserExtSync"===e.api.settings.get("persistent_store"))return el.localForage.defineDriver(Qu.A).then((()=>el.localForage.setDriver("webExtensionSyncStorage"))),void(e.storage.persistent=el.localForage);const s={name:iu()?"converse-test-persistent":"converse-persistent",storeName:t};"localStorage"===e.api.settings.get("persistent_store")?(s.description="localStorage instance",s.driver=[el.localForage.LOCALSTORAGE]):"IndexedDB"===e.api.settings.get("persistent_store")&&(s.description="indexedDB instance",s.driver=[el.localForage.INDEXEDDB]),e.storage.persistent=el.localForage.createInstance(s)}(e,n),e.session.set({id:i}),Zu(e.session,i,s?"persistent":"session"),await new Promise((t=>e.session.fetch({success:t,error:t}))),!s&&e.session.get("active")&&(e.session.clear(),e.session.save({id:i})),oh(e,t),window.addEventListener(ru(),(()=>e.session?.save("active",!1))),e.api.trigger("userSessionInitialized")):oh(e,t)}(Bu,e),Bu.api.trigger("setUserJID"),e}function ch(e=0){return new Promise(Wu((async(e,t)=>{let s=new XMLHttpRequest;s.open("GET",Bu.api.settings.get("credentials_url"),!0),s.setRequestHeader("Accept","application/json, text/javascript"),s.onload=()=>{if(s.status>=200&&s.status<400){const t=JSON.parse(s.responseText);ah(t.jid).then((()=>{e({jid:t.jid,password:t.password})}))}else t(new Error(`${s.status}: ${s.responseText}`))},s.onerror=t,s=await Bu.api.hook("beforeFetchLoginCredentials",this,s),s.send()}),e))}async function lh(e,t){const{api:s}=Bu;if(s.settings.get("authentication")===vu){const t=Bu.session.get("jid");if(e)return uh(e);if(s.settings.get("credentials_url"))return uh(await async function(){let e,t=0;for(;!e;){try{e=await ch(t)}catch(e){Ct.error("Could not fetch login credentials"),Ct.error(e)}t=2e3}return e}());if(t&&(s.settings.get("password")||s.connection.get().pass))return uh();if(s.settings.get("reuse_scram_keys")){const e=await async function(){const e=localStorage.getItem("conversejs-session-jid");if(!e)return null;await ah(e);const t=(await dh(e)).get("scram_keys");return t?{jid:e,password:t}:null}();if(e)return uh(e)}if(!iu()&&"credentials"in navigator){const e=await async function(){if(!localStorage.getItem("conversejs-session-jid"))return null;try{const e=await navigator.credentials.get({password:!0});if(e&&"password"==e.type&&th(e.id))return await ah(e.id),{jid:e.id,password:e.password}}catch(e){return Ct.error(e),null}}();if(e)return uh(e)}iu()||Ct.debug("attemptNonPreboundSession: Couldn't find credentials to log in with")}else![gu,fu].includes(s.settings.get("authentication"))||t&&!s.settings.get("auto_login")||uh()}async function dh(e){const t=`converse.scram-keys-${ft.getBareJidFromJid(e)}`,s=new fd({id:t});return Zu(s,t,"persistent"),await new Promise((e=>s.fetch({success:e,error:e}))),s}async function uh(e){const{api:t}=Bu,s=Bu.session.get("jid"),n=t.connection.get();if([gu,fu].includes(t.settings.get("authentication"))){if(!s)throw new Error("Config Error: when using anonymous login you need to provide the server's domain via the 'jid' option. Either when calling converse.initialize, or when calling _converse.api.user.login.");n.reconnecting||n.reset(),n.connect(s.toLowerCase())}else if(t.settings.get("authentication")===vu){const i=e?.password??(n?.pass||t.settings.get("password"));if(!i){if(t.settings.get("auto_login"))throw new Error("autoLogin: If you use auto_login and authentication='login' then you also need to provide a password.");return n.setDisconnectionCause(ft.Status.AUTHFAIL,void 0,!0),void t.connection.disconnect()}let r;if(n.reconnecting||(n.reset(),n.service=eh()),Bu.state.config.get("trusted")&&s&&t.settings.get("reuse_scram_keys")&&!i?.ck){const e=await dh(s);r=t=>{const{scram_keys:s}=n;s&&e.save({scram_keys:s}),n.onConnectStatusChanged(t)}}n.connect(s,i,r)}}const hh=Object.keys(ft.Status).reduce(((e,t)=>Math.max(e,ft.Status[t])),0);ft.Status.RECONNECTING=hh+1;class mh extends ft.Connection{constructor(e,t){super(e,t),this.send_initial_presence=!0,this.debouncedReconnect=Wu(this.reconnect,3e3)}xmlInput(e){Ct.debug(e.outerHTML,"color: darkgoldenrod")}xmlOutput(e){Ct.debug(e.outerHTML,"color: darkcyan")}async bind(){const{api:e}=Bu;await e.trigger("beforeResourceBinding",{synchronous:!0}),super.bind()}async onDomainDiscovered(e){const{api:t}=Bu,s=await e.text(),n=(new DOMParser).parseFromString(s,"text/xml").firstElementChild;if("XRD"!=n.nodeName||"http://docs.oasis-open.org/ns/xri/xrd-1.0"!=n.namespaceURI)return Ct.warn("Could not discover XEP-0156 connection methods");const i=q()('Link[rel="urn:xmpp:alt-connections:xbosh"]',n),r=q()('Link[rel="urn:xmpp:alt-connections:websocket"]',n),o=i.map((e=>e.getAttribute("href"))).filter((e=>e.startsWith("https:"))),a=r.map((e=>e.getAttribute("href"))).filter((e=>e.startsWith("wss:")));0===o.length&&0===a.length?Ct.warn("Neither BOSH nor WebSocket connection methods have been specified with XEP-0156."):(t.settings.set("websocket_url",a.pop()),t.settings.set("bosh_service_url",o.pop()),this.service=t.settings.get("websocket_url")||t.settings.get("bosh_service_url"),this.setProtocol())}async discoverConnectionMethods(e){const t={mode:"cors",headers:{Accept:"application/xrd+xml, text/xml"}},s=`https://${e}/.well-known/host-meta`;let n;try{n=await fetch(s,t)}catch(e){return Ct.error(`Failed to discover alternative connection methods at ${s}`),void Ct.error(e)}n.status>=200&&n.status<400?await this.onDomainDiscovered(n):Ct.warn("Could not discover XEP-0156 connection methods")}async connect(e,t,s){const{api:n}=Bu;if(n.settings.get("discover_connection_methods")){const t=ft.getDomainFromJid(e);await this.discoverConnectionMethods(t)}if(!n.settings.get("bosh_service_url")&&!n.settings.get("websocket_url"))throw new Error("You must supply a value for either the bosh_service_url or websocket_url or both.");super.connect(e,t,s||this.onConnectStatusChanged,du)}disconnect(e){super.disconnect(e),this.send_initial_presence=!0}async switchTransport(){const{api:e}=Bu,t=Bu.session.get("bare_jid");e.connection.isType("websocket")&&e.settings.get("bosh_service_url")?(await ah(t),this._proto._doDisconnect(),this._proto=new ft.Bosh(this),this.service=e.settings.get("bosh_service_url")):e.connection.isType("bosh")&&e.settings.get("websocket_url")&&(e.settings.get("authentication")===gu?await ah(e.settings.get("jid")):await ah(t),this._proto._doDisconnect(),this._proto=new ft.Websocket(this),this.service=e.settings.get("websocket_url"))}async reconnect(){const{api:e}=Bu;Ct.debug("RECONNECTING: the connection has dropped, attempting to reconnect."),this.reconnecting=!0,await cu(Bu);const t=Bu.state.connfeedback.get("connection_status");t===ft.Status.CONNFAIL?this.switchTransport():t===ft.Status.AUTHFAIL&&e.settings.get("authentication")===gu&&await ah(e.settings.get("jid")),e.trigger("will-reconnect"),e.settings.get("authentication")===gu&&await lu(Bu);const s=Bu.session.get("jid");return e.user.login(s)}async onConnected(e){const{api:t}=Bu;if(delete this.reconnecting,this.flush(),await ah(this.jid),Bu.state.config.get("trusted")){const e=Bu.session.get("bare_jid");localStorage.setItem("conversejs-session-jid",e)}await t.trigger("afterResourceBinding",e,{synchronous:!0}),e?t.trigger("reconnected"):t.trigger("connected")}setDisconnectionCause(e,t,s){void 0===e?(delete this.disconnection_cause,delete this.disconnection_reason):(void 0===this.disconnection_cause||s)&&(this.disconnection_cause=e,this.disconnection_reason=t)}setConnectionStatus(e,t){this.status=e,Bu.state.connfeedback.set({connection_status:e,message:t})}async finishDisconnection(){const{api:e}=Bu;Ct.debug("DISCONNECTED"),delete this.reconnecting,this.reset(),cu(Bu),await lu(Bu),e.connection.destroy(),e.trigger("disconnected")}onDisconnected(){const{api:e}=Bu;if(!e.settings.get("auto_reconnect"))return this.finishDisconnection();{const t=this.disconnection_reason;if(this.disconnection_cause===ft.Status.AUTHFAIL)return e.settings.get("credentials_url")||e.settings.get("authentication")===gu?e.connection.reconnect():this.finishDisconnection();if(this.status===ft.Status.CONNECTING){const{__:e}=Bu;return this.setConnectionStatus(ft.Status.CONNFAIL,e("An error occurred while connecting to the chat server.")),this.finishDisconnection()}if(this.disconnection_cause===_u||t===ft.ErrorCondition.NO_AUTH_MECH||"host-unknown"===t||"remote-connection-failed"===t)return this.finishDisconnection();e.connection.reconnect()}}onConnectStatusChanged(e,t){const{__:s}=Bu;if(Ct.debug(`Status changed to: ${Nu[e]}`),e===ft.Status.ATTACHFAIL)this.setConnectionStatus(e),this.worker_attach_promise?.resolve(!1);else if(e===ft.Status.CONNECTED||e===ft.Status.ATTACHED){if(this.worker_attach_promise?.isResolved&&this.status===ft.Status.ATTACHED)return;this.setConnectionStatus(e),this.worker_attach_promise?.resolve(!0),this.setDisconnectionCause(),this.reconnecting?(Ct.debug(e===ft.Status.CONNECTED?"Reconnected":"Reattached"),this.onConnected(!0)):(Ct.debug(e===ft.Status.CONNECTED?"Connected":"Attached"),this.restored&&(this.send_initial_presence=!1),this.onConnected())}else if(e===ft.Status.DISCONNECTED)this.setDisconnectionCause(e,t),this.onDisconnected();else if(e===ft.Status.BINDREQUIRED)this.bind();else if(e===ft.Status.ERROR)this.setConnectionStatus(e,s("An error occurred while connecting to the chat server."));else if(e===ft.Status.CONNECTING)this.setConnectionStatus(e);else if(e===ft.Status.AUTHENTICATING)this.setConnectionStatus(e);else if(e===ft.Status.AUTHFAIL)t||(t=s("Your XMPP address and/or password is incorrect. Please try again.")),this.setConnectionStatus(e,t),this.setDisconnectionCause(e,t,!0),this.onDisconnected();else if(e===ft.Status.CONNFAIL){let n=t;"host-unknown"===t||"remote-connection-failed"==t?n=s("Sorry, we could not connect to the XMPP host with domain: %1$s",`"${ft.getDomainFromJid(this.jid)}"`):void 0!==t&&t===ft?.ErrorCondition?.NO_AUTH_MECH&&(n=s("The XMPP server did not offer a supported authentication mechanism")),this.setConnectionStatus(e,n),this.setDisconnectionCause(e,t)}else e===ft.Status.DISCONNECTING&&this.setDisconnectionCause(e,t)}isType(e){return"websocket"===e.toLowerCase()?this._proto instanceof ft.Websocket:"bosh"===e.toLowerCase()?ft.Bosh&&this._proto instanceof ft.Bosh:void 0}hasResumed(){const{api:e}=Bu;return e.settings.get("connection_options")?.worker||this.isType("bosh")?Bu.state.connfeedback.get("connection_status")===ft.Status.ATTACHED:!this.do_bind}restoreWorkerSession(){return this.attach(this.onConnectStatusChanged),this.worker_attach_promise=hc(),this.worker_attach_promise}}class gh extends mh{constructor(e,t){super(e,t),this.sent_stanzas=[],this.IQ_stanzas=[],this.IQ_ids=[],this.features=ft.xmlHtmlNode('<stream:features xmlns:stream="http://etherx.jabber.org/streams" xmlns="jabber:client"><ver xmlns="urn:xmpp:features:rosterver"/><csi xmlns="urn:xmpp:csi:0"/><this xmlns="http://jabber.org/protocol/caps" ver="UwBpfJpEt3IoLYfWma/o/p3FFRo=" hash="sha-1" node="http://prosody.im"/><bind xmlns="urn:ietf:params:xml:ns:xmpp-bind"><required/></bind><sm xmlns=\'urn:xmpp:sm:3\'/><session xmlns="urn:ietf:params:xml:ns:xmpp-session"><optional/></session></stream:features>').firstElementChild,this._proto._processRequest=()=>{},this._proto._disconnect=()=>this._onDisconnectTimeout(),this._proto._onDisconnectTimeout=()=>{},this._proto._connect=()=>{this.connected=!0,this.mock=!0,this.jid="romeo@montague.lit/orchard",this._changeConnectStatus(ft.Status.BINDREQUIRED)}}_processRequest(){}sendIQ(e,t,s){e=e.tree?.()??e,this.IQ_stanzas.push(e);const n=super.sendIQ(e,t,s);return this.IQ_ids.push(n),n}send(e){return e=e.tree?.()??e,this.sent_stanzas.push(e),super.send(e)}async bind(){const{api:e}=Bu;await e.trigger("beforeResourceBinding",{synchronous:!0}),this.authenticated=!0,this._changeConnectStatus(ft.Status.CONNECTED)}}let ph;const fh={explicitResourceBinding:!0},vh={init(e){if(e&&ph?.jid&&ih(ph.jid,e))return ph;if(!tu.get("bosh_service_url")&&tu.get("authentication")===yu)throw new Error("authentication is set to 'prebind' but we don't have a BOSH connection");const t=iu()?gh:mh;return ph=new t(eh(),Object.assign(fh,tu.get("connection_options"),{keepalive:tu.get("keepalive")})),function(){const e=tu.get("loglevel");ft.setLogLevel(ft.LogLevel[e.toUpperCase()]);const t={};t[ft.LogLevel.DEBUG]="debug",t[ft.LogLevel.INFO]="info",t[ft.LogLevel.WARN]="warn",t[ft.LogLevel.ERROR]="error",t[ft.LogLevel.FATAL]="fatal",ft.log=(e,s)=>Ct.log(s,t[e]),ft.error=e=>Ct.error(e)}(),qu.trigger("connectionInitialized"),ph},get:()=>ph,destroy(){this.disconnect(),ph?.disconnect(),ph=void 0},authenticated:()=>ph?.authenticated&&!0,connected:()=>ph?.connected&&!0,disconnect(){ph?.disconnect()},reconnect:()=>(ph.setConnectionStatus(ft.Status.RECONNECTING,"The connection has dropped, attempting to reconnect."),ph?.reconnecting?ph.debouncedReconnect():ph.reconnect()),isType:e=>ph.isType(e)};function _h(e,t){clearTimeout(e),clearInterval(t)}function bh(e,t=300,s=3){try{const t=e();if(t)return Promise.resolve(t)}catch(e){return Promise.reject(e)}const n=hc(),i=new Error;const r=setInterval((function(){try{const t=e();t&&(_h(o,r),n.resolve(t))}catch(e){_h(o,r),n.reject(e)}}),s);const o=setTimeout((function(){_h(o,r);const e=`Wait until promise timed out: \n\n${i.stack}`;console.trace(),Ct.error(e),n.reject(new Error(e))}),t);return n}const yh={promises:{add(e,t=!0){(e=Array.isArray(e)?e:[e]).forEach((e=>{const s=hc();s.replace=t,Bu.promises[e]=s}))}},waitUntil(e){if(Yd(e))return bh(e);{const t=Bu.promises[e];return void 0===t?null:t}}};class wh extends Error{}class Sh extends Error{constructor(e){super(e),this.retry_event_id=null}}class Ah extends Error{constructor(e,t,s){super(t.querySelector("text")?.textContent??""),this.name=e,this.type=t.getAttribute("type"),this.el=t,this.extra=s}}class xh extends Error{constructor(e,t){super(t),this.name="StanzaParseError",this.stanza=e}}class Eh extends Ah{}class $h extends Ah{}class Ch extends Ah{}class kh extends Ah{}class jh extends Ah{}class Th extends Ah{}class Oh extends Ah{}class Nh extends Ah{}class Ih extends Ah{}class Mh extends Ah{}class Rh extends Ah{}class Dh extends Ah{}class zh extends Ah{}class Lh extends Ah{}class Ph extends Ah{}class Fh extends Ah{}class Uh extends Ah{}class Bh extends Ah{}class qh extends Ah{}class Hh extends Ah{}class Gh extends Ah{}class Wh extends Ah{}const Vh={send(e){const{api:t}=Bu;if(!t.connection.connected())return Ct.warn("Not sending stanza because we're not connected!"),void Ct.warn(ft.serialize(e));const s=e instanceof Element?e:e.tree();if("iq"===s.tagName)return t.sendIQ(s);t.connection.get().send(s),t.trigger("send",s)},sendIQ(e,t,s=!0){const{api:n}=Bu;if(!n.connection.connected())throw new Error("Not sending IQ stanza because we're not connected!");const i=n.connection.get();let r;const o=e instanceof Element?e:e.tree();return["get","set"].includes(o.getAttribute("type"))?(t=t||n.settings.get("stanza_timeout"),s?(r=new Promise(((e,s)=>i.sendIQ(o,e,s,t))),r.catch((e=>{if(null===e)throw new Sh(`Timeout error after ${t}ms for the following IQ stanza: ${ft.serialize(o)}`)}))):r=new Promise((e=>i.sendIQ(o,e,e,t)))):(i.sendIQ(o),r=Promise.resolve()),n.trigger("send",o),r}};async function Qh(e,t,s){let n;e=ft.getBareJidFromJid(e.toLowerCase()),Object.assign(t,{jid:e,id:e});try{n=new s(t,{collection:Bu.state.chatboxes})}catch(e){return Ct.error(e),null}return await n.initialized,n.isValid()?(Bu.state.chatboxes.add(n),n):(n.destroy(),null)}const{waitUntil:Kh}=yh,Jh={},Yh={create:async(e=[],t={},s)=>(await Kh("chatBoxesFetched"),"string"==typeof e?Qh(e,t,s):Promise.all(e.map((e=>Qh(e,t,s))))),async get(e){await Kh("chatBoxesFetched");const{chatboxes:t}=Bu.state;return void 0===e?t.models:"string"==typeof e?t.get(e.toLowerCase()):(e=e.map((e=>e.toLowerCase())),t.models.filter((t=>e.includes(t.get("jid")))))},registry:{add(e,t){Jh[e]=t},get:e=>Jh[e]}},{waitUntil:Xh}=yh,Zh={create(e,t={}){if(!(t="string"==typeof t?{nick:t}:t||{}).nick&&tu.get("muc_nickname_from_jid")){const e=Bu.session.get("bare_jid");t.nick=ft.getNodeFromJid(e)}if(void 0===e)throw new TypeError("rooms.create: You need to provide at least one JID");return"string"==typeof e?Zh.get(rh(e),t,!0):Promise.all(e.map((e=>Zh.get(rh(e),t,!0))))},async open(e,t={},s=!1){if(await Xh("chatBoxesFetched"),void 0===e){const e="rooms.open: You need to provide at least one JID";throw Ct.error(e),new TypeError(e)}if("string"==typeof e){const n=await Zh.get(e,t,!0);return!t.hidden&&n?.maybeShow(s),n}{const n=await Promise.all(e.map((e=>n.get(e,t,!0))));return n.forEach((e=>!t.hidden&&e.maybeShow(s))),n}},async get(e,t={},s=!1){async function n(e){e=rh(e);let n=await Yh.get(e);return!n&&s?n=await Yh.create(e,t,Bu.exports.MUC):(n=n&&n.get("type")===ju?n:null,n&&Object.keys(t).length&&n.save(t)),n}if(await Xh("chatBoxesFetched"),void 0===e){return(await Yh.get()).filter((e=>e.get("type")===ju))}return"string"==typeof e?n(e):Promise.all(e.map((e=>n(e))))}},em={rooms:Zh},{waitUntil:tm}=yh,{send:sm}=Vh,{rooms:nm}=em,im={presence:{async send(e,t,s,n){await tm("statusInitialized");let i=[];n&&(i=Array.isArray(n)?n:[n]);const r=Bu.state.xmppstatus,o=await r.constructPresence(e,t,s);if(i.map((e=>e?.tree()??e)).forEach((e=>o.cnode(e).up())),sm(o),["away","chat","dnd","online","xa",void 0].includes(e)){(await nm.get()).forEach((t=>t.sendStatusPresence(e,s,i)))}}}};let rm;function om(){const e=Bu.session.get("bare_jid");if(!e){const e="No JID to fetch user settings for";throw Ct.error(e),Error(e)}const t=`converse.user-settings.${e}`;if(rm?.get("id")!==t)return rm=new fd({id:t}),Zu(rm,t),rm.fetch({promise:!0})}async function am(){return await om(),rm}async function cm(e,t){return await om(),rm.save(e,t)}const lm={getModel:()=>am(),async get(e,t){const s=await am();return void 0===s.get(e)?t:s.get(e)},set(e,t){if(e instanceof Object)return cm(e,{promise:!0});{const s={};return s[e]=t,cm(s,{promise:!0})}},clear:()=>async function(){if(Bu.session.get("bare_jid"))return await om(),rm.clear();rm=void 0}()},dm={user:{settings:lm,...im,jid:()=>vh.get()?.jid,async login(e,t,s=!1){const{api:n}=Bu;e=e||n.settings.get("jid");const i=vh.init(e);if(n.settings.get("connection_options")?.worker&&await i.restoreWorkerSession())return;e&&(e=await ah(e));const{success:r}=await Bu.api.hook("login",this,{jid:e,password:t,automatic:s});if(r)return;t=t||n.settings.get("password");const o=e&&t?{jid:e,password:t}:null;await lh(o,s)},async logout(){const{api:e}=Bu;await e.trigger("beforeLogout",{synchronous:!0});const t=hc(),s=()=>{Object.keys(Bu.promises).forEach((e=>ou(Bu,e))),localStorage.removeItem("conversejs-session-jid"),e.trigger("logout"),t.resolve()},n=vh.get();return n?(n.setDisconnectionCause(_u,void 0,!0),e.listen.once("disconnected",(()=>s())),n.disconnect()):s(),t}}},um=dm,hm={connection:vh,settings:tu,...Vh,...um,...qu,...yh,disco:null,elements:null,contacts:null};function mm(e){return!!_t(e)&&"error"===e.getAttribute("type")}function gm(e){return!!_t(e)&&q()(`error[type="auth"] forbidden[xmlns="${ft.NS.STANZAS}"]`,e).length>0}function pm(e){return!!_t(e)&&q()(`error[type="cancel"] service-unavailable[xmlns="${ft.NS.STANZAS}"]`,e).length>0}function fm(e){return e.getAttributeNames().reduce(((t,s)=>(t[s]=ft.xmlunescape(e.getAttribute(s)),t)),{})}var vm=s(9542),_m=s.n(vm);const bm="array",ym="bit",wm="bits",Sm="byte",Am="bytes",xm="",Em="exponent",$m="function",Cm="iec",km="Invalid number",jm="Invalid rounding method",Tm="jedec",Om="object",Nm=".",Im="round",Mm="s",Rm="si",Dm="kbit",zm="kB",Lm=" ",Pm="string",Fm="0",Um={symbol:{iec:{bits:["bit","Kibit","Mibit","Gibit","Tibit","Pibit","Eibit","Zibit","Yibit"],bytes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]},jedec:{bits:["bit","Kbit","Mbit","Gbit","Tbit","Pbit","Ebit","Zbit","Ybit"],bytes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}},fullform:{iec:["","kibi","mebi","gibi","tebi","pebi","exbi","zebi","yobi"],jedec:["","kilo","mega","giga","tera","peta","exa","zetta","yotta"]}};function Bm(e,{bits:t=!1,pad:s=!1,base:n=-1,round:i=2,locale:r=xm,localeOptions:o={},separator:a=xm,spacer:c=Lm,symbols:l={},standard:d=xm,output:u=Pm,fullform:h=!1,fullforms:m=[],exponent:g=-1,roundingMethod:p=Im,precision:f=0}={}){let v=g,_=Number(e),b=[],y=0,w=xm;d===Rm?(n=10,d=Tm):d===Cm||d===Tm?n=2:2===n?d=Cm:(n=10,d=Tm);const S=10===n?1e3:1024,A=!0===h,x=_<0,E=Math[p];if("bigint"!=typeof e&&isNaN(e))throw new TypeError(km);if(typeof E!==$m)throw new TypeError(jm);if(x&&(_=-_),(-1===v||isNaN(v))&&(v=Math.floor(Math.log(_)/Math.log(S)),v<0&&(v=0)),v>8&&(f>0&&(f+=8-v),v=8),u===Em)return v;if(0===_)b[0]=0,w=b[1]=Um.symbol[d][t?wm:Am][v];else{y=_/(2===n?Math.pow(2,10*v):Math.pow(1e3,v)),t&&(y*=8,y>=S&&v<8&&(y/=S,v++));const e=Math.pow(10,v>0?i:0);b[0]=E(y*e)/e,b[0]===S&&v<8&&-1===g&&(b[0]=1,v++),w=b[1]=10===n&&1===v?t?Dm:zm:Um.symbol[d][t?wm:Am][v]}if(x&&(b[0]=-b[0]),f>0&&(b[0]=b[0].toPrecision(f)),b[1]=l[b[1]]||b[1],!0===r?b[0]=b[0].toLocaleString():r.length>0?b[0]=b[0].toLocaleString(r,o):a.length>0&&(b[0]=b[0].toString().replace(Nm,a)),s&&!1===Number.isInteger(b[0])&&i>0){const e=a||Nm,t=b[0].toString().split(e),s=t[1]||xm,n=s.length,r=i-n;b[0]=`${t[0]}${e}${s.padEnd(n+r,Fm)}`}return A&&(b[1]=m[v]?m[v]:Um.fullform[d][v]+(t?ym:Sm)+(1===b[0]?xm:Mm)),u===bm?b:u===Om?{value:b[0],symbol:b[1],exponent:v,unit:w}:b.join(c)}const qm=globalThis,Hm=qm.ShadowRoot&&(void 0===qm.ShadyCSS||qm.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,Gm=Symbol(),Wm=new WeakMap;class Vm{constructor(e,t,s){if(this._$cssResult$=!0,s!==Gm)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const t=this.t;if(Hm&&void 0===e){const s=void 0!==t&&1===t.length;s&&(e=Wm.get(t)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),s&&Wm.set(t,e))}return e}toString(){return this.cssText}}const Qm=Hm?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const s of e.cssRules)t+=s.cssText;return(e=>new Vm("string"==typeof e?e:e+"",void 0,Gm))(t)})(e):e,{is:Km,defineProperty:Jm,getOwnPropertyDescriptor:Ym,getOwnPropertyNames:Xm,getOwnPropertySymbols:Zm,getPrototypeOf:eg}=Object,tg=globalThis,sg=tg.trustedTypes,ng=sg?sg.emptyScript:"",ig=tg.reactiveElementPolyfillSupport,rg=(e,t)=>e,og={toAttribute(e,t){switch(t){case Boolean:e=e?ng:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let s=e;switch(t){case Boolean:s=null!==e;break;case Number:s=null===e?null:Number(e);break;case Object:case Array:try{s=JSON.parse(e)}catch(e){s=null}}return s}},ag=(e,t)=>!Km(e,t),cg={attribute:!0,type:String,converter:og,reflect:!1,hasChanged:ag};Symbol.metadata??=Symbol("metadata"),tg.litPropertyMetadata??=new WeakMap;class lg extends HTMLElement{static addInitializer(e){this._$Ei(),(this.l??=[]).push(e)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(e,t=cg){if(t.state&&(t.attribute=!1),this._$Ei(),this.elementProperties.set(e,t),!t.noAccessor){const s=Symbol(),n=this.getPropertyDescriptor(e,s,t);void 0!==n&&Jm(this.prototype,e,n)}}static getPropertyDescriptor(e,t,s){const{get:n,set:i}=Ym(this.prototype,e)??{get(){return this[t]},set(e){this[t]=e}};return{get(){return n?.call(this)},set(t){const r=n?.call(this);i.call(this,t),this.requestUpdate(e,r,s)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)??cg}static _$Ei(){if(this.hasOwnProperty(rg("elementProperties")))return;const e=eg(this);e.finalize(),void 0!==e.l&&(this.l=[...e.l]),this.elementProperties=new Map(e.elementProperties)}static finalize(){if(this.hasOwnProperty(rg("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(rg("properties"))){const e=this.properties,t=[...Xm(e),...Zm(e)];for(const s of t)this.createProperty(s,e[s])}const e=this[Symbol.metadata];if(null!==e){const t=litPropertyMetadata.get(e);if(void 0!==t)for(const[e,s]of t)this.elementProperties.set(e,s)}this._$Eh=new Map;for(const[e,t]of this.elementProperties){const s=this._$Eu(e,t);void 0!==s&&this._$Eh.set(s,e)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const s=new Set(e.flat(1/0).reverse());for(const e of s)t.unshift(Qm(e))}else void 0!==e&&t.push(Qm(e));return t}static _$Eu(e,t){const s=t.attribute;return!1===s?void 0:"string"==typeof s?s:"string"==typeof e?e.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((e=>e(this)))}addController(e){(this._$EO??=new Set).add(e),void 0!==this.renderRoot&&this.isConnected&&e.hostConnected?.()}removeController(e){this._$EO?.delete(e)}_$E_(){const e=new Map,t=this.constructor.elementProperties;for(const s of t.keys())this.hasOwnProperty(s)&&(e.set(s,this[s]),delete this[s]);e.size>0&&(this._$Ep=e)}createRenderRoot(){const e=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((e,t)=>{if(Hm)e.adoptedStyleSheets=t.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet));else for(const s of t){const t=document.createElement("style"),n=qm.litNonce;void 0!==n&&t.setAttribute("nonce",n),t.textContent=s.cssText,e.appendChild(t)}})(e,this.constructor.elementStyles),e}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((e=>e.hostConnected?.()))}enableUpdating(e){}disconnectedCallback(){this._$EO?.forEach((e=>e.hostDisconnected?.()))}attributeChangedCallback(e,t,s){this._$AK(e,s)}_$EC(e,t){const s=this.constructor.elementProperties.get(e),n=this.constructor._$Eu(e,s);if(void 0!==n&&!0===s.reflect){const i=(void 0!==s.converter?.toAttribute?s.converter:og).toAttribute(t,s.type);this._$Em=e,null==i?this.removeAttribute(n):this.setAttribute(n,i),this._$Em=null}}_$AK(e,t){const s=this.constructor,n=s._$Eh.get(e);if(void 0!==n&&this._$Em!==n){const e=s.getPropertyOptions(n),i="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==e.converter?.fromAttribute?e.converter:og;this._$Em=n,this[n]=i.fromAttribute(t,e.type),this._$Em=null}}requestUpdate(e,t,s){if(void 0!==e){if(s??=this.constructor.getPropertyOptions(e),!(s.hasChanged??ag)(this[e],t))return;this.P(e,t,s)}!1===this.isUpdatePending&&(this._$ES=this._$ET())}P(e,t,s){this._$AL.has(e)||this._$AL.set(e,t),!0===s.reflect&&this._$Em!==e&&(this._$Ej??=new Set).add(e)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[e,t]of this._$Ep)this[e]=t;this._$Ep=void 0}const e=this.constructor.elementProperties;if(e.size>0)for(const[t,s]of e)!0!==s.wrapped||this._$AL.has(t)||void 0===this[t]||this.P(t,this[t],s)}let e=!1;const t=this._$AL;try{e=this.shouldUpdate(t),e?(this.willUpdate(t),this._$EO?.forEach((e=>e.hostUpdate?.())),this.update(t)):this._$EU()}catch(t){throw e=!1,this._$EU(),t}e&&this._$AE(t)}willUpdate(e){}_$AE(e){this._$EO?.forEach((e=>e.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(e){return!0}update(e){this._$Ej&&=this._$Ej.forEach((e=>this._$EC(e,this[e]))),this._$EU()}updated(e){}firstUpdated(e){}}lg.elementStyles=[],lg.shadowRootOptions={mode:"open"},lg[rg("elementProperties")]=new Map,lg[rg("finalized")]=new Map,ig?.({ReactiveElement:lg}),(tg.reactiveElementVersions??=[]).push("2.0.4");const dg=globalThis,ug=dg.trustedTypes,hg=ug?ug.createPolicy("lit-html",{createHTML:e=>e}):void 0,mg="$lit$",gg=`lit$${Math.random().toFixed(9).slice(2)}$`,pg="?"+gg,fg=`<${pg}>`,vg=document,_g=()=>vg.createComment(""),bg=e=>null===e||"object"!=typeof e&&"function"!=typeof e,yg=Array.isArray,wg=e=>yg(e)||"function"==typeof e?.[Symbol.iterator],Sg="[ \t\n\f\r]",Ag=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,xg=/-->/g,Eg=/>/g,$g=RegExp(`>|${Sg}(?:([^\\s"'>=/]+)(${Sg}*=${Sg}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),Cg=/'/g,kg=/"/g,jg=/^(?:script|style|textarea|title)$/i,Tg=e=>(t,...s)=>({_$litType$:e,strings:t,values:s}),Og=Tg(1),Ng=(Tg(2),Symbol.for("lit-noChange")),Ig=Symbol.for("lit-nothing"),Mg=new WeakMap,Rg=vg.createTreeWalker(vg,129);function Dg(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==hg?hg.createHTML(t):t}const zg=(e,t)=>{const s=e.length-1,n=[];let i,r=2===t?"<svg>":"",o=Ag;for(let t=0;t<s;t++){const s=e[t];let a,c,l=-1,d=0;for(;d<s.length&&(o.lastIndex=d,c=o.exec(s),null!==c);)d=o.lastIndex,o===Ag?"!--"===c[1]?o=xg:void 0!==c[1]?o=Eg:void 0!==c[2]?(jg.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=$g):void 0!==c[3]&&(o=$g):o===$g?">"===c[0]?(o=i??Ag,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?$g:'"'===c[3]?kg:Cg):o===kg||o===Cg?o=$g:o===xg||o===Eg?o=Ag:(o=$g,i=void 0);const u=o===$g&&e[t+1].startsWith("/>")?" ":"";r+=o===Ag?s+fg:l>=0?(n.push(a),s.slice(0,l)+mg+s.slice(l)+gg+u):s+gg+(-2===l?t:u)}return[Dg(e,r+(e[s]||"<?>")+(2===t?"</svg>":"")),n]};class Lg{constructor({strings:e,_$litType$:t},s){let n;this.parts=[];let i=0,r=0;const o=e.length-1,a=this.parts,[c,l]=zg(e,t);if(this.el=Lg.createElement(c,s),Rg.currentNode=this.el.content,2===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(n=Rg.nextNode())&&a.length<o;){if(1===n.nodeType){if(n.hasAttributes())for(const e of n.getAttributeNames())if(e.endsWith(mg)){const t=l[r++],s=n.getAttribute(e).split(gg),o=/([.?@])?(.*)/.exec(t);a.push({type:1,index:i,name:o[2],strings:s,ctor:"."===o[1]?qg:"?"===o[1]?Hg:"@"===o[1]?Gg:Bg}),n.removeAttribute(e)}else e.startsWith(gg)&&(a.push({type:6,index:i}),n.removeAttribute(e));if(jg.test(n.tagName)){const e=n.textContent.split(gg),t=e.length-1;if(t>0){n.textContent=ug?ug.emptyScript:"";for(let s=0;s<t;s++)n.append(e[s],_g()),Rg.nextNode(),a.push({type:2,index:++i});n.append(e[t],_g())}}}else if(8===n.nodeType)if(n.data===pg)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=n.data.indexOf(gg,e+1));)a.push({type:7,index:i}),e+=gg.length-1}i++}}static createElement(e,t){const s=vg.createElement("template");return s.innerHTML=e,s}}function Pg(e,t,s=e,n){if(t===Ng)return t;let i=void 0!==n?s._$Co?.[n]:s._$Cl;const r=bg(t)?void 0:t._$litDirective$;return i?.constructor!==r&&(i?._$AO?.(!1),void 0===r?i=void 0:(i=new r(e),i._$AT(e,s,n)),void 0!==n?(s._$Co??=[])[n]=i:s._$Cl=i),void 0!==i&&(t=Pg(e,i._$AS(e,t.values),i,n)),t}class Fg{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:s}=this._$AD,n=(e?.creationScope??vg).importNode(t,!0);Rg.currentNode=n;let i=Rg.nextNode(),r=0,o=0,a=s[0];for(;void 0!==a;){if(r===a.index){let t;2===a.type?t=new Ug(i,i.nextSibling,this,e):1===a.type?t=new a.ctor(i,a.name,a.strings,this,e):6===a.type&&(t=new Wg(i,this,e)),this._$AV.push(t),a=s[++o]}r!==a?.index&&(i=Rg.nextNode(),r++)}return Rg.currentNode=vg,n}p(e){let t=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}class Ug{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,s,n){this.type=2,this._$AH=Ig,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=n,this._$Cv=n?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=Pg(this,e,t),bg(e)?e===Ig||null==e||""===e?(this._$AH!==Ig&&this._$AR(),this._$AH=Ig):e!==this._$AH&&e!==Ng&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):wg(e)?this.k(e):this._(e)}S(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.S(e))}_(e){this._$AH!==Ig&&bg(this._$AH)?this._$AA.nextSibling.data=e:this.T(vg.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:s}=e,n="number"==typeof s?this._$AC(e):(void 0===s.el&&(s.el=Lg.createElement(Dg(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===n)this._$AH.p(t);else{const e=new Fg(n,this),s=e.u(this.options);e.p(t),this.T(s),this._$AH=e}}_$AC(e){let t=Mg.get(e.strings);return void 0===t&&Mg.set(e.strings,t=new Lg(e)),t}k(e){yg(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,n=0;for(const i of e)n===t.length?t.push(s=new Ug(this.S(_g()),this.S(_g()),this,this.options)):s=t[n],s._$AI(i),n++;n<t.length&&(this._$AR(s&&s._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class Bg{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,s,n,i){this.type=1,this._$AH=Ig,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=i,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=Ig}_$AI(e,t=this,s,n){const i=this.strings;let r=!1;if(void 0===i)e=Pg(this,e,t,0),r=!bg(e)||e!==this._$AH&&e!==Ng,r&&(this._$AH=e);else{const n=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=Pg(this,n[s+o],t,o),a===Ng&&(a=this._$AH[o]),r||=!bg(a)||a!==this._$AH[o],a===Ig?e=Ig:e!==Ig&&(e+=(a??"")+i[o+1]),this._$AH[o]=a}r&&!n&&this.j(e)}j(e){e===Ig?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class qg extends Bg{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===Ig?void 0:e}}class Hg extends Bg{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==Ig)}}class Gg extends Bg{constructor(e,t,s,n,i){super(e,t,s,n,i),this.type=5}_$AI(e,t=this){if((e=Pg(this,e,t,0)??Ig)===Ng)return;const s=this._$AH,n=e===Ig&&s!==Ig||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,i=e!==Ig&&(s===Ig||n);n&&this.element.removeEventListener(this.name,this,s),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class Wg{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){Pg(this,e)}}const Vg={P:mg,A:gg,C:pg,M:1,L:zg,R:Fg,D:wg,V:Pg,I:Ug,H:Bg,N:Hg,U:Gg,B:qg,F:Wg},Qg=dg.litHtmlPolyfillSupport;Qg?.(Lg,Ug),(dg.litHtmlVersions??=[]).push("3.1.4");const Kg=globalThis,Jg=Kg.trustedTypes,Yg=Jg?Jg.createPolicy("lit-html",{createHTML:e=>e}):void 0,Xg="$lit$",Zg=`lit$${Math.random().toFixed(9).slice(2)}$`,ep="?"+Zg,tp=`<${ep}>`,sp=document,np=()=>sp.createComment(""),ip=e=>null===e||"object"!=typeof e&&"function"!=typeof e,rp=Array.isArray,op=e=>rp(e)||"function"==typeof e?.[Symbol.iterator],ap="[ \t\n\f\r]",cp=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,lp=/-->/g,dp=/>/g,up=RegExp(`>|${ap}(?:([^\\s"'>=/]+)(${ap}*=${ap}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),hp=/'/g,mp=/"/g,gp=/^(?:script|style|textarea|title)$/i,pp=e=>(t,...s)=>({_$litType$:e,strings:t,values:s}),fp=pp(1),vp=(pp(2),Symbol.for("lit-noChange")),_p=Symbol.for("lit-nothing"),bp=new WeakMap,yp=sp.createTreeWalker(sp,129);function wp(e,t){if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==Yg?Yg.createHTML(t):t}const Sp=(e,t)=>{const s=e.length-1,n=[];let i,r=2===t?"<svg>":"",o=cp;for(let t=0;t<s;t++){const s=e[t];let a,c,l=-1,d=0;for(;d<s.length&&(o.lastIndex=d,c=o.exec(s),null!==c);)d=o.lastIndex,o===cp?"!--"===c[1]?o=lp:void 0!==c[1]?o=dp:void 0!==c[2]?(gp.test(c[2])&&(i=RegExp("</"+c[2],"g")),o=up):void 0!==c[3]&&(o=up):o===up?">"===c[0]?(o=i??cp,l=-1):void 0===c[1]?l=-2:(l=o.lastIndex-c[2].length,a=c[1],o=void 0===c[3]?up:'"'===c[3]?mp:hp):o===mp||o===hp?o=up:o===lp||o===dp?o=cp:(o=up,i=void 0);const u=o===up&&e[t+1].startsWith("/>")?" ":"";r+=o===cp?s+tp:l>=0?(n.push(a),s.slice(0,l)+Xg+s.slice(l)+Zg+u):s+Zg+(-2===l?t:u)}return[wp(e,r+(e[s]||"<?>")+(2===t?"</svg>":"")),n]};class Ap{constructor({strings:e,_$litType$:t},s){let n;this.parts=[];let i=0,r=0;const o=e.length-1,a=this.parts,[c,l]=Sp(e,t);if(this.el=Ap.createElement(c,s),yp.currentNode=this.el.content,2===t){const e=this.el.content.firstChild;e.replaceWith(...e.childNodes)}for(;null!==(n=yp.nextNode())&&a.length<o;){if(1===n.nodeType){if(n.hasAttributes())for(const e of n.getAttributeNames())if(e.endsWith(Xg)){const t=l[r++],s=n.getAttribute(e).split(Zg),o=/([.?@])?(.*)/.exec(t);a.push({type:1,index:i,name:o[2],strings:s,ctor:"."===o[1]?kp:"?"===o[1]?jp:"@"===o[1]?Tp:Cp}),n.removeAttribute(e)}else e.startsWith(Zg)&&(a.push({type:6,index:i}),n.removeAttribute(e));if(gp.test(n.tagName)){const e=n.textContent.split(Zg),t=e.length-1;if(t>0){n.textContent=Jg?Jg.emptyScript:"";for(let s=0;s<t;s++)n.append(e[s],np()),yp.nextNode(),a.push({type:2,index:++i});n.append(e[t],np())}}}else if(8===n.nodeType)if(n.data===ep)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=n.data.indexOf(Zg,e+1));)a.push({type:7,index:i}),e+=Zg.length-1}i++}}static createElement(e,t){const s=sp.createElement("template");return s.innerHTML=e,s}}function xp(e,t,s=e,n){if(t===vp)return t;let i=void 0!==n?s._$Co?.[n]:s._$Cl;const r=ip(t)?void 0:t._$litDirective$;return i?.constructor!==r&&(i?._$AO?.(!1),void 0===r?i=void 0:(i=new r(e),i._$AT(e,s,n)),void 0!==n?(s._$Co??=[])[n]=i:s._$Cl=i),void 0!==i&&(t=xp(e,i._$AS(e,t.values),i,n)),t}class Ep{constructor(e,t){this._$AV=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(e){const{el:{content:t},parts:s}=this._$AD,n=(e?.creationScope??sp).importNode(t,!0);yp.currentNode=n;let i=yp.nextNode(),r=0,o=0,a=s[0];for(;void 0!==a;){if(r===a.index){let t;2===a.type?t=new $p(i,i.nextSibling,this,e):1===a.type?t=new a.ctor(i,a.name,a.strings,this,e):6===a.type&&(t=new Op(i,this,e)),this._$AV.push(t),a=s[++o]}r!==a?.index&&(i=yp.nextNode(),r++)}return yp.currentNode=sp,n}p(e){let t=0;for(const s of this._$AV)void 0!==s&&(void 0!==s.strings?(s._$AI(e,s,t),t+=s.strings.length-2):s._$AI(e[t])),t++}}class $p{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(e,t,s,n){this.type=2,this._$AH=_p,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=s,this.options=n,this._$Cv=n?.isConnected??!0}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===e?.nodeType&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=xp(this,e,t),ip(e)?e===_p||null==e||""===e?(this._$AH!==_p&&this._$AR(),this._$AH=_p):e!==this._$AH&&e!==vp&&this._(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):op(e)?this.k(e):this._(e)}S(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.S(e))}_(e){this._$AH!==_p&&ip(this._$AH)?this._$AA.nextSibling.data=e:this.T(sp.createTextNode(e)),this._$AH=e}$(e){const{values:t,_$litType$:s}=e,n="number"==typeof s?this._$AC(e):(void 0===s.el&&(s.el=Ap.createElement(wp(s.h,s.h[0]),this.options)),s);if(this._$AH?._$AD===n)this._$AH.p(t);else{const e=new Ep(n,this),s=e.u(this.options);e.p(t),this.T(s),this._$AH=e}}_$AC(e){let t=bp.get(e.strings);return void 0===t&&bp.set(e.strings,t=new Ap(e)),t}k(e){rp(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let s,n=0;for(const i of e)n===t.length?t.push(s=new $p(this.S(np()),this.S(np()),this,this.options)):s=t[n],s._$AI(i),n++;n<t.length&&(this._$AR(s&&s._$AB.nextSibling,n),t.length=n)}_$AR(e=this._$AA.nextSibling,t){for(this._$AP?.(!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){void 0===this._$AM&&(this._$Cv=e,this._$AP?.(e))}}class Cp{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(e,t,s,n,i){this.type=1,this._$AH=_p,this._$AN=void 0,this.element=e,this.name=t,this._$AM=n,this.options=i,s.length>2||""!==s[0]||""!==s[1]?(this._$AH=Array(s.length-1).fill(new String),this.strings=s):this._$AH=_p}_$AI(e,t=this,s,n){const i=this.strings;let r=!1;if(void 0===i)e=xp(this,e,t,0),r=!ip(e)||e!==this._$AH&&e!==vp,r&&(this._$AH=e);else{const n=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=xp(this,n[s+o],t,o),a===vp&&(a=this._$AH[o]),r||=!ip(a)||a!==this._$AH[o],a===_p?e=_p:e!==_p&&(e+=(a??"")+i[o+1]),this._$AH[o]=a}r&&!n&&this.j(e)}j(e){e===_p?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,e??"")}}class kp extends Cp{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===_p?void 0:e}}class jp extends Cp{constructor(){super(...arguments),this.type=4}j(e){this.element.toggleAttribute(this.name,!!e&&e!==_p)}}class Tp extends Cp{constructor(e,t,s,n,i){super(e,t,s,n,i),this.type=5}_$AI(e,t=this){if((e=xp(this,e,t,0)??_p)===vp)return;const s=this._$AH,n=e===_p&&s!==_p||e.capture!==s.capture||e.once!==s.once||e.passive!==s.passive,i=e!==_p&&(s===_p||n);n&&this.element.removeEventListener(this.name,this,s),i&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,e):this._$AH.handleEvent(e)}}class Op{constructor(e,t,s){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=s}get _$AU(){return this._$AM._$AU}_$AI(e){xp(this,e)}}const Np=Kg.litHtmlPolyfillSupport;Np?.(Ap,$p),(Kg.litHtmlVersions??=[]).push("3.1.4");const Ip=(e,t,s)=>{const n=s?.renderBefore??t;let i=n._$litPart$;if(void 0===i){const e=s?.renderBefore??null;n._$litPart$=i=new $p(t.insertBefore(np(),e),e,void 0,s??{})}return i._$AI(e),i};class Mp extends lg{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const e=super.createRenderRoot();return this.renderOptions.renderBefore??=e.firstChild,e}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=Ip(t,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return vp}}Mp._$litElement$=!0,Mp.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:Mp});const Rp=globalThis.litElementPolyfillSupport;Rp?.({LitElement:Mp});(globalThis.litElementVersions??=[]).push("4.0.6");const Dp=class extends fd{defaults(){return{connection_status:ft.Status.DISCONNECTED,message:""}}initialize(){super.initialize();const{api:e}=Bu;this.on("change",(()=>e.trigger("connfeedback",Bu.state.connfeedback)))}};function zp(e){return[...new Set(e)]}function Lp(e,t){const s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e),0),s.set(new Uint8Array(t),e.byteLength),s.buffer}function Pp(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}function Fp(e){return new TextDecoder("utf-8").decode(e)}function Up(e){return(new TextEncoder).encode(e).buffer}function Bp(e){return btoa(new Uint8Array(e).reduce(((e,t)=>e+String.fromCharCode(t)),""))}function qp(e){const t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return n.buffer}function Hp(e){const t=new Uint8Array(e.match(/[\da-f]{2}/gi).map((e=>parseInt(e,16))));return t.buffer}class Gp{constructor(){this.hex="#000000",this.rgb_r=0,this.rgb_g=0,this.rgb_b=0,this.xyz_x=0,this.xyz_y=0,this.xyz_z=0,this.luv_l=0,this.luv_u=0,this.luv_v=0,this.lch_l=0,this.lch_c=0,this.lch_h=0,this.hsluv_h=0,this.hsluv_s=0,this.hsluv_l=0,this.hpluv_h=0,this.hpluv_p=0,this.hpluv_l=0,this.r0s=0,this.r0i=0,this.r1s=0,this.r1i=0,this.g0s=0,this.g0i=0,this.g1s=0,this.g1i=0,this.b0s=0,this.b0i=0,this.b1s=0,this.b1i=0}static fromLinear(e){return e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055}static toLinear(e){return e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92}static yToL(e){return e<=Gp.epsilon?e/Gp.refY*Gp.kappa:116*Math.pow(e/Gp.refY,1/3)-16}static lToY(e){return e<=8?Gp.refY*e/Gp.kappa:Gp.refY*Math.pow((e+16)/116,3)}static rgbChannelToHex(e){const t=Math.round(255*e),s=t%16,n=(t-s)/16|0;return Gp.hexChars.charAt(n)+Gp.hexChars.charAt(s)}static hexToRgbChannel(e,t){return(16*Gp.hexChars.indexOf(e.charAt(t))+Gp.hexChars.indexOf(e.charAt(t+1)))/255}static distanceFromOriginAngle(e,t,s){const n=t/(Math.sin(s)-e*Math.cos(s));return n<0?1/0:n}static distanceFromOrigin(e,t){return Math.abs(t)/Math.sqrt(Math.pow(e,2)+1)}static min6(e,t,s,n,i,r){return Math.min(e,Math.min(t,Math.min(s,Math.min(n,Math.min(i,r)))))}rgbToHex(){this.hex="#",this.hex+=Gp.rgbChannelToHex(this.rgb_r),this.hex+=Gp.rgbChannelToHex(this.rgb_g),this.hex+=Gp.rgbChannelToHex(this.rgb_b)}hexToRgb(){this.hex=this.hex.toLowerCase(),this.rgb_r=Gp.hexToRgbChannel(this.hex,1),this.rgb_g=Gp.hexToRgbChannel(this.hex,3),this.rgb_b=Gp.hexToRgbChannel(this.hex,5)}xyzToRgb(){this.rgb_r=Gp.fromLinear(Gp.m_r0*this.xyz_x+Gp.m_r1*this.xyz_y+Gp.m_r2*this.xyz_z),this.rgb_g=Gp.fromLinear(Gp.m_g0*this.xyz_x+Gp.m_g1*this.xyz_y+Gp.m_g2*this.xyz_z),this.rgb_b=Gp.fromLinear(Gp.m_b0*this.xyz_x+Gp.m_b1*this.xyz_y+Gp.m_b2*this.xyz_z)}rgbToXyz(){const e=Gp.toLinear(this.rgb_r),t=Gp.toLinear(this.rgb_g),s=Gp.toLinear(this.rgb_b);this.xyz_x=.41239079926595*e+.35758433938387*t+.18048078840183*s,this.xyz_y=.21263900587151*e+.71516867876775*t+.072192315360733*s,this.xyz_z=.019330818715591*e+.11919477979462*t+.95053215224966*s}xyzToLuv(){const e=this.xyz_x+15*this.xyz_y+3*this.xyz_z;let t=4*this.xyz_x,s=9*this.xyz_y;0!==e?(t/=e,s/=e):(t=NaN,s=NaN),this.luv_l=Gp.yToL(this.xyz_y),0===this.luv_l?(this.luv_u=0,this.luv_v=0):(this.luv_u=13*this.luv_l*(t-Gp.refU),this.luv_v=13*this.luv_l*(s-Gp.refV))}luvToXyz(){if(0===this.luv_l)return this.xyz_x=0,this.xyz_y=0,void(this.xyz_z=0);const e=this.luv_u/(13*this.luv_l)+Gp.refU,t=this.luv_v/(13*this.luv_l)+Gp.refV;this.xyz_y=Gp.lToY(this.luv_l),this.xyz_x=0-9*this.xyz_y*e/((e-4)*t-e*t),this.xyz_z=(9*this.xyz_y-15*t*this.xyz_y-t*this.xyz_x)/(3*t)}luvToLch(){if(this.lch_l=this.luv_l,this.lch_c=Math.sqrt(this.luv_u*this.luv_u+this.luv_v*this.luv_v),this.lch_c<1e-8)this.lch_h=0;else{const e=Math.atan2(this.luv_v,this.luv_u);this.lch_h=180*e/Math.PI,this.lch_h<0&&(this.lch_h=360+this.lch_h)}}lchToLuv(){const e=this.lch_h/180*Math.PI;this.luv_l=this.lch_l,this.luv_u=Math.cos(e)*this.lch_c,this.luv_v=Math.sin(e)*this.lch_c}calculateBoundingLines(e){const t=Math.pow(e+16,3)/1560896,s=t>Gp.epsilon?t:e/Gp.kappa,n=s*(284517*Gp.m_r0-94839*Gp.m_r2),i=s*(838422*Gp.m_r2+769860*Gp.m_r1+731718*Gp.m_r0),r=s*(632260*Gp.m_r2-126452*Gp.m_r1),o=s*(284517*Gp.m_g0-94839*Gp.m_g2),a=s*(838422*Gp.m_g2+769860*Gp.m_g1+731718*Gp.m_g0),c=s*(632260*Gp.m_g2-126452*Gp.m_g1),l=s*(284517*Gp.m_b0-94839*Gp.m_b2),d=s*(838422*Gp.m_b2+769860*Gp.m_b1+731718*Gp.m_b0),u=s*(632260*Gp.m_b2-126452*Gp.m_b1);this.r0s=n/r,this.r0i=i*e/r,this.r1s=n/(r+126452),this.r1i=(i-769860)*e/(r+126452),this.g0s=o/c,this.g0i=a*e/c,this.g1s=o/(c+126452),this.g1i=(a-769860)*e/(c+126452),this.b0s=l/u,this.b0i=d*e/u,this.b1s=l/(u+126452),this.b1i=(d-769860)*e/(u+126452)}calcMaxChromaHpluv(){const e=Gp.distanceFromOrigin(this.r0s,this.r0i),t=Gp.distanceFromOrigin(this.r1s,this.r1i),s=Gp.distanceFromOrigin(this.g0s,this.g0i),n=Gp.distanceFromOrigin(this.g1s,this.g1i),i=Gp.distanceFromOrigin(this.b0s,this.b0i),r=Gp.distanceFromOrigin(this.b1s,this.b1i);return Gp.min6(e,t,s,n,i,r)}calcMaxChromaHsluv(e){const t=e/360*Math.PI*2,s=Gp.distanceFromOriginAngle(this.r0s,this.r0i,t),n=Gp.distanceFromOriginAngle(this.r1s,this.r1i,t),i=Gp.distanceFromOriginAngle(this.g0s,this.g0i,t),r=Gp.distanceFromOriginAngle(this.g1s,this.g1i,t),o=Gp.distanceFromOriginAngle(this.b0s,this.b0i,t),a=Gp.distanceFromOriginAngle(this.b1s,this.b1i,t);return Gp.min6(s,n,i,r,o,a)}hsluvToLch(){if(this.hsluv_l>99.9999999)this.lch_l=100,this.lch_c=0;else if(this.hsluv_l<1e-8)this.lch_l=0,this.lch_c=0;else{this.lch_l=this.hsluv_l,this.calculateBoundingLines(this.hsluv_l);const e=this.calcMaxChromaHsluv(this.hsluv_h);this.lch_c=e/100*this.hsluv_s}this.lch_h=this.hsluv_h}lchToHsluv(){if(this.lch_l>99.9999999)this.hsluv_s=0,this.hsluv_l=100;else if(this.lch_l<1e-8)this.hsluv_s=0,this.hsluv_l=0;else{this.calculateBoundingLines(this.lch_l);const e=this.calcMaxChromaHsluv(this.lch_h);this.hsluv_s=this.lch_c/e*100,this.hsluv_l=this.lch_l}this.hsluv_h=this.lch_h}hpluvToLch(){if(this.hpluv_l>99.9999999)this.lch_l=100,this.lch_c=0;else if(this.hpluv_l<1e-8)this.lch_l=0,this.lch_c=0;else{this.lch_l=this.hpluv_l,this.calculateBoundingLines(this.hpluv_l);const e=this.calcMaxChromaHpluv();this.lch_c=e/100*this.hpluv_p}this.lch_h=this.hpluv_h}lchToHpluv(){if(this.lch_l>99.9999999)this.hpluv_p=0,this.hpluv_l=100;else if(this.lch_l<1e-8)this.hpluv_p=0,this.hpluv_l=0;else{this.calculateBoundingLines(this.lch_l);const e=this.calcMaxChromaHpluv();this.hpluv_p=this.lch_c/e*100,this.hpluv_l=this.lch_l}this.hpluv_h=this.lch_h}hsluvToRgb(){this.hsluvToLch(),this.lchToLuv(),this.luvToXyz(),this.xyzToRgb()}hpluvToRgb(){this.hpluvToLch(),this.lchToLuv(),this.luvToXyz(),this.xyzToRgb()}hsluvToHex(){this.hsluvToRgb(),this.rgbToHex()}hpluvToHex(){this.hpluvToRgb(),this.rgbToHex()}rgbToHsluv(){this.rgbToXyz(),this.xyzToLuv(),this.luvToLch(),this.lchToHpluv(),this.lchToHsluv()}rgbToHpluv(){this.rgbToXyz(),this.xyzToLuv(),this.luvToLch(),this.lchToHpluv(),this.lchToHpluv()}hexToHsluv(){this.hexToRgb(),this.rgbToHsluv()}hexToHpluv(){this.hexToRgb(),this.rgbToHpluv()}}Gp.hexChars="0123456789abcdef",Gp.refY=1,Gp.refU=.19783000664283,Gp.refV=.46831999493879,Gp.kappa=903.2962962,Gp.epsilon=.0088564516,Gp.m_r0=3.240969941904521,Gp.m_r1=-1.537383177570093,Gp.m_r2=-.498610760293,Gp.m_g0=-.96924363628087,Gp.m_g1=1.87596750150772,Gp.m_g2=.041555057407175,Gp.m_b0=.055630079696993,Gp.m_b1=-.20397695888897,Gp.m_b2=1.056971514242878;const Wp=new Map;async function Vp(e){const t=Wp.get(e);if(t)return t;const s=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",(new TextEncoder).encode(e)))),n=(s[0]+256*s[1])/65536*360,i=new Gp;return i.hsluv_h=n,i.hsluv_s=100,i.hsluv_l=50,i.hsluvToHex(),Wp.set(e,i.hex),i.hex}const Qp=(e,t)=>`<field var="${e}">${t}</field>`,Kp=e=>`<value>${ft.xmlescape(e)}</value>`;function Jp(e){const t=[],s=e?.options;for(let e=0,n=s.length;e<n;e++){const n=s[e];n.selected&&t.push(n.value||n.text)}return t}function Yp(e){const t=e.getAttribute("name");if(!t)return null;let s;return s="checkbox"===e.getAttribute("type")?e.checked?"1":"0":"TEXTAREA"==e.tagName?e.value.split("\n").filter((e=>e.trim())):"SELECT"==e.tagName?Jp(e):e.value,vt(Qp(t,Array.isArray(s)?s.map(Kp):Kp(s)))}function Xp(e,t,s){t||(t=e.selectionEnd||void 0);let[n]=e.value.slice(0,t).split(/\s/).slice(-1);return s&&([n]=n.split(s).slice(-1)),n}function Zp(e){return"@"!==e&&RegExp("(\\p{Z}|\\p{P})","u").test(e)}function ef(e,t){const s=e.selectionEnd||void 0,n=e.value.slice(0,s).split(/\s/).pop(),i=e.value,r=Zp(n[0])?n[0]:"";e.value=i.slice(0,s-n.length)+r+`${t} `+i.slice(s);const o=s-n.length+t.length+1;e.selectionEnd=r?o+1:o}function tf(e){e!==document.activeElement&&e.focus();const t=2*e.value.length;setTimeout((()=>e.setSelectionRange(t,t)),1),e.scrollTop=999999}function sf(e){if(!e)return"";const t=e.codePointAt(0),s=t>65535?2:1;return String.fromCodePoint(t).toLocaleUpperCase()+e.substring(s)}function nf(e,t){return t.reduce((function(t,s){return e.startsWith(s)&&s.length>t.length?s:t}),"")}function rf(e){return"string"==typeof e||e instanceof String}const of=tu;function af(e){try{return!!new URL(e)}catch{return!1}}function cf(e){try{return e instanceof _m()?e:new(_m())(e)}catch(e){return Ct.debug(e),null}}function lf(e,t){const s=cf(t);if(null===s)throw new Error(`checkFileTypes: could not parse url ${t}`);const n=s.filename().toLowerCase();return!!e.filter((e=>n.endsWith(e))).length}function df(e){const t=of.get("filter_url_query_params");if(!t)return e;return cf(e).removeQuery(t).toString()}function uf(e){return lf([".jpg",".jpeg",".png",".gif",".bmp",".tiff",".svg"],e)}function hf(e){return lf([".gif"],e)}function mf(e){return lf([".ogg",".mp3",".m4a"],e)}function gf(e){return lf([".mp4",".webm"],e)}function pf(e){const t=of.get("image_urls_regex");return t?.test(e)||uf(e)}function ff(e){return e.startsWith("aesgcm://")}function vf(e,t=0){const s=[];if(!e)return{};try{_m().withinString(e,((e,n,i)=>(e.startsWith("_")&&(e=e.slice(1),n+=1),e.endsWith("_")&&(e=e.slice(0,e.length-1),i-=1),s.push({url:e,start:n+t,end:i+t}),e)),Mu)}catch(e){Ct.debug(e)}const n=s.map((e=>({end:e.end,is_audio:mf(e.url),is_image:pf(e.url),is_video:gf(e.url),is_encrypted:ff(e.url),start:e.start})));return n.length?{media_urls:n}:{}}function _f(e,t,s=0){return e.map((e=>{const n=e.start-s,i=e.end-s;return n<0||n>=t.length?null:Object.assign({},e,{start:n,end:i,url:t.substring(e.start-s,e.end-s)})})).filter((e=>e))}function bf(e){if(location.hash.startsWith("#converse?loglevel=")){e?.preventDefault();const t=location.hash.split("=").pop();Object.keys(Et).includes(t)?Ct.setLogLevel(t):Ct.error(`Could not set loglevel of ${t}`)}}function yf(e){return e instanceof fd&&(e=e.attributes),!(e.oob_url||e.file||e.is_encrypted&&e.plaintext||e.message||e.body)}function wf(e){return e instanceof Error}function Sf(e,t,s){!function(e){return e.collection&&e.collection.browserStorage}(e)?e.set(t,s):e.save(t,s)}function Af(e){return Math.random()*e|0}function xf(e){const t=crypto.randomUUID?.()??"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=Af(16);return("x"===e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t}const Ef=Object.assign({...g,...p,...f,...v,...r,...d,...o,...u,...a,...m,...l,..._,...b,getRandomInt:Af,getUniqueId:xf,isEmptyMessage:yf,isErrorObject:wf,onMultipleEvents:function(e=[],t){let s=[];function n(n){s.push(n),e.length===s.length&&(t(s),s=[])}e.forEach((e=>e.object.on(e.event,n)))},prefixMentions:function(e){let t=e.getMessageText();return(e.get("references")||[]).sort(((e,t)=>t.begin-e.begin)).forEach((e=>{t=`${t.slice(0,e.begin)}@${t.slice(e.begin)}`})),t},safeSave:Sf,shouldCreateMessage:function(e){return e.retracted||!yf(e)},triggerEvent:function(e,t,s="Event",n=!0,i=!0){const r=document.createEvent(s);r.initEvent(t,n,i),e.dispatchEvent(r)}},{muc:null,mam:null});Bu.api=hm;const $f=Object.assign(window.converse||{},{CHAT_STATES:Ru,keycodes:Du,async initialize(e){const{api:t}=Bu;if(await async function(e){const{api:t}=e;await t.trigger("cleanup",{synchronous:!0}),function(e){e.api.trigger("unregisteredGlobalEventHandlers")}(e),t.connection.get()?.reset(),e.stopListening(),e.off(),e.promises.initialized.isResolved&&t.promises.add("initialized")}(Bu),function(e){Zd=e,Xd=new eu;const t=pd(e,Object.keys(Qd));Object.assign(Xd,Qd,t)}(e),Bu.strict_plugin_dependencies=e.strict_plugin_dependencies,Ct.setLogLevel(t.settings.get("loglevel")),t.settings.get("authentication")===gu&&t.settings.get("auto_login")&&!t.settings.get("jid"))throw new Error("Config Error: you need to provide the server's domain via the 'jid' option when using anonymous authentication with auto_login.");bf(),addEventListener("hashchange",bf);const s=new Dp;Object.assign(Bu,{connfeedback:s}),Object.assign(Bu.state,{connfeedback:s}),await async function(e){await el.sessionStorageInitialized,e.storage.session=el.localForage.createInstance({name:iu()?"converse-test-session":"converse-session",description:"sessionStorage instance",driver:["sessionStorageWrapper"]})}(Bu),await async function(e){const t="converse.client-config",s=new fd({id:t,trusted:!0});s.browserStorage=Xu(t,"session"),Object.assign(e,{config:s}),Object.assign(e.state,{config:s}),await new Promise((e=>s.fetch({success:e,error:e}))),e.api.trigger("clientConfigInitialized")}(Bu),await jt.initialize(),function(e){e.pluggable.initialized_plugins=[];const t=Iu.concat(e.api.settings.get("whitelisted_plugins"));e.api.settings.get("singleton")&&["converse-bookmarks","converse-controlbox","converse-headline","converse-register"].forEach((t=>e.api.settings.get("blacklisted_plugins").push(t))),e.pluggable.initializePlugins({_converse:e},t,e.api.settings.get("blacklisted_plugins")),e.api.trigger("pluginsInitialized")}(Bu),t.elements?.register(),function(e){e.api.trigger("registeredGlobalEventHandlers")}(Bu);const n=Bu.pluggable.plugins;if((t.settings.get("auto_login")||t.settings.get("keepalive")&&n["converse-bosh"]?.enabled())&&await t.user.login(null,null,!0),t.trigger("initialized"),iu())return Bu},plugins:{add(e,t){if(t.__name__=e,void 0!==Bu.pluggable.plugins[e])throw new TypeError(`Error: plugin with name "${e}" has already been registered!`);Bu.pluggable.plugins[e]=t}},env:{$build:ze,$iq:Pe,$msg:Le,$pres:Fe,utils:Ef,Collection:Fd,Model:fd,Promise,Strophe:ft,TimeoutError:Sh,URI:_m(),VERSION_NAME:uu,dayjs:P(),errors:h,filesize:Bm,html:fp,log:Ct,sizzle:q(),sprintf:kt.sprintf,stx:pt,u:Ef}}),Cf=$f,kf=Cf.env.utils;function jf(e,t){hm.send(Le({to:e.getAttribute("from"),type:"error",id:e.getAttribute("id")}).c("error",{type:"cancel"}).c("not-allowed",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).up().c("text",{xmlns:"urn:ietf:params:xml:ns:xmpp-stanzas"}).t(t)),Ct.warn(`Rejecting message stanza with the following reason: ${t}`),Ct.warn(e)}function Tf(e,t,s,n){const i=Le({from:hm.connection.get().jid,id:kf.getUniqueId(),to:e,type:n||"chat"}).c(s,{xmlns:ft.NS.MARKERS,id:t});hm.send(i)}function Of(e,t){if(hm.settings.get("send_chat_state_notifications")&&t){const s=hm.settings.get("send_chat_state_notifications");if(Array.isArray(s)&&!s.includes(t))return;hm.send(Le({id:kf.getUniqueId(),to:e,type:"chat"}).c(t,{xmlns:ft.NS.CHATSTATES}).up().c("no-store",{xmlns:ft.NS.HINTS}).up().c("no-permanent-store",{xmlns:ft.NS.HINTS}))}}const{NS:Nf}=ft;async function If(e){if(e instanceof Error)return e;if("error"!==e.getAttribute("type"))return null;const t=e.querySelector("error");if(!t)return null;const s=q()(`[xmlns="${ft.NS.STANZAS}"]`,t).pop(),n=s?.nodeName,i=await hm.hook("parseErrorStanza",e,{});return"bad-request"===n?new Eh(n,t,i):"conflict"===n?new $h(n,t,i):"feature-not-implemented"===n?new Ch(n,t,i):"forbidden"===n?new kh(n,t,i):"gone"===n?new jh(n,t,i):"internal-server-error"===n?new Th(n,t,i):"item-not-found"===n?new Oh(n,t,i):"jid-malformed"===n?new Nh(n,t,i):"not-acceptable"===n?new Ih(n,t,i):"not-allowed"===n?new Mh(n,t,i):"not-authorized"===n?new Rh(n,t,i):"payment-required"===n?new Dh(n,t,i):"recipient-unavailable"===n?new zh(n,t,i):"redirect"===n?new Lh(n,t,i):"registration-required"===n?new Ph(n,t,i):"remote-server-not-found"===n?new Fh(n,t,i):"remote-server-timeout"===n?new Uh(n,t,i):"resource-constraint"===n?new Bh(n,t,i):"service-unavailable"===n?new qh(n,t,i):"subscription-required"===n?new Hh(n,t,i):"undefined-condition"===n?new Gh(n,t,i):"unexpected-request"===n?new Wh(n,t,i):new Ah("unknown",t)}function Mf(e,t){const s={},n=q()(`stanza-id[xmlns="${ft.NS.SID}"]`,e).reduce(((e,t)=>(e[`stanza_id ${t.getAttribute("by")}`]=t.getAttribute("id"),e)),{});Object.assign(s,n);const i=q()(`message > result[xmlns="${ft.NS.MAM}"]`,t).pop();if(i){const e=Bu.session.get("bare_jid");s[`stanza_id ${t.getAttribute("from")||e}`]=i.getAttribute("id")}const r=q()(`origin-id[xmlns="${ft.NS.SID}"]`,e).pop();return r&&(s.origin_id=r.getAttribute("id")),s}function Rf(e){const t=q()(`encryption[xmlns="${ft.NS.EME}"]`,e).pop(),s=t?.getAttribute("namespace"),n={};return s?(n.is_encrypted=!0,n.encryption_namespace=s):q()(`encrypted[xmlns="${ft.NS.OMEMO}"]`,e).pop()&&(n.is_encrypted=!0,n.encryption_namespace=ft.NS.OMEMO),n}function Df(e,t){const s=q()(`> apply-to[xmlns="${ft.NS.FASTEN}"]`,e).pop();if(s){const e=s.getAttribute("id");if(q()(`> retract[xmlns="${ft.NS.RETRACT}"]`,s).pop()){const s=q()(`delay[xmlns="${ft.NS.DELAY}"]`,t).pop();return{editable:!1,retracted:s?P()(s.getAttribute("stamp")).toISOString():(new Date).toISOString(),retracted_id:e}}}else{const t=q()(`> retracted[xmlns="${ft.NS.RETRACT}"]`,e).pop();if(t)return{editable:!1,is_tombstone:!0,retracted:t.getAttribute("stamp")}}return{}}function zf(e,t){const s=q()(`replace[xmlns="${ft.NS.MESSAGE_CORRECT}"]`,e).pop();if(s){const e=s.getAttribute("id");if(e){const s=q()(`delay[xmlns="${ft.NS.DELAY}"]`,t).pop();return{replace_id:e,edited:s?P()(s.getAttribute("stamp")).toISOString():(new Date).toISOString()}}}return{}}function Lf(e){const t=q()(`spoiler[xmlns="${ft.NS.SPOILER}"]`,e).pop();return{is_spoiler:!!t,spoiler_hint:t?.textContent}}function Pf(e){const t=q()(`x[xmlns="${ft.NS.OUTOFBAND}"]`,e).pop();return t?{oob_url:t.querySelector("url")?.textContent,oob_desc:t.querySelector("desc")?.textContent}:{}}function Ff(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error"),s=q()(`text[xmlns="${ft.NS.STANZAS}"]`,t).pop();return{is_error:!0,error_text:s?.textContent,error_type:t.getAttribute("type"),error_condition:t.firstElementChild.nodeName,errors:Array.from(t.children).map((e=>({name:e.nodeName,xmlns:e.getAttribute("xmlns")})))}}return{}}function Uf(e){return q()(`reference[xmlns="${ft.NS.REFERENCE}"]`,e).map((t=>{const s=t.getAttribute("anchor"),n=e.querySelector(s?`#${s}`:"body")?.textContent;if(!n)return Ct.warn(`Could not find referenced text for ${t}`),null;const i=Number(t.getAttribute("begin")),r=Number(t.getAttribute("end"));return{begin:i,end:r,type:t.getAttribute("type"),value:n.slice(i,r),uri:t.getAttribute("uri")}})).filter((e=>e))}function Bf(e){const t=q()(`received[xmlns="${ft.NS.RECEIPTS}"]`,e).pop();return t?.getAttribute("id")}function qf(e){const t=ft.NS.CARBONS;return q()(`message > received[xmlns="${t}"]`,e).length>0||q()(`message > sent[xmlns="${t}"]`,e).length>0}function Hf(e){return q()(`\n        composing[xmlns="${Nf.CHATSTATES}"],\n        paused[xmlns="${Nf.CHATSTATES}"],\n        inactive[xmlns="${Nf.CHATSTATES}"],\n        active[xmlns="${Nf.CHATSTATES}"],\n        gone[xmlns="${Nf.CHATSTATES}"]`,e).pop()?.nodeName}function Gf(e,t){return"me"!==t.sender&&!t.is_carbon&&!t.is_archived&&q()(`request[xmlns="${ft.NS.RECEIPTS}"]`,e).length}function Wf(e){if(q()(`message > forwarded[xmlns="${ft.NS.FORWARD}"]`,e).length){jf(e,"Forwarded messages not part of an encapsulating protocol are not supported");const t=e.getAttribute("from");throw new xh(e,`Ignoring unencapsulated forwarded message from ${t}`)}}function Vf(e){return q()(`\n        acknowledged[xmlns="${ft.NS.MARKERS}"],\n        displayed[xmlns="${ft.NS.MARKERS}"],\n        received[xmlns="${ft.NS.MARKERS}"]`,e).pop()}function Qf(e){return"headline"===e.getAttribute("type")}function Kf(e){if(q()(`mentions[xmlns="${ft.NS.MENTIONS}"]`,e).pop())return!1;const t=e.getAttribute("from");return!("error"===e.getAttribute("type")||!t||t.includes("@"))}function Jf(e){return!!q()(`message > result[xmlns="${ft.NS.MAM}"]`,e).pop()}function Yf(e,t,s){const n=e.getAttribute("var"),i=e.getAttribute("label")||"",r=e.getAttribute("type"),o=e.querySelector("desc")?.textContent,a={readonly:t,desc:o};if("list-single"===r||"list-multi"===r){const t=Array.from(e.querySelectorAll(":scope > value")).map((e=>e?.textContent));return{type:r,options:Array.from(e.querySelectorAll(":scope > option")).map((s=>{const n=s.querySelector("value")?.textContent;return{value:n,label:s.getAttribute("label"),selected:t.includes(n),required:!!e.querySelector("required"),...a}})),label:e.getAttribute("label"),var:n,required:!!e.querySelector("required"),...a}}if("fixed"===r){const t=e.querySelector("value")?.textContent;return{text:t,label:i,type:r,var:n,...a}}if("jid-multi"===r)return{type:r,var:n,label:i,value:e.querySelector("value")?.textContent,required:!!e.querySelector("required"),...a};if("boolean"===r){const t=e.querySelector("value")?.textContent;return{type:r,var:n,label:i,checked:"1"===t||"true"===t,...a}}if("url"===n)return{var:n,label:i,value:e.querySelector("value")?.textContent,...a};if("username"===n)return{var:n,label:i,value:e.querySelector("value")?.textContent,required:!!e.querySelector("required"),type:Xf(e),...a};if("password"===n)return{var:n,label:i,value:e.querySelector("value")?.textContent,required:!!e.querySelector("required"),...a};if("ocr"===n){const t=e.querySelector("uri"),i=q()('data[cid="'+t.textContent.replace(/^cid:/,"")+'"]',s)[0];return{label:e.getAttribute("label"),var:n,uri:{type:t.getAttribute("type"),data:i?.textContent},required:!!e.querySelector("required"),...a}}return{label:i,var:n,required:!!e.querySelector("required"),value:e.querySelector("value")?.textContent,type:Xf(e),...a}}function Xf(e){const t=zu[e.getAttribute("type")];if("text"==t){const s=e.getElementsByTagNameNS("http://jabber.org/protocol/xdata-validate","validate");if(1===s.length){const e=s[0].getAttribute("datatype");return Lu[e]||t}}return t}function Zf(e){const t=q()(`x[xmlns="${ft.NS.XFORM}"]`,e);if(t.length>1)throw Ct.error(e),new Error("Invalid stanza");if(0===t.length)return null;const s=t[0],n=s.getAttribute("type"),i={type:n,title:s.querySelector("title")?.textContent};if("result"===n){const t=s.querySelector(":scope > reported");if(t){const e=t?Array.from(t.querySelectorAll(":scope > field")):[],n=Array.from(s.querySelectorAll(":scope > item"));return{...i,reported:e.map(fm),items:n.map((e=>Array.from(e.querySelectorAll("field")).map((e=>({...fm(e),value:e.querySelector("value")?.textContent??""})))))}}return{...i,fields:Array.from(s.querySelectorAll("field")).map((t=>Yf(t,!0,e)))}}if("form"===n)return{...i,instructions:s.querySelector("instructions")?.textContent,fields:Array.from(s.querySelectorAll("field")).map((t=>Yf(t,!1,e)))};throw new Error(`Invalid type in XForm response stanza: ${n}`)}const ev=class extends fd{defaults(){return{current_category:"smileys",current_skintone:"",scroll_position:0}}},tv={async initialize(){if(!Cf.emojis.initialized){Cf.emojis.initialized=!0;const e=await s.e(2974).then(s.t.bind(s,7641,19)),t=await hm.hook("loadEmojis",{},e.default);Cf.emojis.json=t,Cf.emojis.by_sn=Object.keys(t).reduce(((e,s)=>Object.assign(e,t[s])),{}),Cf.emojis.list=Object.values(Cf.emojis.by_sn),Cf.emojis.list.sort(((e,t)=>e.sn<t.sn?-1:e.sn>t.sn?1:0)),Cf.emojis.shortnames=Cf.emojis.list.map((e=>e.sn));const n=()=>Cf.emojis.shortnames.map((e=>e.replace(/[+]/g,"\\$&"))).join("|");Cf.emojis.shortnames_regex=new RegExp(n(),"gi"),Cf.emojis.initialized_promise.resolve()}return Cf.emojis.initialized_promise}},sv={emojis:tv},nv=new RegExp("<object[^>]*>.*?</object>|<span[^>]*>.*?</span>|<(?:object|embed|svg|img|div|span|p|a)[^>]*>|((\\s|^)(\\*\\\\0\\/\\*|\\*\\\\O\\/\\*|\\-___\\-|\\:'\\-\\)|'\\:\\-\\)|'\\:\\-D|\\>\\:\\-\\)|>\\:\\-\\)|'\\:\\-\\(|\\>\\:\\-\\(|>\\:\\-\\(|\\:'\\-\\(|O\\:\\-\\)|0\\:\\-3|0\\:\\-\\)|0;\\^\\)|O;\\-\\)|0;\\-\\)|O\\:\\-3|\\-__\\-|\\:\\-Þ|\\:\\-Þ|\\<\\/3|<\\/3|\\:'\\)|\\:\\-D|'\\:\\)|'\\=\\)|'\\:D|'\\=D|\\>\\:\\)|>\\:\\)|\\>;\\)|>;\\)|\\>\\=\\)|>\\=\\)|;\\-\\)|\\*\\-\\)|;\\-\\]|;\\^\\)|'\\:\\(|'\\=\\(|\\:\\-\\*|\\:\\^\\*|\\>\\:P|>\\:P|X\\-P|\\>\\:\\[|>\\:\\[|\\:\\-\\(|\\:\\-\\[|\\>\\:\\(|>\\:\\(|\\:'\\(|;\\-\\(|\\>\\.\\<|>\\.<|#\\-\\)|%\\-\\)|X\\-\\)|\\\\0\\/|\\\\O\\/|0\\:3|0\\:\\)|O\\:\\)|O\\=\\)|O\\:3|B\\-\\)|8\\-\\)|B\\-D|8\\-D|\\-_\\-|\\>\\:\\\\|>\\:\\\\|\\>\\:\\/|>\\:\\/|\\:\\-\\/|\\:\\-\\.|\\:\\-P|\\:Þ|\\:Þ|\\:\\-b|\\:\\-O|O_O|\\>\\:O|>\\:O|\\:\\-X|\\:\\-#|\\:\\-\\)|\\(y\\)|\\<3|<3|\\:D|\\=D|;\\)|\\*\\)|;\\]|;D|\\:\\*|\\=\\*|\\:\\(|\\:\\[|\\=\\(|\\:@|;\\(|D\\:|\\:\\$|\\=\\$|#\\)|%\\)|X\\)|B\\)|8\\)|\\:\\/|\\:\\\\|\\=\\/|\\=\\\\|\\:L|\\=L|\\:P|\\=P|\\:b|\\:O|\\:X|\\:#|\\=X|\\=#|\\:\\)|\\=\\]|\\=\\)|\\:\\])(?=\\s|$|[!,.?]))","gi"),iv=/(?:\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d])|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5\udeeb\udeec\udef4-\udefa\udfe0-\udfeb]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd1d\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd71\udd73-\udd76\udd7a-\udda2\udda5-\uddaa\uddae-\uddb4\uddb7\uddba\uddbc-\uddca\uddd0\uddde-\uddff\ude70-\ude73\ude78-\ude7a\ude80-\ude82\ude90-\ude95]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g,{u:rv}=Cf.env,ov={},av={"*\\0/*":"1f646","*\\O/*":"1f646","-___-":"1f611",":'-)":"1f602","':-)":"1f605","':-D":"1f605",">:-)":"1f606","':-(":"1f613",">:-(":"1f620",":'-(":"1f622","O:-)":"1f607","0:-3":"1f607","0:-)":"1f607","0;^)":"1f607","O;-)":"1f607","0;-)":"1f607","O:-3":"1f607","-__-":"1f611",":-Þ":"1f61b","</3":"1f494",":')":"1f602",":-D":"1f603","':)":"1f605","'=)":"1f605","':D":"1f605","'=D":"1f605",">:)":"1f606",">;)":"1f606",">=)":"1f606",";-)":"1f609","*-)":"1f609",";-]":"1f609",";^)":"1f609","':(":"1f613","'=(":"1f613",":-*":"1f618",":^*":"1f618",">:P":"1f61c","X-P":"1f61c",">:[":"1f61e",":-(":"1f61e",":-[":"1f61e",">:(":"1f620",":'(":"1f622",";-(":"1f622",">.<":"1f623","#-)":"1f635","%-)":"1f635","X-)":"1f635","\\0/":"1f646","\\O/":"1f646","0:3":"1f607","0:)":"1f607","O:)":"1f607","O=)":"1f607","O:3":"1f607","B-)":"1f60e","8-)":"1f60e","B-D":"1f60e","8-D":"1f60e","-_-":"1f611",">:\\":"1f615",">:/":"1f615",":-/":"1f615",":-.":"1f615",":-P":"1f61b",":Þ":"1f61b",":-b":"1f61b",":-O":"1f62e",O_O:"1f62e",">:O":"1f62e",":-X":"1f636",":-#":"1f636",":-)":"1f642","(y)":"1f44d","<3":"2764",":D":"1f603","=D":"1f603",";)":"1f609","*)":"1f609",";]":"1f609",";D":"1f609",":*":"1f618","=*":"1f618",":(":"1f61e",":[":"1f61e","=(":"1f61e",":@":"1f620",";(":"1f622","D:":"1f628",":$":"1f633","=$":"1f633","#)":"1f635","%)":"1f635","X)":"1f635","B)":"1f60e","8)":"1f60e",":/":"1f615",":\\":"1f615","=/":"1f615","=\\":"1f615",":L":"1f615","=L":"1f615",":P":"1f61b","=P":"1f61b",":b":"1f61b",":O":"1f62e",":X":"1f636",":#":"1f636","=X":"1f636","=#":"1f636",":)":"1f642","=]":"1f642","=)":"1f642",":]":"1f642"};function cv(e){if(e.indexOf("-")>-1){const t=[],s=e.split("-");for(let e=0;e<s.length;e++){const n=parseInt(s[e],16);if(n>=65536&&n<=1114111){const e=Math.floor((n-65536)/1024)+55296,s=(n-65536)%1024+56320;t.push(String.fromCharCode(e)+String.fromCharCode(s))}else t.push(String.fromCharCode(n))}return t.join("")}return function(e){let t="string"==typeof e?parseInt(e,16):e;return t<65536?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}(e)}function lv(e){return e.replace(nv,((e,t,s,n)=>{if(void 0===n||""===n||!(rv.unescapeHTML(n)in av))return e;n=rv.unescapeHTML(n);return s+cv(av[n].toUpperCase())}))}function dv(e){if(!Cf.emojis.initialized)throw new Error("getShortnameReferences called before emojis are initialized. To avoid this problem, first await the converse.emojis.initialized_promise");return[...e.matchAll(Cf.emojis.shortnames_regex)].filter((e=>e[0].length>0)).map((e=>{const t=Cf.emojis.by_sn[e[0].toLowerCase()].cp;return{cp:t,begin:e.index,end:e.index+e[0].length,shortname:e[0],emoji:t?cv(t):null}}))}function uv(e){const t=[];return function(e,t){const s=/\uFE0F/g,n=String.fromCharCode(8205);String(e).replace(iv,((e,i,r)=>{const o=function(e){const t=[];let s=0,n=0;for(;n<e.length;){const i=e.charCodeAt(n++);s?(t.push((65536+(s-55296<<10)+(i-56320)).toString(16)),s=0):55296<=i&&i<=56319?s=i:t.push(i.toString(16))}return t.join("-")}(e.indexOf(n)<0?e.replace(s,""):e);return o&&t(o,e,r),e}))}(e,((e,s,n)=>{t.push({begin:n,cp:e,emoji:s,end:n+s.length,shortname:mv("cp")[e]?.sn||""})})),t}function hv(e){const t=e.trim().split(/\s+/);if(0===t.length||t.length>3)return!1;const s=t.filter((e=>{const t=uv(rv.shortnamesToUnicode(e));return 1===t.length&&(e.toLowerCase()===t[0].shortname||e===t[0].emoji)}));return s.length===t.length}function mv(e){if(ov[e])return ov[e];if("category"===e)return Cf.emojis.json;const t=Cf.emojis.list.map((t=>t[e])).filter(((e,t,s)=>s.indexOf(e)==t));return ov[e]={},t.forEach((t=>ov[e][t]=Cf.emojis.list.find((s=>s[e]===t)))),ov[e]}Object.assign(rv,{getCodePointReferences:uv,getShortnameReferences:dv,convertASCII2Emoji:lv,getEmojisByAttribute:mv,isOnlyEmojis:hv,shortnamesToUnicode:function(e){return function(e){let t=[e];return[...dv(e),...uv(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const s=t.shift(),n=e.emoji||e.shortname;t=[s.slice(0,e.begin)+n+s.slice(e.end),...t]})),t}(lv(e)).pop()}}),Cf.emojis={initialized:!1,initialized_promise:hc()},Cf.plugins.add("converse-emoji",{initialize(){const{___:e}=Bu;hm.settings.extend({emoji_image_path:"https://twemoji.maxcdn.com/v/12.1.6/",emoji_categories:{smileys:":grinning:",people:":thumbsup:",activity:":soccer:",travel:":motorcycle:",objects:":bomb:",nature:":rainbow:",food:":hotdog:",symbols:":musical_note:",flags:":flag_ac:",custom:null},emoji_category_labels:{smileys:e("Smileys and emotions"),people:e("People"),activity:e("Activities"),travel:e("Travel"),objects:e("Objects"),nature:e("Animals and nature"),food:e("Food and drink"),symbols:e("Symbols"),flags:e("Flags"),custom:e("Stickers")}});const t={EmojiPicker:ev};async function s(e,t){return await hm.emojis.initialize(),{...t,is_only_emojis:!!t.body&&hv(t.body)}}Object.assign(Bu,t),Object.assign(Bu.exports,t),Object.assign(hm,sv),hm.listen.on("getOutgoingMessageAttributes",(async(e,t)=>{await hm.emojis.initialize();const{original_text:s}=t;return{...t,is_only_emojis:!!s&&hv(s)}})),hm.listen.on("parseMUCMessage",s),hm.listen.on("parseMessage",s)}});const{Strophe:gv}=Cf.env;const pv=class extends fd{get idAttribute(){return"jid"}getDisplayName(){return gv.xmlunescape(this.get("name"))}},{Strophe:fv,sizzle:vv}=Cf.env;function _v(e){return class extends e{initialize(){super.initialize(),this.rosterContactAdded=hc(),this.contact=null,this.vcard=null}async setModelContact(e){if(this.contact?.get("jid")===e)return;const{session:t,state:s}=Bu;let n;ft.getBareJidFromJid(e)===t.get("bare_jid")?n=s.xmppstatus:(n=await hm.contacts.get(e),n||(await hm.blocklist.get()).get(e)||await hm.contacts.add({jid:e,subscription:"none"},!1,!1)),n&&(this.contact=n,this.set("nickname",n.get("nickname")),this.listenTo(this.contact,"change",(e=>{e.nickname&&this.set("nickname",e.nickname),this.trigger("contact:change",e)})),this.rosterContactAdded.resolve(),this.trigger("contactAdded",this.contact))}}}const{safeSave:bv,colorize:yv}=Ef;function wv(e){return class extends e{async setColor(){const e=await yv(this.getIdentifier());bv(this,{color:e})}getIdentifier(){return this.get("type")===ju?this.get("jid"):"groupchat"===this.get("type")?this.get("from_real_jid")||this.get("from"):this.get("occupant_id")||this.get("jid")||this.get("from")||this.get("nick")}async getColor(){return this.get("color")||await this.setColor(),this.get("color")}async getAvatarStyle(e=""){try{return`background-color: ${await this.getColor()} !important; ${e}`}catch{return`background-color: gray !important; ${e}`}}}}class Sv extends(_v(wv(fd))){defaults(){return{msgid:xf(),time:(new Date).toISOString(),is_ephemeral:!1}}constructor(e,t){super(e,t),this.file=null,this.attributes}async initialize(){super.initialize(),this.checkValidity()&&(this.chatbox=this.collection?.chatbox,this.initialized=hc(),this.get("file")&&this.on("change:put",(()=>this.uploadFile())),this.on("change:type",(()=>this.setContact())),this.on("change:is_ephemeral",(()=>this.setTimerForEphemeralMessage())),await this.setContact(),this.setTimerForEphemeralMessage(),await hm.trigger("messageInitialized",this,{Synchronous:!0}),this.initialized.resolve())}setContact(){if(["chat","normal"].includes(this.get("type")))return this.setModelContact(ft.getBareJidFromJid(this.get("from")))}setTimerForEphemeralMessage(){this.ephemeral_timer&&clearTimeout(this.ephemeral_timer);const e=this.isEphemeral();if(e){const t="number"==typeof e?e:1e4;this.ephemeral_timer=setTimeout((()=>this.safeDestroy()),t)}}checkValidity(){return 3!==Object.keys(this.attributes).length||(this.validationError="Empty message",this.safeDestroy(),!1)}mayBeRetracted(){const e="me"===this.get("sender"),t="cancel"!==this.get("error_type");return e&&t&&["all","own"].includes(hm.settings.get("allow_message_retraction"))}safeDestroy(){try{this.destroy()}catch(e){Ct.warn(`safeDestroy: ${e}`)}}isEphemeral(){return this.get("is_ephemeral")}isMeCommand(){const e=this.getMessageText();return!!e&&e.startsWith("/me ")}isFollowup(){const e=this.collection?.models;if(!e)return!1;const t=e.indexOf(this),s=t?e[t-1]:null;if(null===s)return!1;const n=P()(this.get("time"));return this.get("from")===s.get("from")&&!this.isMeCommand()&&!s.isMeCommand()&&!!this.get("is_encrypted")==!!s.get("is_encrypted")&&this.get("type")===s.get("type")&&"info"!==this.get("type")&&n.isBefore(P()(s.get("time")).add(10,"minutes"))&&("groupchat"!==this.get("type")||this.get("occupant_id")===s.get("occupant_id"))}getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("from")}getMessageText(){if(this.get("is_encrypted")){const{__:e}=Bu;return this.get("plaintext")||this.get("body")||e("Undecryptable OMEMO message")}return["groupchat","chat","normal"].includes(this.get("type"))?this.get("body"):this.get("message")}sendSlotRequestStanza(){if(!this.file)return Promise.reject(new Error("file is undefined"));const e=Pe({from:Bu.session.get("jid"),to:this.get("slot_request_url"),type:"get"}).c("request",{xmlns:ft.NS.HTTPUPLOAD,filename:this.file.name,size:this.file.size,"content-type":this.file.type});return hm.sendIQ(e)}getUploadRequestMetadata(e){return{headers:q()(`slot[xmlns="${ft.NS.HTTPUPLOAD}"] put header`,e).map((e=>({name:e.getAttribute("name"),value:e.textContent}))).filter((e=>["Authorization","Expires"].includes(e.name)))}}async getRequestSlotURL(){const{__:e}=Bu;let t;try{t=await this.sendSlotRequestStanza()}catch(t){return Ct.error(t),this.save({type:"error",message:e("Sorry, could not determine upload URL."),is_ephemeral:!0})}const s=q()(`slot[xmlns="${ft.NS.HTTPUPLOAD}"]`,t).pop();if(!s)return this.save({type:"error",message:e("Sorry, could not determine file upload URL."),is_ephemeral:!0});this.upload_metadata=this.getUploadRequestMetadata(t),this.save({get:s.querySelector("get").getAttribute("url"),put:s.querySelector("put").getAttribute("url")})}uploadFile(){const e=new XMLHttpRequest;e.onreadystatechange=async t=>{if(e.readyState===XMLHttpRequest.DONE)if(Ct.info("Status: "+e.status),200===e.status||201===e.status){let e={upload:wu,oob_url:this.get("get"),message:this.get("get"),body:this.get("get")};e=await hm.hook("afterFileUploaded",this,e),this.save(e)}else Ct.error(t),e.onerror(new ProgressEvent(`Response status: ${e.status}`))},e.upload.addEventListener("progress",(e=>{e.lengthComputable&&this.set("progress",e.loaded/e.total)}),!1),e.onerror=()=>{const{__:t}=Bu;let s;s=e.responseText?t('Sorry, could not succesfully upload your file. Your server’s response: "%1$s"',e.responseText):t("Sorry, could not succesfully upload your file."),this.save({type:"error",upload:Su,message:s,is_ephemeral:!0})},e.open("PUT",this.get("put"),!0),e.setRequestHeader("Content-type",this.file.type),this.upload_metadata.headers?.forEach((t=>e.setRequestHeader(t.name,t.value))),e.send(this.file)}}const Av=Sv;const xv=class extends Av{async initialize(){this.checkValidity()&&(this.chatbox=this.collection?.chatbox,this.get("file")&&this.on("change:put",(()=>this.uploadFile())),this.on("change:type",(()=>this.setOccupant())),this.on("change:is_ephemeral",(()=>this.setTimerForEphemeralMessage())),this.setTimerForEphemeralMessage(),this.setOccupant(),hm.trigger("chatRoomMessageInitialized",this))}get occupants(){return"chat"===this.get("type")?this.chatbox.collection:this.chatbox.occupants}getDisplayName(){return this.occupant?.getDisplayName()||this.get("nick")}mayBeModerated(){if(void 0!==this.get("from_muc"))return["all","moderator"].includes(hm.settings.get("allow_message_retraction"))&&this.get(`stanza_id ${this.get("from_muc")}`)&&this.chatbox.canModerateMessages()}checkValidity(){const e=Bu.exports.Message.prototype.checkValidity.call(this);return!e&&this.chatbox.debouncedRejoin(),e}onOccupantRemoved(){this.stopListening(this.occupant),delete this.occupant,this.listenTo(this.occupants,"add",this.onOccupantAdded)}onOccupantAdded(e){if(this.get("occupant_id")){if(e.get("occupant_id")!==this.get("occupant_id"))return}else if(e.get("nick")!==ft.getResourceFromJid(this.get("from")))return;this.setOccupant(e)}getOccupant(){return this.occupant||this.setOccupant()}setOccupant(e){if(["groupchat","chat"].includes(this.get("type"))&&!this.isEphemeral()){if(e)this.occupant=e;else if("chat"===this.get("type")&&"them"===this.get("sender"))this.occupant=this.chatbox;else{if(this.occupant)return;const e=ft.getResourceFromJid(this.get("from")),t=this.get("occupant_id");if(this.occupant=e||t?this.occupants.findOccupant({nick:e,occupant_id:t}):null,!this.occupant){const s=this.get("from_real_jid");if(!e&&!t&&!s)return;if(this.occupant=this.occupants.create({nick:e,occupant_id:t,jid:s}),hm.settings.get("muc_send_probes")){const t=`${this.chatbox.get("jid")}/${e}`;hm.user.presence.send("probe",t)}}}return this.get("from_real_jid")!==this.occupant.get("jid")&&this.save("from_real_jid",this.occupant.get("jid")),this.trigger("occupant:add"),this.listenTo(this.occupant,"change",(e=>this.trigger("occupant:change",e))),this.listenTo(this.occupant,"destroy",this.onOccupantRemoved),this.stopListening(this.occupants,"add",this.onOccupantAdded),this.occupant}}};const Ev=class extends Fd{constructor(e,t={}){super(e,Object.assign({comparator:"time"},t)),this.model=xv,this.fetched=null}},$v={},Cv=(e,t)=>e.replace(RegExp("\\"+t,"ig"),"\\"+t);$v.escapeCharacters=e=>t=>e.split("").reduce(Cv,t),$v.escapeRegexString=$v.escapeCharacters("[\\^$.?*+(){}|"),$v.findFirstMatchInArray=e=>t=>{for(let s=0;s<e.length;s++)if(0===t.localeCompare(e[s],void 0,{sensitivity:"base"}))return e[s];return null};const kv=([e,t],s,n)=>{let i=e,{begin:r,end:o}=s;const{value:a}=s;return r-=n,o=o-n-1,i=`${i.slice(0,r)}${a}${i.slice(o+1)}`,[i,[...t,{...s,begin:r,end:o}]]};$v.reduceTextFromReferences=(e,t)=>t.reduce(kv,[e,[]]);const jv=$v,Tv=["301","333","307","321","322"],Ov=["210","303"],Nv=["admin","ban","deop","destroy","member","op","revoke"],Iv=["owner","admin","member","outcast","none"],Mv=["301","333","307","321","322","332"],Rv=["kick","mute","voice","modtools"],Dv=["owner"],zv=["moderator","participant","visitor"],Lv=["nick"],Pv={100:["message","presence"],101:["message"],102:["message"],103:["message"],104:["message"],110:["presence"],170:["message","presence"],171:["message"],172:["message"],173:["message"],174:["message"],201:["presence"],210:["presence"],301:["presence"],303:["presence"],307:["presence"],321:["presence"],322:["presence"],332:["presence"],333:["presence"]},Fv={moderator:1,participant:2,visitor:3,none:2},Uv={OWNER:"owner",ADMIN:"admin",MEMBER:"member",EXADMIN:"exadmin",EXOWNER:"exowner",EXOUTCAST:"exoutcast",EXMEMBER:"exmember"},Bv=Object.values(Uv),qv={ENTERED:"entered",EXITED:"exited"},Hv=Object.values(qv),Gv={OP:"op",DEOP:"deop",VOICE:"voice",MUTE:"mute"},Wv=Object.values(Gv),Vv={visibility_changes:["100","102","103","172","173","174"],self:["110"],non_privacy_changes:["104","201"],muc_logging_changes:["170","171"],nickname_changes:["210","303"],disconnected:["301","307","321","322","332","333"],affiliation_changes:[...Bv],join_leave_events:[...Hv],role_changes:[...Wv]},Qv={CONNECTED:0,CONNECTING:1,NICKNAME_REQUIRED:2,PASSWORD_REQUIRED:3,DISCONNECTED:4,ENTERED:5,DESTROYED:6,BANNED:7,CLOSING:8},Kv=["passwordprotected","unsecured","hidden","publicroom","membersonly","open","persistent","temporary","nonanonymous","semianonymous","moderated","unmoderated","mam_enabled","vcard-temp"],Jv="303",{Strophe:Yv,sizzle:Xv,u:Zv}=Cf.env,{NS:e_}=Yv;function t_(e){const t=Xv(`items[node="${Yv.NS.CONFINFO}"]`,e).pop();if(!t)return null;const s=e.getAttribute("from"),n=e.getAttribute("id"),i=`item conference-info[xmlns="${Yv.NS.CONFINFO}"] activity[xmlns="${Yv.NS.ACTIVITY}"]`;return Xv(i,t).map((t=>{const i=t.querySelector("text")?.textContent;if(i){const r=Uf(e),o=t.querySelector("reason")?.textContent;return{from:s,msgid:n,message:i,reason:o,references:r,type:"mep"}}return{}}))}function s_(e,t){const s=Xv(`${t} > x[xmlns="${Yv.NS.MUC_USER}"] status`,e).map((e=>e.getAttribute("code"))).filter((e=>Pv[e]?.includes(t)));return"presence"===t&&s.includes("333")&&s.includes("307")&&s.splice(s.indexOf("307"),1),{codes:s,is_self:s.includes("110")}}function n_(e,t){if(t.features.get(Yv.NS.OCCUPANTID))return Xv(`occupant-id[xmlns="${Yv.NS.OCCUPANTID}"]`,e).pop()?.getAttribute("id")}function i_(e,t){let s;const n=t.get("occupant_id");if(n)s=e.occupant_id===n;else if(e.from_real_jid){const t=Bu.session.get("bare_jid");s=Yv.getBareJidFromJid(e.from_real_jid)===t}else s=e.nick===t.get("nick");return s?"me":"them"}async function r_(e,t){Wf(e);const s=Xv(`result[xmlns="${e_.MAM}"] > forwarded[xmlns="${e_.FORWARD}"] > message`,e).pop(),n=s||e;if(Xv(`message > forwarded[xmlns="${Yv.NS.FORWARD}"]`,n).length)return new xh(n,`Invalid Stanza: Forged MAM groupchat message from ${n.getAttribute("from")}`);let i,r;if(s){if(Xv(`message > forwarded[xmlns="${Yv.NS.FORWARD}"]`,s).length)return new xh(e,`Invalid Stanza: Forged MAM groupchat message from ${e.getAttribute("from")}`);i=Xv(`delay[xmlns="${Yv.NS.DELAY}"]`,s.parentElement).pop(),r=s.querySelector(":scope > body")?.textContent?.trim()}else i=Xv(`message > delay[xmlns="${Yv.NS.DELAY}"]`,e).pop(),r=e.querySelector(":scope > body")?.textContent?.trim();const o=n.getAttribute("from"),a=Vf(n);let c=Object.assign({from:o,body:r,activities:t_(n),chat_state:Hf(n),from_muc:Yv.getBareJidFromJid(o),is_archived:Jf(e),is_carbon:qf(e),is_delayed:!!i,is_forwarded:!!Xv(`message > forwarded[xmlns="${Yv.NS.FORWARD}"]`,n).length,is_headline:Qf(n),is_markable:!!Xv(`message > markable[xmlns="${Yv.NS.MARKERS}"]`,n).length,is_marker:!!a,is_unstyled:!!Xv(`message > unstyled[xmlns="${Yv.NS.STYLING}"]`,n).length,marker_id:a&&a.getAttribute("id"),msgid:n.getAttribute("id")||e.getAttribute("id"),nick:Yv.unescapeNode(Yv.getResourceFromJid(o)),occupant_id:n_(n,t),receipt_id:Bf(n),received:(new Date).toISOString(),references:Uf(n),subject:n.querySelector(":scope > subject")?.textContent,thread:n.querySelector(":scope > thread")?.textContent,time:i?P()(i.getAttribute("stamp")).toISOString():(new Date).toISOString(),to:n.getAttribute("to"),type:n.getAttribute("type")},Ff(n),Pf(n),Lf(n),zf(n,e),Mf(n,e),function(e){const t=q()(`> apply-to[xmlns="${ft.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),s=q()(`> meta[xmlns="${ft.NS.XHTML}"]`,t);if(s.length){const t=hm.settings.get("message_limit"),n=s.reduce(((e,s)=>{const n=s.getAttribute("property");if(n){let i=xt(s.getAttribute("content")||"");t&&"og:description"===n&&i.length>=t&&(i=`${i.slice(0,t)}${xt("&#8230;")}`),e[n]=i}return e}),{ogp_for_id:e});if("og:description"in n||"og:title"in n||"og:image"in n)return n}}return{}}(n),Df(n,e),function(e){const t=Xv(`apply-to[xmlns="${Yv.NS.FASTEN}"]`,e).pop();if(t){const e=t.getAttribute("id"),s=Xv(`moderated[xmlns="${Yv.NS.MODERATE}"]`,t).pop();if(s&&Xv(`retract[xmlns="${Yv.NS.RETRACT}"]`,s).pop())return{editable:!1,moderated:"retracted",moderated_by:s.getAttribute("by"),moderated_id:e,moderation_reason:s.querySelector("reason")?.textContent}}else{const t=Xv(`> moderated[xmlns="${Yv.NS.MODERATE}"]`,e).pop();if(t&&Xv(`retracted[xmlns="${Yv.NS.RETRACT}"]`,t).pop())return{editable:!1,is_tombstone:!0,moderated_by:t.getAttribute("by"),retracted:t.getAttribute("stamp"),moderation_reason:t.querySelector("reason")?.textContent}}return{}}(n),Rf(n),s_(n,"message"));return c.from_real_jid=c.is_archived&&function(e){const t=Xv(`message > x[xmlns="${Yv.NS.MUC_USER}"] item`,e).pop();return t?.getAttribute("jid")}(n)||t.occupants.findOccupant(c)?.get("jid"),c=Object.assign({is_valid_receipt_request:Gf(n,c),message:c.body||c.error,sender:i_(c,t)},c),c.is_archived&&e.getAttribute("from")!==c.from_muc?new xh(e,`Invalid Stanza: Forged MAM message from ${e.getAttribute("from")}`):c.is_archived&&e.getAttribute("from")!==t.get("jid")?new xh(e,`Invalid Stanza: Forged MAM groupchat message from ${n.getAttribute("from")}`):c.is_carbon?new xh(e,"Invalid Stanza: MUC messages SHOULD NOT be XEP-0280 carbon copied"):(c.id=c.origin_id||c[`stanza_id ${c.from_muc||c.from}`]||Zv.getUniqueId(),c=await hm.hook("parseMUCMessage",e,c),Object.assign(c,Zv.getMediaURLsMetadata(c.is_encrypted?c.plaintext:c.body)))}function o_(e,t){const s=Xv(`presence > x[xmlns="${Yv.NS.MUC_USER}"] item`,e).pop();if(s){const e=s.querySelector("actor");return{affiliation:s.getAttribute("affiliation"),role:s.getAttribute("role"),jid:s.getAttribute("jid"),nick:s.getAttribute("nick")||t,...e?{actor:{nick:e?.getAttribute("nick")??null,jid:e?.getAttribute("jid")??null}}:{},reason:s.querySelector("reason")?.textContent??null}}}const{Strophe:a_,$iq:c_,u:l_}=Cf.env;async function d_(e,t){const{__:s}=Bu,n=c_({to:t,type:"get"}).c("query",{xmlns:a_.NS.MUC_ADMIN}).c("item",{affiliation:e}),i=await hm.sendIQ(n,null,!1);if(null===i){const n=s("Error: timeout while fetching %1s list for MUC %2s",e,t),i=new Error(n);return Ct.warn(n),i}if(l_.isErrorStanza(i)){const n=s("Error: not allowed to fetch %1s list for MUC %2s",e,t),r=new Error(n);return Ct.warn(n),Ct.warn(i),r}return function(e){return Xv(`query[xmlns="${Yv.NS.MUC_ADMIN}"] item`,e).map((e=>{const t={affiliation:e.getAttribute("affiliation")},s=e.getAttribute("jid");Zv.isValidJID(s)?t.jid=s:t.nick=s;const n=e.getAttribute("nick");return n&&(t.nick=n),e.getAttribute("role")&&(t.role=n),t}))}(i).filter((e=>e)).sort(((e,t)=>e.nick<t.nick?-1:e.nick>t.nick?1:0))}function u_(e,t){const s=[...new Set(t.map((e=>e.affiliation)))];return Promise.all(s.map((s=>h_(s,e,t))))}function h_(e,t,s){return Array.isArray(t)||(t=[t]),s=s.filter((t=>[void 0,e].includes(t.affiliation))),Promise.all(t.reduce(((t,n)=>[...t,...s.map((t=>function(e,t,s){e=s.affiliation||e;const n=c_({to:t,type:"set"}).c("query",{xmlns:a_.NS.MUC_ADMIN}).c("item",{affiliation:e,..."outcast"===e?{}:{nick:s.nick},jid:s.jid});void 0!==s.reason&&n.c("reason",s.reason);return hm.sendIQ(n)}(e,n,t)))]),[]))}function m_(e,t,s,n){const i=s.map((e=>e.jid)),r=n.map((e=>e.jid));let o=i.filter((e=>!r.includes(e))).map((e=>s[i.indexOf(e)]));return e||(o=o.concat(s.filter((e=>{const t=r.indexOf(e.jid);return t>=0&&e.affiliation!==n[t].affiliation})))),t&&(o=o.concat(r.filter((e=>!i.includes(e))).map((e=>({jid:e,affiliation:"none"}))))),o}const g_=function(e,t){return e===t||Pl(e,t,Ul(t))},{Strophe:p_,sizzle:f_}=Cf.env;async function v_(e){Wf(e);let t=e.getAttribute("to");const s=p_.getResourceFromJid(t),n=Bu.session.get("resource");if(hm.settings.get("filter_by_resource")&&s&&s!==n)return new xh(e,`Ignoring incoming message intended for a different resource: ${t}`);const i=Bu.session.get("bare_jid"),r=e;let o=e.getAttribute("from")||i;if(qf(e)){if(o!==i)return jf(e,"Rejecting carbon from invalid JID"),new xh(e,`Rejecting carbon from invalid JID ${t}`);{const s=`[xmlns="${p_.NS.CARBONS}"] > forwarded[xmlns="${p_.NS.FORWARD}"] > message`;t=(e=f_(s,e).pop()).getAttribute("to"),o=e.getAttribute("from")}}const a=Jf(e);if(a){if(o!==i)return new xh(e,`Invalid Stanza: alleged MAM message from ${e.getAttribute("from")}`);{const s=`[xmlns="${p_.NS.MAM}"] > forwarded[xmlns="${p_.NS.FORWARD}"] > message`;t=(e=f_(s,e).pop()).getAttribute("to"),o=e.getAttribute("from")}}const c=p_.getBareJidFromJid(o),l=c===i;if(l&&null===t)return new xh(e,`Don't know how to handle message stanza without 'to' attribute. ${e.outerHTML}`);const d=Qf(e),u=Kf(e);let h,m;if(!d&&!u&&(m=l?p_.getBareJidFromJid(t):c,h=await hm.contacts.get(m),void 0===h&&!hm.settings.get("allow_non_roster_messaging")))return Ct.error(e),new xh(e,"Blocking messaging with a JID not in our roster because allow_non_roster_messaging is false.");const g=f_(`delay[xmlns="${p_.NS.DELAY}"]`,r).pop(),p=Vf(e),f=(new Date).toISOString();let v=Object.assign({contact_jid:m,is_archived:a,is_headline:d,is_server_message:u,body:e.querySelector("body")?.textContent?.trim(),chat_state:Hf(e),from:p_.getBareJidFromJid(e.getAttribute("from")),is_carbon:qf(r),is_delayed:!!g,is_markable:!!f_(`markable[xmlns="${p_.NS.MARKERS}"]`,e).length,is_marker:!!p,is_unstyled:!!f_(`unstyled[xmlns="${p_.NS.STYLING}"]`,e).length,marker_id:p&&p.getAttribute("id"),msgid:e.getAttribute("id")||r.getAttribute("id"),nick:h?.attributes?.nickname,receipt_id:Bf(e),received:(new Date).toISOString(),references:Uf(e),sender:l?"me":"them",subject:e.querySelector("subject")?.textContent,thread:e.querySelector("thread")?.textContent,time:g?P()(g.getAttribute("stamp")).toISOString():f,to:e.getAttribute("to"),type:e.getAttribute("type")||"normal"},Ff(e),Pf(e),Lf(e),zf(e,r),Mf(e,r),Df(e,r),Rf(e));if(v.is_archived){const t=r.getAttribute("from");if(t&&t!==i)return new xh(e,`Invalid Stanza: Forged MAM message from ${t}`)}return v=Object.assign({message:v.body||v.error,is_valid_receipt_request:Gf(e,v)},v),v.id=v.origin_id||v[`stanza_id ${v.from}`]||Ef.getUniqueId(),v=await hm.hook("parseMessage",e,v),Object.assign(v,Ef.getMediaURLsMetadata(v.is_encrypted?v.plaintext:v.body))}const{Strophe:__,u:b_}=Cf.env;function y_(e){if(!location.hash.startsWith("#converse/chat?jid="))return;e?.preventDefault();const t=location.hash.split("=").pop();if(!b_.isValidJID(t))return Ct.warn(`Invalid JID "${t}" provided in URL fragment`);hm.chats.open(t)}async function w_(){if(au(Bu)){const{chatboxes:e}=Bu.state;await Promise.all(e.map((e=>e.messages?.clearStore({silent:!0})))),e.clearStore({silent:!0},(e=>e.get("type")!==Ou))}}function S_(){hm.settings.get("auto_join_private_chats").forEach((e=>{Bu.state.chatboxes.where({jid:e}).length||("string"==typeof e?hm.chats.open(e):Ct.error('Invalid jid criteria specified for "auto_join_private_chats"'))})),hm.trigger("privateChatsAutoJoined")}function A_(){hm.connection.get().addHandler((e=>!!(["groupchat","error"].includes(e.getAttribute("type"))||Qf(e)||Kf(e)||Jf(e))||(Bu.exports.handleMessageStanza(e)||!0)),null,"message"),hm.connection.get().addHandler((e=>(async function(e){const t=__.getBareJidFromJid(e.getAttribute("from")),s=Bu.session.get("bare_jid");if(b_.isSameBareJID(t,s))return;const n=await hm.chatboxes.get(t);n?.get("type")===ku&&n?.handleErrorMessageStanza(e)}(e),!0)),null,"message","error")}async function x_(e){if(Kf(e=e instanceof Element?e:e.tree())){const t=e.getAttribute("from");return Ct.info(`handleMessageStanza: Ignoring incoming server message from JID: ${t}`)}if(await async function(e){const t=ft.getBareJidFromJid(e.getAttribute("from"));return!!await hm.rooms.get(t)}(e))return!0;let t;try{t=await v_(e)}catch(e){return Ct.error(e)}if(b_.isErrorObject(t)){const{stanza:e,message:s}=t;return e&&Ct.error(e),Ct.error(s)}const{body:s,plaintext:n,contact_jid:i,nick:r}=t,o=!(!s&&!n),a=await hm.chats.get(i,{nickname:r},o);await(a?.queueMessage(t));const c={stanza:e,attrs:t,chatbox:a};hm.trigger("message",c)}async function E_(){const e=Bu.session.get("bare_jid"),t=__.getDomainFromJid(e);if(!await hm.disco.supports(__.NS.CARBONS,t))return void Ct.warn("Not enabling carbons because it's not supported!");const s=new __.Builder("iq",{from:hm.connection.get().jid,type:"set"}).c("enable",{xmlns:__.NS.CARBONS}),n=await hm.sendIQ(s,null,!1);null===n?Ct.warn("A timeout occurred while trying to enable carbons"):b_.isErrorStanza(n)?(Ct.warn("An error occurred while trying to enable message carbons."),Ct.error(n)):Ct.debug("Message carbons have been enabled.")}const{Strophe:$_,stx:C_,u:k_}=Cf.env;function j_(e){return class extends e{constructor(...e){super(e[0],e[1]),this.disable_mam=!1}async initialize(){super.initialize(),this.initUI(),this.initMessages(),this.initNotifications(),this.ui.on("change:scrolled",(()=>this.onScrolledChanged()))}initNotifications(){this.notifications=new fd}initUI(){this.ui=new fd}getDisplayName(){return this.get("jid")}canPostMessages(){return!0}async createMessage(e,t){return e.time=e.time||(new Date).toISOString(),await this.messages.fetched,this.messages.create(e,t)}getMessagesCacheKey(){return`converse.messages-${this.get("jid")}-${Bu.session.get("bare_jid")}`}getMessagesCollection(){return new Bu.exports.Messages}getNotificationsText(){const{__:e}=Bu;return this.notifications?.get("chat_state")===Eu?e("%1$s is typing",this.getDisplayName()):this.notifications?.get("chat_state")===$u?e("%1$s has stopped typing",this.getDisplayName()):this.notifications?.get("chat_state")===Cu?e("%1$s has gone away",this.getDisplayName()):""}initMessages(){this.messages=this.getMessagesCollection(),this.messages.fetched=hc(),this.messages.chatbox=this,Zu(this.messages,this.getMessagesCacheKey()),this.listenTo(this.messages,"add",(e=>this.onMessageAdded(e))),this.listenTo(this.messages,"change:upload",(e=>this.onMessageUploadChanged(e)))}fetchMessages(){if(this.messages.fetched_flag)return void Ct.info(`Not re-fetching messages for ${this.get("jid")}`);this.messages.fetched_flag=!0;const e=this.messages.fetched.resolve;return this.messages.fetch({add:!0,success:()=>{this.afterMessagesFetched(),e()},error:()=>{this.afterMessagesFetched(),e()}}),this.messages.fetched}afterMessagesFetched(){this.pruneHistoryWhenScrolledDown(),hm.trigger("afterMessagesFetched",this)}async onMessage(e){throw new wh("onMessage is not implemented")}getUpdatedMessageAttributes(e,t){return t.error_type||"Decryption"!==e.get("error_type")?{is_archived:t.is_archived}:Object.assign({},t,{error_condition:void 0,error_message:void 0,error_text:void 0,error_type:void 0,is_archived:t.is_archived,is_ephemeral:!1,is_error:!1})}updateMessage(e,t){const s=this.getUpdatedMessageAttributes(e,t);s&&e.save(s)}async handleCorrection(e){if(!e.replace_id||!e.from)return;let t;if("groupchat"===e.type){const{occupant_id:s,replace_id:n}=e;t=s?({attributes:e})=>e.msgid===n&&e.occupant_id==s:({attributes:t})=>t.msgid===e.replace_id&&t.from===e.from&&null==t.occupant_id}else t=({attributes:t})=>t.msgid===e.replace_id&&t.from===e.from&&null==t.occupant_id;const s=this.messages.models.find(t);if(!s)return e.older_versions={},await this.createMessage(e);const n=s.get("older_versions")||{};return e.time<s.get("time")&&s.get("edited")?(n[e.time]=e.message,s.save({older_versions:n})):(Object.keys(n).length?n[s.get("edited")]=s.getMessageText():n[s.get("time")]=s.getMessageText(),delete(e=Object.assign(e,{older_versions:n})).msgid,delete e.id,e.time=s.get("time"),s.save(e)),s}queueMessage(e){return this.msg_chain=(this.msg_chain||this.messages.fetched).then((()=>this.onMessage(e))).catch((e=>Ct.error(e))),this.msg_chain}async getOutgoingMessageAttributes(e){throw new wh("getOutgoingMessageAttributes is not implemented")}async sendMessage(e){if(await(Cf.emojis?.initialized_promise),!this.canPostMessages())return void Ct.warn("sendMessage was called but canPostMessages is false");e=await this.getOutgoingMessageAttributes(e);let t=this.messages.findWhere("correcting");if(t){const s=t.get("older_versions")||{};s[t.get("edited")||t.get("time")]=t.getMessageText(),t.save({...["body","is_only_emojis","media_urls","references","is_encrypted"].reduce(((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t)),{}),correcting:!1,edited:(new Date).toISOString(),message:e.body,ogp_metadata:[],older_versions:s,origin_id:k_.getUniqueId(),plaintext:e.is_encrypted?e.message:void 0,received:void 0})}else this.setEditable(e,(new Date).toISOString()),t=await this.createMessage(e);try{const e=await this.createMessageStanza(t);hm.send(e)}catch(e){return t.destroy(),void Ct.error(e)}return hm.trigger("sendMessage",{chatbox:this,message:t}),t}retractOwnMessage(e){!function(e,t){const s=t.get("origin_id");if(!s)throw new Error("Can't retract message without a XEP-0359 Origin ID");const n=Le({id:kf.getUniqueId(),to:e,type:"chat"}).c("store",{xmlns:ft.NS.HINTS}).up().c("apply-to",{id:s,xmlns:ft.NS.FASTEN}).c("retract",{xmlns:ft.NS.RETRACT});hm.connection.get().send(n)}(this.get("jid"),e),e.save({retracted:(new Date).toISOString(),retracted_id:e.get("origin_id"),retraction_id:e.get("id"),is_ephemeral:!0,editable:!1})}async sendFiles(e){const{__:t,session:s}=Bu,n=(await hm.disco.features.get($_.NS.HTTPUPLOAD,s.get("domain"))).pop();if(!n)return void this.createMessage({message:t("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0});const i=n.dataforms.where({FORM_TYPE:{value:$_.NS.HTTPUPLOAD,type:"hidden"}}).pop(),r=parseInt((i?.attributes||{})["max-file-size"]?.value,10),o=n?.id;o?Array.from(e).forEach((async e=>{if(e=await hm.hook("beforeFileUpload",this,e),!isNaN(r)&&e.size>r){const s=Bm(r),n=Array.isArray(s)?t("The size of your file, %1$s, exceeds the maximum allowed by your server.",e.name):t("The size of your file, %1$s, exceeds the maximum allowed by your server, which is %2$s.",e.name,s);return this.createMessage({message:n,type:"error",is_ephemeral:!0})}{const t=await this.getOutgoingMessageAttributes(),s=Object.assign(t,{file:!0,progress:0,slot_request_url:o});this.setEditable(s,(new Date).toISOString());const n=await this.createMessage(s,{silent:!0});n.file=e,this.messages.trigger("add",n),n.getRequestSlotURL()}})):this.createMessage({message:t("Sorry, looks like file upload is not supported by your server."),type:"error",is_ephemeral:!0})}setEditable(e,t){e.is_headline||k_.isEmptyMessage(e)||"me"!==e.sender||("all"===hm.settings.get("allow_message_corrections")?e.editable=!(e.file||e.retracted||"oob_url"in e):"last"===hm.settings.get("allow_message_corrections")&&t>this.get("time_sent")&&(this.set({time_sent:t}),this.messages.findWhere({editable:!0})?.save({editable:!1}),e.editable=!(e.file||e.retracted||"oob_url"in e)))}setChatState(e,t){return void 0!==this.chat_state_timeout&&(clearTimeout(this.chat_state_timeout),delete this.chat_state_timeout),e===Eu?this.chat_state_timeout=setTimeout(this.setChatState.bind(this),Bu.TIMEOUTS.PAUSED,$u):e===$u&&(this.chat_state_timeout=setTimeout(this.setChatState.bind(this),Bu.TIMEOUTS.INACTIVE,Au)),this.set("chat_state",e,t),this}onMessageAdded(e){!hm.settings.get("prune_messages_above")||"scrolled"!==hm.settings.get("pruning_behavior")&&this.ui.get("scrolled")||k_.isEmptyMessage(e)||this.debouncedPruneHistory()}async onMessageUploadChanged(e){if(e.get("upload")===wu){const t={body:e.get("body"),spoiler_hint:e.get("spoiler_hint"),oob_url:e.get("oob_url")};await this.sendMessage(t),e.destroy()}}onScrolledChanged(){this.ui.get("scrolled")||(this.clearUnreadMsgCounter(),this.pruneHistoryWhenScrolledDown())}pruneHistoryWhenScrolledDown(){hm.settings.get("prune_messages_above")&&"unscrolled"===hm.settings.get("pruning_behavior")&&!this.ui.get("scrolled")&&this.debouncedPruneHistory()}shouldShowErrorMessage(e){if(this.getMessageReferencedByError(e)||!e.chat_state)return Promise.resolve(!0)}async clearMessages(){try{await this.messages.clearStore()}catch(e){this.messages.trigger("reset"),Ct.error(e)}finally{this.messages.fetched.resolve()}}editEarlierMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t>0;){t-=1;const s=this.messages.at(t);if(s.get("editable")){e=s;break}}e=e||this.messages.filter({sender:"me"}).reverse().find((e=>e.get("editable"))),e&&e.save("correcting",!0)}editLaterMessage(){let e,t=this.messages.findLastIndex("correcting");if(t>=0)for(this.messages.at(t).save("correcting",!1);t<this.messages.length-1;){t+=1;const s=this.messages.at(t);if(s.get("editable")){e=s,e.save("correcting",!0);break}}return e}getOldestMessage(){for(let e=0;e<this.messages.length;e++){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}}getMostRecentMessage(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages.at(e);if(t.get("type")===this.get("message_type"))return t}}getMessageReferencedByError(e){const t=e.msgid;return t&&this.messages.models.find((e=>[e.get("msgid"),e.get("retraction_id")].includes(t)))}findDanglingRetraction(e){if(!e.origin_id||!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models);return t.reverse(),t.find((({attributes:t})=>t.retracted_id===e.origin_id&&t.from===e.from&&!t.moderated_by))}return null}getDuplicateMessage(e){const t=[...this.getStanzaIdQueryAttrs(e),this.getOriginIdQueryAttrs(e),this.getMessageBodyQueryAttrs(e)].filter((e=>e));return this.messages.models.find((e=>t.reduce(((t,s)=>t||g_(e.attributes,s)),!1)))}getOriginIdQueryAttrs(e){return e.origin_id&&{origin_id:e.origin_id,from:e.from}}getStanzaIdQueryAttrs(e){const t=Object.keys(e).filter((e=>e.startsWith("stanza_id ")));return t.map((t=>{const s={};return s[`stanza_id ${t.replace(/^stanza_id /,"")}`]=e[t],s}))}getMessageBodyQueryAttrs(e){if(e.msgid){const t={from:e.from,msgid:e.msgid};return!e.is_encrypted&&e.body&&(t.body=e.body),t}}async sendMarkerForMessage(e,t="displayed",s=!1){if(!e||"groupchat"===e?.get("type")||!hm.settings.get("send_chat_markers").includes(t))return;const n=await hm.contacts.get(this.get("jid")),i=n?.get("subscription");if(n&&"none"!==i&&"to"!==i&&(e?.get("is_markable")||s)){Tf($_.getBareJidFromJid(e.get("from")),e.get("msgid"),t,e.get("type"))}}handleUnreadMessage(e){e?.get("body")&&function(e){return e instanceof Element?!(q()(`result[xmlns="${__.NS.MAM}"]`,e).length&&q()(`delay[xmlns="${__.NS.DELAY}"]`,e).length):(e instanceof fd&&(e=e.attributes),!(e.is_delayed&&e.is_archived))}(e)&&("me"===e.get("sender")?this.ui.set("scrolled",!1):this.isHidden()?this.incrementUnreadMsgsCounter(e):this.sendMarkerForMessage(e))}async getErrorAttributesForMessage(e,t){const{__:s}=Bu,n={editable:!1,error:t.error,error_condition:t.error_condition,error_text:t.error_text,error_type:t.error_type,is_error:!0};return t.msgid===e.get("retraction_id")?(n.retraction_id=void 0,t.error||("forbidden"===t.error_condition?n.error=s("You're not allowed to retract your message."):n.error=s("Sorry, an error occurred while trying to retract your message."))):t.error||("forbidden"===t.error_condition?n.error=s("You're not allowed to send a message."):n.error=s("Sorry, an error occurred while trying to send your message.")),await hm.hook("getErrorAttributesForMessage",t,n)}async handleErrorMessageStanza(e){const t=await v_(e);if(k_.isErrorObject(t)){const{stanza:e,message:s}=t;return e&&Ct.error(e),Ct.error(s)}const s=t;if(!await this.shouldShowErrorMessage(s))return;const n=this.getMessageReferencedByError(s);if(n){const e=await this.getErrorAttributesForMessage(n,s);n.save(e)}else this.createMessage(s)}incrementUnreadMsgsCounter(e){const t={num_unread:this.get("num_unread")+1};0===this.get("num_unread")&&(t.first_unread_id=e.get("id")),this.save(t)}clearUnreadMsgCounter(){this.get("num_unread")>0&&this.sendMarkerForMessage(this.messages.last()),k_.safeSave(this,{num_unread:0})}async handleRetraction(e){const t=["retracted","retracted_id","editable"];if(e.retracted){if(e.is_tombstone)return!1;const s=this.messages.findWhere({origin_id:e.retracted_id,from:e.from});return s?(s.save(pd(e,t)),!0):(e.dangling_retraction=!0,await this.createMessage(e),!0)}{const s=this.findDanglingRetraction(e);if(s){const n=pd(s.attributes,t),i=Object.assign({dangling_retraction:!1},e,n);return delete i.id,s.save(i),!0}}return!1}handleReceipt(e){if("them"===e.sender)if(e.is_valid_receipt_request)!function(e,t){const s=Le({from:hm.connection.get().jid,id:kf.getUniqueId(),to:e,type:"chat"}).c("received",{xmlns:ft.NS.RECEIPTS,id:t}).up().c("store",{xmlns:ft.NS.HINTS}).up();hm.send(s)}(e.from,e.msgid);else if(e.receipt_id){const t=this.messages.findWhere({msgid:e.receipt_id});return t&&!t.get("received")&&t.save({received:(new Date).toISOString()}),!0}return!1}async createMessageStanza(e){const{body:t,edited:s,is_encrypted:n,is_spoiler:i,msgid:r,oob_url:o,origin_id:a,references:c,spoiler_hint:l,type:d}=e.attributes,u=C_`
                <message xmlns="jabber:client"
                        from="${e.get("from")||hm.connection.get().jid}"
                        to="${e.get("to")||this.get("jid")}"
                        type="${this.get("message_type")}"
                        id="${s&&k_.getUniqueId()||r}">
                    ${t?C_`<body>${t}</body>`:""}
                    <active xmlns="${$_.NS.CHATSTATES}"/>
                    ${"chat"===d?C_`<request xmlns="${$_.NS.RECEIPTS}"></request>`:""}
                    ${!n&&o?C_`<x xmlns="${$_.NS.OUTOFBAND}"><url>${o}</url></x>`:""}
                    ${!n&&i?C_`<spoiler xmlns="${$_.NS.SPOILER}">${l??""}</spoiler>`:""}
                    ${n?"":c?.map((e=>C_`<reference xmlns="${$_.NS.REFERENCE}"
                                                begin="${e.begin}"
                                                end="${e.end}"
                                                type="${e.type}"
                                                uri="${e.uri}"></reference>`))}
                    ${s?C_`<replace xmlns="${$_.NS.MESSAGE_CORRECT}" id="${r}"></replace>`:""}
                    ${a?C_`<origin-id xmlns="${$_.NS.SID}" id="${a}"></origin-id>`:""}
                </message>`;return(await hm.hook("createMessageStanza",this,{message:e,stanza:u})).stanza}pruneHistory(){const e=hm.settings.get("prune_messages_above");if(e&&"number"==typeof e&&this.messages.length>e){const t=this.messages.filter((e=>!k_.isEmptyMessage(e)));if(t.length>e){for(;t.length>e;)t.shift().destroy();hm.trigger("historyPruned",this)}}}debouncedPruneHistory=Wu((()=>this.pruneHistory()),500,{maxWait:2e3});isScrolledUp(){return this.ui.get("scrolled")}isHidden(){return this.get("hidden")||this.isScrolledUp()||document.hidden}}}const{u:T_}=Cf.env;class O_ extends(j_(fd)){async initialize(){await super.initialize();const e=this.get("jid");e&&this.set({box_id:`box-${e}`})}validate(e){if(!e.jid)return"Ignored ChatBox without JID";const t=hm.settings.get("auto_join_rooms").map((e=>e instanceof Object?e.jid:e)),s=hm.settings.get("auto_join_private_chats").concat(t);if(hm.settings.get("singleton")&&!s.includes(e.jid)&&!hm.settings.get("auto_join_on_invite")){const t=`${e.jid} is not allowed because singleton is true and it's not being auto_joined`;return Ct.warn(t),t}}maybeShow(e){if(nu()){const t=e=>!e.get("hidden")&&e.get("jid")!==this.get("jid")&&"controlbox"!==e.get("id"),s=Bu.state.chatboxes.filter(t);return(e||0===s.length)&&(s.forEach((e=>T_.safeSave(e,{hidden:!0}))),T_.safeSave(this,{hidden:!1}),this.trigger("show")),this}return T_.safeSave(this,{hidden:!1}),this.trigger("show"),this}async close(e){try{await new Promise(((e,t)=>this.destroy({success:e,error:(e,s)=>t(s)})))}catch(e){Ct.debug(e)}finally{hm.settings.get("clear_messages_on_reconnection")&&await this.clearMessages()}hm.trigger("chatBoxClosed",this)}announceReconnection(){hm.trigger("chatReconnected",this)}async onReconnection(){hm.settings.get("clear_messages_on_reconnection")&&await this.clearMessages(),this.announceReconnection()}}const{Strophe:N_,sizzle:I_,u:M_}=Cf.env;function R_(e){return e.nick&&(M_.shouldCreateMessage(e)||e.is_tombstone)}function D_(e,t){const s=e.get("role")||"none",n=t.get("role")||"none";if(Fv[s]===Fv[n]){const s=e.getDisplayName().toLowerCase(),n=t.getDisplayName().toLowerCase();return s<n?-1:s>n?1:0}return Fv[s]<Fv[n]?-1:1}function z_(){hm.connection.get().addHandler((e=>(Bu.exports.onDirectMUCInvitation(e),!0)),"jabber:x:conference","message")}function L_(){return Bu.state.chatboxes.filter((e=>e.get("type")===ju)).forEach((e=>e.session.save({connection_status:Cf.ROOMSTATUS.DISCONNECTED})))}async function P_(){if(!document.hidden&&hm.connection.connected()){(await hm.rooms.get()).forEach((e=>e.rejoinIfNecessary()))}}async function F_(e){if(!location.hash.startsWith("#converse/room?jid="))return;e?.preventDefault();const t=location.hash.split("=").pop();if(!M_.isValidMUCJID(t))return Ct.warn(`invalid jid "${t}" provided in url fragment`);await hm.waitUntil("roomsAutoJoined"),hm.settings.get("allow_bookmarks")&&await hm.waitUntil("bookmarksInitialized"),hm.rooms.open(t,{},!0)}async function U_(e){const t=I_('x[xmlns="jabber:x:conference"]',e).pop(),s=N_.getBareJidFromJid(e.getAttribute("from")),n=t.getAttribute("jid"),i=t.getAttribute("reason");let r;if(hm.settings.get("auto_join_on_invite"))r=!0;else{const e=Bu.state.roster.get(s)?.getDisplayName()??s;r=await hm.hook("confirmDirectMUCInvitation",{contact:e,reason:i,jid:n},!1)}if(r){const e=await async function(e,t){t.type=ju,t.id=e;const s=await hm.rooms.get(e,t,!0);return s.maybeShow(!0),s}(n,{password:t.getAttribute("password")});e.session.get("connection_status")===Cf.ROOMSTATUS.DISCONNECTED&&Bu.state.chatboxes.get(n).rejoin()}}function B_(){const{xmppstatus:e}=Bu.state;if(!e)return Ct.error("Called getDefaultMUCNickname before statusInitialized has been fired."),"";const t=e.getNickname();if(t)return t;if(hm.settings.get("muc_nickname_from_jid")){const e=Bu.session.get("bare_jid");return N_.unescapeNode(N_.getNodeFromJid(e))}}function q_(e){return!!hm.settings.get("muc_show_info_messages").includes(e)}async function H_(){await Promise.all(hm.settings.get("auto_join_rooms").map((e=>"string"==typeof e?Bu.state.chatboxes.where({jid:e}).length?Promise.resolve():hm.rooms.open(e):e instanceof Object?hm.rooms.open(e.jid,{...e}):(Ct.error('Invalid muc criteria specified for "auto_join_rooms"'),Promise.resolve())))),hm.trigger("roomsAutoJoined")}function G_(){hm.disco.own.features.add(N_.NS.MUC),hm.settings.get("allow_muc_invitations")&&hm.disco.own.features.add("jabber:x:conference")}function W_(){Bu.state.chatboxes.where({type:ju}).forEach((e=>Sf(e.session,{connection_status:Cf.ROOMSTATUS.DISCONNECTED})))}function V_(){window.addEventListener(ru(),(()=>{!hm.connection.isType("websocket")||hm.settings.get("enable_smacks")&&Bu.session.get("smacks_stream_id")||L_()}))}function Q_(){hm.connection.get().addHandler((e=>{const t=N_.getBareJidFromJid(e.getAttribute("from"));return Bu.state.chatboxes.get(t)||hm.waitUntil("chatBoxesFetched").then((async()=>{const s=Bu.state.chatboxes.get(t);s&&(await s.initialized,s.message_handler.run(e))})),!0}),null,"message","groupchat")}const K_=class extends fd{defaults(){return{connection_status:Qv.DISCONNECTED}}},{u:J_,stx:Y_}=Cf.env;class X_ extends(j_(wv(O_))){defaults(){return{bookmarked:!1,chat_state:void 0,has_activity:!1,hidden:nu()&&!hm.settings.get("singleton"),hidden_occupants:!!hm.settings.get("hide_muc_participants"),message_type:"groupchat",name:"",num_unread_general:0,num_unread:0,roomconfig:{},time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:ju}}async initialize(){super.initialize(),this.vcard=null,this.initialized=hc(),this.debouncedRejoin=Wu(this.rejoin,250),this.initOccupants(),this.initDiscoModels(),this.registerHandlers(),this.on("change:chat_state",this.sendChatState,this),this.on("change:hidden",this.onHiddenChange,this),this.on("destroy",this.removeHandlers,this),await this.restoreSession(),this.session.on("change:connection_status",this.onConnectionStatusChanged,this),this.listenTo(this.occupants,"add",this.onOccupantAdded),this.listenTo(this.occupants,"remove",this.onOccupantRemoved),this.listenTo(this.occupants,"change:show",this.onOccupantShowChanged),this.listenTo(this.occupants,"change:affiliation",this.createAffiliationChangeMessage),this.listenTo(this.occupants,"change:role",this.createRoleChangeMessage);await this.restoreFromCache()||this.join(),await hm.trigger("chatRoomInitialized",this,{Synchronous:!0}),this.initialized.resolve()}isEntered(){return this.session?.get("connection_status")===Qv.ENTERED}isRAICandidate(){return this.get("hidden")&&hm.settings.get("muc_subscribe_to_rai")&&"none"!==this.getOwnAffiliation()}async restoreFromCache(){if(this.isEntered()){if(await this.fetchOccupants().catch((e=>Ct.error(e))),this.isRAICandidate())return this.session.save("connection_status",Qv.DISCONNECTED),this.enableRAI(),!0;if(await this.isJoined())return await new Promise((e=>this.config.fetch({success:e,error:e}))),await new Promise((e=>this.features.fetch({success:e,error:e}))),await this.fetchMessages().catch((e=>Ct.error(e))),!0}return this.session.save("connection_status",Qv.DISCONNECTED),this.clearOccupantsCache(),!1}async join(e,t){return this.isEntered()?this:(this.session.save("connection_status",Qv.CONNECTING),await this.refreshDiscoInfo(),(e=await this.getAndPersistNickname(e))?(hm.send(await this.constructJoinPresence(t)),this):(Sf(this.session,{connection_status:Qv.NICKNAME_REQUIRED}),hm.settings.get("muc_show_logs_before_join")&&await this.fetchMessages(),this))}rejoin(){return this.session.save("connection_status",Qv.DISCONNECTED),this.registerHandlers(),this.clearOccupantsCache(),this.join()}async constructJoinPresence(e){let t=Fe({id:xf(),from:hm.connection.get().jid,to:this.getRoomJIDAndNick()}).c("x",{xmlns:ft.NS.MUC}).c("history",{maxstanzas:this.features.get("mam_enabled")?0:hm.settings.get("muc_history_max_stanzas")}).up();return(e=e||this.get("password"))&&t.cnode(ft.xmlElement("password",[],e)),t.up(),t=await hm.hook("constructedMUCPresence",this,t),t}clearOccupantsCache(){this.occupants.length?this.occupants.filter((e=>!e.isMember())).forEach((e=>e.destroy())):this.occupants.clearStore()}sendMarkerForMessage(e,t="displayed",s=!1){if(e&&hm.settings.get("send_chat_markers").includes(t)&&"groupchat"===e?.get("type")){if(e?.get("is_markable")||s){const s=`stanza_id ${this.get("jid")}`,n=e.get(s);if(!n)return Ct.error(`Can't send marker for message without stanza ID: ${s}`),Promise.resolve();Tf(ft.getBareJidFromJid(e.get("from")),n,t,e.get("type"))}return Promise.resolve()}}sendMarkerForLastMessage(e="displayed",t=!1){const s=Array.from(this.messages.models);s.reverse();const n=s.find((e=>"them"===e.get("sender")&&(t||e.get("is_markable"))));n&&this.sendMarkerForMessage(n,e,t)}enableRAI(){if(hm.settings.get("muc_subscribe_to_rai")){const e=ft.getDomainFromJid(this.get("jid"));hm.user.presence.send(null,e,null,ze("rai",{xmlns:ft.NS.RAI}))}}async onHiddenChange(){const e=Qv,t=this.session.get("connection_status");this.get("hidden")?t===e.ENTERED&&(this.setChatState(Au),this.isRAICandidate()&&(this.sendMarkerForLastMessage("received",!0),await this.leave(),this.enableRAI())):(t===e.DISCONNECTED&&this.rejoin(),this.clearUnreadMsgCounter())}onOccupantAdded(e){q_(Cf.MUC_TRAFFIC_STATES.ENTERED)&&this.session.get("connection_status")===Qv.ENTERED&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),Cf.MUC_TRAFFIC_STATES.ENTERED)}onOccupantRemoved(e){q_(Cf.MUC_TRAFFIC_STATES.EXITED)&&this.isEntered()&&"online"===e.get("show")&&this.updateNotifications(e.get("nick"),Cf.MUC_TRAFFIC_STATES.EXITED)}onOccupantShowChanged(e){e.get("states").includes("303")||("offline"===e.get("show")&&q_(Cf.MUC_TRAFFIC_STATES.EXITED)?this.updateNotifications(e.get("nick"),Cf.MUC_TRAFFIC_STATES.EXITED):"online"===e.get("show")&&q_(Cf.MUC_TRAFFIC_STATES.ENTERED)&&this.updateNotifications(e.get("nick"),Cf.MUC_TRAFFIC_STATES.ENTERED))}async onRoomEntered(){await this.occupants.fetchMembers(),hm.settings.get("clear_messages_on_reconnection")?await this.clearMessages():await this.fetchMessages(),hm.trigger("enteredNewRoom",this),hm.settings.get("auto_register_muc_nickname")&&await hm.disco.supports(ft.NS.MUC_REGISTER,this.get("jid"))&&this.registerNickname()}async onConnectionStatusChanged(){if(this.isEntered())if(this.isRAICandidate()){try{await this.leave()}catch(e){Ct.error(e)}this.enableRAI()}else await this.onRoomEntered()}async onReconnection(){await this.rejoin(),this.announceReconnection()}getMessagesCollection(){return new Bu.exports.MUCMessages}restoreSession(){const e=`muc.session-${Bu.session.get("bare_jid")}-${this.get("jid")}`;return this.session=new K_({id:e}),Zu(this.session,e,"session"),new Promise((e=>this.session.fetch({success:e,error:e})))}initDiscoModels(){const e=Bu.session.get("bare_jid");let t=`converse.muc-features-${e}-${this.get("jid")}`;this.features=new fd(Object.assign({id:t},Cf.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{}))),this.features.browserStorage=Xu(t,"session"),this.features.listenTo(Bu,"beforeLogout",(()=>this.features.browserStorage.flush())),t=`converse.muc-config-${e}-${this.get("jid")}`,this.config=new fd({id:t}),this.config.browserStorage=Xu(t,"session"),this.config.listenTo(Bu,"beforeLogout",(()=>this.config.browserStorage.flush()))}initOccupants(){this.occupants=new Bu.exports.MUCOccupants;const e=`converse.occupants-${Bu.session.get("bare_jid")}${this.get("jid")}`;this.occupants.browserStorage=Xu(e,"session"),this.occupants.chatroom=this,this.occupants.listenTo(Bu,"beforeLogout",(()=>this.occupants.browserStorage.flush()))}fetchOccupants(){return this.occupants.fetched=new Promise((e=>{this.occupants.fetch({add:!0,silent:!0,success:e,error:e})})),this.occupants.fetched}handleAffiliationChangedMessage(e){const t=q()(`x[xmlns="${ft.NS.MUC_USER}"] item`,e).pop();if(t){const s=e.getAttribute("from"),n=e.getAttribute("type"),i=t.getAttribute("affiliation"),r=t.getAttribute("jid"),o={from:s,type:n,affiliation:i,states:[],show:"unavailable"==n?"offline":"online",role:t.getAttribute("role"),jid:ft.getBareJidFromJid(r),resource:ft.getResourceFromJid(r)},a=this.occupants.findOccupant({jid:o.jid});a?a.save(o):this.occupants.create(o)}}async handleErrorMessageStanza(e){const{__:t}=Bu,s=await r_(e,this);if(J_.isErrorObject(s)){const{stanza:e,message:t}=s;return e&&Ct.error(e),Ct.error(t)}const n=s;if(!await this.shouldShowErrorMessage(n))return;const i=ft.getResourceFromJid(n.from),r=i?this.getOccupant(i):null,o=r||this,a=o.getMessageReferencedByError(n);if(a){const e={error:n.error,error_condition:n.error_condition,error_text:n.error_text,error_type:n.error_type,editable:!1};n.msgid===a.get("retraction_id")?(e.retracted=void 0,e.retraction_id=void 0,e.retracted_id=void 0,n.error||("forbidden"===n.error_condition?e.error=t("You're not allowed to retract your message."):"not-acceptable"===n.error_condition?e.error=t("Your retraction was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to retract your message."))):n.error||("forbidden"===n.error_condition?e.error=t("Your message was not delivered because you weren't allowed to send it."):"not-acceptable"===n.error_condition?e.error=t("Your message was not delivered because you're not present in the groupchat."):e.error=t("Sorry, an error occurred while trying to send your message.")),a.save(e)}else o.createMessage(n)}handleMessageFromMUCHost(e){if(this.isEntered())return;const t=q()(`rai[xmlns="${ft.NS.RAI}"]`,e).pop(),s=Array.from(t?.querySelectorAll("activity")||[]).map((e=>e.textContent));s.includes(this.get("jid"))&&this.save({has_activity:!0,num_unread_general:0})}handleForwardedMentions(e){if(this.isEntered())return;const t=q()(`mentions[xmlns="${ft.NS.MENTIONS}"] forwarded[xmlns="${ft.NS.FORWARD}"] message[type="groupchat"]`,e),s=this.get("jid"),n=t.filter((e=>ft.getBareJidFromJid(e.getAttribute("from"))===s));n.length&&(this.save({has_activity:!0,num_unread:this.get("num_unread")+n.length}),n.forEach((async e=>{const t={stanza:e,attrs:await r_(e,this),chatbox:this};hm.trigger("message",t)})))}async handleMessageStanza(e){const t=(e=e.tree?.()??e).getAttribute("type");if("error"===t)return this.handleErrorMessageStanza(e);if("groupchat"===t){if(Jf(e))return Ct.warn('Received a MAM message with type "groupchat"')}else if(!t)return this.handleForwardedMentions(e);let s;try{s=await r_(e,this)}catch(e){return Ct.error(e)}if(J_.isErrorObject(s)){const{stanza:e,message:t}=s;return e&&Ct.error(e),Ct.error(t)}const n=s;"groupchat"===n.type&&(n.codes.forEach((e=>this.createInfoMessage(e))),this.fetchFeaturesIfConfigurationChanged(n));const i={stanza:e,attrs:n,chatbox:this};return hm.trigger("message",i),n&&this.queueMessage(n)}registerHandlers(){const e=this.get("jid"),t=ft.getDomainFromJid(e);this.removeHandlers();const s=hm.connection.get();this.presence_handler=s.addHandler((e=>(this.onPresence(e),!0)),null,"presence",null,null,e,{ignoreNamespaceFragment:!0,matchBareFromJid:!0}),this.domain_presence_handler=s.addHandler((e=>(this.onPresenceFromMUCHost(e),!0)),null,"presence",null,null,t),this.message_handler=s.addHandler((e=>(this.handleMessageStanza(e),!0)),null,"message",null,null,e,{matchBareFromJid:!0}),this.domain_message_handler=s.addHandler((e=>(this.handleMessageFromMUCHost(e),!0)),null,"message",null,null,t),this.affiliation_message_handler=s.addHandler((e=>(this.handleAffiliationChangedMessage(e),!0)),ft.NS.MUC_USER,"message",null,null,e)}removeHandlers(){const e=hm.connection.get();return this.message_handler&&(e?.deleteHandler(this.message_handler),delete this.message_handler),this.domain_message_handler&&(e?.deleteHandler(this.domain_message_handler),delete this.domain_message_handler),this.presence_handler&&(e?.deleteHandler(this.presence_handler),delete this.presence_handler),this.domain_presence_handler&&(e?.deleteHandler(this.domain_presence_handler),delete this.domain_presence_handler),this.affiliation_message_handler&&(e?.deleteHandler(this.affiliation_message_handler),delete this.affiliation_message_handler),this}invitesAllowed(){return hm.settings.get("allow_muc_invitations")&&(this.features.get("open")||"owner"===this.getOwnAffiliation())}getDisplayName(){const e=this.get("name");return e?e.trim():"hidden"===hm.settings.get("locked_muc_domain")?ft.getNodeFromJid(this.get("jid")):this.get("jid")}sendTimedMessage(e){const t=e instanceof Element?e:e.tree();let s=t.getAttribute("id");s||(s=xf("sendIQ"),t.setAttribute("id",s));const n=hc(),i=hm.settings.get("stanza_timeout"),r=hm.connection.get(),o=r.addTimedHandler(i,(()=>{r.deleteHandler(a);const e=new Sh("Timeout Error: No response from server");return n.resolve(e),!1})),a=r.addHandler((e=>{o&&r.deleteTimedHandler(o),n.resolve(e)}),null,"message",["error","groupchat"],s);return hm.send(t),n}async retractOwnMessage(e){const t=Bu.__,s=e.get("origin_id");if(!s)throw new Error("Can't retract message without a XEP-0359 Origin ID");const n=e.get("editable"),i=Le({id:xf(),to:this.get("jid"),type:"groupchat"}).c("store",{xmlns:ft.NS.HINTS}).up().c("apply-to",{id:s,xmlns:ft.NS.FASTEN}).c("retract",{xmlns:ft.NS.RETRACT});e.set({retracted:(new Date).toISOString(),retracted_id:s,retraction_id:i.tree().getAttribute("id"),editable:!1});const r=await this.sendTimedMessage(i);J_.isErrorStanza(r)?Ct.error(r):r instanceof Sh&&(Ct.error(r),e.save({editable:n,error_type:"timeout",error:t("A timeout happened while while trying to retract your message."),retracted:void 0,retracted_id:void 0,retraction_id:void 0}))}async retractOtherMessage(e,t){const s=e.get("editable"),n=Bu.session.get("bare_jid");e.save({moderated:"retracted",moderated_by:n,moderated_id:e.get("msgid"),moderation_reason:t,editable:!1});const i=await this.sendRetractionIQ(e,t);return(null===i||J_.isErrorStanza(i))&&e.save({editable:s,moderated:void 0,moderated_by:void 0,moderated_id:void 0,moderation_reason:void 0}),i}sendRetractionIQ(e,t){const s=Pe({to:this.get("jid"),type:"set"}).c("apply-to",{id:e.get(`stanza_id ${this.get("jid")}`),xmlns:ft.NS.FASTEN}).c("moderate",{xmlns:ft.NS.MODERATE}).c("retract",{xmlns:ft.NS.RETRACT}).up().c("reason").t(t||"");return hm.sendIQ(s,null,!1)}sendDestroyIQ(e,t){const s=ze("destroy");t&&s.attrs({jid:t});const n=Pe({to:this.get("jid"),type:"set"}).c("query",{xmlns:ft.NS.MUC_OWNER}).cnode(s.node);return e&&e.length>0&&n.c("reason",e),hm.sendIQ(n)}async leave(e){hm.trigger("leaveRoom",this),hm.connection.connected()&&hm.user.presence.send("unavailable",this.getRoomJIDAndNick(),e),this.features&&await new Promise((e=>this.features.destroy({success:e,error:(t,s)=>{Ct.error(s),e()}})));const t=Bu.state.disco_entities?.get(this.get("jid"));t&&await new Promise((e=>t.destroy({success:e,error:(t,s)=>{Ct.error(s),e()}}))),Sf(this.session,{connection_status:Qv.DISCONNECTED})}async close(e){const{ENTERED:t,CLOSING:s}=Qv,n=this.session.get("connection_status")===t;return Sf(this.session,{connection_status:s}),n&&this.sendMarkerForLastMessage("received",!0),await this.unregisterNickname(),await this.leave(),this.occupants.clearStore(),"closeAllChatBoxes"!==e?.name&&hm.settings.get("muc_clear_messages_on_leave")&&this.clearMessages(),await new Promise((e=>this.session.destroy({success:e,error:(t,s)=>{Ct.error(s),e()}}))),super.close()}canModerateMessages(){const e=this.getOwnOccupant();return e&&e.isModerator()&&hm.disco.supports(ft.NS.MODERATE,this.get("jid"))}canPostMessages(){return this.isEntered()&&!(this.features.get("moderated")&&"visitor"===this.getOwnRole())}getAllKnownNicknames(){return[...new Set([...this.occupants.map((e=>e.get("nick"))),...this.messages.map((e=>e.get("nick")))])].filter((e=>e))}getAllKnownNicknamesRegex(){const e=this.getAllKnownNicknames().map((e=>jv.escapeRegexString(e))).join("|");return RegExp(`(?:\\p{P}|\\p{Z}|^)@(${e})(?![\\w@-])`,"uig")}getOccupantByJID(e){return this.occupants.findOccupant({jid:e})}getOccupantByNickname(e){return this.occupants.findOccupant({nick:e})}getReferenceURIFromNickname(e){const t=this.get("jid"),s=this.getOccupant(e),n=this.features.get("nonanonymous")&&s?.get("jid")||`${t}/${e}`;return encodeURI(`xmpp:${n}`)}parseTextForReferences(e){if(!e||!/(\p{P}|\p{Z}|^)([@][\w_-]+(?:\.\w+)*)/giu.test(e))return[e,[]];const t=jv.findFirstMatchInArray(this.getAllKnownNicknames()),s=this.getAllKnownNicknamesRegex(),n=[...e.matchAll(s)].filter((e=>!e[0].startsWith("/"))),i=n.map((e=>{let s=e[0].indexOf("@");"@"===e[0][s+1]&&(s+=1);const n=e.index+s,i=n+e[0].length-s,r=t(e[1]);return{begin:n,end:i,value:r,type:"mention",uri:this.getReferenceURIFromNickname(r)}})),[r,o]=jv.reduceTextFromReferences(e,i);return[r,o]}async getOutgoingMessageAttributes(e){const t=this.get("composing_spoiler");let s,n="";e?.body&&([n,s]=this.parseTextForReferences(e.body));const i=xf(),r=n?J_.shortnamesToUnicode(n):void 0;return e=Object.assign({},e,{body:r,is_spoiler:t,origin_id:i,references:s,id:i,msgid:i,from:`${this.get("jid")}/${this.get("nick")}`,fullname:this.get("nick"),message:r,nick:this.get("nick"),sender:"me",type:"groupchat",original_text:n},J_.getMediaURLsMetadata(n)),e=await hm.hook("getOutgoingMessageAttributes",this,e)}getRoomJIDAndNick(){const e=this.get("nick");return ft.getBareJidFromJid(this.get("jid"))+(null!==e?`/${e}`:"")}sendChatState(){if(!hm.settings.get("send_chat_state_notifications")||!this.get("chat_state")||!this.isEntered()||this.features.get("moderated")&&"visitor"===this.getOwnRole())return;const e=hm.settings.get("send_chat_state_notifications");if(Array.isArray(e)&&!e.includes(this.get("chat_state")))return;const t=this.get("chat_state");t!==Cu&&hm.send(Le({to:this.get("jid"),type:"groupchat"}).c(t,{xmlns:ft.NS.CHATSTATES}).up().c("no-store",{xmlns:ft.NS.HINTS}).up().c("no-permanent-store",{xmlns:ft.NS.HINTS}))}directInvite(e,t){this.features.get("membersonly")&&this.updateMemberLists([{jid:e,affiliation:"member",reason:t}]);const s={xmlns:"jabber:x:conference",jid:this.get("jid")};null!==t&&(s.reason=t),this.get("password")&&(s.password=this.get("password"));const n=Le({from:hm.connection.get().jid,to:e,id:xf()}).c("x",s);hm.send(n),hm.trigger("roomInviteSent",{room:this,recipient:e,reason:t})}refreshDiscoInfo(){return hm.disco.refresh(this.get("jid")).then((()=>this.getDiscoInfo())).catch((e=>Ct.error(e)))}getDiscoInfo(){return hm.disco.getIdentity("conference","text",this.get("jid")).then((e=>this.save({name:e?.get("name")}))).then((()=>this.getDiscoInfoFields())).then((()=>this.getDiscoInfoFeatures())).catch((e=>Ct.error(e)))}async getDiscoInfoFields(){const e=(await hm.disco.getFields(this.get("jid"))).reduce(((e,t)=>{const s=t.get("var");return s?.startsWith("muc#roominfo_")&&(e[s.replace("muc#roominfo_","")]=t.get("value")),e}),{});this.config.save(e)}async getDiscoInfoFeatures(){const e=await hm.disco.getFeatures(this.get("jid")),t=Cf.ROOM_FEATURES.reduce(((e,t)=>(e[t]=!1,e)),{fetched:(new Date).toISOString()});e.each((e=>{const s=e.get("var");s.startsWith("muc_")?t[s.replace("muc_","")]=!0:s===ft.NS.MAM?t.mam_enabled=!0:t[s]=!0})),this.features.save(t)}addFieldValue(e){const t=e.getAttribute("type");if("fixed"===t)return e;const s=e.getAttribute("var").replace("muc#roomconfig_",""),n=this.get("roomconfig");if(s in n){let i;switch(t){case"boolean":i=[n[s]?1:0];break;case"list-multi":i=n[s];break;default:i=[n[s]]}e.innerHTML=i.map((e=>ze("value").t(e))).join("")}return e}async autoConfigureChatRoom(){const e=await this.fetchRoomConfiguration(),t=q()("field",e).map((e=>this.addFieldValue(e)));if(t.length)return this.sendConfiguration(t)}fetchRoomConfiguration(){return hm.sendIQ(Pe({to:this.get("jid"),type:"get"}).c("query",{xmlns:ft.NS.MUC_OWNER}))}sendConfiguration(e=[]){const t=Pe({to:this.get("jid"),type:"set"}).c("query",{xmlns:ft.NS.MUC_OWNER}).c("x",{xmlns:ft.NS.XFORM,type:"submit"});return e.forEach((e=>t.cnode(e).up())),hm.sendIQ(t)}onCommandError(e){const{__:t}=Bu;Ct.fatal(e);const s=t("Sorry, an error happened while running the command.")+" "+t("Check your browser's developer console for details.");this.createMessage({message:s,type:"error"})}getNickOrJIDFromCommandArgs(e){const{__:t}=Bu;if(J_.isValidJID(e.trim()))return e.trim();e.startsWith("@")||(e="@"+e);const s=this.parseTextForReferences(e)[1];if(!s.length){const e=t("Error: couldn't find a groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}if(s.length>1){const e=t("Error: found multiple groupchat participant based on your arguments");return void this.createMessage({message:e,type:"error"})}const n=s.pop().value,i=e.split(n,2)[1];if(!i||i.startsWith(" "))return n;{const e=t("Error: couldn't find a groupchat participant based on your arguments");this.createMessage({message:e,type:"error"})}}validateRoleOrAffiliationChangeArgs(e,t){const{__:s}=Bu;if(!t){const t=s('Error: the "%1$s" command takes two arguments, the user\'s nickname and optionally a reason.',e);return this.createMessage({message:t,type:"error"}),!1}return!0}getAllowedCommands(){let e=["clear","help","me","nick","register"];(this.config.get("changesubject")||["owner","admin"].includes(this.getOwnAffiliation()))&&(e=[...e,"subject","topic"]);const t=Bu.session.get("bare_jid"),s=this.occupants.findWhere({jid:t});return this.verifyAffiliations(["owner"],s,!1)?e=e.concat(Dv).concat(Nv):this.verifyAffiliations(["admin"],s,!1)&&(e=e.concat(Nv)),this.verifyRoles(["moderator"],s,!1)?e=e.concat(Rv).concat(Lv):this.verifyRoles(["visitor","participant","moderator"],s,!1)||(e=e.concat(Lv)),e.sort(),Array.isArray(hm.settings.get("muc_disable_slash_commands"))?e.filter((e=>!hm.settings.get("muc_disable_slash_commands").includes(e))):e}verifyAffiliations(e,t,s=!0){const{__:n}=Bu;if(!Array.isArray(e))throw new TypeError("affiliations must be an Array");if(!e.length)return!0;const i=Bu.session.get("bare_jid");if(t=t||this.occupants.findWhere({jid:i})){const s=t.get("affiliation");if(e.includes(s))return!0}if(s){const e=n("Forbidden: you do not have the necessary affiliation in order to do that.");this.createMessage({message:e,type:"error"})}return!1}verifyRoles(e,t,s=!0){const{__:n}=Bu;if(!Array.isArray(e))throw new TypeError("roles must be an Array");if(!e.length)return!0;const i=Bu.session.get("bare_jid");if(t=t||this.occupants.findWhere({jid:i})){const s=t.get("role");if(e.includes(s))return!0}if(s){const e=n("Forbidden: you do not have the necessary role in order to do that.");this.createMessage({message:e,type:"error",is_ephemeral:2e4})}return!1}getOwnRole(){return this.getOwnOccupant()?.get("role")}getOwnAffiliation(){return this.getOwnOccupant()?.get("affiliation")||"none"}getOwnOccupant(){return this.occupants.getOwnOccupant()}async setNickname(e){const t=ft.getBareJidFromJid(this.get("jid"));hm.send(Y_`<presence xmlns="jabber:client"
                    id="${xf()}"
                    from="${hm.connection.get().jid}"
                    to="${t}/${e}"></presence>`)}setRole(e,t,s,n,i){const r=ze("item",{nick:e.get("nick"),role:t}),o=Pe({to:this.get("jid"),type:"set"}).c("query",{xmlns:ft.NS.MUC_ADMIN}).cnode(r.node);return null!==s&&o.c("reason",s),hm.sendIQ(o).then(n).catch(i)}getOccupant(e){return J_.isValidJID(e)?this.getOccupantByJID(e):this.getOccupantByNickname(e)}getOccupantsWithRole(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("role")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),role:e.get("role")})))}getOccupantsWithAffiliation(e){return this.getOccupantsSortedBy("nick").filter((t=>t.get("affiliation")===e)).map((e=>({jid:e.get("jid"),nick:e.get("nick"),affiliation:e.get("affiliation")})))}getOccupantsSortedBy(e){return Array.from(this.occupants.models).sort(((t,s)=>t.get(e)<s.get(e)?-1:t.get(e)>s.get(e)?1:0))}async updateMemberLists(e){const t=this.get("jid"),s=await Promise.all(["member","admin","owner"].map((e=>d_(e,t)))),n=s.reduce(((e,t)=>t instanceof Error?(Ct.error(t),e):[...t,...e]),[]);await u_(t,m_(!0,!1,e,n)),await this.occupants.fetchMembers()}async getAndPersistNickname(e){return(e=e||this.get("nick")||await this.getReservedNick()||Bu.exports.getDefaultMUCNickname())&&Sf(this,{nick:e},{silent:!0}),e}async getReservedNick(){const e=Pe({to:this.get("jid"),from:hm.connection.get().jid,type:"get"}).c("query",{xmlns:ft.NS.DISCO_INFO,node:"x-roomuser-item"}),t=await hm.sendIQ(e,null,!1);if(wf(t))throw t;const s=t?.querySelector('query[node="x-roomuser-item"] identity');return s?s.getAttribute("name"):null}async registerNickname(){const{__:e}=Bu,t=this.get("nick"),s=this.get("jid");let n,i;try{n=await hm.sendIQ(Y_`<iq to="${s}" type="get" xmlns="jabber:client">
                    <query xmlns="${ft.NS.MUC_REGISTER}"/>
                </iq>`)}catch(t){return q()(`not-allowed[xmlns="${ft.NS.STANZAS}"]`,t).length?i=e("You're not allowed to register yourself in this groupchat."):q()(`registration-required[xmlns="${ft.NS.STANZAS}"]`,t).length&&(i=e("You're not allowed to register in this groupchat because it's members-only.")),Ct.error(t),i}const r=q()("field required",n).map((e=>e.parentElement));if(r.length>1&&"muc#register_roomnick"!==r[0].getAttribute("var"))return Ct.error(`Can't register the user register in the groupchat ${s} due to the required fields`);try{await hm.sendIQ(Y_`<iq to="${s}" type="set" xmlns="jabber:client">
                    <query xmlns="${ft.NS.MUC_REGISTER}">
                        <x xmlns="${ft.NS.XFORM}" type="submit">
                            <field var="FORM_TYPE">
                                <value>http://jabber.org/protocol/muc#register</value>
                            </field>
                            <field var="muc#register_roomnick">
                                <value>${t}</value>
                            </field>
                        </x>
                    </query>
                </iq>`)}catch(e){const t=await If(e);throw"service-unavailable"===t?.name?Ct.error("Can't register your nickname in this groupchat, it doesn't support registration."):"bad-request"===t?.name?Ct.error("Can't register your nickname in this groupchat, invalid data form supplied."):Ct.error(e),t}}async unregisterNickname(){if("unregister"===hm.settings.get("auto_register_muc_nickname"))try{await hm.disco.supports(ft.NS.MUC_REGISTER,this.get("jid"))&&await this.sendUnregistrationIQ()}catch(e){Ct.error(e)}}sendUnregistrationIQ(){const e=Pe({to:this.get("jid"),type:"set"}).c("query",{xmlns:ft.NS.MUC_REGISTER}).c("remove");return hm.sendIQ(e).catch((e=>Ct.error(e)))}updateOccupantsOnPresence(e){if("error"===e.type||!e.jid&&!e.nick&&!e.occupant_id)return!0;const t=this.occupants.findOccupant(e);if("unavailable"===e.type&&t&&!e.codes.includes(Cf.MUC_NICK_CHANGED_CODE)&&!["admin","owner","member"].includes(e.affiliation))return t.set(e),void t.destroy();const s=e.jid||"",n={...e,jid:ft.getBareJidFromJid(s)||t?.attributes?.jid,resource:ft.getResourceFromJid(s)||t?.attributes?.resource};if(e.is_self){let t=!1;e.codes.includes(Cf.MUC_NICK_CHANGED_CODE)&&(t=!0,this.set("nick",e.nick)),this.features.get(ft.NS.OCCUPANTID)&&this.get("occupant-id")!==e.occupant_id&&(t=!0,this.set("occupant_id",e.occupant_id)),t&&this.save()}t?t.save(n):this.occupants.create(n)}fetchFeaturesIfConfigurationChanged(e){const t=["104","170","171","172","173","174"];e.codes.filter((e=>t.includes(e))).length&&this.refreshDiscoInfo()}isSameUser(e,t){const s=ft.getBareJidFromJid(e),n=ft.getBareJidFromJid(t),i=ft.getResourceFromJid(e),r=ft.getResourceFromJid(t);if(J_.isSameBareJID(e,t))return s!==this.get("jid")||i===r;return(s===this.get("jid")?this.occupants.findOccupant({nick:i}):this.occupants.findOccupant({jid:s}))===(n===this.get("jid")?this.occupants.findOccupant({nick:r}):this.occupants.findOccupant({jid:n}))}async isSubjectHidden(){return(await hm.user.settings.get("mucs_with_hidden_subject",[])).includes(this.get("jid"))}async toggleSubjectHiddenState(){const e=this.get("jid"),t=await hm.user.settings.get("mucs_with_hidden_subject",[]);t.includes(this.get("jid"))?hm.user.settings.set("mucs_with_hidden_subject",t.filter((t=>t!==e))):hm.user.settings.set("mucs_with_hidden_subject",[...t,e])}async handleSubjectChange(e){const t=Bu.__;if("string"==typeof e.subject&&!e.thread&&!e.message){const s=e.subject,n=e.nick;if(Sf(this,{subject:{author:n,text:e.subject||""}}),!e.is_delayed&&n){const i=t(s?"Topic set by %1$s":"Topic cleared by %1$s",n),r=this.messages.last();r?.get("nick")===e.nick&&"info"===r?.get("type")&&r?.get("message")===i||this.createMessage({message:i,nick:e.nick,type:"info",is_ephemeral:!0}),await this.isSubjectHidden()&&this.toggleSubjectHiddenState()}return!0}return!1}setSubject(e=""){hm.send(Le({to:this.get("jid"),from:hm.connection.get().jid,type:"groupchat"}).c("subject",{xmlns:"jabber:client"}).t(e).tree())}ignorableCSN(e){return e.chat_state&&!e.body&&(e.is_delayed||this.isOwnMessage(e))}isOwnMessage(e){let t;return t=e instanceof Element?e.getAttribute("from"):e instanceof Bu.exports.MUCMessage?e.get("from"):e.from,ft.getResourceFromJid(t)==this.get("nick")}getUpdatedMessageAttributes(e,t){const s={...super.getUpdatedMessageAttributes(e,t),...pd(t,["from_muc","occupant_id"])};if(this.isOwnMessage(t)){const n=Object.keys(t).filter((e=>e.startsWith("stanza_id")));Object.assign(s,pd(t,n)),e.get("received")||(s.received=(new Date).toISOString())}return s}async isJoined(){return this.isEntered()?(hm.connection.connected()||await new Promise((e=>hm.listen.once("reconnected",e))),hm.ping(`${this.get("jid")}/${this.get("nick")}`)):(Ct.info(`isJoined: not pinging MUC ${this.get("jid")} since we're not entered`),!1)}async sendStatusPresence(e,t,s){if(this.session.get("connection_status")===Qv.ENTERED){const n=await Bu.state.xmppstatus.constructPresence(e,this.getRoomJIDAndNick(),t);s?.map((e=>e?.tree()??e)).forEach((e=>n.cnode(e).up())),hm.send(n)}}async rejoinIfNecessary(){return this.isRAICandidate()?(Ct.debug(`rejoinIfNecessary: not rejoining hidden MUC "${this.get("jid")}" since we're using RAI`),!0):await this.isJoined()?void 0:(this.rejoin(),!0)}async shouldShowErrorMessage(e){if("Decryption"===e.error_type){if("Message key not found. The counter was repeated or the key was not filled."===e.error_message)return!1;if("not-encrypted-for-this-device"===e.error_condition)return!1}else if("not-acceptable"===e.error_condition&&await this.rejoinIfNecessary())return!1;return super.shouldShowErrorMessage(e)}findDanglingModeration(e){if(!this.messages.length)return null;if(this.messages.last().get("time")>e.time){const t=Array.from(this.messages.models),s=e[`stanza_id ${this.get("jid")}`];return s?(t.reverse(),t.find((({attributes:e})=>"retracted"===e.moderated&&e.moderated_id===s&&e.moderated_by))):null}}async handleModeration(e){const t=["editable","moderated","moderated_by","moderated_id","moderation_reason"];if("retracted"===e.moderated){const s={};s[`stanza_id ${this.get("jid")}`]=e.moderated_id;const n=this.messages.findWhere(s);return n?(n.save(pd(e,t)),!0):(e.dangling_moderation=!0,await this.createMessage(e),!0)}{const s=this.findDanglingModeration(e);if(s){const n=pd(s.attributes,t),i=Object.assign({dangling_moderation:!1},e,n);return delete i.id,s.save(i),!0}}return!1}getNotificationsText(){const{__:e}=Bu,t=this.notifications.toJSON(),s=hm.settings.get("muc_show_info_messages").filter((e=>Cf.MUC_ROLE_CHANGES_LIST.includes(e))),n=hm.settings.get("muc_show_info_messages").filter((e=>Cf.MUC_TRAFFIC_STATES_LIST.includes(e)));return[...Cf.CHAT_STATES,...n,...s].reduce(((s,n)=>{const i=t[n];if(!i?.length)return s;const r=i.map((e=>this.getOccupant(e)?.getDisplayName()||e));if(1===r.length){if("composing"===n)return`${s}${e("%1$s is typing",r[0])}\n`;if("paused"===n)return`${s}${e("%1$s has stopped typing",r[0])}\n`;if(n===Cu)return`${s}${e("%1$s has gone away",r[0])}\n`;if("entered"===n)return`${s}${e("%1$s has entered the groupchat",r[0])}\n`;if("exited"===n)return`${s}${e("%1$s has left the groupchat",r[0])}\n`;if("op"===n)return`${s}${e("%1$s is now a moderator",r[0])}\n`;if("deop"===n)return`${s}${e("%1$s is no longer a moderator",r[0])}\n`;if("voice"===n)return`${s}${e("%1$s has been given a voice",r[0])}\n`;if("mute"===n)return`${s}${e("%1$s has been muted",r[0])}\n`}else if(r.length>1){let t;if(r.length>3)t=`${Array.from(r).slice(0,2).join(", ")} and others`;else{const s=r.pop();t=e("%1$s and %2$s",r.join(", "),s)}if("composing"===n)return`${s}${e("%1$s are typing",t)}\n`;if("paused"===n)return`${s}${e("%1$s have stopped typing",t)}\n`;if(n===Cu)return`${s}${e("%1$s have gone away",t)}\n`;if("entered"===n)return`${s}${e("%1$s have entered the groupchat",t)}\n`;if("exited"===n)return`${s}${e("%1$s have left the groupchat",t)}\n`;if("op"===n)return`${s}${e("%1$s are now moderators",r[0])}\n`;if("deop"===n)return`${s}${e("%1$s are no longer moderators",r[0])}\n`;if("voice"===n)return`${s}${e("%1$s have been given voices",r[0])}\n`;if("mute"===n)return`${s}${e("%1$s have been muted",r[0])}\n`}return s}),"")}removeNotification(e,t){const s=this.notifications.toJSON();(t=Array.isArray(t)?t:[t]).forEach((t=>{const n=Array.from(s[t]||[]);if(n.includes(e)){const s=n.indexOf(e);n.splice(s,1),this.notifications.set(t,Array.from(n))}}))}updateNotifications(e,t){const s=this.notifications.toJSON(),n=s[t]||[];if(n.includes(e))return;const i=(i,r)=>(i[r]=r===t?[...n,e]:(s[r]||[]).filter((t=>t!==e)),i),r=Cf.CHAT_STATES.reduce(i,{}),o=Cf.MUC_TRAFFIC_STATES_LIST.reduce(i,{}),a=Cf.MUC_ROLE_CHANGES_LIST.reduce(i,{});this.notifications.set(Object.assign(r,o,a)),setTimeout((()=>this.removeNotification(e,t)),1e4)}handleMUCPrivateMessage(e){if("chat"===e.type||null===e.type){const t=this.occupants.findOccupant(e);if(t)return t.queueMessage(e)}return!1}handleMetadataFastening(e){if(e.ogp_for_id){if(e.from!==this.get("jid"))return!1;const t=this.messages.findWhere({origin_id:e.ogp_for_id});if(t){const s=t.get("ogp_metadata")||[];if(s.filter((t=>t["og:url"]===e["og:url"])).length)return!1;const n=[...s,pd(e,mu)];return t.save("ogp_metadata",n),!0}}return!1}handleMEPNotification(e){return!(e.from!==this.get("jid")||!e.activities)&&(e.activities?.forEach((t=>{const s=Object.assign(e,t);this.createMessage(s),hm.trigger("message",{attrs:s,chatbox:this})})),!!e.activities.length)}getDuplicateMessage(e){return e.activities?.length?this.messages.findWhere({type:"mep",msgid:e.msgid}):super.getDuplicateMessage(e)}async onMessage(e){if(wf(e))return Ct.error(e.message);const t=e;if("error"===t.type&&!await this.shouldShowErrorMessage(t))return;const s=this.getDuplicateMessage(t);if(s)"groupchat"===s.get("type")&&this.updateMessage(s,t);else if(!(t.receipt_id||t.is_marker||this.ignorableCSN(t)))if(this.handleMUCPrivateMessage(t)||this.handleMetadataFastening(t)||this.handleMEPNotification(t)||await this.handleRetraction(t)||await this.handleModeration(t)||await this.handleSubjectChange(t))t.nick&&this.removeNotification(t.nick,["composing","paused"]);else if(this.setEditable(t,t.time),t.chat_state&&this.updateNotifications(t.nick,t.chat_state),R_(t)){const e=await this.handleCorrection(t)||await this.createMessage(t);this.removeNotification(t.nick,["composing","paused"]),this.handleUnreadMessage(e)}}handleModifyError(e){const t=e.querySelector("error text")?.textContent;if(t)if(this.session.get("connection_status")===Qv.CONNECTING)this.setDisconnectionState(t);else{const e={type:"error",message:t,is_ephemeral:!0};this.createMessage(e)}}handleDisconnection(e){const{is_self:t,reason:s,actor:n}=e,i=e.codes.filter((e=>Mv.includes(e)));if(!(t&&i.length>0))return;const{STATUS_CODE_MESSAGES:r}=Bu.labels.muc,o=r[i[0]],a=i.includes("301")?Qv.BANNED:Qv.DISCONNECTED;this.setDisconnectionState(o,s,n?.nick,a)}getActionInfoMessage(e,t){const{nick:s,actor:n}=t,i=Bu.__;return"301"===e?n?.nick?i("%1$s has been banned by %2$s",s,n.nick):i("%1$s has been banned",s):"303"===e?i("%1$s's nickname has changed",s):"307"===e?n?.nick?i("%1$s has been kicked out by %2$s",s,n.nick):i("%1$s has been kicked out",s):"321"===e?i("%1$s has been removed because of an affiliation change",s):"322"===e?i("%1$s has been removed for not being a member",s):void 0}createAffiliationChangeMessage(e){const t=Bu.__,s=e._previousAttributes.affiliation;if(!s)return;const n=e.get("affiliation");"admin"===s&&q_(Cf.AFFILIATION_CHANGES.EXADMIN)?this.createMessage({type:"info",message:t("%1$s is no longer an admin of this groupchat",e.get("nick"))}):"owner"===s&&q_(Cf.AFFILIATION_CHANGES.EXOWNER)?this.createMessage({type:"info",message:t("%1$s is no longer an owner of this groupchat",e.get("nick"))}):"outcast"===s&&q_(Cf.AFFILIATION_CHANGES.EXOUTCAST)&&this.createMessage({type:"info",message:t("%1$s is no longer banned from this groupchat",e.get("nick"))}),"none"===n&&"member"===s&&q_(Cf.AFFILIATION_CHANGES.EXMEMBER)&&this.createMessage({type:"info",message:t("%1$s is no longer a member of this groupchat",e.get("nick"))}),"member"===n&&q_(Cf.AFFILIATION_CHANGES.MEMBER)?this.createMessage({type:"info",message:t("%1$s is now a member of this groupchat",e.get("nick"))}):("admin"===n&&q_(Cf.AFFILIATION_CHANGES.ADMIN)||"owner"==n&&q_(Cf.AFFILIATION_CHANGES.OWNER))&&this.createMessage({type:"info",message:t("%1$s is now an %2$s of this groupchat",e.get("nick"),n)})}createRoleChangeMessage(e,t){if("none"===t||e.changed.affiliation)return;const s=e._previousAttributes.role;"moderator"===s&&q_(Cf.MUC_ROLE_CHANGES.DEOP)?this.updateNotifications(e.get("nick"),Cf.MUC_ROLE_CHANGES.DEOP):"visitor"===s&&q_(Cf.MUC_ROLE_CHANGES.VOICE)&&this.updateNotifications(e.get("nick"),Cf.MUC_ROLE_CHANGES.VOICE),"visitor"===e.get("role")&&q_(Cf.MUC_ROLE_CHANGES.MUTE)?this.updateNotifications(e.get("nick"),Cf.MUC_ROLE_CHANGES.MUTE):"moderator"===e.get("role")&&!["owner","admin"].includes(e.get("affiliation"))&&q_(Cf.MUC_ROLE_CHANGES.OP)&&this.updateNotifications(e.get("nick"),Cf.MUC_ROLE_CHANGES.OP)}createInfoMessageFromPresence(e,t){const s=Bu.__,n=t.is_self??!1;if(!q_||"110"===e||"100"===e&&!n)return;const{STATUS_CODE_MESSAGES:i}=Bu.labels.muc,r=i[e],o={type:"info",is_ephemeral:!0,message:r,code:e};if(!n&&Tv.includes(e)?(o.message=this.getActionInfoMessage(e,t),o.reason=t.reason):n&&Ov.includes(e)&&(o.message=t.nick?s(r,t.nick):void 0),o.message){if("201"===e&&this.messages.findWhere(o))return;this.createMessage(o)}}createInfoMessage(e){if(!q_(e)||"110"===e)return;const{STATUS_CODE_MESSAGES:t}=Bu.labels.muc,s=t[e];s&&this.createMessage({type:"info",is_ephemeral:!0,message:s,code:e})}setDisconnectionState(e,t,s,n=Qv.DISCONNECTED){this.session.save({connection_status:n,disconnection_actor:s,disconnection_message:e,disconnection_reason:t})}onNicknameClash(e){const t=Bu.__;if(hm.settings.get("muc_nickname_from_jid")){const t=e.getAttribute("from").split("/")[1];if(t===Bu.exports.getDefaultMUCNickname())this.join(t+"-2");else{const e=t.lastIndexOf("-"),s=t.substring(e+1,t.length);this.join(t.substring(0,e+1)+String(Number(s)+1))}}else this.save({nickname_validation_message:t("The nickname you chose is reserved or currently in use, please choose a different one.")}),this.session.save({connection_status:Qv.NICKNAME_REQUIRED})}onErrorPresence(e){const t=Bu.__,s=e.querySelector("error"),n=s.getAttribute("type"),i=q()(`text[xmlns="${ft.NS.STANZAS}"]`,s).pop()?.textContent;if("modify"===n)this.handleModifyError(e);else if("auth"===n){if(q()(`not-authorized[xmlns="${ft.NS.STANZAS}"]`,s).length&&(this.save({password_validation_message:i||t("Password incorrect")}),this.session.save({connection_status:Qv.PASSWORD_REQUIRED})),s.querySelector("registration-required")){const e=t("You are not on the member list of this groupchat.");this.setDisconnectionState(e,i)}else if(s.querySelector("forbidden")){const{STATUS_CODE_MESSAGES:e}=Bu.labels.muc;this.setDisconnectionState(e[301],i,null,Qv.BANNED)}}else if("cancel"===n)if(s.querySelector("not-allowed")){const e=t("You are not allowed to create new groupchats.");this.setDisconnectionState(e,i)}else if(s.querySelector("not-acceptable")){const e=t("Your nickname doesn't conform to this groupchat's policies.");this.setDisconnectionState(e,i)}else if(q()(`gone[xmlns="${ft.NS.STANZAS}"]`,s).length){const e=q()(`gone[xmlns="${ft.NS.STANZAS}"]`,s).pop()?.textContent.replace(/^xmpp:/,"").replace(/\?join$/,"");this.save({moved_jid:e,destroyed_reason:i}),this.session.save({connection_status:Qv.DESTROYED})}else if(s.querySelector("conflict"))this.onNicknameClash(e);else if(s.querySelector("item-not-found")){const e=t("This groupchat does not (yet) exist.");this.setDisconnectionState(e,i)}else if(s.querySelector("service-unavailable")){const e=t("This groupchat has reached its maximum number of participants.");this.setDisconnectionState(e,i)}else if(s.querySelector("remote-server-not-found")){const e=t("Remote server not found");this.setDisconnectionState(e,i)}else if(s.querySelector("forbidden")){const e=t("You're not allowed to enter this groupchat");this.setDisconnectionState(e,i)}else{const e=t("An error happened while trying to enter this groupchat");this.setDisconnectionState(e,i)}}onPresenceFromMUCHost(e){if("error"===e.getAttribute("type")){const t=e.querySelector("error");"wait"===t?.getAttribute("type")&&t?.querySelector("resource-constraint")&&this.session.get("connection_status")===Qv.DISCONNECTED&&this.rejoin()}}async onPresence(e){if("error"===e.getAttribute("type"))return this.onErrorPresence(e);const t=await async function(e,t){const s=e.getAttribute("from"),n=e.getAttribute("type"),i=Yv.getResourceFromJid(s),r={from:s,nick:i,type:n,muc_jid:Yv.getBareJidFromJid(s),occupant_id:n_(e,t),status:e.querySelector(":scope > status")?.textContent??void 0,show:e.querySelector(":scope > show")?.textContent??("unavailable"!==n?"online":"offline"),image_hash:Xv(`presence > x[xmlns="${Yv.NS.VCARDUPDATE}"] photo`,e).pop()?.textContent,hats:Xv(`presence > hats[xmlns="${Yv.NS.MUC_HATS}"] hat`,e).map((e=>({title:e.getAttribute("title"),uri:e.getAttribute("uri")}))),...s_(e,"presence"),...o_(e,i)};return await hm.hook("parseMUCPresence",e,r)}(e,this);t.codes.forEach((async e=>{if(this.createInfoMessageFromPresence(e,t),t.is_self&&Ov.includes(e)&&(this.save("nick",t.nick),"303"===e&&hm.settings.get("auto_register_muc_nickname")&&await hm.disco.supports(ft.NS.MUC_REGISTER,this.get("jid"))))try{await this.registerNickname()}catch(e){Ct.error(e),Ct.error("Error: could not register new nickname")}})),t.is_self?(this.onOwnPresence(t),"none"!==this.getOwnRole()&&this.session.get("connection_status")===Qv.CONNECTING&&this.session.save("connection_status",Qv.CONNECTED)):this.updateOccupantsOnPresence(t)}async onOwnPresence(e){if(await this.occupants.fetched,"unavailable"===e.type)return void this.handleDisconnection(e);const t=this.session.get("connection_status");t!==Qv.ENTERED&&t!==Qv.CLOSING?(this.session.save("connection_status",Qv.ENTERED,{silent:!0}),this.updateOccupantsOnPresence(e),this.session.trigger("change:connection_status",this.session,t)):this.updateOccupantsOnPresence(e);e.codes.includes("201")&&(this.get("auto_configure")?await this.autoConfigureChatRoom().then((()=>this.refreshDiscoInfo())):hm.settings.get("muc_instant_rooms")?await this.sendConfiguration().then((()=>this.refreshDiscoInfo())):hm.modal.show("converse-muc-config-modal",{model:this}))}isUserMentioned(e){const t=this.get("nick");if(e.get("references").length){return e.get("references").filter((e=>"mention"===e.type)).map((e=>e.value)).includes(t)}return new RegExp(`\\b${t}\\b`).test(e.get("body"))}incrementUnreadMsgsCounter(e){const t={num_unread_general:this.get("num_unread_general")+1};0===this.get("num_unread_general")&&(t.first_unread_id=e.get("id")),this.isUserMentioned(e)&&(t.num_unread=this.get("num_unread")+1),this.save(t)}async clearUnreadMsgCounter(){(this.get("num_unread_general")>0||this.get("num_unread")>0||this.get("has_activity"))&&await this.sendMarkerForMessage(this.messages.last()),Sf(this,{has_activity:!1,num_unread:0,num_unread_general:0})}}const Z_=X_,{Strophe:eb,stx:tb}=Cf.env;class sb extends(j_(wv(fd))){constructor(e,t){super(e,t),this.vcard=null}async initialize(){await super.initialize(),await this.fetchMessages(),this.on("change:nick",(()=>this.setColor())),this.on("change:jid",(()=>this.setColor())),this.on("change:chat_state",(()=>Of(this.get("jid"),this.get("chat_state"))))}defaults(){return{hats:[],show:"offline",states:[],hidden:!0,num_unread:0,message_type:"chat"}}save(e,t,s){let n;return null==e?super.save(e,t,s):("object"==typeof e?(n=e,s=t):(n={})[e]=t,n.occupant_id&&(n.id=n.occupant_id),super.save(n,s))}getMessagesCollection(){return new Ev}async onMessage(e){if(Ef.isErrorObject(e)){const{stanza:t,message:s}=e;return t&&Ct.error(t),Ct.error(s)}const t=e;if("error"===t.type&&!await this.shouldShowErrorMessage(t))return;const s=this.getDuplicateMessage(t);if(s)this.updateMessage(s,t);else if(!await this.handleRetraction(t)&&(this.setEditable(t,t.time),R_(t))){const e=await this.handleCorrection(t)||await this.createMessage(t);this.handleUnreadMessage(e)}}getDisplayName(){return this.get("nick")||this.get("jid")||""}getAssignableRoles(){let e=hm.settings.get("modtools_disable_assign");return Array.isArray(e)||(e=e?zv:[]),"moderator"===this.get("role")?zv.filter((t=>!e.includes(t))):[]}getAssignableAffiliations(){let e=hm.settings.get("modtools_disable_assign");return Array.isArray(e)||(e=e?Iv:[]),"owner"===this.get("affiliation")?Iv.filter((t=>!e.includes(t))):"admin"===this.get("affiliation")?Iv.filter((t=>!["owner","admin",...e].includes(t))):[]}isMember(){return["admin","owner","member"].includes(this.get("affiliation"))}isModerator(){return["admin","owner"].includes(this.get("affiliation"))||"moderator"===this.get("role")}isSelf(){return this.get("states").includes("110")}async getOutgoingMessageAttributes(e){const t=Ef.getUniqueId(),s=e?.body,n=s?Ef.shortnamesToUnicode(s):void 0,i=this.collection.chatroom,r=i.getOwnOccupant();return e=Object.assign({},e,{body:n,from:r.get("from"),fullname:Bu.state.xmppstatus.get("fullname"),id:t,jid:this.get("jid"),message:n,msgid:t,nick:r.get("nickname"),origin_id:t,sender:"me",time:(new Date).toISOString(),to:this.get("from")??`${i.get("jid")}/${this.get("nick")}`,type:"chat"},Ef.getMediaURLsMetadata(s)),e=await hm.hook("getOutgoingMessageAttributes",this,e)}async createMessageStanza(e){const t=await super.createMessageStanza(e);return t.cnode(tb`<x xmlns="${eb.NS.MUC}#user"/>`).root(),t}}const nb=sb,{u:ib}=Cf.env;class rb extends Fd{constructor(e,t){super(e,Object.assign({comparator:D_},t)),this.chatroom=null}get model(){return nb}initialize(){this.on("change:nick",(()=>this.sort())),this.on("change:role",(()=>this.sort()))}static getAutoFetchedAffiliationLists(){const e=hm.settings.get("muc_fetch_members");return Array.isArray(e)?e:e?["member","admin","owner"]:[]}create(e,t){return e.id||e instanceof fd||(e.id=e.occupant_id||xf()),super.create(e,t)}async fetchMembers(){if(!["member","admin","owner"].includes(this.getOwnOccupant()?.get("affiliation")))return;const e=rb.getAutoFetchedAffiliationLists();if(0===e.length)return;const t=this.chatroom.get("jid"),s=await Promise.all(e.map((e=>d_(e,t)))),n=s.reduce(((e,t)=>t instanceof Error?(Ct.error(t),e):[...t,...e]),[]),i=e.filter((t=>!ib.isErrorObject(s[e.indexOf(t)]))),r=n.map((e=>e.jid)).filter((e=>void 0!==e)),o=n.map((e=>!e.jid&&e.nick||void 0)).filter((e=>void 0!==e)),a=this.filter((e=>i.includes(e.get("affiliation"))&&!o.includes(e.get("nick"))&&!r.includes(e.get("jid")))),c=Bu.session.get("bare_jid");a.forEach((e=>{e.get("jid")!==c&&("offline"===e.get("show")?e.destroy():e.save("affiliation",null))})),n.forEach((e=>{const t=this.findOccupant(e);t?t.save(e):this.create(e)})),hm.trigger("membersFetched")}findOccupant(e){if(e.occupant_id)return this.get(e.occupant_id);const t=e.jid&&ft.getBareJidFromJid(e.jid);return t&&this.findWhere({jid:t})||e.nick&&this.findWhere({nick:e.nick})}getOwnOccupant(){const e=Bu.session.get("bare_jid");return this.findOccupant({jid:e,occupant_id:this.chatroom.get("occupant_id")})}}const ob=rb,{Strophe:ab,u:cb}=Cf.env;class lb extends(j_(_v(wv(O_)))){defaults(){return{bookmarked:!1,hidden:nu()&&!hm.settings.get("singleton"),message_type:"chat",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:new Date(0).toISOString(),type:ku}}constructor(e,t){super(e,t),this.disable_mam=!1}async initialize(){super.initialize(),this.initialized=hc();const e=this.get("jid"),{presences:t}=Bu.state;this.presence=t.get(e)||t.create({jid:e}),await this.setModelContact(e),this.presence.on("change:show",(e=>this.onPresenceChanged(e))),this.on("change:chat_state",(()=>Of(this.get("jid"),this.get("chat_state")))),this.on("change:hidden",(()=>this.get("hidden")&&this.setChatState(Au))),await this.fetchMessages(),await hm.trigger("chatBoxInitialized",this,{Synchronous:!0}),this.initialized.resolve()}async onMessage(e){if(cb.isErrorObject(e)){const{stanza:t,message:s}=e;return t&&Ct.error(t),Ct.error(s)}const t=e,s=this.getDuplicateMessage(t);if(s)this.updateMessage(s,t);else if(!this.handleReceipt(t)&&!this.handleChatMarker(t)&&!await this.handleRetraction(t)&&(this.setEditable(t,t.time),t.chat_state&&"them"===t.sender&&this.notifications.set("chat_state",t.chat_state),cb.shouldCreateMessage(t))){const e=await this.handleCorrection(t)||await this.createMessage(t);this.notifications.set({chat_state:null}),this.handleUnreadMessage(e)}}onPresenceChanged(e){const{__:t}=Bu,s=e.get("show"),n=this.getDisplayName();let i;"offline"===s?i=t("%1$s has gone offline",n):"away"===s?i=t("%1$s has gone away",n):"dnd"===s?i=t("%1$s is busy",n):"online"===s&&(i=t("%1$s is online",n)),i&&this.createMessage({message:i,type:"info",is_ephemeral:!0})}async close(){hm.connection.connected()&&(this.setChatState(Au),Of(this.get("jid"),this.get("chat_state"))),await super.close()}getDisplayName(){return this.contact?this.contact.getDisplayName():this.vcard?this.vcard.getDisplayName():this.get("jid")}isSameUser(e,t){return cb.isSameBareJID(e,t)}handleChatMarker(e){if(ab.getBareJidFromJid(e.to)!==Bu.session.get("bare_jid"))return!1;if(e.is_markable)return!this.contact||["none","to"].includes(this.contact.get("subscription"))||e.is_archived||e.is_carbon||Tf(e.from,e.msgid,"received"),!1;if(e.marker_id){const t=this.messages.findWhere({msgid:e.marker_id}),s=`marker_${e.marker}`;return t&&!t.get(s)&&t.save({field_name:(new Date).toISOString()}),!0}}async getOutgoingMessageAttributes(e){const t=!!this.get("composing_spoiler"),s=cb.getUniqueId(),n=e?.body,i=n?cb.shortnamesToUnicode(n):void 0;return e=Object.assign({},e,{body:i,from:Bu.session.get("jid"),fullname:Bu.state.xmppstatus.get("fullname"),id:s,is_spoiler:t,jid:this.get("jid"),message:i,msgid:s,nick:this.get("nickname"),origin_id:s,sender:"me",time:(new Date).toISOString(),type:this.get("message_type")},cb.getMediaURLsMetadata(n)),e=await hm.hook("getOutgoingMessageAttributes",this,e)}canPostMessages(){return!0}}const db=lb;const ub=class extends Fd{constructor(){super(),this.comparator="time",this.model=Av,this.fetched=null,this.chatbox=null}},hb={chats:{async create(e,t){if("string"==typeof e){if(t&&!t?.fullname){const s=await hm.contacts.get(e);t.fullname=s?.attributes?.fullname}const s=hm.chats.get(e,t,!0);return s||void Ct.error("Could not open chatbox for JID: "+e)}return Array.isArray(e)?Promise.all(e.map((async s=>{const n=await hm.contacts.get(e);return t.fullname=n?.attributes?.fullname,hm.chats.get(s,t,!0).maybeShow()}))):(Ct.error("chats.create: You need to provide at least one JID"),null)},async open(e,t,s){if("string"==typeof e){const n=await hm.chats.get(e,t,!0);return n?n.maybeShow(s):n}if(Array.isArray(e))return Promise.all(e.map((e=>hm.chats.get(e,t,!0).then((e=>e&&e.maybeShow(s))))).filter((e=>e)));const n="chats.open: You need to provide at least one JID";throw Ct.error(n),new Error(n)},async get(e,t={},s=!1){async function n(e){let n=await hm.chatboxes.get(e);return!n&&s?n=await hm.chatboxes.create(e,t,Bu.exports.ChatBox):(n=n&&n.get("type")===ku?n:null,n&&Object.keys(t).length&&n.save(t)),n}if(await hm.waitUntil("chatBoxesFetched"),void 0===e){return(await hm.chatboxes.get()).filter((e=>e.get("type")===ku))}return"string"==typeof e?n(e):Promise.all(e.map((e=>n(e))))}}};Cf.plugins.add("converse-chat",{dependencies:["converse-chatboxes","converse-disco"],initialize(){hm.settings.extend({allow_message_corrections:"all",allow_message_retraction:"all",allow_message_styling:!0,auto_join_private_chats:[],clear_messages_on_reconnection:!1,filter_by_resource:!1,prune_messages_above:void 0,pruning_behavior:"unscrolled",send_chat_markers:["received","displayed","acknowledged"],send_chat_state_notifications:!0});const e={ChatBox:db,Message:Av,Messages:ub,handleMessageStanza:x_};Object.assign(Bu,e),Object.assign(Bu.exports,e),Object.assign(hm,hb),Yh.registry.add(ku,db),y_(),addEventListener("hashchange",y_),hm.listen.on("chatBoxesFetched",S_),hm.listen.on("presencesInitialized",A_),hm.listen.on("clearSession",w_),hm.listen.on("connected",(()=>E_())),hm.listen.on("reconnected",(()=>E_()))}});const{Strophe:mb}=Cf.env;const gb=class extends fd{get idAttribute(){return"jid"}initialize(e,t){super.initialize(),this.waitUntilFeaturesDiscovered=hc(),this.dataforms=new Fd;let s=`converse.dataforms-${this.get("jid")}`;this.dataforms.browserStorage=Xu(s,"session"),this.features=new Fd,s=`converse.features-${this.get("jid")}`,this.features.browserStorage=Xu(s,"session"),this.listenTo(this.features,"add",this.onFeatureAdded),this.fields=new Fd,s=`converse.fields-${this.get("jid")}`,this.fields.browserStorage=Xu(s,"session"),this.listenTo(this.fields,"add",this.onFieldAdded),this.identities=new Fd,s=`converse.identities-${this.get("jid")}`,this.identities.browserStorage=Xu(s,"session"),this.fetchFeatures(t)}async getIdentity(e,t){return await this.waitUntilFeaturesDiscovered,this.identities.findWhere({category:e,type:t})}async getFeature(e){if(await this.waitUntilFeaturesDiscovered,this.features.findWhere({var:e}))return this}onFeatureAdded(e){e.entity=this,hm.trigger("serviceDiscovered",e)}onFieldAdded(e){e.entity=this,hm.trigger("discoExtensionFieldDiscovered",e)}async fetchFeatures(e){if(e.ignore_cache)this.queryInfo();else{const e=this.features.browserStorage.name,t=await this.features.browserStorage.store.getItem(e);t&&0===t.length||null===t?this.queryInfo():(this.features.fetch({add:!0,success:()=>{this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}}),this.identities.fetch({add:!0}))}}async queryInfo(){let e;try{e=await hm.disco.info(this.get("jid"),null)}catch(e){return null===e?Ct.error(`Timeout for disco#info query for ${this.get("jid")}`):Ct.error(e),void this.waitUntilFeaturesDiscovered.resolve(this)}this.onInfo(e)}onDiscoItems(e){q()(`query[xmlns="${mb.NS.DISCO_ITEMS}"] item`,e).forEach((e=>{if(e.getAttribute("node"))return;const t=e.getAttribute("jid"),s=Bu.state.disco_entities.get(t);s?s.set({parent_jids:[this.get("jid")]}):hm.disco.entities.create({jid:t,parent_jids:[this.get("jid")],name:e.getAttribute("name")})}))}async queryForItems(){if(0===this.identities.where({category:"server"}).length)return;const e=await hm.disco.items(this.get("jid"));this.onDiscoItems(e)}async onInfo(e){Array.from(e.querySelectorAll("identity")).forEach((e=>{this.identities.create({category:e.getAttribute("category"),type:e.getAttribute("type"),name:e.getAttribute("name")})})),q()(`x[type="result"][xmlns="${mb.NS.XFORM}"]`,e).forEach((e=>{const t={};q()("field",e).forEach((e=>{t[e.getAttribute("var")]={value:e.querySelector("value")?.textContent,type:e.getAttribute("type")}})),this.dataforms.create(t)})),e.querySelector(`feature[var="${mb.NS.DISCO_ITEMS}"]`)&&await this.queryForItems(),Array.from(e.querySelectorAll("feature")).forEach((t=>{this.features.create({var:t.getAttribute("var"),from:e.getAttribute("from")})})),q()('x[type="result"][xmlns="jabber:x:data"] field',e).forEach((t=>{this.fields.create({var:t.getAttribute("var"),value:t.querySelector("value")?.textContent,from:e.getAttribute("from")})})),this.waitUntilFeaturesDiscovered.resolve(this),this.trigger("featuresDiscovered")}};const pb=class extends Fd{constructor(){super(),this.model=gb}fetchEntities(){return new Promise(((e,t)=>{this.fetch({add:!0,success:e,error(e,s){Ct.error(s),t(new Error("Could not fetch disco entities"))}})}))}},{Strophe:fb,$iq:vb}=Cf.env,_b={disco:{stream:{async getFeature(e,t){await hm.waitUntil("streamFeaturesAdded");const s=Bu.state.stream_features;if(!e||!t)throw new Error("name and xmlns need to be provided when calling disco.stream.getFeature");if(void 0!==s||hm.connection.connected())return s.findWhere({name:e,xmlns:t});{const s=`Tried to get feature ${e} ${t} but stream_features has been torn down`;Ct.warn(s)}}},own:{identities:{add(e,t,s,n){const i=Bu.state.disco;for(var r=0;r<i._identities.length;r++)if(i._identities[r].category==e&&i._identities[r].type==t&&i._identities[r].name==s&&i._identities[r].lang==n)return!1;i._identities.push({category:e,type:t,name:s,lang:n})},clear(){Bu.state.disco._identities=[]},get:()=>Bu.state.disco._identities},features:{add(e){const t=Bu.state.disco;for(let s=0;s<t._features.length;s++)if(t._features[s]==e)return!1;t._features.push(e)},clear(){Bu.state.disco._features=[]},get:()=>Bu.state.disco._features}},info(e,t){const s={xmlns:fb.NS.DISCO_INFO};t&&(s.node=t);const n=vb({from:hm.connection.get().jid,to:e,type:"get"}).c("query",s);return hm.sendIQ(n)},items(e,t){const s={xmlns:fb.NS.DISCO_ITEMS};return t&&(s.node=t),hm.sendIQ(vb({from:hm.connection.get().jid,to:e,type:"get"}).c("query",s))},entities:{async get(e,t=!1){await hm.waitUntil("discoInitialized");const s=Bu.state.disco_entities;if(!e)return s;if(void 0===s)return void Ct.warn(`Tried to look up entity ${e} but disco_entities has been torn down`);const n=s.get(e);return n||!t?n:hm.disco.entities.create({jid:e})},items:e=>Bu.state.disco_entities.filter((t=>t.get("parent_jids")?.includes(e))),create:(e,t)=>Bu.state.disco_entities.create(e,t)},features:{async get(e,t){if(!t)throw new TypeError("api.disco.features.get: You need to provide an entity JID");const s=await hm.disco.entities.get(t,!0);if(void 0===Bu.state.disco_entities&&!hm.connection.connected())return Ct.warn(`Tried to get feature ${e} for ${t} but _converse.disco_entities has been torn down`),[];const n=[s.getFeature(e),...hm.disco.entities.items(t).map((t=>t.getFeature(e)))];return(await Promise.all(n)).filter((e=>e instanceof Object))},async has(e,t){if(!t)throw new TypeError("api.disco.feature.has: You need to provide an entity JID");const s=await hm.disco.entities.get(t,!0);if(void 0===Bu.state.disco_entities&&!hm.connection.connected())return Ct.warn(`Tried to check if ${t} supports feature ${e}`),!1;if(await s.getFeature(e))return!0;const n=await Promise.all(hm.disco.entities.items(t).map((t=>t.getFeature(e))));return n.map((e=>e instanceof Object)).includes(!0)}},supports(e,t){try{return hm.disco.features.has(e,t)}catch(e){return Ct.error(e),!1}},async refresh(e){if(!e)throw new TypeError("api.disco.refresh: You need to provide an entity JID");await hm.waitUntil("discoInitialized");let t=await hm.disco.entities.get(e);return t?(t.features.reset(),t.fields.reset(),t.identities.reset(),t.waitUntilFeaturesDiscovered.isPending||(t.waitUntilFeaturesDiscovered=hc()),t.queryInfo()):t=await hm.disco.entities.create({jid:e},{ignore_cache:!0}),t.waitUntilFeaturesDiscovered},async getFeatures(e){if(!e)throw new TypeError("api.disco.getFeatures: You need to provide an entity JID");await hm.waitUntil("discoInitialized");let t=await hm.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.features},async getFields(e){if(!e)throw new TypeError("api.disco.getFields: You need to provide an entity JID");await hm.waitUntil("discoInitialized");let t=await hm.disco.entities.get(e,!0);return t=await t.waitUntilFeaturesDiscovered,t.fields},async getIdentity(e,t,s){const n=await hm.disco.entities.get(s,!0);if(void 0!==n||hm.connection.connected())return n.getIdentity(e,t);{const t=`Tried to look up category ${e} for ${s} but _converse.disco_entities has been torn down`;Ct.warn(t)}}}},{Strophe:bb,$iq:yb}=Cf.env;async function wb(){hm.disco.own.identities.add("client","web","Converse"),hm.disco.own.features.add(bb.NS.CHATSTATES),hm.disco.own.features.add(bb.NS.DISCO_INFO),hm.disco.own.features.add(bb.NS.ROSTERX),hm.disco.own.features.add(bb.NS.CARBONS),hm.trigger("addClientFeatures"),hm.connection.get().addHandler((e=>function(e){const t=e.getElementsByTagName("query")[0].getAttribute("node"),s={xmlns:bb.NS.DISCO_INFO};t&&(s.node=t);const n=yb({type:"result",id:e.getAttribute("id")}),i=e.getAttribute("from");return null!==i&&n.attrs({to:i}),n.c("query",s),Bu.state.disco._identities.forEach((e=>{const t={category:e.category,type:e.type};e.name&&(t.name=e.name),e.lang&&(t["xml:lang"]=e.lang),n.c("identity",t).up()})),Bu.state.disco._features.forEach((e=>n.c("feature",{var:e}).up())),hm.send(n.tree()),!0}(e)),bb.NS.DISCO_INFO,"iq","get",null,null);const e=new Bu.exports.DiscoEntities;Object.assign(Bu,{disco_entities:e}),Object.assign(Bu.state,{disco_entities:e});const t=`converse.disco-entities-${Bu.session.get("bare_jid")}`;e.browserStorage=Xu(t,"session");const s=await e.fetchEntities(),n=Bu.session.get("domain");0!==s.length&&s.get(n)||hm.disco.entities.create({jid:n},{ignore_cache:!0}),hm.trigger("discoInitialized")}function Sb(){if(!Bu.state.stream_features){const e=`converse.stream-features-${Bu.session.get("bare_jid")}`;hm.promises.add("streamFeaturesAdded");const t=new Fd;t.browserStorage=Xu(e,"session"),Object.assign(Bu,{stream_features:t}),Object.assign(Bu.state,{stream_features:t})}}function Ab(){hm.trigger("streamFeaturesAdded")}function xb(){Sb(),Array.from(hm.connection.get().features.childNodes).forEach((e=>{Bu.state.stream_features.create({name:e.nodeName,xmlns:e.getAttribute("xmlns")})})),Ab()}function Eb(){const{disco_entities:e}=Bu.state;e?.forEach((e=>e.features.clearStore())),e?.forEach((e=>e.identities.clearStore())),e?.forEach((e=>e.dataforms.clearStore())),e?.forEach((e=>e.fields.clearStore())),e?.clearStore(),delete Bu.state.disco_entities,Object.assign(Bu,{disco_entities:void 0})}const{Strophe:$b}=Cf.env;Cf.plugins.add("converse-disco",{initialize(){Object.assign(hm,_b),hm.promises.add("discoInitialized"),hm.promises.add("streamFeaturesAdded");const e={DiscoEntity:gb,DiscoEntities:pb};Object.assign(Bu,e),Object.assign(Bu.exports,e);const t={_identities:[],_features:[]};Object.assign(Bu,{disco:t}),Object.assign(Bu.state,{disco:t}),hm.listen.on("userSessionInitialized",(async()=>{Sb(),Bu.state.connfeedback.get("connection_status")===$b.Status.ATTACHED&&(await new Promise(((e,t)=>Bu.state.stream_features.fetch({success:e,error:t}))),Ab())})),hm.listen.on("beforeResourceBinding",xb),hm.listen.on("reconnected",wb),hm.listen.on("connected",wb),hm.listen.on("beforeTearDown",(async()=>{hm.promises.add("streamFeaturesAdded");const{stream_features:e}=Bu.state;e&&(await e.clearStore(),delete Bu.state.stream_features,Object.assign(Bu,{stream_features:void 0}))})),hm.listen.on("will-reconnect",Eb),hm.listen.on("clearSession",Eb)}});const Cb={affiliations:{set:(e,t)=>(t=Array.isArray(t)?t:[t],u_(e=Array.isArray(e)?e:[e],t)),get:(e,t)=>d_(e,t)}};Cf.AFFILIATION_CHANGES=Uv,Cf.AFFILIATION_CHANGES_LIST=Bv,Cf.MUC_TRAFFIC_STATES=qv,Cf.MUC_TRAFFIC_STATES_LIST=Hv,Cf.MUC_ROLE_CHANGES=Gv,Cf.MUC_ROLE_CHANGES_LIST=Wv,Cf.MUC={INFO_CODES:Vv},Cf.MUC_NICK_CHANGED_CODE=Jv,Cf.ROOM_FEATURES=Kv,Cf.ROOMSTATUS=Qv;const{Strophe:kb}=Cf.env;kb.addNamespace("MUC_ADMIN",kb.NS.MUC+"#admin"),kb.addNamespace("MUC_OWNER",kb.NS.MUC+"#owner"),kb.addNamespace("MUC_REGISTER","jabber:iq:register"),kb.addNamespace("MUC_ROOMCONF",kb.NS.MUC+"#roomconfig"),kb.addNamespace("MUC_USER",kb.NS.MUC+"#user"),kb.addNamespace("MUC_HATS","xmpp:prosody.im/protocol/hats:1"),kb.addNamespace("CONFINFO","urn:ietf:params:xml:ns:conference-info"),Cf.plugins.add("converse-muc",{dependencies:["converse-chatboxes","converse-chat","converse-disco"],initialize(){const{__:e,___:t}=Bu;if(hm.settings.extend({allow_muc_invitations:!0,auto_join_on_invite:!1,auto_join_rooms:[],auto_register_muc_nickname:!0,colorize_username:!1,hide_muc_participants:!1,locked_muc_domain:!1,modtools_disable_assign:!1,muc_clear_messages_on_leave:!0,muc_domain:void 0,muc_fetch_members:!0,muc_history_max_stanzas:void 0,muc_instant_rooms:!0,muc_nickname_from_jid:!1,muc_send_probes:!1,muc_show_info_messages:[...Cf.MUC.INFO_CODES.visibility_changes,...Cf.MUC.INFO_CODES.self,...Cf.MUC.INFO_CODES.non_privacy_changes,...Cf.MUC.INFO_CODES.muc_logging_changes,...Cf.MUC.INFO_CODES.nickname_changes,...Cf.MUC.INFO_CODES.disconnected,...Cf.MUC.INFO_CODES.affiliation_changes,...Cf.MUC.INFO_CODES.join_leave_events,...Cf.MUC.INFO_CODES.role_changes],muc_show_logs_before_join:!1,muc_subscribe_to_rai:!1}),hm.promises.add(["roomsAutoJoined"]),hm.settings.get("locked_muc_domain")&&"string"!=typeof hm.settings.get("muc_domain"))throw new Error("Config Error: it makes no sense to set locked_muc_domain to true when muc_domain is not set");Cf.env.muc_utils={computeAffiliationsDelta:m_},Object.assign(hm,em),Object.assign(hm.rooms,Cb);const s={muc:{STATUS_CODE_MESSAGES:{100:e("This groupchat is not anonymous"),102:e("This groupchat now shows unavailable members"),103:e("This groupchat does not show unavailable members"),104:e("The groupchat configuration has changed"),170:e("Groupchat logging is now enabled"),171:e("Groupchat logging is now disabled"),172:e("This groupchat is now no longer anonymous"),173:e("This groupchat is now semi-anonymous"),174:e("This groupchat is now fully-anonymous"),201:e("A new groupchat has been created"),210:t("Your nickname has been automatically set to %1$s"),301:e("You have been banned from this groupchat"),303:t("Your nickname has been changed to %1$s"),307:e("You have been kicked from this groupchat"),321:e("You have been removed from this groupchat because of an affiliation change"),322:e("You have been removed from this groupchat because it has changed to members-only and you're not a member"),332:e("You have been removed from this groupchat because the service hosting it is being shut down"),333:e("You have exited this groupchat due to a technical problem")}}};Object.assign(Bu.labels,s),Object.assign(Bu,s),F_(),addEventListener("hashchange",F_);const n={ChatRoom:Z_,ChatRoomMessage:xv,ChatRoomMessages:Ev,ChatRoomOccupant:nb,ChatRoomOccupants:ob};Object.assign(Bu,n);const i={MUC:Z_,MUCMessage:xv,MUCMessages:Ev,MUCOccupant:nb,MUCOccupants:ob,getDefaultMUCNickname:B_,isInfoVisible:q_,onDirectMUCInvitation:U_};Object.assign(Bu.exports,i),Object.assign(Bu,i),hm.chatboxes.registry.add(ju,Z_),hm.settings.get("allow_muc_invitations")&&(hm.listen.on("connected",z_),hm.listen.on("reconnected",z_)),hm.listen.on("addClientFeatures",(()=>hm.disco.own.features.add(`${kb.NS.CONFINFO}+notify`))),hm.listen.on("addClientFeatures",G_),hm.listen.on("beforeResourceBinding",Q_),hm.listen.on("beforeTearDown",W_),hm.listen.on("chatBoxesFetched",H_),hm.listen.on("disconnected",L_),hm.listen.on("statusInitialized",V_),document.addEventListener("visibilitychange",P_)}}),Object.assign(Ef,{muc:{isChatRoom:function(e){return"chatroom"===e?.get("type")},setAffiliation:h_}});const{Strophe:jb,stx:Tb}=Cf.env;const Ob=class extends Fd{get idAttribute(){return"jid"}async initialize(){this.on("add",(e=>this.openBookmarkedRoom(e).then((e=>this.markRoomAsBookmarked(e))).catch((e=>Ct.fatal(e))))),this.on("remove",this.leaveRoom,this),this.on("change:autojoin",this.onAutoJoinChanged,this),this.on("remove",this.sendBookmarkStanza,this);const{session:e}=Bu,t=`converse.room-bookmarks${e.get("bare_jid")}`;this.fetched_flag=t+"fetched",Zu(this,t),await this.fetchBookmarks(),hm.trigger("bookmarksInitialized",this)}static async checkBookmarksSupport(){const e=Bu.session.get("bare_jid");if(!e)return!1;const t=await hm.disco.getIdentity("pubsub","pep",e);return hm.settings.get("allow_public_bookmarks")?!!t:hm.disco.supports(jb.NS.PUBSUB+"#publish-options",e)}constructor(){super([],{comparator:e=>e.get("name").toLowerCase()}),this.model=pv}async openBookmarkedRoom(e){if(hm.settings.get("muc_respect_autojoin")&&e.get("autojoin")){(await hm.rooms.create(e.get("jid"),{nick:e.get("nick"),password:e.get("password")})).maybeShow()}return e}fetchBookmarks(){const e=hc();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBookmarksFromServer(e),e}setBookmark(e,t=!0){if(!e.jid)return Ct.warn("No JID provided for setBookmark");let s=!1;const n=this.get(e.jid);if(n){const t=Object.keys(e).reduce(((t,s)=>t||(e[s]??"")!==(n.attributes[s]??"")),!1);t&&(n.save(e),s=!0)}else t&&(this.create(e),s=!0);s&&this.sendBookmarkStanza().catch((t=>this.onBookmarkError(t,e)))}getPublishedItems(e){return e===jb.NS.BOOKMARKS2?this.map((e=>{const t=e.get("extensions")??[];return Tb`<item id="${e.get("jid")}">
                    <conference xmlns="${jb.NS.BOOKMARKS2}"
                                name="${e.get("name")}"
                                autojoin="${e.get("autojoin")}">
                            ${e.get("nick")?Tb`<nick>${e.get("nick")}</nick>`:""}
                            ${e.get("password")?Tb`<password>${e.get("password")}</password>`:""}
                        ${t.length?Tb`<extensions>${t.map((e=>gt.unsafeXML(e)))}</extensions>`:""};
                        </conference>
                    </item>`})):Tb`<item id="current">
                <storage xmlns="${jb.NS.BOOKMARKS}">
                ${this.map((e=>Tb`<conference name="${e.get("name")}" autojoin="${e.get("autojoin")}"
                        jid="${e.get("jid")}">
                        ${e.get("nick")?Tb`<nick>${e.get("nick")}</nick>`:""}
                        ${e.get("password")?Tb`<password>${e.get("password")}</password>`:""}
                    </conference>`))}
                </storage>
            </item>`}async sendBookmarkStanza(){const e=Bu.session.get("bare_jid"),t=await hm.disco.supports(`${jb.NS.BOOKMARKS2}#compat`,e)?jb.NS.BOOKMARKS2:jb.NS.BOOKMARKS;return hm.pubsub.publish(null,t,this.getPublishedItems(t),{persist_items:!0,max_items:"max",send_last_published_item:"never",access_model:"whitelist"})}onBookmarkError(e,t){Ct.error("Error while trying to add bookmark"),Ct.error(e),this.get(t.jid)?.destroy()}async fetchBookmarksFromServer(e){const t=Bu.session.get("bare_jid"),s=await hm.disco.supports(`${jb.NS.BOOKMARKS2}#compat`,t)?jb.NS.BOOKMARKS2:jb.NS.BOOKMARKS,n=Tb`
            <iq type="get" from="${hm.connection.get().jid}" xmlns="jabber:client">
                <pubsub xmlns="${jb.NS.PUBSUB}">
                    <items node="${s}"/>
                </pubsub>
            </iq>`;hm.sendIQ(n).then((t=>this.onBookmarksReceived(e,t))).catch((t=>this.onBookmarksReceivedError(e,t)))}markRoomAsBookmarked(e){const{chatboxes:t}=Bu.state,s=t.get(e.get("jid"));s?.save("bookmarked",!0)}onAutoJoinChanged(e){e.get("autojoin")?this.openBookmarkedRoom(e):this.leaveRoom(e)}async leaveRoom(e){const t=await hm.rooms.get(e.get("jid"));t?.close()}async setBookmarksFromStanza(e){const t=await async function(e){let t,s;const n=Bu.session.get("bare_jid");return await hm.disco.supports(`${fv.NS.BOOKMARKS2}#compat`,n)?(t=fv.NS.BOOKMARKS2,s=`items[node="${t}"] item conference`):(t=fv.NS.BOOKMARKS,s=`items[node="${t}"] item storage[xmlns="${t}"] conference`),vv(s,e).map((e=>{const s=t===fv.NS.BOOKMARKS2?e.parentElement.getAttribute("id"):e.getAttribute("jid");return{jid:s,name:e.getAttribute("name")||s,autojoin:["1","true"].includes(e.getAttribute("autojoin")),nick:e.querySelector("nick")?.textContent??"",password:e.querySelector("password")?.textContent??"",extensions:Array.from(e.querySelector("extensions")?.children??[]).map((e=>e.outerHTML))}}))}(e);t.forEach((e=>{const t=this.get(e.jid);t?t.save(e):this.create(e)}))}async onBookmarksReceived(e,t){if(await this.setBookmarksFromStanza(t),window.sessionStorage.setItem(this.fetched_flag,"true"),void 0!==e)return e.resolve()}onBookmarksReceivedError(e,t){const{__:s}=Bu;if(null===t)Ct.error("Error: timeout while fetching bookmarks"),hm.alert("error",s("Timeout Error"),[s("The server did not return your bookmarks within the allowed time. You can reload the page to request them again.")]);else{if(e)return t.querySelector('error[type="cancel"] item-not-found')?(window.sessionStorage.setItem(this.fetched_flag,"true"),e.resolve()):(Ct.error("Error while fetching bookmarks"),Ct.error(t),e.reject(new Error("Could not fetch bookmarks")));Ct.error("Error while fetching bookmarks"),Ct.error(t)}}async getUnopenedBookmarks(){await hm.waitUntil("bookmarksInitialized"),await hm.waitUntil("chatBoxesFetched");const{chatboxes:e}=Bu.state;return this.filter((t=>!e.get(t.get("jid"))))}};function Nb(e){return hm.waitUntil("bookmarksInitialized").then((()=>Bu.state.bookmarks.setBookmarksFromStanza(e))).catch((e=>Ct.fatal(e))),!0}const{waitUntil:Ib}=yh,Mb={bookmarks:{set:async(e,t=!0)=>(await Ib("bookmarksInitialized")).setBookmark(e,t),get:async e=>(await Ib("bookmarksInitialized")).get(e)}},{Strophe:Rb}=Cf.env;Rb.addNamespace("BOOKMARKS","storage:bookmarks"),Rb.addNamespace("BOOKMARKS2","urn:xmpp:bookmarks:1"),Cf.plugins.add("converse-bookmarks",{dependencies:["converse-chatboxes","converse-muc"],overrides:{ChatRoom:{getDisplayName(){const{_converse:e,getDisplayName:t}=this.__super__,{bookmarks:s}=e.state,n=this.get("bookmarked")?s?.get(this.get("jid")):null;return n?.get("name")||t.apply(this,arguments)},getAndPersistNickname(e){var t;return e=e||(t=this.get("jid"),hm.settings.get("allow_bookmarks")?Bu.state.bookmarks?.get(t)?.get("nick"):null),this.__super__.getAndPersistNickname.call(this,e)}}},initialize(){hm.settings.extend({allow_bookmarks:!0,allow_public_bookmarks:!1,muc_respect_autojoin:!0}),hm.promises.add("bookmarksInitialized"),Object.assign(hm,Mb);const e={Bookmark:pv,Bookmarks:Ob};Object.assign(Bu,e),Object.assign(Bu.exports,e),hm.listen.on("parseMUCPresence",((e,t)=>(t.is_self&&t.codes.includes("303")&&hm.bookmarks.get(t.muc_jid).then((e=>{e||Ct.warn("parseMUCPresence: no bookmark returned");const{nick:s,muc_jid:n}=t;hm.bookmarks.set({jid:n,nick:s,autojoin:e?.get("autojoin")??!0,password:e?.get("password")??"",name:e?.get("name")??"",extensions:e?.get("extensions")??[]})})),t))),hm.listen.on("enteredNewRoom",(async({attributes:e})=>{const{jid:t,nick:s,password:n,name:i}=e;await hm.bookmarks.set({jid:t,autojoin:!0,nick:s,...n?{password:n}:{},...i?{name:i}:{}})})),hm.listen.on("leaveRoom",(async({attributes:e})=>{const{jid:t}=e;await hm.bookmarks.set({jid:t,autojoin:!1},!1)})),hm.listen.on("addClientFeatures",(()=>{hm.settings.get("allow_bookmarks")&&hm.disco.own.features.add(Rb.NS.BOOKMARKS+"+notify")})),hm.listen.on("clearSession",(()=>{const{state:e}=Bu;e.bookmarks&&(e.bookmarks.clearStore({silent:!0}),window.sessionStorage.removeItem(e.bookmarks.fetched_flag),delete e.bookmarks)})),hm.listen.on("connected",(async()=>{const e=Bu.session.get("bare_jid"),t=hm.connection.get();t.addHandler(Nb,Rb.NS.BOOKMARKS,"message","headline",null,e),t.addHandler(Nb,Rb.NS.BOOKMARKS2,"message","headline",null,e),await Promise.all([hm.waitUntil("chatBoxesFetched")]),async function(){hm.settings.get("allow_bookmarks")&&await Ob.checkBookmarksSupport()&&(Bu.state.bookmarks=new Bu.exports.Bookmarks,Object.assign(Bu,{bookmarks:Bu.state.bookmarks}))}()}))}});const{Strophe:Db}=Cf.env;const zb=class extends fd{get idAttribute(){return"jid"}getDisplayName(){return Db.xmlunescape(this.get("name"))}},{stx:Lb,u:Pb}=Cf.env;const Fb=class extends Fd{get idAttribute(){return"jid"}constructor(){super(),this.model=zb}async initialize(){const{session:e}=Bu,t=`converse.blocklist-${e.get("bare_jid")}`;this.fetched_flag=`${t}-fetched`,Zu(this,t),this.on("add",this.rejectContactRequest),await this.fetchBlocklist(),hm.trigger("blocklistInitialized",this)}async rejectContactRequest(e){const t=(await hm.waitUntil("rosterContactsFetched")).get(e.get("jid"));if(t?.get("requesting")){const e=await hm.chats.get(t.get("jid"));e?.close(),t.unauthorize().destroy()}}fetchBlocklist(){const e=hc();return window.sessionStorage.getItem(this.fetched_flag)?this.fetch({success:()=>e.resolve(),error:()=>e.resolve()}):this.fetchBlocklistFromServer(e),e}async fetchBlocklistFromServer(e){const t=Lb`<iq xmlns="jabber:client"
            type="get"
            id="${Pb.getUniqueId()}"><blocklist xmlns="urn:xmpp:blocking"/></iq>`;try{this.onBlocklistReceived(e,await hm.sendIQ(t))}catch(t){return Ct.error(t),void e.resolve()}}async onBlocklistReceived(e,t){if(Array.from(t.querySelectorAll("blocklist item")).forEach((e=>{const t=e.getAttribute("jid"),s=this.get(t);s?s.save({jid:t}):this.create({jid:t})})),window.sessionStorage.setItem(this.fetched_flag,"true"),void 0!==e)return e.resolve()}},{Strophe:Ub,stx:Bb,u:qb}=Cf.env;const{waitUntil:Hb}=yh,Gb={blocklist:{get:async()=>await Hb("blocklistInitialized"),async add(e,t=!0){const s=await Hb("blocklistInitialized"),n=Array.isArray(e)?e:[e];return t&&await async function(e){const t=Array.isArray(e)?e:[e],s=Bb`
        <iq xmlns="jabber:client" type="set" id="${qb.getUniqueId()}">
            <block xmlns="${Ub.NS.BLOCKING}">
                ${t.map((e=>Bb`<item jid="${e}"/>`))}
            </block>
        </iq>`;await Vh.sendIQ(s)}(n),n.forEach((e=>s.create({jid:e}))),s},async remove(e,t=!0){const s=await Hb("blocklistInitialized"),n=Array.isArray(e)?e:[e];return t&&await async function(e){const t=Array.isArray(e)?e:[e],s=Bb`
        <iq xmlns="jabber:client" type="set" id="${qb.getUniqueId()}">
            <unblock xmlns="${Ub.NS.BLOCKING}">
                ${t.map((e=>Bb`<item jid="${e}"/>`))}
            </unblock>
        </iq>`;await Vh.sendIQ(s)}(n),s.remove(n),s}}},{Strophe:Wb,sizzle:Vb}=Cf.env;Wb.addNamespace("BLOCKING","urn:xmpp:blocking"),Cf.plugins.add("converse-blocklist",{dependencies:["converse-disco"],initialize(){const e={Blocklist:Fb,BlockedEntity:zb};Object.assign(Bu.exports,e),Object.assign(hm,Gb),hm.promises.add(["blocklistInitialized"]),hm.listen.on("getErrorAttributesForMessage",((e,t)=>{if(e.errors.find((e=>"blocked"===e.name&&e.xmlns===`${Wb.NS.BLOCKING}:errors`))){const{__:e}=Bu;t.error=e("You are blocked from sending messages.")}return t})),hm.listen.on("connected",(()=>{hm.connection.get().addHandler((e=>{const t=Bu.session.get("bare_jid"),s=e.getAttribute("from");if(Wb.getBareJidFromJid(s??t)!=t)return Ct.warn(`Received a blocklist push stanza from a suspicious JID ${s}`),!0;const n=Vb(`block[xmlns="${Wb.NS.BLOCKING}"] item`,e).map((e=>e.getAttribute("jid")));n.length&&hm.blocklist.add(n,!1);const i=Vb(`unblock[xmlns="${Wb.NS.BLOCKING}"] item`,e).map((e=>e.getAttribute("jid")));return i.length&&hm.blocklist.remove(i,!1),!0}),Wb.NS.BLOCKING,"iq","set")})),hm.listen.on("clearSession",(()=>{const{state:e}=Bu;e.blocklist&&(e.blocklist.clearStore({silent:!0}),window.sessionStorage.removeItem(e.blocklist.fetched_flag),delete e.blocklist)})),hm.listen.on("discoInitialized",(async()=>{const e=Bu.session.get("domain");await hm.disco.supports(Wb.NS.BLOCKING,e)&&(Bu.state.blocklist=new Bu.exports.Blocklist)}))}});const Qb={tokens:{get(e){const t=hm.connection.get();return t?"rid"===e.toLowerCase()?t.rid||t._proto.rid:"sid"===e.toLowerCase()?t.sid||t._proto.sid:void 0:null}}},Kb="converse.bosh-session";let Jb;async function Yb(e,t){if(t.success)return t;const{automatic:s}=t;return await async function(){const e=(await async function(){const e=Kb;Jb||(Jb=new fd({id:e}),Jb.browserStorage=Xu(e,"session"),await new Promise((e=>Jb.fetch({success:e,error:e}))));let t=Bu.session.get("jid");if(t)Jb.get("jid")!==t&&(t=await ah(t),Jb.clear({silent:!0}),Jb.save({jid:t}));else{const e=Jb.get("jid");e&&await ah(e)}return Jb}()).get("jid"),t=hm.connection.get();if(e&&t._proto instanceof ft.Bosh)try{return t.restore(e,t.onConnectStatusChanged),!0}catch(t){return!iu()&&Ct.warn("Could not restore session for jid: "+e+" Error message: "+t.message),!1}return!1}()?{...t,success:!0}:hm.settings.get("authentication")!==yu||s&&!hm.settings.get("auto_login")?t:(function(){if(!hm.settings.get("prebind_url"))throw new Error("startNewPreboundBOSHSession: If you use prebind then you MUST supply a prebind_url");const e=hm.connection.get(),t=new XMLHttpRequest;t.open("GET",hm.settings.get("prebind_url"),!0),t.setRequestHeader("Accept","application/json, text/javascript"),t.onload=async function(s){if(t.status>=200&&t.status<400){const s=JSON.parse(t.responseText),n=await ah(s.jid);e.attach(n,s.sid,s.rid,e.onConnectStatusChanged,du)}else t.onerror(s)},t.onerror=function(){hm.connection.destroy(),hm.trigger("noResumeableBOSHSession",Bu)},t.send()}(),{...t,success:!0})}function Xb(){void 0!==Jb&&Jb.save({jid:Bu.session.get("jid")})}function Zb(){if(void 0===Jb){const e=Kb;sessionStorage.removeItem(e),sessionStorage.removeItem(`${e}-${e}`)}else Jb.destroy(),Jb=void 0}Cf.plugins.add("converse-bosh",{enabled:()=>!Bu.api.settings.get("blacklisted_plugins").includes("converse-bosh"),initialize(){hm.settings.extend({bosh_service_url:void 0,prebind_url:null}),Object.assign(hm,Qb),hm.listen.on("clearSession",Zb),hm.listen.on("setUserJID",Xb),hm.listen.on("login",Yb),hm.listen.on("addClientFeatures",(()=>hm.disco.own.features.add(ft.NS.BOSH)))}});const{Strophe:ey,$build:ty}=Cf.env;function sy(e,t){return e.sort(((e,s)=>e[t]>s[t]?-1:1))}async function ny(){const e=Bu.api.disco.own.identities.get(),t=Bu.api.disco.own.features.get();e.length>1&&(sy(e,"category"),sy(e,"type"),sy(e,"lang"));let s=e.reduce(((e,t)=>`${e}${t.category}/${t.type}/${t?.lang??""}/${t.name}<`),"");t.sort(),s=t.reduce(((e,t)=>`${e}${t}<`),s);return Bp(await crypto.subtle.digest("SHA-1",Up(s)))}async function iy(e){const t=await async function(){return ty("c",{xmlns:ey.NS.CAPS,hash:"sha-1",node:"https://conversejs.org",ver:await ny()}).tree()}();return e.root().cnode(t).up(),e}const{Strophe:ry}=Cf.env;ry.addNamespace("CAPS","http://jabber.org/protocol/caps"),Cf.plugins.add("converse-caps",{dependencies:["converse-status"],initialize(){hm.listen.on("constructedPresence",((e,t)=>iy(t))),hm.listen.on("constructedMUCPresence",((e,t)=>iy(t)))}});const oy=class extends Fd{constructor(e,t){super(e,Object.assign({comparator:"time_opened"},t))}onChatBoxesFetched(e){e.filter((e=>!e.isValid())).forEach((e=>e.destroy())),hm.trigger("chatBoxesFetched")}onConnected(e){if(e)return;Zu(this,`converse.chatboxes-${Bu.session.get("bare_jid")}`),this.fetch({add:!0,success:e=>this.onChatBoxesFetched(e)})}createModel(e,t){if(!e.type)throw new Error("You need to specify a type of chatbox to be created");return new(hm.chatboxes.registry.get(e.type))(e,t)}},{Strophe:ay}=Cf.env;Cf.plugins.add("converse-chatboxes",{dependencies:["converse-emoji","converse-roster","converse-vcard"],initialize(){let e;hm.promises.add(["chatBoxesFetched","chatBoxesInitialized","privateChatsAutoJoined"]),Object.assign(hm,{chatboxes:Yh}),Object.assign(Bu,{ChatBoxes:oy}),Object.assign(Bu.exports,{ChatBoxes:oy}),hm.listen.on("addClientFeatures",(()=>{hm.disco.own.features.add(ay.NS.MESSAGE_CORRECT),hm.disco.own.features.add(ay.NS.HTTPUPLOAD),hm.disco.own.features.add(ay.NS.OUTOFBAND)})),hm.listen.on("pluginsInitialized",(()=>{e=new Bu.exports.ChatBoxes,Object.assign(Bu,{chatboxes:e}),Object.assign(Bu.state,{chatboxes:e}),hm.trigger("chatBoxesInitialized")})),hm.listen.on("presencesInitialized",(t=>e.onConnected(t))),hm.listen.on("reconnected",(()=>e.forEach((e=>e.onReconnection()))))}});const{Strophe:cy,u:ly}=Cf.env;function dy(e){const t=q()(`command[xmlns="${cy.NS.ADHOC}"]`,e).pop(),s=t.querySelector("note");return{...Zf(e),sessionid:t.getAttribute("sessionid"),note:s?{text:s.textContent,type:s.getAttribute("type")}:null,actions:Array.from(t.querySelector("actions")?.children??[]).map((e=>e.nodeName.toLowerCase()))}}const{Strophe:uy,$iq:hy,u:my,stx:gy}=Cf.env,py={adhoc:{async getCommands(e){try{return t=await hm.disco.items(e,uy.NS.ADHOC),q()(`query[xmlns="${cy.NS.DISCO_ITEMS}"][node="${cy.NS.ADHOC}"] item`,t).map(ly.getAttributes)}catch(t){return null===t?Ct.error(`Error: timeout while fetching ad-hoc commands for ${e}`):(Ct.error(`Error while fetching ad-hoc commands for ${e}`),Ct.error(t)),[]}var t},async fetchCommandForm(e,t){const s=hy({type:"set",to:e}).c("command",{xmlns:uy.NS.ADHOC,action:"execute",node:t});return dy(await hm.sendIQ(s))},async runCommand(e,t,s,n,i){const r=gy`<iq type="set" to="${e}" xmlns="jabber:client">
                    <command sessionid="${t}" node="${s}" action="${n}" xmlns="${uy.NS.ADHOC}">
                        ${["cancel","prev"].includes(n)?"":gy`
                            <x xmlns="${uy.NS.XFORM}" type="submit">
                                ${i.map((({name:e,value:t})=>gy`<field var="${e}"><value>${t}</value></field>`))}
                            </x>`}
                    </command>
                </iq>`,o=await hm.sendIQ(r,null,!1);if(null===o){Ct.warn("A timeout occurred while trying to run an ad-hoc command");const{__:e}=Bu;return{status:"error",note:e("A timeout occurred")}}my.isErrorStanza(o)&&(Ct.error("Error while trying to execute an ad-hoc command"),Ct.error(o));const a=o.querySelector("command"),c=a?.getAttribute("status");return{status:c,..."executing"===c?dy(o):{},note:o.querySelector("note")?.textContent}}}},{Strophe:fy}=Cf.env;fy.addNamespace("ADHOC","http://jabber.org/protocol/commands"),Cf.plugins.add("converse-adhoc",{dependencies:["converse-disco"],initialize(){Object.assign(this._converse.api,py)}});class vy extends O_{defaults(){return{bookmarked:!1,hidden:nu()&&!hm.settings.get("singleton"),message_type:"headline",num_unread:0,time_opened:this.get("time_opened")||(new Date).getTime(),time_sent:void 0,type:Tu}}constructor(e,t){super(e,t),this.disable_mam=!0}async initialize(){await super.initialize(),await this.fetchMessages(),hm.trigger("headlinesFeedInitialized",this)}canPostMessages(){return!1}}const _y={headlines:{async get(e,t={},s=!1){async function n(e){let n=await hm.chatboxes.get(e);if(!n&&s){const{HeadlinesFeed:s}=Bu.exports;n=await hm.chatboxes.create(e,t,s)}else n=n&&n.get("type")===Tu?n:null,n&&Object.keys(t).length&&n.save(t);return n}if(void 0===e){return(await hm.chatboxes.get()).filter((e=>e.get("type")===Tu))}return"string"==typeof e?n(e):Promise.all(e.map((e=>n(e))))}}};Cf.plugins.add("converse-headlines",{dependencies:["converse-chat"],initialize(){const e={HeadlinesFeed:vy};function t(){hm.connection.get()?.addHandler((e=>(async function(e){if(Qf(e)||Kf(e)){const t=e.getAttribute("from");if(await hm.waitUntil("rosterInitialized"),t.includes("@")&&!Bu.state.roster.get(t)&&!hm.settings.get("allow_non_roster_messaging"))return;if(null===e.querySelector("body"))return;const s=await hm.chatboxes.create(t,{id:t,jid:t,type:Tu,from:t},vy),n=await v_(e);await s.createMessage(n),hm.trigger("message",{chatbox:s,stanza:e,attrs:n})}}(e),!0)),null,"message")}Object.assign(Bu,e),Object.assign(Bu.exports,e),hm.listen.on("connected",t),hm.listen.on("reconnected",t),Object.assign(hm,_y),hm.chatboxes.registry.add(Tu,vy)}});class by extends fd{defaults(){return{msgid:xf(),is_ephemeral:!1}}}const{NS:yy}=ft,wy=Cf.env.utils;async function Sy(e){const t=await If(e);"feature-not-implemented"===t?.name?Ct.warn(`Message Archive Management (XEP-0313) not supported by ${e.getAttribute("from")}`):(Ct.error(`Error while trying to set archiving preferences for ${e.getAttribute("from")}.`),Ct.error(e))}function Ay(e,t){const s=q()(`prefs[xmlns="${yy.MAM}"]`,e).pop();if(s.getAttribute("default")!==hm.settings.get("message_archiving")){const e=Pe({type:"set"}).c("prefs",{xmlns:yy.MAM,default:hm.settings.get("message_archiving")});Array.from(s.children).forEach((t=>e.cnode(t).up())),hm.sendIQ(e).then((()=>t.save({preferences:{default:hm.settings.get("message_archiving")}}))).catch(Bu.exports.onMAMError)}else t.save({preferences:{default:hm.settings.get("message_archiving")}})}function xy(e){const t=e.get("preferences")||{};e.get("var")===yy.MAM&&void 0!==hm.settings.get("message_archiving")&&t.default!==hm.settings.get("message_archiving")&&hm.sendIQ(Pe({type:"get"}).c("prefs",{xmlns:yy.MAM})).then((t=>Bu.exports.onMAMPreferences(t,e))).catch(Bu.exports.onMAMError)}function Ey(e){hm.settings.get("muc_show_logs_before_join")&&e.features.get("mam_enabled")&&!e.get("prejoin_mam_fetched")&&(ky(e),e.save({prejoin_mam_fetched:!0}))}async function $y(e,t,s,n,i){const r=e.get("type")===ju,o=await Promise.all(t.messages.map((t=>r?r_(t,e):v_(t))));t.messages=o;const a={query:s,chatbox:e,messages:o};if(await hm.trigger("MAMResult",a,{synchronous:!0}),o.forEach((t=>e.queueMessage(t))),t.error){const s=t.error.retry_event_id=wy.getUniqueId();hm.listen.once(s,(()=>Cy(e,n,i))),async function(e,t){t instanceof Sh&&((await e.createMessage({type:"error",message:t.message,retry_event_id:t.retry_event_id,is_ephemeral:2e4})).error=t)}(e,t.error)}}async function Cy(e,t={},s=null){if(e.disable_mam)return;const n=e.get("type")===ju,i=Bu.session.get("bare_jid"),r=n?e.get("jid"):i;if(!await hm.disco.supports(yy.MAM,r))return;const o=hm.settings.get("archived_messages_page_size"),a=Object.assign({groupchat:n,max:o,with:e.get("jid")},t),c=await hm.archive.query(a);if(await $y(e,c,a,t,s),c.rsm&&!c.complete){if(s)return"forwards"===s?t=c.rsm.next(o,t.before).query:"backwards"===s&&(t=c.rsm.previous(o,t.after).query),Cy(e,t,s);!async function(e,t,s){if(""==t.before&&(0===e.messages.length||!t.start))return;if(t.before&&!t.start)return;if(null==t.before)return;const n=await Promise.all(s.messages),{rsm:i}=s,r=`stanza_id ${e.get("jid")}`,o=n.find((e=>e[r]===i.result.first)),a=new Date(o.time),c={template_hook:"getMessageTemplate",time:new Date(a.getTime()-1).toISOString(),before:i.result.first,start:t.start};e.messages.add(new by(c))}(e,t,c)}}function ky(e){if(e.disable_mam)return;const t=e.getMostRecentMessage();if(t&&!hm.settings.get("clear_messages_on_reconnection")){if(hm.settings.get("mam_request_all_pages")){const s=t.get(`stanza_id ${e.get("jid")}`);Cy(e,s?{after:s}:{start:t.get("time")},"forwards")}else Cy(e,{before:"",start:t.get("time")})}else Cy(e,{before:""})}const{Strophe:jy,$build:Ty}=Cf.env;jy.addNamespace("RSM","http://jabber.org/protocol/rsm");const Oy=["after","before","index","max"],Ny=e=>Number(e),Iy=e=>e.toString(),My={after:Iy,before:Iy,count:Ny,first:Iy,index:Ny,last:Iy,max:Ny},Ry=e=>void 0===e,Dy=Object.keys(My);class zy{static getQueryParameters(e={}){return pd(e,Oy)}static parseXMLResult(e){const t={};for(var s=0;s<Dy.length;s++){const n=Dy[s],i=e.getElementsByTagName(n)[0];Ry(i)||null===i||(t[n]=My[n](jy.getText(i)),"first"==n&&(t.index=My.index(i.getAttribute("index"))))}return t}constructor(e={}){this.query=zy.getQueryParameters(e),this.result=e.xml?zy.parseXMLResult(e.xml):{}}toXML(){const e=Ty("set",{xmlns:jy.NS.RSM});return Oy.reduce(((e,t)=>Ry(this.query[t])?e:e.c(t).t((this.query[t]||"").toString()).up()),e).tree()}next(e,t){const s=Object.assign({},this.query,{after:this.result.last,before:t,max:e});return new zy(s)}previous(e,t){const s=Object.assign({},this.query,{after:t,before:this.result.first,max:e});return new zy(s)}}const{NS:Ly}=ft,Py=Cf.env.utils,Fy={archive:{async query(e){if(!hm.connection.connected())throw new Error("Can't call `api.archive.query` before having established an XMPP session");const t={type:"set"};if(e&&e.groupchat){if(!e.with)throw new Error('You need to specify a "with" value containing the chat room JID, when querying groupchat messages.');t.to=e.with}const s=Bu.session.get("bare_jid"),n=t.to||s;if(!await hm.disco.supports(Ly.MAM,n))return Ct.warn(`Did not fetch MAM archive for ${n} because it doesn't support ${Ly.MAM}`),{messages:[]};const i=Py.getUniqueId(),r=Pe(t).c("query",{xmlns:Ly.MAM,queryid:i});if(e){r.c("x",{xmlns:Ly.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t(Ly.MAM).up().up(),e.with&&!e.groupchat&&r.c("field",{var:"with"}).c("value").t(e.with).up().up(),["start","end"].forEach((t=>{if(e[t]){const s=P()(e[t]);if(!s.isValid())throw new TypeError(`archive.query: invalid date provided for: ${t}`);r.c("field",{var:t}).c("value").t(s.toISOString()).up().up()}})),r.up();const t=new zy(e);Object.keys(t.query).length&&r.cnode(t.toXML())}const o=hm.connection.get(),a=[],c=o.addHandler((t=>{const n=q()(`message > result[xmlns="${Ly.MAM}"]`,t).pop();if(void 0===n||n.getAttribute("queryid")!==i)return!0;const r=t.getAttribute("from")||s;if(e.groupchat){if(r!==e.with)return Ct.warn(`Ignoring alleged groupchat MAM message from ${t.getAttribute("from")}`),!0}else if(r!==s)return Ct.warn(`Ignoring alleged MAM message from ${t.getAttribute("from")}`),!0;return a.push(t),!0}),Ly.MAM);let l;const d=hm.settings.get("message_archiving_timeout"),u=await hm.sendIQ(r,d,!1);if(null===u){const{__:e}=Bu,t=e("Timeout while trying to fetch archived messages.");return Ct.error(t),l=new Sh(t),{messages:a,error:l}}if(Py.isErrorStanza(u)){const{__:e}=Bu,t=e("An error occurred while querying for archived messages.");return Ct.error(t),Ct.error(u),l=new Error(t),{messages:a,error:l}}let h;o.deleteHandler(c);const m=u&&q()(`fin[xmlns="${Ly.MAM}"]`,u).pop(),g="true"===m?.getAttribute("complete"),p=q()(`set[xmlns="${Ly.RSM}"]`,m).pop();return p&&(h=new zy({...e,xml:p})),{messages:a,rsm:h,complete:g}}}},{NS:Uy}=ft;Cf.plugins.add("converse-mam",{dependencies:["converse-disco","converse-muc"],initialize(){hm.settings.extend({archived_messages_page_size:"50",mam_request_all_pages:!0,message_archiving:void 0,message_archiving_timeout:6e4}),Object.assign(hm,Fy);const e={onMAMError:Sy,onMAMPreferences:Ay,handleMAMResult:$y,MAMPlaceholderMessage:by};Object.assign(Bu,e),Object.assign(Bu.exports,e),hm.listen.on("addClientFeatures",(()=>hm.disco.own.features.add(Uy.MAM))),hm.listen.on("serviceDiscovered",xy),hm.listen.on("chatRoomViewInitialized",(e=>{hm.settings.get("muc_show_logs_before_join")&&(Ey(e.model),e.model.features.on("change:mam_enabled",(()=>Ey(e.model))))})),hm.listen.on("enteredNewRoom",(e=>e.features.get("mam_enabled")&&ky(e))),hm.listen.on("chatReconnected",(e=>{e.get("type")===ku&&ky(e)})),hm.listen.on("afterMessagesFetched",(e=>{e.get("type")===ku&&ky(e)}))}}),Object.assign(Ef,{mam:{fetchArchivedMessages:Cy}});const{Strophe:By,$iq:qy}=Cf.env;let Hy,Gy;function Wy(){document.hidden||hm.ping(null,5e3)}function Vy(e){Hy=new Date;const t=e.getAttribute("from"),s=e.getAttribute("id"),n=qy({type:"result",to:t,id:s});return hm.sendIQ(n),!0}function Qy(){!function(){const e=hm.connection.get();e.disco&&hm.disco.own.features.add(By.NS.PING),e.addHandler(Vy,By.NS.PING,"iq","get")}(),hm.connection.get()?.addHandler((()=>{if(hm.settings.get("ping_interval")>0)return Hy=new Date,!0})),clearInterval(Gy),Gy=setInterval(Jy,1e3)}function Ky(){clearInterval(Gy)}function Jy(){if(iu()||!hm.connection.authenticated())return;const e=hm.settings.get("ping_interval");if(e>0){const t=new Date;Hy=Hy??t,(t.valueOf()-Hy.valueOf())/1e3>e&&hm.ping()}}const{Strophe:Yy,$iq:Xy,u:Zy}=Cf.env,ew={async ping(e,t){if(!hm.connection.authenticated())return Ct.debug("Not pinging when we know we're not authenticated"),null;var s;s=new Date,Hy=s;const n=Bu.session.get("bare_jid");e=e||Yy.getDomainFromJid(n);const i=Xy({type:"get",to:e,id:Zy.getUniqueId("ping")}).c("ping",{xmlns:Yy.NS.PING}),r=await hm.sendIQ(i,t||1e4,!1);return null===r?(Ct.warn(`Timeout while pinging ${e}`),e===Yy.getDomainFromJid(n)&&hm.connection.reconnect(),!1):!Zy.isErrorStanza(r)||(Ct.error(`Error while pinging ${e}`),Ct.error(r),!1)}},{Strophe:tw}=Cf.env;tw.addNamespace("PING","urn:xmpp:ping"),Cf.plugins.add("converse-ping",{initialize(){hm.settings.extend({ping_interval:60}),Object.assign(hm,ew),hm.listen.on("connected",Qy),hm.listen.on("reconnected",Qy),hm.listen.on("disconnected",Ky),document.addEventListener("visibilitychange",Wy)}});const{Strophe:sw,stx:nw}=Cf.env,iw={pubsub:{config:{async get(e,t){if(!t)throw new Error("api.pubsub.config.get: Node value required");const s=Bu.session.get("bare_jid"),n=Bu.session.get("jid"),i=nw`
                    <iq xmlns="jabber:client"
                        from="${n}"
                        type="get"
                        to="${e||s}">
                    <pubsub xmlns="${sw.NS.PUBSUB}"><configure node="${t}"/></pubsub>
                    </iq>`;let r;try{r=await hm.sendIQ(i)}catch(e){throw await If(e)}return Zf(r).fields.reduce(((e,t)=>{if(t.var.startsWith("pubsub#")){const s=t.var.replace(/^pubsub#/,""),n="boolean"===t.type?t.checked:t.value??null;e[s]=n}return e}),{})},async set(e,t,s){if(!t)throw new Error("api.pubsub.config.set: Node value required");const n=Bu.session.get("bare_jid"),i=e||n,r={...await hm.pubsub.config.get(i,t),...s},o=nw`
                    <iq xmlns="jabber:client"
                        from="${n}"
                        type="set"
                        to="${i}">
                    <pubsub xmlns="${sw.NS.PUBSUB}#owner">
                        <configure node="${t}">
                            <x xmlns="${sw.NS.XFORM}" type="submit">
                                <field var="FORM_TYPE" type="hidden">
                                    <value>${sw.NS.PUBSUB}#nodeconfig</value>
                                </field>
                                ${Object.entries(r).map((([e,t])=>nw`<field var="${e}"><value>${t}</value></field>`))}
                            </x>
                        </configure>
                    </pubsub>
                    </iq>`;try{await hm.sendIQ(o)}catch(e){throw await If(e)}return r}},async publish(e,t,s,n,i=!0){if(!t)throw new Error("api.pubsub.config.publish: node value required");if(!s)throw new Error("api.pubsub.config.publish: item value required");const r=Bu.session.get("bare_jid"),o=e||r,a=nw`
                <iq xmlns="jabber:client"
                    from="${r}"
                    type="set"
                    to="${o}">
                <pubsub xmlns="${sw.NS.PUBSUB}">
                    <publish node="${t}">${s}</publish>
                    ${n?nw`<publish-options>
                    <x xmlns="${sw.NS.XFORM}" type="submit">
                        <field var="FORM_TYPE" type="hidden">
                            <value>${sw.NS.PUBSUB}#publish-options</value>
                        </field>
                        ${Object.entries(n).map((([e,t])=>nw`<field var="pubsub#${e}"><value>${t}</value></field>`))}
                    </x></publish-options>`:""}
                </pubsub>
                </iq>`;if(o===r){if(!(await hm.disco.getIdentity("pubsub","pep",r)||await hm.disco.getIdentity("pubsub","pep",sw.getDomainFromJid(r))))return Ct.warn("api.pubsub.publish: Not publishing via PEP because it's not supported!"),void Ct.warn(a)}if(!(await hm.disco.supports(sw.NS.PUBSUB+"#publish-options",o)||o===r&&await hm.disco.supports(sw.NS.PUBSUB+"#publish-options",sw.getDomainFromJid(o)))&&i)return Ct.warn("api.pubsub.publish: #publish-options not supported, refusing to publish item."),void Ct.warn(a);try{await hm.sendIQ(a)}catch(e){const s=await If(e);if("conflict"!==s.name||"precondition-not-met"!==s.extra[sw.NS.PUBSUB_ERROR])throw e;await hm.pubsub.config.set(o,t,n);try{await hm.sendIQ(a)}catch(e){if(Ct.error(e),!i){const e=a.tree();e.querySelector("publish-options").outerHTML="",Ct.warn("api.pubsub.publish: #publish-options precondition-not-met, publishing anyway."),await hm.sendIQ(e)}}}}}},{Strophe:rw,sizzle:ow}=Cf.env;rw.addNamespace("PUBSUB_ERROR",rw.NS.PUBSUB+"#errors"),Cf.plugins.add("converse-pubsub",{dependencies:["converse-disco"],initialize(){const{api:e}=Bu;Object.assign(Bu.api,iw),e.listen.on("parseErrorStanza",((e,t)=>{const s=ow(`error [xmlns="${rw.NS.PUBSUB_ERROR}"]`,e).pop();return s?{...t,[rw.NS.PUBSUB_ERROR]:s.nodeName}:t}))}});const aw={status:{get:async()=>(await hm.waitUntil("statusInitialized"),Bu.state.xmppstatus.get("status")),async set(e,t){const s={status:e};if(!Object.keys(hu).includes(e))throw new Error("Invalid availability value. See https://xmpp.org/rfcs/rfc3921.html#rfc.section.2.2.2.1");"string"==typeof t&&(s.status_message=t),await hm.waitUntil("statusInitialized"),Bu.state.xmppstatus.save(s)},message:{get:async()=>(await hm.waitUntil("statusInitialized"),Bu.state.xmppstatus.get("status_message")),async set(e){await hm.waitUntil("statusInitialized"),Bu.state.xmppstatus.save({status_message:e})}}}};class cw extends fd{initialize(){super.initialize(),this.set({text:"",type:"items",state:"online"})}}const{$pres:lw}=Cf.env;function dw(e){const t=Bu.state.roster,s=t?.get(e.get("jid"));s?.save({num_unread:e.get("num_unread")})}let uw;function hw(){if(uw){hm.connection.get().deleteHandler(uw),uw=null}}async function mw(){await(Bu.state.presences?.clearStore())}async function gw(){if(await mw(),au(Bu)){const e=Bu.state.roster;e&&(e.data?.destroy(),await e.clearStore(),delete Bu.state.roster,Object.assign(Bu,{roster:void 0}))}}function pw(e){e?hm.trigger("rosterReadyAfterReconnection"):function(){const e=new Bu.exports.RosterContacts;Object.assign(Bu,{roster:e}),Object.assign(Bu.state,{roster:e});const t=Bu.session.get("bare_jid");let s=`converse.contacts-${t}`;Zu(e,s);const n=new cw;Object.assign(Bu,{roster_filter:n}),Object.assign(Bu.state,{roster_filter:n}),n.id=`_converse.rosterfilter-${t}`,Zu(n,n.id),n.fetch(),s=`converse-roster-model-${t}`,e.data=new fd,e.data.id=s,Zu(e.data,s),e.data.fetch(),hm.trigger("rosterInitialized",e)}();Bu.state.roster.onConnected(),function(){hw();const e=hm.connection.get();uw=e.addHandler((e=>(Bu.state.roster.presenceHandler(e),!0)),null,"presence",null)}(),async function(e=!1){const t=hm.connection.get();e&&(t.send_initial_presence=!0);const s=Bu.state.roster;try{await s.fetchRosterContacts(),hm.trigger("rosterContactsFetched",s)}catch(e){Ct.error(e)}finally{t.send_initial_presence&&hm.user.presence.send()}}(!hm.connection.get().restored)}async function fw(e){if(e)!hm.connection.get().hasResumed()&&await mw();else{const e=new Bu.exports.Presences;Object.assign(Bu,{presences:e}),Object.assign(Bu.state,{presences:e});Zu(e,`converse.presences-${Bu.session.get("bare_jid")}`,"session"),e.fetch()}hm.trigger("presencesInitialized",e)}function vw(){const{chatboxes:e}=Bu.state;e.on("change:num_unread",dw),e.on("add",(e=>{e.get("type")===ku&&e.setModelContact(e.get("jid"))}))}function _w(){Bu.state.roster.on("add",(e=>{const t=Bu.state.chatboxes.findWhere({jid:e.get("jid")});t?.setModelContact(e.get("jid"))}))}function bw(e,t){const s=lw({to:e,type:"unsubscribed"});t&&""!==t&&s.c("status").t(t),hm.send(s)}const{Strophe:yw,$iq:ww,$pres:Sw}=Cf.env;class Aw extends(wv(fd)){get idAttribute(){return"jid"}defaults(){return{chat_state:void 0,groups:[],num_unread:0,status:void 0}}async initialize(e){super.initialize(),this.initialized=hc(),this.setPresence();const{jid:t}=e;this.set({...e,jid:yw.getBareJidFromJid(t).toLowerCase(),user_id:yw.getNodeFromJid(t)}),this.listenTo(this.presence,"change:show",(()=>hm.trigger("contactPresenceChanged",this))),this.listenTo(this.presence,"change:show",(()=>this.trigger("presenceChanged"))),await hm.trigger("rosterContactInitialized",this,{Synchronous:!0}),this.initialized.resolve()}setPresence(){const e=this.get("jid"),{presences:t}=Bu.state;this.presence=t.findWhere(e)||t.create({jid:e})}getStatus(){return this.presence.get("show")||"offline"}openChat(){hm.chats.open(this.get("jid"),this.attributes,!0)}getDisplayName(){return this.get("nickname")?this.get("nickname"):this.get("jid")}getFullname(){return this.get("jid")}subscribe(e){return hm.user.presence.send("subscribe",this.get("jid"),e),this.save("ask","subscribe"),this}ackSubscribe(){hm.send(Sw({type:"subscribe",to:this.get("jid")}))}ackUnsubscribe(){hm.send(Sw({type:"unsubscribe",to:this.get("jid")})),this.sendRosterRemoveStanza(),this.destroy()}unauthorize(e){return bw(this.get("jid"),e),this}authorize(e){const t=Sw({to:this.get("jid"),type:"subscribed"});return e&&""!==e&&t.c("status").t(e),hm.send(t),this}remove(e){const t=this.get("subscription");if("none"===t&&"subscribe"!==this.get("ask"))return void this.destroy();e&&["from","both"].includes(t)&&this.unauthorize();const s=this.sendRosterRemoveStanza();return this.collection&&this.destroy(),s}sendRosterRemoveStanza(){const e=ww({type:"set"}).c("query",{xmlns:yw.NS.ROSTER}).c("item",{jid:this.get("jid"),subscription:"remove"});return hm.sendIQ(e)}}const xw=Aw,{Strophe:Ew,$iq:$w,sizzle:Cw,u:kw}=Cf.env;const jw=class extends Fd{constructor(){super(),this.model=xw,this.data=null}initialize(){const e=`roster.state-${Bu.session.get("bare_jid")}-${this.get("jid")}`;this.state=new fd({id:e,collapsed_groups:[]}),Zu(this.state,e),this.state.fetch(),hm.listen.on("chatBoxClosed",(e=>this.onChatBoxClosed(e)))}onChatBoxClosed(e){const t=this.get(e.get("jid"));"none"===t?.get("subscription")&&t.destroy()}onConnected(){this.registerRosterHandler(),this.registerRosterXHandler()}registerRosterHandler(){hm.connection.get().addHandler((e=>(Bu.state.roster.onRosterPush(e),!0)),Ew.NS.ROSTER,"iq","set")}registerRosterXHandler(){let e=0;hm.connection.get().addHandler((t=>(setTimeout((()=>{const{roster:e}=Bu.state;hm.connection.get().flush(),e.subscribeToSuggestedItems(t)}),e),e+=250*t.querySelectorAll("item").length,!0)),Ew.NS.ROSTERX,"message",null)}async fetchRosterContacts(){const e=await new Promise(((e,t)=>{this.fetch({add:!0,silent:!0,success:e,error:(e,s)=>t(s)})}));if(kw.isErrorObject(e)&&(Ct.error(e),Bu.session.save("roster_cached",!1),this.data.save("version",void 0)),!Bu.session.get("roster_cached"))return hm.connection.get().send_initial_presence=!0,Bu.state.roster.fetchFromServer();hm.trigger("cachedRoster",e)}subscribeToSuggestedItems(e){const{xmppstatus:t}=Bu.state;return Array.from(e.querySelectorAll("item")).forEach((e=>{"add"===e.getAttribute("action")&&this.addContact({jid:e.getAttribute("jid"),name:t.getNickname()||t.getFullname(),subscription:"to"})})),!0}isSelf(e){return kw.isSameBareJID(e,hm.connection.get().jid)}sendContactAddIQ(e){const{jid:t,groups:s}=e,n=e.name?e.name:null,i=$w({type:"set"}).c("query",{xmlns:Ew.NS.ROSTER}).c("item",{jid:t,name:n});return s?.forEach((e=>i.c("group").t(e).up())),hm.sendIQ(i)}async addContact(e,t=!0,s=!0,n=""){const{jid:i,name:r}=e??{};if(!i||!kw.isValidJID(i))throw new Error("Invalid JID provided to addContact");if(await hm.waitUntil("rosterContactsFetched"),t)try{await this.sendContactAddIQ(e)}catch(e){Ct.error(e);const{__:t}=Bu;throw alert(t("Sorry, an error occurred while trying to add %1$s as a contact.",r||i)),e}const o=await this.create({ask:void 0,nickname:r,groups:[],requesting:!1,subscription:s?"to":"none",...e},{sort:!1});return s&&o.subscribe(n),o}async subscribeBack(e,t,s="",n=""){const i=this.get(e),{RosterContact:r}=Bu.exports;if(i instanceof r)i.authorize().subscribe();else{const i=Cw(`nick[xmlns="${Ew.NS.NICK}"]`,t).pop()?.textContent||void 0,o=await this.addContact({jid:e,name:i,groups:[],subscription:"from"});o instanceof r&&o.authorize(s).subscribe(n)}}onRosterPush(e){const t=e.getAttribute("id"),s=e.getAttribute("from"),n=Bu.session.get("bare_jid");if(s&&s!==n)return void Ct.warn(`Ignoring roster illegitimate roster push message from ${e.getAttribute("from")}`);hm.send($w({type:"result",id:t,from:hm.connection.get().jid}));const i=Cw(`query[xmlns="${Ew.NS.ROSTER}"]`,e).pop();this.data.save("version",i.getAttribute("ver"));const r=Cw("item",i);if(r.length>1)throw Ct.error(e),new Error('Roster push query may not contain more than one "item" element.');if(0===r.length)return Ct.warn(e),void Ct.warn('Received a roster push stanza without an "item" element.');this.updateContact(r.pop()),hm.trigger("rosterPush",e)}rosterVersioningSupported(){return hm.disco.stream.getFeature("ver","urn:xmpp:features:rosterver")&&this.data.get("version")}async fetchFromServer(e=!1){const t=$w({type:"get",id:kw.getUniqueId("roster")}).c("query",{xmlns:Ew.NS.ROSTER});this.rosterVersioningSupported()&&!e&&t.attrs({ver:this.data.get("version")});const s=await hm.sendIQ(t,null,!1);if("result"===s.getAttribute("type")){const e=Cw(`query[xmlns="${Ew.NS.ROSTER}"]`,s).pop();if(e){const t=Cw("item",e);if(!this.data.get("version")&&this.models.length){const e=t.map((e=>e.getAttribute("jid")));this.forEach((t=>!t.get("requesting")&&!e.includes(t.get("jid"))&&t.destroy()))}t.forEach((e=>this.updateContact(e))),this.data.save("version",e.getAttribute("ver"))}}else if(!kw.isServiceUnavailableError(s))return Ct.error(s),void Ct.error("Error while trying to fetch roster from the server");Bu.session.save("roster_cached",!0),hm.trigger("roster",s)}updateContact(e){const t=e.getAttribute("jid"),s=this.get(t),n=e.getAttribute("subscription");if("remove"===n)return s?.destroy();const i=e.getAttribute("ask"),r=e.getAttribute("name"),o=[...new Set(Cw("group",e).map((e=>e.textContent)))];s?s.save({subscription:n,ask:i,nickname:r,groups:o,requesting:null}):this.create({nickname:r,ask:i,groups:o,jid:t,subscription:n},{sort:!1})}createRequestingContact(e){const t={jid:Ew.getBareJidFromJid(e.getAttribute("from")),subscription:"none",ask:null,requesting:!0,nickname:Cw(`nick[xmlns="${Ew.NS.NICK}"]`,e).pop()?.textContent||null};hm.trigger("contactRequest",this.create(t))}handleIncomingSubscription(e){const t=e.getAttribute("from"),s=Ew.getBareJidFromJid(t),n=this.get(s);if(!hm.settings.get("allow_contact_requests")){const{__:e}=Bu;bw(t,e("This client does not allow presence subscriptions"))}hm.settings.get("auto_subscribe")?n&&"to"===n.get("subscription")?n.authorize():this.subscribeBack(s,e):n?("none"!==n.get("subscription")||"subscribe"===n.get("ask"))&&n.authorize():this.createRequestingContact(e)}handleOwnPresence(e){const t=e.getAttribute("from"),s=Ew.getResourceFromJid(t),n=e.getAttribute("type"),{xmppstatus:i}=Bu.state;if(hm.connection.get().jid!==t&&"unavailable"!==n&&(!0===hm.settings.get("synchronize_availability")||hm.settings.get("synchronize_availability")===s)){const t=e.querySelector("show")?.textContent||"online";i.save({status:t},{silent:!0});const s=e.querySelector("status")?.textContent;s&&i.save({status_message:s})}Bu.session.get("jid")===t&&"unavailable"===n&&hm.user.presence.send()}presenceHandler(e){const t=e.getAttribute("type");if("error"===t)return!0;const s=e.getAttribute("from"),n=Ew.getBareJidFromJid(s);if(this.isSelf(n))return this.handleOwnPresence(e);if(Cw(`query[xmlns="${Ew.NS.MUC}"]`,e).length)return;const i=this.get(n);if(i){const t=e.querySelector("status")?.textContent;i.get("status")!==t&&i.save({status:t})}if("subscribed"===t&&i)i.ackSubscribe();else if("unsubscribed"===t&&i)i.ackUnsubscribe();else{if("unsubscribe"===t)return;if("subscribe"===t)this.handleIncomingSubscription(e);else if("unavailable"===t&&i){const e=Ew.getResourceFromJid(s);i.presence.removeResource(e)}else i&&i.presence.addResource(e)}}};const Tw=class extends fd{get idAttribute(){return"name"}};const Ow=class extends Fd{constructor(){super(),this.model=Tw}},{Strophe:Nw,dayjs:Iw,sizzle:Mw}=Cf.env;const Rw=class extends fd{get idAttribute(){return"jid"}defaults(){return{show:"offline"}}initialize(){super.initialize(),this.resources=new Ow;const e=`converse.identities-${this.get("jid")}`;Zu(this.resources,e,"session"),this.listenTo(this.resources,"update",this.onResourcesChanged),this.listenTo(this.resources,"change",this.onResourcesChanged)}onResourcesChanged(){const e=this.getHighestPriorityResource(),t=e?.attributes?.show||"offline";this.get("show")!==t&&this.save({show:t})}getHighestPriorityResource(){return this.resources.sortBy((e=>`${e.get("priority")}-${e.get("timestamp")}`)).reverse()[0]}addResource(e){const t=e.getAttribute("from"),s=Nw.getResourceFromJid(t),n=Mw(`delay[xmlns="${Nw.NS.DELAY}"]`,e).pop(),i=e.querySelector("priority")?.textContent,r=this.resources.get(s),o={name:s,priority:Number.isNaN(parseInt(i,10))?0:parseInt(i,10),show:e.querySelector("show")?.textContent??"online",timestamp:n?Iw(n.getAttribute("stamp")).toISOString():(new Date).toISOString()};r?r.save(o):this.resources.create(o)}removeResource(e){const t=this.resources.get(e);t?.destroy()}};const Dw=class extends Fd{constructor(){super(),this.model=Rw}},{Strophe:zw,$build:Lw}=Cf.env;function Pw(e){hm.trigger("statusInitialized",e)}function Fw(e){if(e=void 0!==Bu.state.xmppstatus&&e)Pw(e);else{const t=`converse.xmppstatus-${Bu.session.get("bare_jid")}`;Bu.state.xmppstatus=new Bu.exports.XMPPStatus({id:t}),Object.assign(Bu,{xmppstatus:Bu.state.xmppstatus}),Zu(Bu.state.xmppstatus,t,"session"),Bu.state.xmppstatus.fetch({success:()=>Pw(e),error:()=>Pw(e),silent:!0})}}let Uw,Bw=0,qw=!1,Hw=!1,Gw=!1;function Ww(){Bw>0&&(Bw=0),hm.connection.get()?.authenticated&&(Gw&&Qw(xu),qw&&(qw=!1,hm.user.presence.send()),!0===Hw&&(Hw=!1,Bu.state.xmppstatus.set("status",hm.settings.get("default_state"))))}function Vw(){if(!hm.connection.get()?.authenticated)return;const{xmppstatus:e}=Bu.state,t=e.get("status");Bw++,hm.settings.get("csi_waiting_time")>0&&Bw>hm.settings.get("csi_waiting_time")&&!Gw&&Qw(Au),hm.settings.get("idle_presence_timeout")>0&&Bw>hm.settings.get("idle_presence_timeout")&&!qw&&(qw=!0,hm.user.presence.send()),hm.settings.get("auto_away")>0&&Bw>hm.settings.get("auto_away")&&"away"!==t&&"xa"!==t&&"dnd"!==t?(Hw=!0,e.set("status","away")):hm.settings.get("auto_xa")>0&&Bw>hm.settings.get("auto_xa")&&"xa"!==t&&"dnd"!==t&&(Hw=!0,e.set("status","xa"))}function Qw(e){hm.send(Lw(e,{xmlns:zw.NS.CSI})),Gw=e===Au}function Kw(){if(hm.settings.get("auto_away")<1&&hm.settings.get("auto_xa")<1&&hm.settings.get("csi_waiting_time")<1&&hm.settings.get("idle_presence_timeout")<1)return;Bw=0,Hw=!1;const{onUserActivity:e,onEverySecond:t}=Bu.exports;window.addEventListener("click",e),window.addEventListener("focus",e),window.addEventListener("keypress",e),window.addEventListener("mousemove",e),window.addEventListener(ru(),e,{once:!0,passive:!0}),Uw=setInterval(t,1e3)}function Jw(){const{onUserActivity:e}=Bu.exports;window.removeEventListener("click",e),window.removeEventListener("focus",e),window.removeEventListener("keypress",e),window.removeEventListener("mousemove",e),window.removeEventListener(ru(),e),Uw&&(clearInterval(Uw),Uw=null)}function Yw(e,t){const{xmppstatus:s}=Bu.state,n=s.get("status");["away","chat","dnd","xa"].includes(n)&&t.c("show").t(n).up();const i=s.get("status_message");return i&&t.c("status").t(i).up(),t}const{Strophe:Xw,$pres:Zw}=Cf.env;class eS extends(wv(fd)){constructor(e,t){super(e,t),this.vcard=null}defaults(){return{status:hm.settings.get("default_state")}}getStatus(){return this.get("status")}get(e){return"jid"===e?Bu.session.get("bare_jid"):"nickname"===e?hm.settings.get("nickname"):super.get(e)}set(e,t,s){if("jid"===e||"nickname"===e)throw new Error("Readonly property");return super.set(e,t,s)}initialize(){this.on("change",(e=>{e.changed instanceof Object&&("status"in e.changed||"status_message"in e.changed)&&hm.user.presence.send(this.get("status"),null,this.get("status_message"))}))}getDisplayName(){return this.getFullname()||this.getNickname()||this.get("jid")}getNickname(){return hm.settings.get("nickname")}getFullname(){return""}async constructPresence(e,t=null,s){let n;if(e="string"==typeof e?e:this.get("status")||hm.settings.get("default_state"),s="string"==typeof s?s:this.get("status_message"),"subscribe"===e){n=Zw({to:t,type:e});const{xmppstatus:s}=Bu.state,i=s.getNickname();i&&n.c("nick",{xmlns:Xw.NS.NICK}).t(i).up()}else n="unavailable"===e||"probe"===e||"error"===e||"unsubscribe"===e||"unsubscribed"===e||"subscribed"===e?Zw({to:t,type:e}):"offline"===e?Zw({to:t,type:"unavailable"}):"online"===e?Zw({to:t}):Zw({to:t}).c("show").t(e).up();s&&n.c("status").t(s).up();const i=hm.settings.get("priority");if(n.c("priority").t(Number.isNaN(Number(i))?0:i).up(),qw){const e=new Date;e.setSeconds(e.getSeconds()-Bw),n.c("idle",{xmlns:Xw.NS.IDLE,since:e.toISOString()})}return n=await hm.hook("constructedPresence",null,n),n}}const{Strophe:tS}=Cf.env;tS.addNamespace("IDLE","urn:xmpp:idle:1"),Cf.plugins.add("converse-status",{initialize(){hm.settings.extend({auto_away:0,auto_xa:0,csi_waiting_time:0,default_state:"online",idle_presence_timeout:300,priority:0}),hm.promises.add(["statusInitialized"]);const e={XMPPStatus:eS,onUserActivity:Ww,onEverySecond:Vw,sendCSI:Qw,registerIntervalHandler:Kw};Object.assign(Bu,e),Object.assign(Bu.exports,e),Object.assign(Bu.api.user,aw),hm.settings.get("idle_presence_timeout")>0&&hm.listen.on("addClientFeatures",(()=>hm.disco.own.features.add(tS.NS.IDLE))),hm.listen.on("presencesInitialized",(e=>!e&&Kw())),hm.listen.on("beforeTearDown",Jw),hm.listen.on("clearSession",(()=>{au(Bu)&&Bu.state.xmppstatus&&(Bu.state.xmppstatus.destroy(),delete Bu.state.xmppstatus,Object.assign(Bu,{xmppstatus:void 0}),hm.promises.add(["statusInitialized"]))})),hm.listen.on("connected",(()=>Fw(!1))),hm.listen.on("reconnected",(()=>Fw(!0))),hm.listen.on("constructedMUCPresence",Yw)}});const{Strophe:sS}=Cf.env,nS={contacts:{async get(e){await hm.waitUntil("rosterContactsFetched");const{roster:t}=Bu.state,s=e=>t.get(sS.getBareJidFromJid(e));if(void 0===e)e=t.pluck("jid");else if("string"==typeof e)return s(e);return e.map(s)},async remove(e,t){await hm.waitUntil("rosterContactsFetched");(await hm.contacts.get(e)).remove(t)},async add(e,t=!0,s=!0,n=""){if(!th(e?.jid))throw new Error("api.contacts.add: Valid JID required");await hm.waitUntil("rosterContactsFetched");const{roster:i}=Bu.state;return i.addContact(e,t,s,n)}}};Cf.plugins.add("converse-roster",{dependencies:["converse-status"],initialize(){hm.settings.extend({show_self_in_roster:!0,allow_contact_requests:!0,auto_subscribe:!1,synchronize_availability:!0}),hm.promises.add(["cachedRoster","roster","rosterContactsFetched","rosterInitialized"]),Object.assign(Bu.api,nS);const{__:e}=Bu,t={HEADER_UNSAVED_CONTACTS:e("Unsaved contacts"),HEADER_CURRENT_CONTACTS:e("My contacts"),HEADER_PENDING_CONTACTS:e("Pending contacts"),HEADER_REQUESTING_CONTACTS:e("Contact requests"),HEADER_UNGROUPED:e("Ungrouped"),HEADER_UNREAD:e("New messages")};Object.assign(Bu,t),Object.assign(Bu.labels,t);const s={Presence:Rw,Presences:Dw,RosterContact:xw,RosterContacts:jw};Object.assign(Bu,s),Object.assign(Bu.exports,s),hm.listen.on("beforeTearDown",(()=>hw())),hm.listen.on("chatBoxesInitialized",vw),hm.listen.on("clearSession",gw),hm.listen.on("presencesInitialized",pw),hm.listen.on("statusInitialized",fw),hm.listen.on("streamResumptionFailed",(()=>Bu.session.set("roster_cached",!1))),hm.waitUntil("rosterContactsFetched").then(_w)}});const{Strophe:iS,u:rS,stx:oS}=Cf.env;function aS(){return!(hm.connection.isType("bosh")&&!iu())&&hm.disco.stream.getFeature("sm",iS.NS.SM)}function cS(e){if(!Bu.session.get("smacks_enabled"))return!0;const t=parseInt(e.getAttribute("h"),10),s=Bu.session.get("num_stanzas_handled_by_server"),n=t-s;if(n<0){const e=`New reported stanza count lower than previous. New: ${t} - Previous: ${s}`;Ct.error(e)}const i=Bu.session.get("unacked_stanzas");if(n>i.length){const e=`Higher reported acknowledge count than unacknowledged stanzas. Reported Acknowledged Count: ${n} -Unacknowledged Stanza Count: ${i.length} -New: ${t} - Previous: ${s}`;Ct.error(e)}return Bu.session.save({num_stanzas_handled_by_server:t,num_stanzas_since_last_ack:0,unacked_stanzas:i.slice(n)}),!0}function lS(){if(Bu.session.get("smacks_enabled")){const e=Bu.session.get("num_stanzas_handled"),t=oS`<a xmlns="${iS.NS.SM}" h="${e}"/>`;hm.send(t)}return!0}function dS(e){if(Bu.session.get("smacks_enabled")&&(rS.isTagEqual(e,"iq")||rS.isTagEqual(e,"presence")||rS.isTagEqual(e,"message"))){const e=Bu.session.get("num_stanzas_handled");Bu.session.save("num_stanzas_handled",e+1)}return!0}function uS(){Bu.session.save({smacks_enabled:Bu.session.get("smacks_enabled")||!1,num_stanzas_handled:Bu.session.get("num_stanzas_handled")||0,num_stanzas_handled_by_server:Bu.session.get("num_stanzas_handled_by_server")||0,num_stanzas_since_last_ack:Bu.session.get("num_stanzas_since_last_ack")||0,unacked_stanzas:Bu.session.get("unacked_stanzas")||[]})}function hS(){Bu.session?.save({smacks_enabled:!1,num_stanzas_handled:0,num_stanzas_handled_by_server:0,num_stanzas_since_last_ack:0,unacked_stanzas:[]})}function mS(e){const t={smacks_enabled:!0};return["1","true"].includes(e.getAttribute("resume"))&&(t.smacks_stream_id=e.getAttribute("id")),Bu.session.save(t),!0}function gS(e){if(hS(),hm.trigger("streamResumptionFailed"),e.querySelector("item-not-found"))Ct.warn("Could not resume previous SMACKS session, session id not found. A new session will be established.");else{Ct.error("Failed to enable stream management"),Ct.error(e.outerHTML);hm.connection.get()._changeConnectStatus(iS.Status.DISCONNECTED,null)}return!0}function pS(e){mS(e),cS(e),function(){const e=Bu.session.get("unacked_stanzas");Bu.session.save("unacked_stanzas",[]),e.forEach((e=>hm.send(rS.toStanza(e))))}();const t=hm.connection.get();t.do_bind=!1,t.authenticated=!0,t.restored=!0,t._changeConnectStatus(iS.Status.CONNECTED,null)}async function fS(){if(hm.settings.get("enable_smacks")&&!Bu.session.get("smacks_enabled")&&await aS()){const e=hc(),t=hm.connection.get();t._addSysHandler((t=>e.resolve(mS(t))),iS.NS.SM,"enabled"),t._addSysHandler((t=>e.resolve(gS(t))),iS.NS.SM,"failed");const s=hm.connection.isType("websocket")||iu(),n=oS`<enable xmlns="${iS.NS.SM}" resume="${s}"/>`;hm.send(n),t.flush(),await e}}const vS=[];async function _S(){if(!hm.settings.get("enable_smacks"))return;if(!await aS())return;const e=hm.connection.get();for(;vS.length;)e.deleteHandler(vS.pop());vS.push(e.addHandler(dS)),vS.push(e.addHandler(lS,iS.NS.SM,"r")),vS.push(e.addHandler(cS,iS.NS.SM,"a")),Bu.session?.get("smacks_stream_id")?await async function(){const e=hc(),t=hm.connection.get();t._addSysHandler((t=>e.resolve(pS(t))),iS.NS.SM,"resumed"),t._addSysHandler((t=>e.resolve(gS(t))),iS.NS.SM,"failed");const s=Bu.session.get("smacks_stream_id"),n=Bu.session.get("num_stanzas_handled"),i=oS`<resume xmlns="${iS.NS.SM}" h="${n}" previd="${s}"/>`;hm.send(i),t.flush(),await e}():hS()}function bS(e){if(Bu.session){if(Bu.session.get("smacks_enabled")&&(rS.isTagEqual(e,"iq")||rS.isTagEqual(e,"presence")||rS.isTagEqual(e,"message"))){const t=iS.serialize(e);Bu.session.save("unacked_stanzas",(Bu.session.get("unacked_stanzas")||[]).concat([t]));const s=hm.settings.get("smacks_max_unacked_stanzas");if(s>0){const e=Bu.session.get("num_stanzas_since_last_ack")+1;e%s==0&&hm.send(oS`<r xmlns="${iS.NS.SM}"/>`),Bu.session.save({num_stanzas_since_last_ack:e})}}}else Ct.warn("No _converse.session!")}const{Strophe:yS}=Cf.env;yS.addNamespace("SM","urn:xmpp:sm:3"),Cf.plugins.add("converse-smacks",{initialize(){hm.settings.extend({enable_smacks:!0,smacks_max_unacked_stanzas:5}),hm.listen.on("afterResourceBinding",fS),hm.listen.on("beforeResourceBinding",_S),hm.listen.on("send",bS),hm.listen.on("userSessionInitialized",uS)}});const wS=class extends fd{get idAttribute(){return"jid"}getDisplayName(){return this.get("nickname")||this.get("fullname")||this.get("jid")}},{Strophe:SS,$iq:AS,u:xS}=Cf.env;function ES(e,t,s){const n=AS(t?{type:e,to:t}:{type:e});return s?n.cnode(s):n.c("vCard",{xmlns:SS.NS.VCARD}),n}async function $S(e){if(e instanceof Bu.exports.MUCMessage)return kS(e);let t;if(e instanceof Bu.exports.Message){if(["error","info"].includes(e.get("type")))return;t=SS.getBareJidFromJid(e.get("from"))}else t=e.get("jid");if(!t)return void Ct.warn("Could not set VCard on model because no JID found!");await hm.waitUntil("VCardsInitialized");const{vcards:s}=Bu.state;e.vcard=s.get(t)||s.create({jid:t}),e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add")}async function CS(e){await hm.waitUntil("VCardsInitialized"),e.vcard=function(e){const{vcards:t,xmppstatus:s}=Bu.state,n=e?.collection?.chatroom,i=e.get("nick");if(i&&n?.get("nick")===i)return s.vcard;{const s=e.get("jid")||e.get("from");return s?t.get(s)||t.create({jid:s}):void Ct.warn("Could not get VCard for occupant because no JID found!")}}(e),e.vcard&&(e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add"))}async function kS(e){["error","info"].includes(e.get("type"))||(await hm.waitUntil("VCardsInitialized"),e.vcard=function(e){const{vcards:t,xmppstatus:s}=Bu.state,n=e?.collection?.chatbox,i=SS.getResourceFromJid(e.get("from"));if(i&&n?.get("nick")===i)return s.vcard;{const s=e.occupant?.get("jid")||e.get("from");return s?t.get(s)||t.create({jid:s}):void Ct.warn(`Could not get VCard for message because no JID found! msgid: ${e.get("msgid")}`)}}(e),e.vcard&&(e.vcard.on("change",(()=>e.trigger("vcard:change"))),e.trigger("vcard:add")))}async function jS(){const e=new Bu.exports.VCards;Bu.state.vcards=e,Object.assign(Bu,{vcards:e});const t=Bu.session.get("bare_jid");Zu(e,`${t}-converse.vcards`),await new Promise((t=>{e.fetch({success:t,error:t},{silent:!0})}));const{xmppstatus:s}=Bu.state;s.vcard=e.get(t)||e.create({jid:t}),s.vcard&&(s.vcard.on("change",(()=>s.trigger("vcard:change"))),s.trigger("vcard:add")),hm.trigger("VCardsInitialized")}async function TS(e){const t=Bu.session.get("bare_jid"),s=SS.getBareJidFromJid(e)===t?null:e;let n;try{n=await hm.sendIQ(ES("get",s))}catch(t){return{jid:e,stanza:_t(t)?t:null,error:_t(t)?null:t,vcard_error:(new Date).toISOString()}}return async function(e){const t=e.querySelector("vCard");let s={};if(null!==t&&(s={stanza:e,fullname:t.querySelector("FN")?.textContent,nickname:t.querySelector("NICKNAME")?.textContent,image:t.querySelector("PHOTO BINVAL")?.textContent,image_type:t.querySelector("PHOTO TYPE")?.textContent,url:t.querySelector("URL")?.textContent,role:t.querySelector("ROLE")?.textContent,email:t.querySelector("EMAIL USERID")?.textContent,vcard_updated:(new Date).toISOString(),vcard_error:void 0,image_hash:void 0}),s.image){const e=xS.base64ToArrayBuffer(s.image),t=await crypto.subtle.digest("SHA-1",e);s.image_hash=xS.arrayBufferToHex(t)}return s}(n)}const{dayjs:OS,u:NS}=Cf.env,IS={vcard:{async set(e,t){if(!e)throw Error("No jid provided for the VCard data");const s=document.createElement("div"),n=NS.toStanza(`\n                <vCard xmlns="vcard-temp">\n                    <FN>${t.fn}</FN>\n                    <NICKNAME>${t.nickname}</NICKNAME>\n                    <URL>${t.url}</URL>\n                    <ROLE>${t.role}</ROLE>\n                    <EMAIL><INTERNET/><PREF/><USERID>${t.email}</USERID></EMAIL>\n                    <PHOTO>\n                        <TYPE>${t.image_type}</TYPE>\n                        <BINVAL>${t.image}</BINVAL>\n                    </PHOTO>\n                </vCard>`,s);let i;try{i=await hm.sendIQ(ES("set",e,n))}catch(e){throw e}return await hm.vcard.update(e,!0),i},get(e,t){if("string"==typeof e)return TS(e);const s=e.get("vcard_error"),n=s&&OS(s).isSame(new Date,"day");if(t||!e.get("vcard_updated")&&!n){const t=e.get("jid");return t||Ct.error("No JID to get vcard for"),TS(t)}return Promise.resolve({})},async update(e,t){const s=await this.get(e,t);(e="string"==typeof e?Bu.state.vcards.get(e):e)?Object.keys(s).length&&(delete s.stanza,e.save(s)):Ct.error(`Could not find a VCard model for ${e}`)}}};const MS=class extends Fd{constructor(){super(),this.model=wS}initialize(){this.on("add",(e=>e.get("jid")&&IS.vcard.update(e)))}},{Strophe:RS}=Cf.env;Cf.plugins.add("converse-vcard",{dependencies:["converse-status","converse-roster"],overrides:{XMPPStatus:{getNickname(){const{_converse:e}=this.__super__,{xmppstatus:t}=e.state,s=this.__super__.getNickname.apply(this);return!s&&t?.vcard?t.vcard.get("nickname"):s},getFullname(){const{_converse:e}=this.__super__,{xmppstatus:t}=e.state,s=this.__super__.getFullname.apply(this);return!s&&t?.vcard?t.vcard.get("fullname"):s}},RosterContact:{getDisplayName(){return!this.get("nickname")&&this.vcard?this.vcard.getDisplayName():this.__super__.getDisplayName.apply(this)},getFullname(){return this.vcard?this.vcard.get("fullname"):this.__super__.getFullname.apply(this)}}},initialize(){hm.promises.add("VCardsInitialized");const e={VCard:wS,VCards:MS};Object.assign(Bu,e),Object.assign(Bu.exports,e),hm.listen.on("chatRoomInitialized",(e=>{$S(e),e.occupants.forEach(CS),e.listenTo(e.occupants,"add",CS),e.listenTo(e.occupants,"change:image_hash",(e=>function(e){const t=e.get("image_hash"),s=[];e.get("jid")&&s.push(Bu.state.vcards.get(e.get("jid"))),s.push(Bu.state.vcards.get(e.get("from"))),s.forEach((e=>t&&e&&e?.get("image_hash")!==t&&hm.vcard.update(e,!0)))}(e)))})),hm.listen.on("chatBoxInitialized",(e=>$S(e))),hm.listen.on("chatRoomMessageInitialized",(e=>kS(e))),hm.listen.on("addClientFeatures",(()=>hm.disco.own.features.add(RS.NS.VCARD))),hm.listen.on("clearSession",(()=>{au(Bu)&&(hm.promises.add("VCardsInitialized"),Bu.state.vcards&&(Bu.state.vcards.clearStore(),Object.assign(Bu,{vcards:void 0}),delete Bu.state.vcards))})),hm.listen.on("messageInitialized",(e=>$S(e))),hm.listen.on("rosterContactInitialized",(e=>$S(e))),hm.listen.on("statusInitialized",jS),Object.assign(Bu.api,IS)}}),P().extend(U());const DS=Object.assign({},c,y);Object.assign(Bu.constants,DS);const{dayjs:zS}=Cf.env;let LS,PS="en";function FS(e,t){return t.includes(e)}function US(e,t){if("en"===e||t(e))return e;const{languages:s}=window.navigator;let n;for(let e=0;e<s.length&&!n;e++)n=BS(s[e],t);return n||"en"}function BS(e,t){if(t(e))return e;var s=e.split("-")[0];return s!==e&&t(s)?s:void 0}const qS=Object.assign(jt,{getLocale:()=>PS,translate(e,t){if(!LS)return z().sprintf.apply(z(),arguments);const s=LS.translate(e);return arguments.length>1?s.fetch.apply(s,t):s.fetch()},async initialize(){if(Ef.isTestEnv())PS="en";else try{const e=hm.settings.get("i18n"),t=hm.settings.get("locales");PS=US(e,(e=>FS(e,t))),LS=await async function(){const e=function(e){const t=e.toLowerCase().replace("_","-");return"ug"===t?"ug-cn":t}(PS);if(!FS(PS,hm.settings.get("locales"))||"en"===PS)return;const{default:t}=await s(3883)(`./${PS}/LC_MESSAGES/converse.po`);return await s(9499)(`./${e}.js`),zS.locale(US(e,(e=>zS.locale(e)))),new(z())(t)}()}catch(e){Ct.fatal(e.message),PS="en"}},__:(e,...t)=>qS.translate(e,t)}),HS=qS.__,GS={},WS={registry:GS,define(e,t){this.registry[e]=t},register(){Object.keys(GS).forEach((e=>{customElements.get(e)||customElements.define(e,GS[e])}))}};Object.assign(hm,{elements:WS});class VS extends($i(Mp)){constructor(){super()}createRenderRoot(){return this}initialize(){return null}connectedCallback(){return super.connectedCallback(),this.initialize()}disconnectedCallback(){super.disconnectedCallback(),this.stopListening()}}const QS=["converse-adhoc-views","converse-bookmark-views","converse-chatboxviews","converse-chatview","converse-controlbox","converse-dragresize","converse-fullscreen","converse-headlines-view","converse-mam-views","converse-minimize","converse-modal","converse-muc-views","converse-notification","converse-omemo","converse-profile","converse-push","converse-register","converse-roomslist","converse-rootview","converse-rosterview","converse-singleton"];var KS="top",JS="bottom",YS="right",XS="left",ZS="auto",eA=[KS,JS,YS,XS],tA="start",sA="end",nA="clippingParents",iA="viewport",rA="popper",oA="reference",aA=eA.reduce((function(e,t){return e.concat([t+"-"+tA,t+"-"+sA])}),[]),cA=[].concat(eA,[ZS]).reduce((function(e,t){return e.concat([t,t+"-"+tA,t+"-"+sA])}),[]),lA="beforeRead",dA="read",uA="afterRead",hA="beforeMain",mA="main",gA="afterMain",pA="beforeWrite",fA="write",vA="afterWrite",_A=[lA,dA,uA,hA,mA,gA,pA,fA,vA];function bA(e){return e?(e.nodeName||"").toLowerCase():null}function yA(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function wA(e){return e instanceof yA(e).Element||e instanceof Element}function SA(e){return e instanceof yA(e).HTMLElement||e instanceof HTMLElement}function AA(e){return"undefined"!=typeof ShadowRoot&&(e instanceof yA(e).ShadowRoot||e instanceof ShadowRoot)}const xA={name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var s=t.styles[e]||{},n=t.attributes[e]||{},i=t.elements[e];SA(i)&&bA(i)&&(Object.assign(i.style,s),Object.keys(n).forEach((function(e){var t=n[e];!1===t?i.removeAttribute(e):i.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,s={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,s.popper),t.styles=s,t.elements.arrow&&Object.assign(t.elements.arrow.style,s.arrow),function(){Object.keys(t.elements).forEach((function(e){var n=t.elements[e],i=t.attributes[e]||{},r=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:s[e]).reduce((function(e,t){return e[t]="",e}),{});SA(n)&&bA(n)&&(Object.assign(n.style,r),Object.keys(i).forEach((function(e){n.removeAttribute(e)})))}))}},requires:["computeStyles"]};function EA(e){return e.split("-")[0]}var $A=Math.max,CA=Math.min,kA=Math.round;function jA(){var e=navigator.userAgentData;return null!=e&&e.brands&&Array.isArray(e.brands)?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function TA(){return!/^((?!chrome|android).)*safari/i.test(jA())}function OA(e,t,s){void 0===t&&(t=!1),void 0===s&&(s=!1);var n=e.getBoundingClientRect(),i=1,r=1;t&&SA(e)&&(i=e.offsetWidth>0&&kA(n.width)/e.offsetWidth||1,r=e.offsetHeight>0&&kA(n.height)/e.offsetHeight||1);var o=(wA(e)?yA(e):window).visualViewport,a=!TA()&&s,c=(n.left+(a&&o?o.offsetLeft:0))/i,l=(n.top+(a&&o?o.offsetTop:0))/r,d=n.width/i,u=n.height/r;return{width:d,height:u,top:l,right:c+d,bottom:l+u,left:c,x:c,y:l}}function NA(e){var t=OA(e),s=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-s)<=1&&(s=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:s,height:n}}function IA(e,t){var s=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(s&&AA(s)){var n=t;do{if(n&&e.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function MA(e){return yA(e).getComputedStyle(e)}function RA(e){return["table","td","th"].indexOf(bA(e))>=0}function DA(e){return((wA(e)?e.ownerDocument:e.document)||window.document).documentElement}function zA(e){return"html"===bA(e)?e:e.assignedSlot||e.parentNode||(AA(e)?e.host:null)||DA(e)}function LA(e){return SA(e)&&"fixed"!==MA(e).position?e.offsetParent:null}function PA(e){for(var t=yA(e),s=LA(e);s&&RA(s)&&"static"===MA(s).position;)s=LA(s);return s&&("html"===bA(s)||"body"===bA(s)&&"static"===MA(s).position)?t:s||function(e){var t=/firefox/i.test(jA());if(/Trident/i.test(jA())&&SA(e)&&"fixed"===MA(e).position)return null;var s=zA(e);for(AA(s)&&(s=s.host);SA(s)&&["html","body"].indexOf(bA(s))<0;){var n=MA(s);if("none"!==n.transform||"none"!==n.perspective||"paint"===n.contain||-1!==["transform","perspective"].indexOf(n.willChange)||t&&"filter"===n.willChange||t&&n.filter&&"none"!==n.filter)return s;s=s.parentNode}return null}(e)||t}function FA(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function UA(e,t,s){return $A(e,CA(t,s))}function BA(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function qA(e,t){return t.reduce((function(t,s){return t[s]=e,t}),{})}const HA={name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,s=e.state,n=e.name,i=e.options,r=s.elements.arrow,o=s.modifiersData.popperOffsets,a=EA(s.placement),c=FA(a),l=[XS,YS].indexOf(a)>=0?"height":"width";if(r&&o){var d=function(e,t){return BA("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:qA(e,eA))}(i.padding,s),u=NA(r),h="y"===c?KS:XS,m="y"===c?JS:YS,g=s.rects.reference[l]+s.rects.reference[c]-o[c]-s.rects.popper[l],p=o[c]-s.rects.reference[c],f=PA(r),v=f?"y"===c?f.clientHeight||0:f.clientWidth||0:0,_=g/2-p/2,b=d[h],y=v-u[l]-d[m],w=v/2-u[l]/2+_,S=UA(b,w,y),A=c;s.modifiersData[n]=((t={})[A]=S,t.centerOffset=S-w,t)}},effect:function(e){var t=e.state,s=e.options.element,n=void 0===s?"[data-popper-arrow]":s;null!=n&&("string"!=typeof n||(n=t.elements.popper.querySelector(n)))&&IA(t.elements.popper,n)&&(t.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function GA(e){return e.split("-")[1]}var WA={top:"auto",right:"auto",bottom:"auto",left:"auto"};function VA(e){var t,s=e.popper,n=e.popperRect,i=e.placement,r=e.variation,o=e.offsets,a=e.position,c=e.gpuAcceleration,l=e.adaptive,d=e.roundOffsets,u=e.isFixed,h=o.x,m=void 0===h?0:h,g=o.y,p=void 0===g?0:g,f="function"==typeof d?d({x:m,y:p}):{x:m,y:p};m=f.x,p=f.y;var v=o.hasOwnProperty("x"),_=o.hasOwnProperty("y"),b=XS,y=KS,w=window;if(l){var S=PA(s),A="clientHeight",x="clientWidth";if(S===yA(s)&&"static"!==MA(S=DA(s)).position&&"absolute"===a&&(A="scrollHeight",x="scrollWidth"),i===KS||(i===XS||i===YS)&&r===sA)y=JS,p-=(u&&S===w&&w.visualViewport?w.visualViewport.height:S[A])-n.height,p*=c?1:-1;if(i===XS||(i===KS||i===JS)&&r===sA)b=YS,m-=(u&&S===w&&w.visualViewport?w.visualViewport.width:S[x])-n.width,m*=c?1:-1}var E,$=Object.assign({position:a},l&&WA),C=!0===d?function(e,t){var s=e.x,n=e.y,i=t.devicePixelRatio||1;return{x:kA(s*i)/i||0,y:kA(n*i)/i||0}}({x:m,y:p},yA(s)):{x:m,y:p};return m=C.x,p=C.y,c?Object.assign({},$,((E={})[y]=_?"0":"",E[b]=v?"0":"",E.transform=(w.devicePixelRatio||1)<=1?"translate("+m+"px, "+p+"px)":"translate3d("+m+"px, "+p+"px, 0)",E)):Object.assign({},$,((t={})[y]=_?p+"px":"",t[b]=v?m+"px":"",t.transform="",t))}const QA={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,s=e.options,n=s.gpuAcceleration,i=void 0===n||n,r=s.adaptive,o=void 0===r||r,a=s.roundOffsets,c=void 0===a||a,l={placement:EA(t.placement),variation:GA(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,VA(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,VA(Object.assign({},l,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}};var KA={passive:!0};const JA={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,s=e.instance,n=e.options,i=n.scroll,r=void 0===i||i,o=n.resize,a=void 0===o||o,c=yA(t.elements.popper),l=[].concat(t.scrollParents.reference,t.scrollParents.popper);return r&&l.forEach((function(e){e.addEventListener("scroll",s.update,KA)})),a&&c.addEventListener("resize",s.update,KA),function(){r&&l.forEach((function(e){e.removeEventListener("scroll",s.update,KA)})),a&&c.removeEventListener("resize",s.update,KA)}},data:{}};var YA={left:"right",right:"left",bottom:"top",top:"bottom"};function XA(e){return e.replace(/left|right|bottom|top/g,(function(e){return YA[e]}))}var ZA={start:"end",end:"start"};function ex(e){return e.replace(/start|end/g,(function(e){return ZA[e]}))}function tx(e){var t=yA(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function sx(e){return OA(DA(e)).left+tx(e).scrollLeft}function nx(e){var t=MA(e),s=t.overflow,n=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(s+i+n)}function ix(e){return["html","body","#document"].indexOf(bA(e))>=0?e.ownerDocument.body:SA(e)&&nx(e)?e:ix(zA(e))}function rx(e,t){var s;void 0===t&&(t=[]);var n=ix(e),i=n===(null==(s=e.ownerDocument)?void 0:s.body),r=yA(n),o=i?[r].concat(r.visualViewport||[],nx(n)?n:[]):n,a=t.concat(o);return i?a:a.concat(rx(zA(o)))}function ox(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function ax(e,t,s){return t===iA?ox(function(e,t){var s=yA(e),n=DA(e),i=s.visualViewport,r=n.clientWidth,o=n.clientHeight,a=0,c=0;if(i){r=i.width,o=i.height;var l=TA();(l||!l&&"fixed"===t)&&(a=i.offsetLeft,c=i.offsetTop)}return{width:r,height:o,x:a+sx(e),y:c}}(e,s)):wA(t)?function(e,t){var s=OA(e,!1,"fixed"===t);return s.top=s.top+e.clientTop,s.left=s.left+e.clientLeft,s.bottom=s.top+e.clientHeight,s.right=s.left+e.clientWidth,s.width=e.clientWidth,s.height=e.clientHeight,s.x=s.left,s.y=s.top,s}(t,s):ox(function(e){var t,s=DA(e),n=tx(e),i=null==(t=e.ownerDocument)?void 0:t.body,r=$A(s.scrollWidth,s.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=$A(s.scrollHeight,s.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-n.scrollLeft+sx(e),c=-n.scrollTop;return"rtl"===MA(i||s).direction&&(a+=$A(s.clientWidth,i?i.clientWidth:0)-r),{width:r,height:o,x:a,y:c}}(DA(e)))}function cx(e,t,s,n){var i="clippingParents"===t?function(e){var t=rx(zA(e)),s=["absolute","fixed"].indexOf(MA(e).position)>=0&&SA(e)?PA(e):e;return wA(s)?t.filter((function(e){return wA(e)&&IA(e,s)&&"body"!==bA(e)})):[]}(e):[].concat(t),r=[].concat(i,[s]),o=r[0],a=r.reduce((function(t,s){var i=ax(e,s,n);return t.top=$A(i.top,t.top),t.right=CA(i.right,t.right),t.bottom=CA(i.bottom,t.bottom),t.left=$A(i.left,t.left),t}),ax(e,o,n));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function lx(e){var t,s=e.reference,n=e.element,i=e.placement,r=i?EA(i):null,o=i?GA(i):null,a=s.x+s.width/2-n.width/2,c=s.y+s.height/2-n.height/2;switch(r){case KS:t={x:a,y:s.y-n.height};break;case JS:t={x:a,y:s.y+s.height};break;case YS:t={x:s.x+s.width,y:c};break;case XS:t={x:s.x-n.width,y:c};break;default:t={x:s.x,y:s.y}}var l=r?FA(r):null;if(null!=l){var d="y"===l?"height":"width";switch(o){case tA:t[l]=t[l]-(s[d]/2-n[d]/2);break;case sA:t[l]=t[l]+(s[d]/2-n[d]/2)}}return t}function dx(e,t){void 0===t&&(t={});var s=t,n=s.placement,i=void 0===n?e.placement:n,r=s.strategy,o=void 0===r?e.strategy:r,a=s.boundary,c=void 0===a?nA:a,l=s.rootBoundary,d=void 0===l?iA:l,u=s.elementContext,h=void 0===u?rA:u,m=s.altBoundary,g=void 0!==m&&m,p=s.padding,f=void 0===p?0:p,v=BA("number"!=typeof f?f:qA(f,eA)),_=h===rA?oA:rA,b=e.rects.popper,y=e.elements[g?_:h],w=cx(wA(y)?y:y.contextElement||DA(e.elements.popper),c,d,o),S=OA(e.elements.reference),A=lx({reference:S,element:b,strategy:"absolute",placement:i}),x=ox(Object.assign({},b,A)),E=h===rA?x:S,$={top:w.top-E.top+v.top,bottom:E.bottom-w.bottom+v.bottom,left:w.left-E.left+v.left,right:E.right-w.right+v.right},C=e.modifiersData.offset;if(h===rA&&C){var k=C[i];Object.keys($).forEach((function(e){var t=[YS,JS].indexOf(e)>=0?1:-1,s=[KS,JS].indexOf(e)>=0?"y":"x";$[e]+=k[s]*t}))}return $}const ux={name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,s=e.options,n=e.name;if(!t.modifiersData[n]._skip){for(var i=s.mainAxis,r=void 0===i||i,o=s.altAxis,a=void 0===o||o,c=s.fallbackPlacements,l=s.padding,d=s.boundary,u=s.rootBoundary,h=s.altBoundary,m=s.flipVariations,g=void 0===m||m,p=s.allowedAutoPlacements,f=t.options.placement,v=EA(f),_=c||(v===f||!g?[XA(f)]:function(e){if(EA(e)===ZS)return[];var t=XA(e);return[ex(e),t,ex(t)]}(f)),b=[f].concat(_).reduce((function(e,s){return e.concat(EA(s)===ZS?function(e,t){void 0===t&&(t={});var s=t,n=s.placement,i=s.boundary,r=s.rootBoundary,o=s.padding,a=s.flipVariations,c=s.allowedAutoPlacements,l=void 0===c?cA:c,d=GA(n),u=d?a?aA:aA.filter((function(e){return GA(e)===d})):eA,h=u.filter((function(e){return l.indexOf(e)>=0}));0===h.length&&(h=u);var m=h.reduce((function(t,s){return t[s]=dx(e,{placement:s,boundary:i,rootBoundary:r,padding:o})[EA(s)],t}),{});return Object.keys(m).sort((function(e,t){return m[e]-m[t]}))}(t,{placement:s,boundary:d,rootBoundary:u,padding:l,flipVariations:g,allowedAutoPlacements:p}):s)}),[]),y=t.rects.reference,w=t.rects.popper,S=new Map,A=!0,x=b[0],E=0;E<b.length;E++){var $=b[E],C=EA($),k=GA($)===tA,j=[KS,JS].indexOf(C)>=0,T=j?"width":"height",O=dx(t,{placement:$,boundary:d,rootBoundary:u,altBoundary:h,padding:l}),N=j?k?YS:XS:k?JS:KS;y[T]>w[T]&&(N=XA(N));var I=XA(N),M=[];if(r&&M.push(O[C]<=0),a&&M.push(O[N]<=0,O[I]<=0),M.every((function(e){return e}))){x=$,A=!1;break}S.set($,M)}if(A)for(var R=function(e){var t=b.find((function(t){var s=S.get(t);if(s)return s.slice(0,e).every((function(e){return e}))}));if(t)return x=t,"break"},D=g?3:1;D>0;D--){if("break"===R(D))break}t.placement!==x&&(t.modifiersData[n]._skip=!0,t.placement=x,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function hx(e,t,s){return void 0===s&&(s={x:0,y:0}),{top:e.top-t.height-s.y,right:e.right-t.width+s.x,bottom:e.bottom-t.height+s.y,left:e.left-t.width-s.x}}function mx(e){return[KS,YS,JS,XS].some((function(t){return e[t]>=0}))}const gx={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,s=e.name,n=t.rects.reference,i=t.rects.popper,r=t.modifiersData.preventOverflow,o=dx(t,{elementContext:"reference"}),a=dx(t,{altBoundary:!0}),c=hx(o,n),l=hx(a,i,r),d=mx(c),u=mx(l);t.modifiersData[s]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:d,hasPopperEscaped:u},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":u})}};const px={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,s=e.options,n=e.name,i=s.offset,r=void 0===i?[0,0]:i,o=cA.reduce((function(e,s){return e[s]=function(e,t,s){var n=EA(e),i=[XS,KS].indexOf(n)>=0?-1:1,r="function"==typeof s?s(Object.assign({},t,{placement:e})):s,o=r[0],a=r[1];return o=o||0,a=(a||0)*i,[XS,YS].indexOf(n)>=0?{x:a,y:o}:{x:o,y:a}}(s,t.rects,r),e}),{}),a=o[t.placement],c=a.x,l=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=l),t.modifiersData[n]=o}};const fx={name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,s=e.name;t.modifiersData[s]=lx({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}};const vx={name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,s=e.options,n=e.name,i=s.mainAxis,r=void 0===i||i,o=s.altAxis,a=void 0!==o&&o,c=s.boundary,l=s.rootBoundary,d=s.altBoundary,u=s.padding,h=s.tether,m=void 0===h||h,g=s.tetherOffset,p=void 0===g?0:g,f=dx(t,{boundary:c,rootBoundary:l,padding:u,altBoundary:d}),v=EA(t.placement),_=GA(t.placement),b=!_,y=FA(v),w="x"===y?"y":"x",S=t.modifiersData.popperOffsets,A=t.rects.reference,x=t.rects.popper,E="function"==typeof p?p(Object.assign({},t.rects,{placement:t.placement})):p,$="number"==typeof E?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),C=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,k={x:0,y:0};if(S){if(r){var j,T="y"===y?KS:XS,O="y"===y?JS:YS,N="y"===y?"height":"width",I=S[y],M=I+f[T],R=I-f[O],D=m?-x[N]/2:0,z=_===tA?A[N]:x[N],L=_===tA?-x[N]:-A[N],P=t.elements.arrow,F=m&&P?NA(P):{width:0,height:0},U=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},B=U[T],q=U[O],H=UA(0,A[N],F[N]),G=b?A[N]/2-D-H-B-$.mainAxis:z-H-B-$.mainAxis,W=b?-A[N]/2+D+H+q+$.mainAxis:L+H+q+$.mainAxis,V=t.elements.arrow&&PA(t.elements.arrow),Q=V?"y"===y?V.clientTop||0:V.clientLeft||0:0,K=null!=(j=null==C?void 0:C[y])?j:0,J=I+W-K,Y=UA(m?CA(M,I+G-K-Q):M,I,m?$A(R,J):R);S[y]=Y,k[y]=Y-I}if(a){var X,Z="x"===y?KS:XS,ee="x"===y?JS:YS,te=S[w],se="y"===w?"height":"width",ne=te+f[Z],ie=te-f[ee],re=-1!==[KS,XS].indexOf(v),oe=null!=(X=null==C?void 0:C[w])?X:0,ae=re?ne:te-A[se]-x[se]-oe+$.altAxis,ce=re?te+A[se]+x[se]-oe-$.altAxis:ie,le=m&&re?function(e,t,s){var n=UA(e,t,s);return n>s?s:n}(ae,te,ce):UA(m?ae:ne,te,m?ce:ie);S[w]=le,k[w]=le-te}t.modifiersData[n]=k}},requiresIfExists:["offset"]};function _x(e,t,s){void 0===s&&(s=!1);var n,i,r=SA(t),o=SA(t)&&function(e){var t=e.getBoundingClientRect(),s=kA(t.width)/e.offsetWidth||1,n=kA(t.height)/e.offsetHeight||1;return 1!==s||1!==n}(t),a=DA(t),c=OA(e,o,s),l={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(r||!r&&!s)&&(("body"!==bA(t)||nx(a))&&(l=(n=t)!==yA(n)&&SA(n)?{scrollLeft:(i=n).scrollLeft,scrollTop:i.scrollTop}:tx(n)),SA(t)?((d=OA(t,!0)).x+=t.clientLeft,d.y+=t.clientTop):a&&(d.x=sx(a))),{x:c.left+l.scrollLeft-d.x,y:c.top+l.scrollTop-d.y,width:c.width,height:c.height}}function bx(e){var t=new Map,s=new Set,n=[];function i(e){s.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!s.has(e)){var n=t.get(e);n&&i(n)}})),n.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){s.has(e.name)||i(e)})),n}var yx={placement:"bottom",modifiers:[],strategy:"absolute"};function wx(){for(var e=arguments.length,t=new Array(e),s=0;s<e;s++)t[s]=arguments[s];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function Sx(e){void 0===e&&(e={});var t=e,s=t.defaultModifiers,n=void 0===s?[]:s,i=t.defaultOptions,r=void 0===i?yx:i;return function(e,t,s){void 0===s&&(s=r);var i,o,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},yx,r),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},c=[],l=!1,d={state:a,setOptions:function(s){var i="function"==typeof s?s(a.options):s;u(),a.options=Object.assign({},r,a.options,i),a.scrollParents={reference:wA(e)?rx(e):e.contextElement?rx(e.contextElement):[],popper:rx(t)};var o,l,h=function(e){var t=bx(e);return _A.reduce((function(e,s){return e.concat(t.filter((function(e){return e.phase===s})))}),[])}((o=[].concat(n,a.options.modifiers),l=o.reduce((function(e,t){var s=e[t.name];return e[t.name]=s?Object.assign({},s,t,{options:Object.assign({},s.options,t.options),data:Object.assign({},s.data,t.data)}):t,e}),{}),Object.keys(l).map((function(e){return l[e]}))));return a.orderedModifiers=h.filter((function(e){return e.enabled})),a.orderedModifiers.forEach((function(e){var t=e.name,s=e.options,n=void 0===s?{}:s,i=e.effect;if("function"==typeof i){var r=i({state:a,name:t,instance:d,options:n}),o=function(){};c.push(r||o)}})),d.update()},forceUpdate:function(){if(!l){var e=a.elements,t=e.reference,s=e.popper;if(wx(t,s)){a.rects={reference:_x(t,PA(s),"fixed"===a.options.strategy),popper:NA(s)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(e){return a.modifiersData[e.name]=Object.assign({},e.data)}));for(var n=0;n<a.orderedModifiers.length;n++)if(!0!==a.reset){var i=a.orderedModifiers[n],r=i.fn,o=i.options,c=void 0===o?{}:o,u=i.name;"function"==typeof r&&(a=r({state:a,options:c,name:u,instance:d})||a)}else a.reset=!1,n=-1}}},update:(i=function(){return new Promise((function(e){d.forceUpdate(),e(a)}))},function(){return o||(o=new Promise((function(e){Promise.resolve().then((function(){o=void 0,e(i())}))}))),o}),destroy:function(){u(),l=!0}};if(!wx(e,t))return d;function u(){c.forEach((function(e){return e()})),c=[]}return d.setOptions(s).then((function(e){!l&&s.onFirstUpdate&&s.onFirstUpdate(e)})),d}}var Ax=Sx(),xx=Sx({defaultModifiers:[JA,fx,QA,xA,px,ux,vx,HA,gx]}),Ex=Sx({defaultModifiers:[JA,fx,QA,xA]});const $x=new Map,Cx={set(e,t,s){$x.has(e)||$x.set(e,new Map);const n=$x.get(e);n.has(t)||0===n.size?n.set(t,s):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(n.keys())[0]}.`)},get:(e,t)=>$x.has(e)&&$x.get(e).get(t)||null,remove(e,t){if(!$x.has(e))return;const s=$x.get(e);s.delete(t),0===s.size&&$x.delete(e)}},kx="transitionend",jx=e=>(e&&window.CSS&&window.CSS.escape&&(e=e.replace(/#([^\s"#']+)/g,((e,t)=>`#${CSS.escape(t)}`))),e),Tx=e=>{e.dispatchEvent(new Event(kx))},Ox=e=>!(!e||"object"!=typeof e)&&(void 0!==e.jquery&&(e=e[0]),void 0!==e.nodeType),Nx=e=>Ox(e)?e.jquery?e[0]:e:"string"==typeof e&&e.length>0?document.querySelector(jx(e)):null,Ix=e=>{if(!Ox(e)||0===e.getClientRects().length)return!1;const t="visible"===getComputedStyle(e).getPropertyValue("visibility"),s=e.closest("details:not([open])");if(!s)return t;if(s!==e){const t=e.closest("summary");if(t&&t.parentNode!==s)return!1;if(null===t)return!1}return t},Mx=e=>!e||e.nodeType!==Node.ELEMENT_NODE||(!!e.classList.contains("disabled")||(void 0!==e.disabled?e.disabled:e.hasAttribute("disabled")&&"false"!==e.getAttribute("disabled"))),Rx=e=>{if(!document.documentElement.attachShadow)return null;if("function"==typeof e.getRootNode){const t=e.getRootNode();return t instanceof ShadowRoot?t:null}return e instanceof ShadowRoot?e:e.parentNode?Rx(e.parentNode):null},Dx=()=>{},zx=e=>{e.offsetHeight},Lx=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Px=[],Fx=()=>"rtl"===document.documentElement.dir,Ux=e=>{var t;t=()=>{const t=Lx();if(t){const s=e.NAME,n=t.fn[s];t.fn[s]=e.jQueryInterface,t.fn[s].Constructor=e,t.fn[s].noConflict=()=>(t.fn[s]=n,e.jQueryInterface)}},"loading"===document.readyState?(Px.length||document.addEventListener("DOMContentLoaded",(()=>{for(const e of Px)e()})),Px.push(t)):t()},Bx=(e,t=[],s=e)=>"function"==typeof e?e(...t):s,qx=(e,t,s=!0)=>{if(!s)return void Bx(e);const n=(e=>{if(!e)return 0;let{transitionDuration:t,transitionDelay:s}=window.getComputedStyle(e);const n=Number.parseFloat(t),i=Number.parseFloat(s);return n||i?(t=t.split(",")[0],s=s.split(",")[0],1e3*(Number.parseFloat(t)+Number.parseFloat(s))):0})(t)+5;let i=!1;const r=({target:s})=>{s===t&&(i=!0,t.removeEventListener(kx,r),Bx(e))};t.addEventListener(kx,r),setTimeout((()=>{i||Tx(t)}),n)},Hx=(e,t,s,n)=>{const i=e.length;let r=e.indexOf(t);return-1===r?!s&&n?e[i-1]:e[0]:(r+=s?1:-1,n&&(r=(r+i)%i),e[Math.max(0,Math.min(r,i-1))])},Gx=/[^.]*(?=\..*)\.|.*/,Wx=/\..*/,Vx=/::\d+$/,Qx={};let Kx=1;const Jx={mouseenter:"mouseover",mouseleave:"mouseout"},Yx=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function Xx(e,t){return t&&`${t}::${Kx++}`||e.uidEvent||Kx++}function Zx(e){const t=Xx(e);return e.uidEvent=t,Qx[t]=Qx[t]||{},Qx[t]}function eE(e,t,s=null){return Object.values(e).find((e=>e.callable===t&&e.delegationSelector===s))}function tE(e,t,s){const n="string"==typeof t,i=n?s:t||s;let r=rE(e);return Yx.has(r)||(r=e),[n,i,r]}function sE(e,t,s,n,i){if("string"!=typeof t||!e)return;let[r,o,a]=tE(t,s,n);if(t in Jx){const e=e=>function(t){if(!t.relatedTarget||t.relatedTarget!==t.delegateTarget&&!t.delegateTarget.contains(t.relatedTarget))return e.call(this,t)};o=e(o)}const c=Zx(e),l=c[a]||(c[a]={}),d=eE(l,o,r?s:null);if(d)return void(d.oneOff=d.oneOff&&i);const u=Xx(o,t.replace(Gx,"")),h=r?function(e,t,s){return function n(i){const r=e.querySelectorAll(t);for(let{target:o}=i;o&&o!==this;o=o.parentNode)for(const a of r)if(a===o)return aE(i,{delegateTarget:o}),n.oneOff&&oE.off(e,i.type,t,s),s.apply(o,[i])}}(e,s,o):function(e,t){return function s(n){return aE(n,{delegateTarget:e}),s.oneOff&&oE.off(e,n.type,t),t.apply(e,[n])}}(e,o);h.delegationSelector=r?s:null,h.callable=o,h.oneOff=i,h.uidEvent=u,l[u]=h,e.addEventListener(a,h,r)}function nE(e,t,s,n,i){const r=eE(t[s],n,i);r&&(e.removeEventListener(s,r,Boolean(i)),delete t[s][r.uidEvent])}function iE(e,t,s,n){const i=t[s]||{};for(const[r,o]of Object.entries(i))r.includes(n)&&nE(e,t,s,o.callable,o.delegationSelector)}function rE(e){return e=e.replace(Wx,""),Jx[e]||e}const oE={on(e,t,s,n){sE(e,t,s,n,!1)},one(e,t,s,n){sE(e,t,s,n,!0)},off(e,t,s,n){if("string"!=typeof t||!e)return;const[i,r,o]=tE(t,s,n),a=o!==t,c=Zx(e),l=c[o]||{},d=t.startsWith(".");if(void 0===r){if(d)for(const s of Object.keys(c))iE(e,c,s,t.slice(1));for(const[s,n]of Object.entries(l)){const i=s.replace(Vx,"");a&&!t.includes(i)||nE(e,c,o,n.callable,n.delegationSelector)}}else{if(!Object.keys(l).length)return;nE(e,c,o,r,i?s:null)}},trigger(e,t,s){if("string"!=typeof t||!e)return null;const n=Lx();let i=null,r=!0,o=!0,a=!1;t!==rE(t)&&n&&(i=n.Event(t,s),n(e).trigger(i),r=!i.isPropagationStopped(),o=!i.isImmediatePropagationStopped(),a=i.isDefaultPrevented());const c=aE(new Event(t,{bubbles:r,cancelable:!0}),s);return a&&c.preventDefault(),o&&e.dispatchEvent(c),c.defaultPrevented&&i&&i.preventDefault(),c}};function aE(e,t={}){for(const[s,n]of Object.entries(t))try{e[s]=n}catch(t){Object.defineProperty(e,s,{configurable:!0,get:()=>n})}return e}function cE(e){if("true"===e)return!0;if("false"===e)return!1;if(e===Number(e).toString())return Number(e);if(""===e||"null"===e)return null;if("string"!=typeof e)return e;try{return JSON.parse(decodeURIComponent(e))}catch(t){return e}}function lE(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}const dE={setDataAttribute(e,t,s){e.setAttribute(`data-bs-${lE(t)}`,s)},removeDataAttribute(e,t){e.removeAttribute(`data-bs-${lE(t)}`)},getDataAttributes(e){if(!e)return{};const t={},s=Object.keys(e.dataset).filter((e=>e.startsWith("bs")&&!e.startsWith("bsConfig")));for(const n of s){let s=n.replace(/^bs/,"");s=s.charAt(0).toLowerCase()+s.slice(1,s.length),t[s]=cE(e.dataset[n])}return t},getDataAttribute:(e,t)=>cE(e.getAttribute(`data-bs-${lE(t)}`))};class uE{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(e){return e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e}_mergeConfigObj(e,t){const s=Ox(t)?dE.getDataAttribute(t,"config"):{};return{...this.constructor.Default,..."object"==typeof s?s:{},...Ox(t)?dE.getDataAttributes(t):{},..."object"==typeof e?e:{}}}_typeCheckConfig(e,t=this.constructor.DefaultType){for(const[n,i]of Object.entries(t)){const t=e[n],r=Ox(t)?"element":null==(s=t)?`${s}`:Object.prototype.toString.call(s).match(/\s([a-z]+)/i)[1].toLowerCase();if(!new RegExp(i).test(r))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${n}" provided type "${r}" but expected type "${i}".`)}var s}}class hE extends uE{constructor(e,t){super(),(e=Nx(e))&&(this._element=e,this._config=this._getConfig(t),Cx.set(this._element,this.constructor.DATA_KEY,this))}dispose(){Cx.remove(this._element,this.constructor.DATA_KEY),oE.off(this._element,this.constructor.EVENT_KEY);for(const e of Object.getOwnPropertyNames(this))this[e]=null}_queueCallback(e,t,s=!0){qx(e,t,s)}_getConfig(e){return e=this._mergeConfigObj(e,this._element),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}static getInstance(e){return Cx.get(Nx(e),this.DATA_KEY)}static getOrCreateInstance(e,t={}){return this.getInstance(e)||new this(e,"object"==typeof t?t:null)}static get VERSION(){return"5.3.3"}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(e){return`${e}${this.EVENT_KEY}`}}const mE=e=>{let t=e.getAttribute("data-bs-target");if(!t||"#"===t){let s=e.getAttribute("href");if(!s||!s.includes("#")&&!s.startsWith("."))return null;s.includes("#")&&!s.startsWith("#")&&(s=`#${s.split("#")[1]}`),t=s&&"#"!==s?s.trim():null}return t?t.split(",").map((e=>jx(e))).join(","):null},gE={find:(e,t=document.documentElement)=>[].concat(...Element.prototype.querySelectorAll.call(t,e)),findOne:(e,t=document.documentElement)=>Element.prototype.querySelector.call(t,e),children:(e,t)=>[].concat(...e.children).filter((e=>e.matches(t))),parents(e,t){const s=[];let n=e.parentNode.closest(t);for(;n;)s.push(n),n=n.parentNode.closest(t);return s},prev(e,t){let s=e.previousElementSibling;for(;s;){if(s.matches(t))return[s];s=s.previousElementSibling}return[]},next(e,t){let s=e.nextElementSibling;for(;s;){if(s.matches(t))return[s];s=s.nextElementSibling}return[]},focusableChildren(e){const t=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((e=>`${e}:not([tabindex^="-"])`)).join(",");return this.find(t,e).filter((e=>!Mx(e)&&Ix(e)))},getSelectorFromElement(e){const t=mE(e);return t&&gE.findOne(t)?t:null},getElementFromSelector(e){const t=mE(e);return t?gE.findOne(t):null},getMultipleElementsFromSelector(e){const t=mE(e);return t?gE.find(t):[]}},pE=(e,t="hide")=>{const s=`click.dismiss${e.EVENT_KEY}`,n=e.NAME;oE.on(document,s,`[data-bs-dismiss="${n}"]`,(function(s){if(["A","AREA"].includes(this.tagName)&&s.preventDefault(),Mx(this))return;const i=gE.getElementFromSelector(this)||this.closest(`.${n}`);e.getOrCreateInstance(i)[t]()}))},fE=".bs.alert",vE=`close${fE}`,_E=`closed${fE}`;class bE extends hE{static get NAME(){return"alert"}close(){if(oE.trigger(this._element,vE).defaultPrevented)return;this._element.classList.remove("show");const e=this._element.classList.contains("fade");this._queueCallback((()=>this._destroyElement()),this._element,e)}_destroyElement(){this._element.remove(),oE.trigger(this._element,_E),this.dispose()}static jQueryInterface(e){return this.each((function(){const t=bE.getOrCreateInstance(this);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e](this)}}))}}pE(bE,"close"),Ux(bE);const yE='[data-bs-toggle="button"]';class wE extends hE{static get NAME(){return"button"}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle("active"))}static jQueryInterface(e){return this.each((function(){const t=wE.getOrCreateInstance(this);"toggle"===e&&t[e]()}))}}oE.on(document,"click.bs.button.data-api",yE,(e=>{e.preventDefault();const t=e.target.closest(yE);wE.getOrCreateInstance(t).toggle()})),Ux(wE);const SE=".bs.swipe",AE=`touchstart${SE}`,xE=`touchmove${SE}`,EE=`touchend${SE}`,$E=`pointerdown${SE}`,CE=`pointerup${SE}`,kE={endCallback:null,leftCallback:null,rightCallback:null},jE={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class TE extends uE{constructor(e,t){super(),this._element=e,e&&TE.isSupported()&&(this._config=this._getConfig(t),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return kE}static get DefaultType(){return jE}static get NAME(){return"swipe"}dispose(){oE.off(this._element,SE)}_start(e){this._supportPointerEvents?this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX):this._deltaX=e.touches[0].clientX}_end(e){this._eventIsPointerPenTouch(e)&&(this._deltaX=e.clientX-this._deltaX),this._handleSwipe(),Bx(this._config.endCallback)}_move(e){this._deltaX=e.touches&&e.touches.length>1?0:e.touches[0].clientX-this._deltaX}_handleSwipe(){const e=Math.abs(this._deltaX);if(e<=40)return;const t=e/this._deltaX;this._deltaX=0,t&&Bx(t>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(oE.on(this._element,$E,(e=>this._start(e))),oE.on(this._element,CE,(e=>this._end(e))),this._element.classList.add("pointer-event")):(oE.on(this._element,AE,(e=>this._start(e))),oE.on(this._element,xE,(e=>this._move(e))),oE.on(this._element,EE,(e=>this._end(e))))}_eventIsPointerPenTouch(e){return this._supportPointerEvents&&("pen"===e.pointerType||"touch"===e.pointerType)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const OE=".bs.carousel",NE=".data-api",IE="ArrowLeft",ME="ArrowRight",RE="next",DE="prev",zE="left",LE="right",PE=`slide${OE}`,FE=`slid${OE}`,UE=`keydown${OE}`,BE=`mouseenter${OE}`,qE=`mouseleave${OE}`,HE=`dragstart${OE}`,GE=`load${OE}${NE}`,WE=`click${OE}${NE}`,VE="carousel",QE="active",KE=".active",JE=".carousel-item",YE=KE+JE,XE={[IE]:LE,[ME]:zE},ZE={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},e$={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class t$ extends hE{constructor(e,t){super(e,t),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=gE.findOne(".carousel-indicators",this._element),this._addEventListeners(),this._config.ride===VE&&this.cycle()}static get Default(){return ZE}static get DefaultType(){return e$}static get NAME(){return"carousel"}next(){this._slide(RE)}nextWhenVisible(){!document.hidden&&Ix(this._element)&&this.next()}prev(){this._slide(DE)}pause(){this._isSliding&&Tx(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval((()=>this.nextWhenVisible()),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?oE.one(this._element,FE,(()=>this.cycle())):this.cycle())}to(e){const t=this._getItems();if(e>t.length-1||e<0)return;if(this._isSliding)return void oE.one(this._element,FE,(()=>this.to(e)));const s=this._getItemIndex(this._getActive());if(s===e)return;const n=e>s?RE:DE;this._slide(n,t[e])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(e){return e.defaultInterval=e.interval,e}_addEventListeners(){this._config.keyboard&&oE.on(this._element,UE,(e=>this._keydown(e))),"hover"===this._config.pause&&(oE.on(this._element,BE,(()=>this.pause())),oE.on(this._element,qE,(()=>this._maybeEnableCycle()))),this._config.touch&&TE.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const e of gE.find(".carousel-item img",this._element))oE.on(e,HE,(e=>e.preventDefault()));const e={leftCallback:()=>this._slide(this._directionToOrder(zE)),rightCallback:()=>this._slide(this._directionToOrder(LE)),endCallback:()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout((()=>this._maybeEnableCycle()),500+this._config.interval))}};this._swipeHelper=new TE(this._element,e)}_keydown(e){if(/input|textarea/i.test(e.target.tagName))return;const t=XE[e.key];t&&(e.preventDefault(),this._slide(this._directionToOrder(t)))}_getItemIndex(e){return this._getItems().indexOf(e)}_setActiveIndicatorElement(e){if(!this._indicatorsElement)return;const t=gE.findOne(KE,this._indicatorsElement);t.classList.remove(QE),t.removeAttribute("aria-current");const s=gE.findOne(`[data-bs-slide-to="${e}"]`,this._indicatorsElement);s&&(s.classList.add(QE),s.setAttribute("aria-current","true"))}_updateInterval(){const e=this._activeElement||this._getActive();if(!e)return;const t=Number.parseInt(e.getAttribute("data-bs-interval"),10);this._config.interval=t||this._config.defaultInterval}_slide(e,t=null){if(this._isSliding)return;const s=this._getActive(),n=e===RE,i=t||Hx(this._getItems(),s,n,this._config.wrap);if(i===s)return;const r=this._getItemIndex(i),o=t=>oE.trigger(this._element,t,{relatedTarget:i,direction:this._orderToDirection(e),from:this._getItemIndex(s),to:r});if(o(PE).defaultPrevented)return;if(!s||!i)return;const a=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(r),this._activeElement=i;const c=n?"carousel-item-start":"carousel-item-end",l=n?"carousel-item-next":"carousel-item-prev";i.classList.add(l),zx(i),s.classList.add(c),i.classList.add(c);this._queueCallback((()=>{i.classList.remove(c,l),i.classList.add(QE),s.classList.remove(QE,l,c),this._isSliding=!1,o(FE)}),s,this._isAnimated()),a&&this.cycle()}_isAnimated(){return this._element.classList.contains("slide")}_getActive(){return gE.findOne(YE,this._element)}_getItems(){return gE.find(JE,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(e){return Fx()?e===zE?DE:RE:e===zE?RE:DE}_orderToDirection(e){return Fx()?e===DE?zE:LE:e===DE?LE:zE}static jQueryInterface(e){return this.each((function(){const t=t$.getOrCreateInstance(this,e);if("number"!=typeof e){if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e]()}}else t.to(e)}))}}oE.on(document,WE,"[data-bs-slide], [data-bs-slide-to]",(function(e){const t=gE.getElementFromSelector(this);if(!t||!t.classList.contains(VE))return;e.preventDefault();const s=t$.getOrCreateInstance(t),n=this.getAttribute("data-bs-slide-to");return n?(s.to(n),void s._maybeEnableCycle()):"next"===dE.getDataAttribute(this,"slide")?(s.next(),void s._maybeEnableCycle()):(s.prev(),void s._maybeEnableCycle())})),oE.on(window,GE,(()=>{const e=gE.find('[data-bs-ride="carousel"]');for(const t of e)t$.getOrCreateInstance(t)})),Ux(t$);const s$=".bs.collapse",n$=`show${s$}`,i$=`shown${s$}`,r$=`hide${s$}`,o$=`hidden${s$}`,a$=`click${s$}.data-api`,c$="show",l$="collapse",d$="collapsing",u$=`:scope .${l$} .${l$}`,h$='[data-bs-toggle="collapse"]',m$={parent:null,toggle:!0},g$={parent:"(null|element)",toggle:"boolean"};class p$ extends hE{constructor(e,t){super(e,t),this._isTransitioning=!1,this._triggerArray=[];const s=gE.find(h$);for(const e of s){const t=gE.getSelectorFromElement(e),s=gE.find(t).filter((e=>e===this._element));null!==t&&s.length&&this._triggerArray.push(e)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return m$}static get DefaultType(){return g$}static get NAME(){return"collapse"}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let e=[];if(this._config.parent&&(e=this._getFirstLevelChildren(".collapse.show, .collapse.collapsing").filter((e=>e!==this._element)).map((e=>p$.getOrCreateInstance(e,{toggle:!1})))),e.length&&e[0]._isTransitioning)return;if(oE.trigger(this._element,n$).defaultPrevented)return;for(const t of e)t.hide();const t=this._getDimension();this._element.classList.remove(l$),this._element.classList.add(d$),this._element.style[t]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const s=`scroll${t[0].toUpperCase()+t.slice(1)}`;this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(d$),this._element.classList.add(l$,c$),this._element.style[t]="",oE.trigger(this._element,i$)}),this._element,!0),this._element.style[t]=`${this._element[s]}px`}hide(){if(this._isTransitioning||!this._isShown())return;if(oE.trigger(this._element,r$).defaultPrevented)return;const e=this._getDimension();this._element.style[e]=`${this._element.getBoundingClientRect()[e]}px`,zx(this._element),this._element.classList.add(d$),this._element.classList.remove(l$,c$);for(const e of this._triggerArray){const t=gE.getElementFromSelector(e);t&&!this._isShown(t)&&this._addAriaAndCollapsedClass([e],!1)}this._isTransitioning=!0;this._element.style[e]="",this._queueCallback((()=>{this._isTransitioning=!1,this._element.classList.remove(d$),this._element.classList.add(l$),oE.trigger(this._element,o$)}),this._element,!0)}_isShown(e=this._element){return e.classList.contains(c$)}_configAfterMerge(e){return e.toggle=Boolean(e.toggle),e.parent=Nx(e.parent),e}_getDimension(){return this._element.classList.contains("collapse-horizontal")?"width":"height"}_initializeChildren(){if(!this._config.parent)return;const e=this._getFirstLevelChildren(h$);for(const t of e){const e=gE.getElementFromSelector(t);e&&this._addAriaAndCollapsedClass([t],this._isShown(e))}}_getFirstLevelChildren(e){const t=gE.find(u$,this._config.parent);return gE.find(e,this._config.parent).filter((e=>!t.includes(e)))}_addAriaAndCollapsedClass(e,t){if(e.length)for(const s of e)s.classList.toggle("collapsed",!t),s.setAttribute("aria-expanded",t)}static jQueryInterface(e){const t={};return"string"==typeof e&&/show|hide/.test(e)&&(t.toggle=!1),this.each((function(){const s=p$.getOrCreateInstance(this,t);if("string"==typeof e){if(void 0===s[e])throw new TypeError(`No method named "${e}"`);s[e]()}}))}}oE.on(document,a$,h$,(function(e){("A"===e.target.tagName||e.delegateTarget&&"A"===e.delegateTarget.tagName)&&e.preventDefault();for(const e of gE.getMultipleElementsFromSelector(this))p$.getOrCreateInstance(e,{toggle:!1}).toggle()})),Ux(p$);const f$="dropdown",v$=".bs.dropdown",_$=".data-api",b$="ArrowUp",y$="ArrowDown",w$=`hide${v$}`,S$=`hidden${v$}`,A$=`show${v$}`,x$=`shown${v$}`,E$=`click${v$}${_$}`,$$=`keydown${v$}${_$}`,C$=`keyup${v$}${_$}`,k$="show",j$='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',T$=`${j$}.${k$}`,O$=".dropdown-menu",N$=Fx()?"top-end":"top-start",I$=Fx()?"top-start":"top-end",M$=Fx()?"bottom-end":"bottom-start",R$=Fx()?"bottom-start":"bottom-end",D$=Fx()?"left-start":"right-start",z$=Fx()?"right-start":"left-start",L$={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},P$={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class F$ extends hE{constructor(e,t){super(e,t),this._popper=null,this._parent=this._element.parentNode,this._menu=gE.next(this._element,O$)[0]||gE.prev(this._element,O$)[0]||gE.findOne(O$,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return L$}static get DefaultType(){return P$}static get NAME(){return f$}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Mx(this._element)||this._isShown())return;const e={relatedTarget:this._element};if(!oE.trigger(this._element,A$,e).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(".navbar-nav"))for(const e of[].concat(...document.body.children))oE.on(e,"mouseover",Dx);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(k$),this._element.classList.add(k$),oE.trigger(this._element,x$,e)}}hide(){if(Mx(this._element)||!this._isShown())return;const e={relatedTarget:this._element};this._completeHide(e)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(e){if(!oE.trigger(this._element,w$,e).defaultPrevented){if("ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))oE.off(e,"mouseover",Dx);this._popper&&this._popper.destroy(),this._menu.classList.remove(k$),this._element.classList.remove(k$),this._element.setAttribute("aria-expanded","false"),dE.removeDataAttribute(this._menu,"popper"),oE.trigger(this._element,S$,e)}}_getConfig(e){if("object"==typeof(e=super._getConfig(e)).reference&&!Ox(e.reference)&&"function"!=typeof e.reference.getBoundingClientRect)throw new TypeError(`${f$.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return e}_createPopper(){if(void 0===w)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let e=this._element;"parent"===this._config.reference?e=this._parent:Ox(this._config.reference)?e=Nx(this._config.reference):"object"==typeof this._config.reference&&(e=this._config.reference);const t=this._getPopperConfig();this._popper=xx(e,this._menu,t)}_isShown(){return this._menu.classList.contains(k$)}_getPlacement(){const e=this._parent;if(e.classList.contains("dropend"))return D$;if(e.classList.contains("dropstart"))return z$;if(e.classList.contains("dropup-center"))return"top";if(e.classList.contains("dropdown-center"))return"bottom";const t="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return e.classList.contains("dropup")?t?I$:N$:t?R$:M$}_detectNavbar(){return null!==this._element.closest(".navbar")}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map((e=>Number.parseInt(e,10))):"function"==typeof e?t=>e(t,this._element):e}_getPopperConfig(){const e={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(dE.setDataAttribute(this._menu,"popper","static"),e.modifiers=[{name:"applyStyles",enabled:!1}]),{...e,...Bx(this._config.popperConfig,[e])}}_selectMenuItem({key:e,target:t}){const s=gE.find(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",this._menu).filter((e=>Ix(e)));s.length&&Hx(s,t,e===y$,!s.includes(t)).focus()}static jQueryInterface(e){return this.each((function(){const t=F$.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}static clearMenus(e){if(2===e.button||"keyup"===e.type&&"Tab"!==e.key)return;const t=gE.find(T$);for(const s of t){const t=F$.getInstance(s);if(!t||!1===t._config.autoClose)continue;const n=e.composedPath(),i=n.includes(t._menu);if(n.includes(t._element)||"inside"===t._config.autoClose&&!i||"outside"===t._config.autoClose&&i)continue;if(t._menu.contains(e.target)&&("keyup"===e.type&&"Tab"===e.key||/input|select|option|textarea|form/i.test(e.target.tagName)))continue;const r={relatedTarget:t._element};"click"===e.type&&(r.clickEvent=e),t._completeHide(r)}}static dataApiKeydownHandler(e){const t=/input|textarea/i.test(e.target.tagName),s="Escape"===e.key,n=[b$,y$].includes(e.key);if(!n&&!s)return;if(t&&!s)return;e.preventDefault();const i=this.matches(j$)?this:gE.prev(this,j$)[0]||gE.next(this,j$)[0]||gE.findOne(j$,e.delegateTarget.parentNode),r=F$.getOrCreateInstance(i);if(n)return e.stopPropagation(),r.show(),void r._selectMenuItem(e);r._isShown()&&(e.stopPropagation(),r.hide(),i.focus())}}oE.on(document,$$,j$,F$.dataApiKeydownHandler),oE.on(document,$$,O$,F$.dataApiKeydownHandler),oE.on(document,E$,F$.clearMenus),oE.on(document,C$,F$.clearMenus),oE.on(document,E$,j$,(function(e){e.preventDefault(),F$.getOrCreateInstance(this).toggle()})),Ux(F$);const U$="backdrop",B$="show",q$=`mousedown.bs.${U$}`,H$={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},G$={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class W$ extends uE{constructor(e){super(),this._config=this._getConfig(e),this._isAppended=!1,this._element=null}static get Default(){return H$}static get DefaultType(){return G$}static get NAME(){return U$}show(e){if(!this._config.isVisible)return void Bx(e);this._append();const t=this._getElement();this._config.isAnimated&&zx(t),t.classList.add(B$),this._emulateAnimation((()=>{Bx(e)}))}hide(e){this._config.isVisible?(this._getElement().classList.remove(B$),this._emulateAnimation((()=>{this.dispose(),Bx(e)}))):Bx(e)}dispose(){this._isAppended&&(oE.off(this._element,q$),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const e=document.createElement("div");e.className=this._config.className,this._config.isAnimated&&e.classList.add("fade"),this._element=e}return this._element}_configAfterMerge(e){return e.rootElement=Nx(e.rootElement),e}_append(){if(this._isAppended)return;const e=this._getElement();this._config.rootElement.append(e),oE.on(e,q$,(()=>{Bx(this._config.clickCallback)})),this._isAppended=!0}_emulateAnimation(e){qx(e,this._getElement(),this._config.isAnimated)}}const V$=".bs.focustrap",Q$=`focusin${V$}`,K$=`keydown.tab${V$}`,J$="backward",Y$={autofocus:!0,trapElement:null},X$={autofocus:"boolean",trapElement:"element"};class Z$ extends uE{constructor(e){super(),this._config=this._getConfig(e),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Y$}static get DefaultType(){return X$}static get NAME(){return"focustrap"}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),oE.off(document,V$),oE.on(document,Q$,(e=>this._handleFocusin(e))),oE.on(document,K$,(e=>this._handleKeydown(e))),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,oE.off(document,V$))}_handleFocusin(e){const{trapElement:t}=this._config;if(e.target===document||e.target===t||t.contains(e.target))return;const s=gE.focusableChildren(t);0===s.length?t.focus():this._lastTabNavDirection===J$?s[s.length-1].focus():s[0].focus()}_handleKeydown(e){"Tab"===e.key&&(this._lastTabNavDirection=e.shiftKey?J$:"forward")}}const eC=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",tC=".sticky-top",sC="padding-right",nC="margin-right";class iC{constructor(){this._element=document.body}getWidth(){const e=document.documentElement.clientWidth;return Math.abs(window.innerWidth-e)}hide(){const e=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,sC,(t=>t+e)),this._setElementAttributes(eC,sC,(t=>t+e)),this._setElementAttributes(tC,nC,(t=>t-e))}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,sC),this._resetElementAttributes(eC,sC),this._resetElementAttributes(tC,nC)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(e,t,s){const n=this.getWidth();this._applyManipulationCallback(e,(e=>{if(e!==this._element&&window.innerWidth>e.clientWidth+n)return;this._saveInitialAttribute(e,t);const i=window.getComputedStyle(e).getPropertyValue(t);e.style.setProperty(t,`${s(Number.parseFloat(i))}px`)}))}_saveInitialAttribute(e,t){const s=e.style.getPropertyValue(t);s&&dE.setDataAttribute(e,t,s)}_resetElementAttributes(e,t){this._applyManipulationCallback(e,(e=>{const s=dE.getDataAttribute(e,t);null!==s?(dE.removeDataAttribute(e,t),e.style.setProperty(t,s)):e.style.removeProperty(t)}))}_applyManipulationCallback(e,t){if(Ox(e))t(e);else for(const s of gE.find(e,this._element))t(s)}}const rC=".bs.modal",oC=`hide${rC}`,aC=`hidePrevented${rC}`,cC=`hidden${rC}`,lC=`show${rC}`,dC=`shown${rC}`,uC=`resize${rC}`,hC=`click.dismiss${rC}`,mC=`mousedown.dismiss${rC}`,gC=`keydown.dismiss${rC}`,pC=`click${rC}.data-api`,fC="modal-open",vC="show",_C="modal-static",bC={backdrop:!0,focus:!0,keyboard:!0},yC={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class wC extends hE{constructor(e,t){super(e,t),this._dialog=gE.findOne(".modal-dialog",this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new iC,this._addEventListeners()}static get Default(){return bC}static get DefaultType(){return yC}static get NAME(){return"modal"}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown||this._isTransitioning)return;oE.trigger(this._element,lC,{relatedTarget:e}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(fC),this._adjustDialog(),this._backdrop.show((()=>this._showElement(e))))}hide(){if(!this._isShown||this._isTransitioning)return;oE.trigger(this._element,oC).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(vC),this._queueCallback((()=>this._hideModal()),this._element,this._isAnimated()))}dispose(){oE.off(window,rC),oE.off(this._dialog,rC),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new W$({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Z$({trapElement:this._element})}_showElement(e){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const t=gE.findOne(".modal-body",this._dialog);t&&(t.scrollTop=0),zx(this._element),this._element.classList.add(vC);this._queueCallback((()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,oE.trigger(this._element,dC,{relatedTarget:e})}),this._dialog,this._isAnimated())}_addEventListeners(){oE.on(this._element,gC,(e=>{"Escape"===e.key&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())})),oE.on(window,uC,(()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()})),oE.on(this._element,mC,(e=>{oE.one(this._element,hC,(t=>{this._element===e.target&&this._element===t.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())}))}))}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide((()=>{document.body.classList.remove(fC),this._resetAdjustments(),this._scrollBar.reset(),oE.trigger(this._element,cC)}))}_isAnimated(){return this._element.classList.contains("fade")}_triggerBackdropTransition(){if(oE.trigger(this._element,aC).defaultPrevented)return;const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._element.style.overflowY;"hidden"===t||this._element.classList.contains(_C)||(e||(this._element.style.overflowY="hidden"),this._element.classList.add(_C),this._queueCallback((()=>{this._element.classList.remove(_C),this._queueCallback((()=>{this._element.style.overflowY=t}),this._dialog)}),this._dialog),this._element.focus())}_adjustDialog(){const e=this._element.scrollHeight>document.documentElement.clientHeight,t=this._scrollBar.getWidth(),s=t>0;if(s&&!e){const e=Fx()?"paddingLeft":"paddingRight";this._element.style[e]=`${t}px`}if(!s&&e){const e=Fx()?"paddingRight":"paddingLeft";this._element.style[e]=`${t}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(e,t){return this.each((function(){const s=wC.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===s[e])throw new TypeError(`No method named "${e}"`);s[e](t)}}))}}oE.on(document,pC,'[data-bs-toggle="modal"]',(function(e){const t=gE.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&e.preventDefault(),oE.one(t,lC,(e=>{e.defaultPrevented||oE.one(t,cC,(()=>{Ix(this)&&this.focus()}))}));const s=gE.findOne(".modal.show");s&&wC.getInstance(s).hide();wC.getOrCreateInstance(t).toggle(this)})),pE(wC),Ux(wC);const SC=".bs.offcanvas",AC=".data-api",xC=`load${SC}${AC}`,EC="show",$C="showing",CC="hiding",kC=".offcanvas.show",jC=`show${SC}`,TC=`shown${SC}`,OC=`hide${SC}`,NC=`hidePrevented${SC}`,IC=`hidden${SC}`,MC=`resize${SC}`,RC=`click${SC}${AC}`,DC=`keydown.dismiss${SC}`,zC={backdrop:!0,keyboard:!0,scroll:!1},LC={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class PC extends hE{constructor(e,t){super(e,t),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return zC}static get DefaultType(){return LC}static get NAME(){return"offcanvas"}toggle(e){return this._isShown?this.hide():this.show(e)}show(e){if(this._isShown)return;if(oE.trigger(this._element,jC,{relatedTarget:e}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||(new iC).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add($C);this._queueCallback((()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(EC),this._element.classList.remove($C),oE.trigger(this._element,TC,{relatedTarget:e})}),this._element,!0)}hide(){if(!this._isShown)return;if(oE.trigger(this._element,OC).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(CC),this._backdrop.hide();this._queueCallback((()=>{this._element.classList.remove(EC,CC),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||(new iC).reset(),oE.trigger(this._element,IC)}),this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const e=Boolean(this._config.backdrop);return new W$({className:"offcanvas-backdrop",isVisible:e,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:e?()=>{"static"!==this._config.backdrop?this.hide():oE.trigger(this._element,NC)}:null})}_initializeFocusTrap(){return new Z$({trapElement:this._element})}_addEventListeners(){oE.on(this._element,DC,(e=>{"Escape"===e.key&&(this._config.keyboard?this.hide():oE.trigger(this._element,NC))}))}static jQueryInterface(e){return this.each((function(){const t=PC.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e](this)}}))}}oE.on(document,RC,'[data-bs-toggle="offcanvas"]',(function(e){const t=gE.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&e.preventDefault(),Mx(this))return;oE.one(t,IC,(()=>{Ix(this)&&this.focus()}));const s=gE.findOne(kC);s&&s!==t&&PC.getInstance(s).hide();PC.getOrCreateInstance(t).toggle(this)})),oE.on(window,xC,(()=>{for(const e of gE.find(kC))PC.getOrCreateInstance(e).show()})),oE.on(window,MC,(()=>{for(const e of gE.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(e).position&&PC.getOrCreateInstance(e).hide()})),pE(PC),Ux(PC);const FC={"*":["class","dir","id","lang","role",/^aria-[\w-]*$/i],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},UC=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),BC=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,qC=(e,t)=>{const s=e.nodeName.toLowerCase();return t.includes(s)?!UC.has(s)||Boolean(BC.test(e.nodeValue)):t.filter((e=>e instanceof RegExp)).some((e=>e.test(s)))};const HC={allowList:FC,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},GC={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},WC={entry:"(string|element|function|null)",selector:"(string|element)"};class VC extends uE{constructor(e){super(),this._config=this._getConfig(e)}static get Default(){return HC}static get DefaultType(){return GC}static get NAME(){return"TemplateFactory"}getContent(){return Object.values(this._config.content).map((e=>this._resolvePossibleFunction(e))).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(e){return this._checkContent(e),this._config.content={...this._config.content,...e},this}toHtml(){const e=document.createElement("div");e.innerHTML=this._maybeSanitize(this._config.template);for(const[t,s]of Object.entries(this._config.content))this._setContent(e,s,t);const t=e.children[0],s=this._resolvePossibleFunction(this._config.extraClass);return s&&t.classList.add(...s.split(" ")),t}_typeCheckConfig(e){super._typeCheckConfig(e),this._checkContent(e.content)}_checkContent(e){for(const[t,s]of Object.entries(e))super._typeCheckConfig({selector:t,entry:s},WC)}_setContent(e,t,s){const n=gE.findOne(s,e);n&&((t=this._resolvePossibleFunction(t))?Ox(t)?this._putElementInTemplate(Nx(t),n):this._config.html?n.innerHTML=this._maybeSanitize(t):n.textContent=t:n.remove())}_maybeSanitize(e){return this._config.sanitize?function(e,t,s){if(!e.length)return e;if(s&&"function"==typeof s)return s(e);const n=(new window.DOMParser).parseFromString(e,"text/html"),i=[].concat(...n.body.querySelectorAll("*"));for(const e of i){const s=e.nodeName.toLowerCase();if(!Object.keys(t).includes(s)){e.remove();continue}const n=[].concat(...e.attributes),i=[].concat(t["*"]||[],t[s]||[]);for(const t of n)qC(t,i)||e.removeAttribute(t.nodeName)}return n.body.innerHTML}(e,this._config.allowList,this._config.sanitizeFn):e}_resolvePossibleFunction(e){return Bx(e,[this])}_putElementInTemplate(e,t){if(this._config.html)return t.innerHTML="",void t.append(e);t.textContent=e.textContent}}const QC=new Set(["sanitize","allowList","sanitizeFn"]),KC="fade",JC="show",YC=".tooltip-inner",XC=".modal",ZC="hide.bs.modal",ek="hover",tk="focus",sk={AUTO:"auto",TOP:"top",RIGHT:Fx()?"left":"right",BOTTOM:"bottom",LEFT:Fx()?"right":"left"},nk={allowList:FC,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},ik={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class rk extends hE{constructor(e,t){if(void 0===w)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(e,t),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return nk}static get DefaultType(){return ik}static get NAME(){return"tooltip"}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),oE.off(this._element.closest(XC),ZC,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const e=oE.trigger(this._element,this.constructor.eventName("show")),t=(Rx(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(e.defaultPrevented||!t)return;this._disposePopper();const s=this._getTipElement();this._element.setAttribute("aria-describedby",s.getAttribute("id"));const{container:n}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(n.append(s),oE.trigger(this._element,this.constructor.eventName("inserted"))),this._popper=this._createPopper(s),s.classList.add(JC),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))oE.on(e,"mouseover",Dx);this._queueCallback((()=>{oE.trigger(this._element,this.constructor.eventName("shown")),!1===this._isHovered&&this._leave(),this._isHovered=!1}),this.tip,this._isAnimated())}hide(){if(!this._isShown())return;if(oE.trigger(this._element,this.constructor.eventName("hide")).defaultPrevented)return;if(this._getTipElement().classList.remove(JC),"ontouchstart"in document.documentElement)for(const e of[].concat(...document.body.children))oE.off(e,"mouseover",Dx);this._activeTrigger.click=!1,this._activeTrigger[tk]=!1,this._activeTrigger[ek]=!1,this._isHovered=null;this._queueCallback((()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),oE.trigger(this._element,this.constructor.eventName("hidden")))}),this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(e){const t=this._getTemplateFactory(e).toHtml();if(!t)return null;t.classList.remove(KC,JC),t.classList.add(`bs-${this.constructor.NAME}-auto`);const s=(e=>{do{e+=Math.floor(1e6*Math.random())}while(document.getElementById(e));return e})(this.constructor.NAME).toString();return t.setAttribute("id",s),this._isAnimated()&&t.classList.add(KC),t}setContent(e){this._newContent=e,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(e){return this._templateFactory?this._templateFactory.changeContent(e):this._templateFactory=new VC({...this._config,content:e,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[YC]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(e){return this.constructor.getOrCreateInstance(e.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(KC)}_isShown(){return this.tip&&this.tip.classList.contains(JC)}_createPopper(e){const t=Bx(this._config.placement,[this,e,this._element]),s=sk[t.toUpperCase()];return xx(this._element,e,this._getPopperConfig(s))}_getOffset(){const{offset:e}=this._config;return"string"==typeof e?e.split(",").map((e=>Number.parseInt(e,10))):"function"==typeof e?t=>e(t,this._element):e}_resolvePossibleFunction(e){return Bx(e,[this._element])}_getPopperConfig(e){const t={placement:e,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:e=>{this._getTipElement().setAttribute("data-popper-placement",e.state.placement)}}]};return{...t,...Bx(this._config.popperConfig,[t])}}_setListeners(){const e=this._config.trigger.split(" ");for(const t of e)if("click"===t)oE.on(this._element,this.constructor.eventName("click"),this._config.selector,(e=>{this._initializeOnDelegatedTarget(e).toggle()}));else if("manual"!==t){const e=t===ek?this.constructor.eventName("mouseenter"):this.constructor.eventName("focusin"),s=t===ek?this.constructor.eventName("mouseleave"):this.constructor.eventName("focusout");oE.on(this._element,e,this._config.selector,(e=>{const t=this._initializeOnDelegatedTarget(e);t._activeTrigger["focusin"===e.type?tk:ek]=!0,t._enter()})),oE.on(this._element,s,this._config.selector,(e=>{const t=this._initializeOnDelegatedTarget(e);t._activeTrigger["focusout"===e.type?tk:ek]=t._element.contains(e.relatedTarget),t._leave()}))}this._hideModalHandler=()=>{this._element&&this.hide()},oE.on(this._element.closest(XC),ZC,this._hideModalHandler)}_fixTitle(){const e=this._element.getAttribute("title");e&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",e),this._element.setAttribute("data-bs-original-title",e),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout((()=>{this._isHovered&&this.show()}),this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout((()=>{this._isHovered||this.hide()}),this._config.delay.hide))}_setTimeout(e,t){clearTimeout(this._timeout),this._timeout=setTimeout(e,t)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(e){const t=dE.getDataAttributes(this._element);for(const e of Object.keys(t))QC.has(e)&&delete t[e];return e={...t,..."object"==typeof e&&e?e:{}},e=this._mergeConfigObj(e),e=this._configAfterMerge(e),this._typeCheckConfig(e),e}_configAfterMerge(e){return e.container=!1===e.container?document.body:Nx(e.container),"number"==typeof e.delay&&(e.delay={show:e.delay,hide:e.delay}),"number"==typeof e.title&&(e.title=e.title.toString()),"number"==typeof e.content&&(e.content=e.content.toString()),e}_getDelegateConfig(){const e={};for(const[t,s]of Object.entries(this._config))this.constructor.Default[t]!==s&&(e[t]=s);return e.selector=!1,e.trigger="manual",e}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(e){return this.each((function(){const t=rk.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}}Ux(rk);const ok=".popover-header",ak=".popover-body",ck={...rk.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},lk={...rk.DefaultType,content:"(null|string|element|function)"};class dk extends rk{static get Default(){return ck}static get DefaultType(){return lk}static get NAME(){return"popover"}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[ok]:this._getTitle(),[ak]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(e){return this.each((function(){const t=dk.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e]()}}))}}Ux(dk);const uk=".bs.scrollspy",hk=`activate${uk}`,mk=`click${uk}`,gk=`load${uk}.data-api`,pk="active",fk="[href]",vk=".nav-link",_k=`${vk}, .nav-item > ${vk}, .list-group-item`,bk={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},yk={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class wk extends hE{constructor(e,t){super(e,t),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return bk}static get DefaultType(){return yk}static get NAME(){return"scrollspy"}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const e of this._observableSections.values())this._observer.observe(e)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(e){return e.target=Nx(e.target)||document.body,e.rootMargin=e.offset?`${e.offset}px 0px -30%`:e.rootMargin,"string"==typeof e.threshold&&(e.threshold=e.threshold.split(",").map((e=>Number.parseFloat(e)))),e}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(oE.off(this._config.target,mk),oE.on(this._config.target,mk,fk,(e=>{const t=this._observableSections.get(e.target.hash);if(t){e.preventDefault();const s=this._rootElement||window,n=t.offsetTop-this._element.offsetTop;if(s.scrollTo)return void s.scrollTo({top:n,behavior:"smooth"});s.scrollTop=n}})))}_getNewObserver(){const e={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver((e=>this._observerCallback(e)),e)}_observerCallback(e){const t=e=>this._targetLinks.get(`#${e.target.id}`),s=e=>{this._previousScrollData.visibleEntryTop=e.target.offsetTop,this._process(t(e))},n=(this._rootElement||document.documentElement).scrollTop,i=n>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=n;for(const r of e){if(!r.isIntersecting){this._activeTarget=null,this._clearActiveClass(t(r));continue}const e=r.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(i&&e){if(s(r),!n)return}else i||e||s(r)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const e=gE.find(fk,this._config.target);for(const t of e){if(!t.hash||Mx(t))continue;const e=gE.findOne(decodeURI(t.hash),this._element);Ix(e)&&(this._targetLinks.set(decodeURI(t.hash),t),this._observableSections.set(t.hash,e))}}_process(e){this._activeTarget!==e&&(this._clearActiveClass(this._config.target),this._activeTarget=e,e.classList.add(pk),this._activateParents(e),oE.trigger(this._element,hk,{relatedTarget:e}))}_activateParents(e){if(e.classList.contains("dropdown-item"))gE.findOne(".dropdown-toggle",e.closest(".dropdown")).classList.add(pk);else for(const t of gE.parents(e,".nav, .list-group"))for(const e of gE.prev(t,_k))e.classList.add(pk)}_clearActiveClass(e){e.classList.remove(pk);const t=gE.find(`${fk}.${pk}`,e);for(const e of t)e.classList.remove(pk)}static jQueryInterface(e){return this.each((function(){const t=wk.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e]()}}))}}oE.on(window,gk,(()=>{for(const e of gE.find('[data-bs-spy="scroll"]'))wk.getOrCreateInstance(e)})),Ux(wk);const Sk=".bs.tab",Ak=`hide${Sk}`,xk=`hidden${Sk}`,Ek=`show${Sk}`,$k=`shown${Sk}`,Ck=`click${Sk}`,kk=`keydown${Sk}`,jk=`load${Sk}`,Tk="ArrowLeft",Ok="ArrowRight",Nk="ArrowUp",Ik="ArrowDown",Mk="Home",Rk="End",Dk="active",zk="fade",Lk="show",Pk=".dropdown-toggle",Fk=`:not(${Pk})`,Uk='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Bk=`${`.nav-link${Fk}, .list-group-item${Fk}, [role="tab"]${Fk}`}, ${Uk}`,qk=`.${Dk}[data-bs-toggle="tab"], .${Dk}[data-bs-toggle="pill"], .${Dk}[data-bs-toggle="list"]`;class Hk extends hE{constructor(e){super(e),this._parent=this._element.closest('.list-group, .nav, [role="tablist"]'),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),oE.on(this._element,kk,(e=>this._keydown(e))))}static get NAME(){return"tab"}show(){const e=this._element;if(this._elemIsActive(e))return;const t=this._getActiveElem(),s=t?oE.trigger(t,Ak,{relatedTarget:e}):null;oE.trigger(e,Ek,{relatedTarget:t}).defaultPrevented||s&&s.defaultPrevented||(this._deactivate(t,e),this._activate(e,t))}_activate(e,t){if(!e)return;e.classList.add(Dk),this._activate(gE.getElementFromSelector(e));this._queueCallback((()=>{"tab"===e.getAttribute("role")?(e.removeAttribute("tabindex"),e.setAttribute("aria-selected",!0),this._toggleDropDown(e,!0),oE.trigger(e,$k,{relatedTarget:t})):e.classList.add(Lk)}),e,e.classList.contains(zk))}_deactivate(e,t){if(!e)return;e.classList.remove(Dk),e.blur(),this._deactivate(gE.getElementFromSelector(e));this._queueCallback((()=>{"tab"===e.getAttribute("role")?(e.setAttribute("aria-selected",!1),e.setAttribute("tabindex","-1"),this._toggleDropDown(e,!1),oE.trigger(e,xk,{relatedTarget:t})):e.classList.remove(Lk)}),e,e.classList.contains(zk))}_keydown(e){if(![Tk,Ok,Nk,Ik,Mk,Rk].includes(e.key))return;e.stopPropagation(),e.preventDefault();const t=this._getChildren().filter((e=>!Mx(e)));let s;if([Mk,Rk].includes(e.key))s=t[e.key===Mk?0:t.length-1];else{const n=[Ok,Ik].includes(e.key);s=Hx(t,e.target,n,!0)}s&&(s.focus({preventScroll:!0}),Hk.getOrCreateInstance(s).show())}_getChildren(){return gE.find(Bk,this._parent)}_getActiveElem(){return this._getChildren().find((e=>this._elemIsActive(e)))||null}_setInitialAttributes(e,t){this._setAttributeIfNotExists(e,"role","tablist");for(const e of t)this._setInitialAttributesOnChild(e)}_setInitialAttributesOnChild(e){e=this._getInnerElement(e);const t=this._elemIsActive(e),s=this._getOuterElement(e);e.setAttribute("aria-selected",t),s!==e&&this._setAttributeIfNotExists(s,"role","presentation"),t||e.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(e,"role","tab"),this._setInitialAttributesOnTargetPanel(e)}_setInitialAttributesOnTargetPanel(e){const t=gE.getElementFromSelector(e);t&&(this._setAttributeIfNotExists(t,"role","tabpanel"),e.id&&this._setAttributeIfNotExists(t,"aria-labelledby",`${e.id}`))}_toggleDropDown(e,t){const s=this._getOuterElement(e);if(!s.classList.contains("dropdown"))return;const n=(e,n)=>{const i=gE.findOne(e,s);i&&i.classList.toggle(n,t)};n(Pk,Dk),n(".dropdown-menu",Lk),s.setAttribute("aria-expanded",t)}_setAttributeIfNotExists(e,t,s){e.hasAttribute(t)||e.setAttribute(t,s)}_elemIsActive(e){return e.classList.contains(Dk)}_getInnerElement(e){return e.matches(Bk)?e:gE.findOne(Bk,e)}_getOuterElement(e){return e.closest(".nav-item, .list-group-item")||e}static jQueryInterface(e){return this.each((function(){const t=Hk.getOrCreateInstance(this);if("string"==typeof e){if(void 0===t[e]||e.startsWith("_")||"constructor"===e)throw new TypeError(`No method named "${e}"`);t[e]()}}))}}oE.on(document,Ck,Uk,(function(e){["A","AREA"].includes(this.tagName)&&e.preventDefault(),Mx(this)||Hk.getOrCreateInstance(this).show()})),oE.on(window,jk,(()=>{for(const e of gE.find(qk))Hk.getOrCreateInstance(e)})),Ux(Hk);const Gk=".bs.toast",Wk=`mouseover${Gk}`,Vk=`mouseout${Gk}`,Qk=`focusin${Gk}`,Kk=`focusout${Gk}`,Jk=`hide${Gk}`,Yk=`hidden${Gk}`,Xk=`show${Gk}`,Zk=`shown${Gk}`,ej="hide",tj="show",sj="showing",nj={animation:"boolean",autohide:"boolean",delay:"number"},ij={animation:!0,autohide:!0,delay:5e3};class rj extends hE{constructor(e,t){super(e,t),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return ij}static get DefaultType(){return nj}static get NAME(){return"toast"}show(){if(oE.trigger(this._element,Xk).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add("fade");this._element.classList.remove(ej),zx(this._element),this._element.classList.add(tj,sj),this._queueCallback((()=>{this._element.classList.remove(sj),oE.trigger(this._element,Zk),this._maybeScheduleHide()}),this._element,this._config.animation)}hide(){if(!this.isShown())return;if(oE.trigger(this._element,Jk).defaultPrevented)return;this._element.classList.add(sj),this._queueCallback((()=>{this._element.classList.add(ej),this._element.classList.remove(sj,tj),oE.trigger(this._element,Yk)}),this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(tj),super.dispose()}isShown(){return this._element.classList.contains(tj)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout((()=>{this.hide()}),this._config.delay)))}_onInteraction(e,t){switch(e.type){case"mouseover":case"mouseout":this._hasMouseInteraction=t;break;case"focusin":case"focusout":this._hasKeyboardInteraction=t}if(t)return void this._clearTimeout();const s=e.relatedTarget;this._element===s||this._element.contains(s)||this._maybeScheduleHide()}_setListeners(){oE.on(this._element,Wk,(e=>this._onInteraction(e,!0))),oE.on(this._element,Vk,(e=>this._onInteraction(e,!1))),oE.on(this._element,Qk,(e=>this._onInteraction(e,!0))),oE.on(this._element,Kk,(e=>this._onInteraction(e,!1)))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(e){return this.each((function(){const t=rj.getOrCreateInstance(this,e);if("string"==typeof e){if(void 0===t[e])throw new TypeError(`No method named "${e}"`);t[e](this)}}))}}pE(rj),Ux(rj);const oj=fp`<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">${HS("Close")}</button>`,aj=fp`<button type="button" class="btn btn-close" data-bs-dismiss="modal" aria-label="${HS("Close")}"></button>`,cj=e=>{const t=e.model?.get("alert"),s=e.model?.get("level")??"";return fp`<div class="modal-dialog" role="document" role="dialog"><div class="modal-content"><div class="modal-header ${s}"><h5 class="modal-title">${e.getModalTitle()}</h5>${aj}</div><div class="modal-body"><span class="modal-alert">${t?(e=>fp`<div class="alert ${e.type}" role="alert"><p>${e.message}</p></div>`)({type:`alert-${t.type}`,message:t.message}):""} </span>${e.renderModal()}</div>${e.renderModalFooter()}</div></div>`};var lj=s(8610),dj={};dj.styleTagTransform=I(),dj.setAttributes=j(),dj.insert=C().bind(null,"head"),dj.domAPI=E(),dj.insertStyleElement=O();A()(lj.A,dj);lj.A&&lj.A.locals&&lj.A.locals;const uj=class extends ji{constructor(e){super(),this.model=null,this.className=Ef.isTestEnv()?"modal":"modal fade",this.tabIndex=-1,this.ariaHidden="true",this.initialized=hc(),Object.assign(this,e),setTimeout((()=>this.insertIntoDOM())),this.addEventListener("shown.bs.modal",(()=>{this.ariaHidden="false"})),this.addEventListener("hidden.bs.modal",(()=>{this.ariaHidden="true"}))}initialize(){this.render(),this.modal=new wC(this,{backdrop:!Ef.isTestEnv(),keyboard:!0}),this.initialized.resolve()}renderModal(){return""}renderModalFooter(){return fp`<div class="modal-footer">${oj}</div>`}toHTML(){return cj(this)}getModalTitle(){return""}switchTab(e){e?.stopPropagation(),e?.preventDefault(),this.tab=e.target.getAttribute("data-name"),this.render()}close(){this.modal.hide()}insertIntoDOM(){document.querySelector("#converse-modals").insertAdjacentElement("beforeend",this)}alert(e,t="primary"){this.model.set("alert",{message:e,type:t}),setTimeout((()=>{this.model.set("alert",void 0)}),5e3)}async show(){await this.initialized,this.modal.show(),this.render()}};hm.elements.define("converse-alert-modal",class extends uj{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render())),this.addEventListener("hide.bs.modal",(()=>this.remove()),!1)}renderModal(){return(e=>fp`<div class="modal-body"><span class="modal-alert"></span> ${e.messages.map((e=>fp`<p>${e}</p>`))}</div>`)(this.model.toJSON())}getModalTitle(){return this.model.get("title")}});const hj=e=>fp`<form class="converse-form converse-form--modal confirm" action="#" @submit="${t=>e.onConfimation(t)}"><div>${e.model.get("messages")?.map((e=>fp`<p>${e}</p>`))}</div>${e.model.get("fields")?.map((e=>function(e){return"checkbox"===e.type?fp`<div class="form-check"><input name="${e.name}" class="form-check-input" type="checkbox" id="${e.name}"> <label class="form-check-label" for="${e.name}">${e.label}</label></div>`:fp`<div><label class="form-label">${e.label||""} <input type="text" name="${e.name}" class="${e.challenge_failed?"error":""} form-control form-control--labeled" ?required="${e.required}" placeholder="${e.placeholder}"></label></div>`}(e)))}<div><button type="submit" class="btn btn-primary">${HS("Confirm")}</button> <input type="button" class="btn btn-secondary" data-bs-dismiss="modal" value="${HS("Cancel")}"></div></form>`;class mj extends uj{constructor(e){super(e),this.confirmation=hc()}initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render())),this.addEventListener("hide.bs.modal",(()=>{this.confirmation.isResolved||this.confirmation.reject()}),!1)}renderModal(){return hj(this)}getModalTitle(){return this.model.get("title")}onConfimation(e){e.preventDefault();const t=new FormData(e.target),s=(this.model.get("fields")||[]).map((e=>{const s=t.get(e.name);return e.value=s,e.challenge&&(e.challenge_failed=s!==e.challenge),e}));if(s.filter((e=>e.challenge_failed)).length)return this.model.set("fields",s),void this.model.trigger("change");this.confirmation.resolve(s),this.modal.hide()}renderModalFooter(){return""}}hm.elements.define("converse-confirm-modal",mj);let gj=[],pj={};const fj={modal:{show(e,t,s){let n;if("string"==typeof e)n=this.get(e)??this.create(e,t),Object.assign(n,t);else{const s=e,i=s.id??t.id;n=this.get(i)??this.create(s,t)}return n.show(s),n},get:e=>pj[e]??gj.filter((t=>t.id==e)).pop(),create(e,t){const s=customElements.get(e);return pj[e]=new s(t)},remove(e){let t;"string"==typeof e?(t=pj[e],delete pj[e]):(t=e,gj=gj.filter((e=>e!==t))),t?.remove()},removeAll(){gj.forEach((e=>e.remove())),gj=[],pj={}}},async confirm(e,t=[],s=[]){"string"==typeof t&&(t=[t]);const n=new fd({title:e,messages:t,fields:s,type:"confirm"}),i=new mj({model:n});let r;i.show();try{r=await i.confirmation}catch(e){r=!1}return i.remove(),r},async prompt(e,t=[],s=""){"string"==typeof t&&(t=[t]);const n=new fd({title:e,messages:t,fields:[{name:"reason",placeholder:s}],type:"prompt"}),i=new mj({model:n});let r;i.show();try{r=(await i.confirmation).pop()?.value}catch(e){r=!1}return i.remove(),r},alert(e,t,s){let n;"string"==typeof s&&(s=[s]),"error"===e?n="alert-danger":"info"===e?n="alert-info":"warn"===e&&(n="alert-warning");const i=new fd({title:t,messages:s,level:n,type:"alert"});fj.modal.show("converse-alert-modal",{model:i})}},vj=fj;Object.assign(Cf.env,{BaseModal:uj}),Cf.plugins.add("converse-modal",{initialize(){hm.listen.on("disconnect",(()=>{const e=document.querySelector("#converse-modals");e&&(e.innerHTML="")})),hm.listen.on("clearSession",(()=>hm.modal.removeAll())),Object.assign(Bu.api,vj)}});const _j=class extends String{constructor(e,t){super();const s=Array.isArray(e)?{label:e[0],value:e[1]}:"object"==typeof e&&"label"in e&&"value"in e?e:{label:e,value:e};this.label=s.label||s.value,this.value=s.value,this.query=t}get lenth(){return this.label.length}toString(){return""+this.label}valueOf(){return this.toString()}},bj=Cf.env.utils,yj={getElement:(e,t)=>"string"==typeof e?(t||document).querySelector(e):e||null,bind(e,t){if(e)for(var s in t){if(!Object.prototype.hasOwnProperty.call(t,s))continue;const n=t[s];s.split(/\s+/).forEach((t=>e.addEventListener(t,n)))}},unbind(e,t){if(e)for(var s in t){if(!Object.prototype.hasOwnProperty.call(t,s))continue;const n=t[s];s.split(/\s+/).forEach((t=>e.removeEventListener(t,n)))}},regExpEscape:e=>e.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&"),isMention:(e,t)=>t.includes(e[0])||bj.isMentionBoundary(e[0])&&t.includes(e[1])},wj=function(e,t){return RegExp(yj.regExpEscape(t.trim()),"i").test(e)},Sj=function(e,t){return RegExp("^"+yj.regExpEscape(t.trim()),"i").test(e)},Aj=function(e,t){const s=e.query.toLowerCase(),n=e.label.toLowerCase().indexOf(s),i=t.label.toLowerCase().indexOf(s);return n===i?function(e,t){return e.length!==t.length?e.length-t.length:e<t?-1:1}(e,t):(-1===n?1/0:n)<(-1===i?1/0:i)?-1:1},xj=(e,t)=>{t=t.trim();const s=document.createElement("li");s.setAttribute("aria-selected","false");const n=new RegExp("("+t+")","ig");return(t?e.split(n):[e]).forEach((e=>{if(t&&e.match(n)){const t=document.createElement("mark");t.textContent=e,s.appendChild(t)}else s.appendChild(document.createTextNode(e))})),s},{siblingIndex:Ej}=Ef;class $j extends($i(Object)){constructor(e,t={}){super(),this.suggestions=[],this.is_opened=!1,this.auto_evaluate=!0,this.match_current_word=!1,this.sort=!1===t.sort?null:Aj,this.filter=wj,this.ac_triggers=[],this.include_triggers=[],this.min_chars=2,this.max_items=10,this.auto_first=!1,this.data=(e,t)=>e,this.item=xj,Ef.hasClass("suggestion-box",e)?this.container=e:this.container=e.querySelector(".suggestion-box"),this.input=this.container.querySelector(".suggestion-box__input"),this.input.setAttribute("aria-autocomplete","list"),this.ul=this.container.querySelector(".suggestion-box__results"),this.status=this.container.querySelector(".suggestion-box__additions"),Object.assign(this,t),this.index=-1,this.bindEvents(),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||t.list||[]}bindEvents(){const e={blur:()=>this.close({reason:"blur"})};this.auto_evaluate&&(e.input=e=>this.evaluate(e)),this._events={input:e,form:{submit:()=>this.close({reason:"submit"})},ul:{mousedown:e=>this.onMouseDown(e),mouseover:e=>this.onMouseOver(e)}},yj.bind(this.input,this._events.input),yj.bind(this.input.form,this._events.form),yj.bind(this.ul,this._events.ul)}set list(e){if(Array.isArray(e)||"function"==typeof e)this._list=e;else if("string"==typeof e&&e.includes(","))this._list=e.split(/\s*,\s*/);else{const t=yj.getElement(e)?.children||[];this._list=Array.from(t).filter((e=>!e.disabled)).map((e=>{const t=e.textContent.trim(),s=e.value||t,n=e.label||t;return""!==s?{label:n,value:s}:null})).filter((e=>e))}document.activeElement===this.input&&this.evaluate()}get list(){return this._list}get selected(){return this.index>-1}get opened(){return this.is_opened}close(e){this.opened&&(this.ul.setAttribute("hidden",""),this.is_opened=!1,this.index=-1,this.trigger("suggestion-box-close",e||{}))}insertValue(e){this.match_current_word?Ef.replaceCurrentWord(this.input,e.value):this.input.value=e.value}open(){this.ul.removeAttribute("hidden"),this.is_opened=!0,this.auto_first&&-1===this.index&&this.goto(0),this.trigger("suggestion-box-open")}destroy(){yj.unbind(this.input,this._events.input),yj.unbind(this.input.form,this._events.form),this.input.removeAttribute("aria-autocomplete")}next(){const e=this.ul.children.length;this.goto(this.index<e-1?this.index+1:e?0:-1)}previous(){const e=this.ul.children.length,t=this.index-1;this.goto(this.selected&&-1!==t?t:e-1)}goto(e,t=!0){const s=Array.from(this.ul.children).filter((e=>e instanceof HTMLElement));this.selected&&s[this.index].setAttribute("aria-selected","false"),this.index=e,e>-1&&s.length>0&&(s[e].setAttribute("aria-selected","true"),s[e].focus(),this.status.textContent=s[e].textContent,t&&(this.ul.scrollTop=s[e].offsetTop-this.ul.clientHeight+s[e].clientHeight),this.trigger("suggestion-box-highlight",{text:this.suggestions[this.index]}))}select(e){if(e?this.index=Ej(e):e=this.ul.children[this.index],e){const e=this.suggestions[this.index];this.insertValue(e),this.close({reason:"select"}),this.auto_completing=!1,this.trigger("suggestion-box-selectcomplete",{text:e})}}onMouseOver(e){const t=Ef.ancestor(e.target,"li");if(t){const e=Array.prototype.slice.call(this.ul.children).indexOf(t);this.goto(e,!1)}}onMouseDown(e){if(0!==e.button)return;const t=Ef.ancestor(e.target,"li");t&&(e.preventDefault(),this.select(t))}onKeyDown(e){if(this.opened){if([Cf.keycodes.ENTER,Cf.keycodes.TAB].includes(e.keyCode)&&this.selected)return e.preventDefault(),e.stopPropagation(),this.select(),!0;if(e.keyCode===Cf.keycodes.ESCAPE)return this.close({reason:"esc"}),!0;if([Cf.keycodes.UP_ARROW,Cf.keycodes.DOWN_ARROW].includes(e.keyCode))return e.preventDefault(),e.stopPropagation(),this[e.keyCode===Cf.keycodes.UP_ARROW?"previous":"next"](),!0}if(![Cf.keycodes.SHIFT,Cf.keycodes.META,Cf.keycodes.META_RIGHT,Cf.keycodes.ESCAPE,Cf.keycodes.ALT].includes(e.keyCode))if(this.ac_triggers.includes(e.key)){if("Tab"===e.key){if(e.shiftKey)return;if(this.min_chars>0&&""===this.input.value)return;e.preventDefault()}this.auto_completing=!0}else if("Backspace"===e.key){const t=Ef.getCurrentWord(e.target,e.target.selectionEnd-1);yj.isMention(t,this.ac_triggers)&&(this.auto_completing=!0)}}async evaluate(e){const t=this.selected&&e&&(e.keyCode===Cf.keycodes.UP_ARROW||e.keyCode===Cf.keycodes.DOWN_ARROW);if(!this.auto_evaluate&&!this.auto_completing||t)return;let s=this.match_current_word?Ef.getCurrentWord(this.input):this.input.value;const n=yj.isMention(s,this.ac_triggers);n&&!this.include_triggers.includes(e.key)&&(s=Ef.isMentionBoundary(s[0])?s.slice(2):s.slice(1));const i=s.length&&s.length>=this.min_chars;if(n||i){this.auto_completing=!0;const e="function"==typeof this._list?await this._list(s):this._list;if(0===e.length||!this.auto_completing)return void this.close({reason:"nomatches"});this.index=-1,this.ul.innerHTML="",this.suggestions=e.map((e=>new _j(this.data(e,s),s))).filter((e=>this.filter(e,s))),this.sort&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.max_items),this.suggestions.forEach((e=>this.ul.appendChild(this.item(e,s)))),0===this.ul.children.length?this.close({reason:"nomatches"}):this.open()}else this.close({reason:"nomatches"}),n||(this.auto_completing=!1)}}const Cj=$j;hm.elements.define("converse-autocomplete",class extends VS{static get properties(){return{position:{type:String},autofocus:{type:Boolean},getAutoCompleteList:{type:Function},data:{type:Function},list:{type:Array},auto_evaluate:{type:Boolean},auto_first:{type:Boolean},filter:{type:String},include_triggers:{type:String},min_chars:{type:Number},name:{type:String},placeholder:{type:String},value:{type:String},triggers:{type:String},required:{type:Boolean}}}constructor(){super(),this.data=e=>e,this.value="",this.position="above",this.auto_evaluate=!0,this.auto_first=!1,this.filter="contains",this.include_triggers="",this.match_current_word=!1,this.max_items=10,this.min_chars=1,this.triggers="",this.getAutoCompleteList=null,this.list=null,this.name="",this.placeholder="",this.required=!1}render(){const e=`suggestion-box__results--${this.position}`;return fp`<div class="suggestion-box suggestion-box__name"><ul class="suggestion-box__results ${e}" hidden=""></ul><input ?autofocus="${this.autofocus}" ?required="${this.required}" type="text" name="${this.name}" autocomplete="off" @keydown="${this.onKeyDown}" @keyup="${this.onKeyUp}" class="form-control suggestion-box__input" value="${this.value}" placeholder="${this.placeholder}"> <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span></div>`}firstUpdated(){this.auto_complete=new Cj(this.firstElementChild,{ac_triggers:this.triggers.split(" "),auto_evaluate:this.auto_evaluate,auto_first:this.auto_first,filter:"contains"==this.filter?wj:Sj,include_triggers:[],list:this.list??(e=>this.getAutoCompleteList(e)),data:this.data,match_current_word:!0,max_items:this.max_items,min_chars:this.min_chars}),this.auto_complete.on("suggestion-box-selectcomplete",(()=>this.auto_completing=!1))}onKeyDown(e){this.auto_complete.onKeyDown(e)}onKeyUp(e){this.auto_complete.evaluate(e)}});var kj=s(593),jj={};jj.styleTagTransform=I(),jj.setAttributes=j(),jj.insert=C().bind(null,"head"),jj.domAPI=E(),jj.insertStyleElement=O();A()(kj.A,jj);kj.A&&kj.A.locals&&kj.A.locals;const Tj={AutoComplete:Cj};Object.assign(Bu,Tj),Object.assign(Bu.exports,Tj);var Oj=s(473),Nj={};Nj.styleTagTransform=I(),Nj.setAttributes=j(),Nj.insert=C().bind(null,"head"),Nj.domAPI=E(),Nj.insertStyleElement=O();A()(Oj.A,Nj);Oj.A&&Oj.A.locals&&Oj.A.locals;const Ij=(e,t,s)=>{const{hostname:n}=new URL(e);return fp`<figure class="audio-element">${s||!t?fp`<figcaption>${s?fp`${s}<br>`:""} ${t?"":fp`<a target="_blank" rel="noopener" title="${e}" href="${e}">${n}</a>`}</figcaption>`:""}<audio controls src="${e}"></audio></figure>`},Mj=(e,t)=>{const s=HS('Download file "%1$s"',t);return fp`<a target="_blank" rel="noopener" href="${e}">${s}</a>`},Rj=e=>fp`<div class="pb-2">${"hidden"!==e.type?fp`<label for="${e.id}" class="form-label">${e.label} ${e.desc?fp`<small class="form-text text-muted">${e.desc}</small>`:""}</label>`:""} ${"password"===e.type&&e.fixed_username?fp`<input class="hidden-username" aria-hidden="true" type="text" autocomplete="username" value="${e.fixed_username}">`:""} <input autocomplete="${e.autocomplete||""}" class="form-control" id="${e.id}" name="${e.name}" placeholder="${e.placeholder||""}" type="${e.type}" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"></div>`,Dj=e=>fp`<div class="pb-2"><label for="${e.id}" class="form-label">${e.label}</label> <select class="form-control" id="${e.id}" name="${e.name}" ?multiple="${e.multiple}">${e.options?.map((e=>(e=>fp`<option value="${e.value}" ?selected="${e.selected}">${e.label}</option>`)(e)))}</select></div>`,zj=e=>fp`<div class="pb-2"><label for="${e.id}" class="form-label">${e.label} ${e.desc?fp`<small id="o.id" class="form-text text-muted">${e.desc}</small>`:""}</label><div><a class="form-url" target="_blank" rel="noopener" id="${e.id}" href="${e.value}">${e.value}</a></div></div>`,Lj=e=>fp`<div class="pb-2">${"hidden"!==e.type?fp`<label for="${e.id}" class="form-label">${e.label} ${e.desc?fp`<small class="form-text text-muted">${e.desc}</small>`:""}</label>`:""}<div class="input-group"><input name="${e.name}" class="form-control" id="${e.id}" type="${e.type}" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"> ${e.domain?fp`<div class="input-group-append"><div class="input-group-text" title="${e.domain}">${e.domain}</div></div>`:""}</div></div>`;function Pj(e){e.preventDefault(),hm.rooms.open(e.target.href)}const Fj=(e,t)=>{let s=e.normalizePath().toString();return e._parts.protocol||t.startsWith("http://")||t.startsWith("https://")||(s="http://"+s),"xmpp"===e._parts.protocol&&"join"===e._parts.query?fp`<a target="_blank" rel="noopener" @click="${Pj}" href="${s}">${t}</a>`:fp`<a target="_blank" rel="noopener" href="${s}">${t}</a>`},Uj=(e,t)=>{const{hostname:s}=new URL(e);return fp`<figure><video controls preload="metadata" src="${e}"></video>${t||!s?"":fp`<a target="_blank" rel="noopener" title="${e}" href="${e}">${s}</a>`}</figure>`},{sizzle:Bj,Strophe:qj,dayjs:Hj}=Cf.env,{getURI:Gj,isAudioURL:Wj,isImageURL:Vj,isVideoURL:Qj,isValidURL:Kj}=Ef,Jj=["http","https","xmpp","mailto"],Yj=/\s*\n\s*/;function Xj(e){let t;(e instanceof Be||e instanceof gt)&&(e=e.tree());const s=[],n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,(e=>"body"===e.parentElement.nodeName.toLowerCase()?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT));for(;t=n.nextNode();)s.push(t);return s.forEach((e=>Yj.test(e.data)&&e.parentElement.removeChild(e))),e}function Zj(e,t){return{"muc#roomconfig_lang":"language","muc#roomconfig_roomsecret":t?.new_password?"new-password":"current-password"}[e]}const eT=new XMLSerializer;function tT(e){const t=e.getAttribute("name");if(!t)return null;let s;return s="checkbox"===e.getAttribute("type")?e.checked?1:0:"TEXTAREA"==e.tagName?e.value.split("\n").filter((e=>e.trim())):"SELECT"==e.tagName?Ef.getSelectValues(e):e.value,{name:t,value:s}}function sT(e){const t=Gj(e);try{return decodeURI(t.filename())}catch(e){return Ct.debug(e),t.filename()}}function nT(e){const t=Gj(e);return null===t?e:Qj(t)?Uj(e):Wj(t)?Ij(e):(Vj(t),Mj(t.toString(),sT(t)))}function iT(e){return Array.from(e.children).reduce(((e,t)=>t instanceof HTMLElement?e+t.offsetHeight:e),0)}function rT(e,t){return t instanceof Element&&t.classList.contains(e)}function oT(e,t){return t instanceof Element&&t.classList.remove(e),t}function aT(e){const t=RegExp("^w{3}.","ig").test(e)?`http://${e}`:e,s=Gj(e);return null===s||!Kj(t)||!function(e,t=Jj){return!!t.includes(e)}(s._parts.protocol)&&s._parts.protocol?e:Fj(s,e)}function cT(e,t=200){return new Promise(((s,n)=>{if(!e){const e="An element needs to be passed in to slideOut";return Ct.warn(e),void n(new Error(e))}const i=e.getAttribute("data-slider-marker");i&&!Number.isNaN(Number(i))&&(e.removeAttribute("data-slider-marker"),cancelAnimationFrame(Number(i)));const r=iT(e);if(hm.settings.get("disable_effects"))return e.style.height=r+"px",function(e){e.removeAttribute("data-slider-marker"),e.classList.remove("collapsed"),e.style.overflow="",e.style.height=""}(e),void s();if(!rT("collapsed",e)&&!rT("hidden",e))return void s();const o=t/17;let a=0;e.style.height="0",e.style.overflow="hidden",e.classList.remove("hidden"),e.classList.remove("collapsed"),e.setAttribute("data-slider-marker",requestAnimationFrame((function t(){a+=r/o,a<r?(e.style.height=a+"px",e.setAttribute("data-slider-marker",requestAnimationFrame(t).toString())):(e.removeAttribute("data-slider-marker"),e.style.height=iT(e)+"px",e.style.overflow="",e.style.height="",s())})).toString())}))}function lT(e,t=200){return new Promise(((s,n)=>{if(!e){const e="An element needs to be passed in to slideIn";return Ct.warn(e),n(new Error(e))}if(rT("collapsed",e))return s(e);if(hm.settings.get("disable_effects"))return e.classList.add("collapsed"),e.style.height="",s(e);const i=e.getAttribute("data-slider-marker");i&&!Number.isNaN(Number(i))&&(e.removeAttribute("data-slider-marker"),cancelAnimationFrame(Number(i)));const r=e.offsetHeight,o=t/17;let a=r;e.style.overflow="hidden",e.setAttribute("data-slider-marker",requestAnimationFrame((function t(){a-=r/o,a>0?(e.style.height=a+"px",e.setAttribute("data-slider-marker",requestAnimationFrame(t).toString())):(e.removeAttribute("data-slider-marker"),e.classList.add("collapsed"),e.style.height="",s(e))})).toString())}))}function dT(e,t={}){const s={id:Ef.getUniqueId(),name:e.var};if("list-single"===e.type||"list-multi"===e.type)return Dj({...s,...e,multiple:"list-multi"===e.type});if("fixed"===e.type)return(e=>fp`<p>${e.text}</p>`)(e);if("jid-multi"===e.type)return(e=>{const t=Ef.getUniqueId();return fp`<div class="pb-2"><label class="form-label label-ta" for="${e.id}">${e.label} ${e.desc?fp`<small class="form-text text-muted">${e.desc}</small>`:""}</label> <textarea name="${e.name}" id="${t}" ?readonly="${e.readonly}" ?required="${e.required}" class="form-control">${e.value}</textarea></div>`})({...s,...e});if("boolean"===e.type)return(e=>fp`<fieldset class="pb-2 form-check"><input id="${e.id}" name="${e.name}" type="checkbox" class="form-check-input" ?readonly="${e.readonly}" ?checked="${e.checked}" ?required="${e.required}"> <label class="form-check-label" for="${e.id}">${e.label} ${e.desc?fp`<small class="form-text text-muted">${e.desc}</small>`:""}</label></fieldset>`)({...s,...e});if("username"===e.var)return Lj({...s,domain:t.domain?" @"+t.domain:"",...e});if("password"===e.var)return Rj({...s,...e,autocomplete:Zj(e.var,t),fixed_username:t?.fixed_username,type:"password"});if("ocr"===e.var)return(e=>fp`<fieldset class="pb-2">${e.label?fp`<label class="form-label">${e.label}</label>`:""} <img src="data:${e.type};base64,${e.data}"> <input name="${e.name}" type="text" ?required="${e.required}"></fieldset>`)({...s,...e,data:e.uri.data,type:e.uri.type});if("hidden"===e.type||"url"!==e.var&&"uri"!==e.var&&!Kj(e.value)){if("datetime"===e.type||"date"===e.type){const t=e.value?Hj(e.value):null,n=t?.isValid()?"datetime"===e.type?t.format("YYYY-MM-DDTHH:mm:ss"):t.format("YYYY-MM-DD"):null;return(e=>fp`<div class="pb-2"><label for="${e.id}" class="form-label">${e.label} ${e.desc?fp`<small class="form-text text-muted">${e.desc}</small>`:""}</label> <input class="form-control" id="${e.id}" name="${e.name}" type="datetime-local" value="${e.value||""}" ?readonly="${e.readonly}" ?required="${e.required}"></div>`)({...s,...e,value:n})}return Rj({...s,...e,autocomplete:Zj(e.var,t),placeholder:null})}return zj(e)}Object.assign(Ef,{addClass:function(e,t){return t instanceof Element&&t.classList.add(e),t},ancestor:function(e,t){let s=e;for(;null!==s&&!Bj.matchesSelector(s,t);)s=s.parentElement;return s},calculateElementHeight:iT,escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},getElementFromTemplateResult:function(e){const t=document.createElement("div");return Ip(e,t),t.firstElementChild},getNextElement:function(e,t="*"){let s=e.nextElementSibling;for(;null!==s&&!Bj.matchesSelector(s,t);)s=s.nextElementSibling;return s},getOOBURLMarkup:nT,getOuterWidth:function(e,t=!1){let s=e.offsetWidth;if(!t)return s;const n=window.getComputedStyle(e);return s+=parseInt(n.marginLeft?n.marginLeft:"0",10)+parseInt(n.marginRight?n.marginRight:"0",10),s},hasClass:rT,hideElement:function(e){return e instanceof Element&&e.classList.add("hidden"),e},isEqualNode:function(e,t){if(!Ef.isElement(e))throw new Error("Element being compared must be an Element!");e=Xj(e),t=Xj(t);let s=e.isEqualNode(t);if(!s){const{xmlHtmlNode:n}=qj,i=eT.serializeToString(e),r=eT.serializeToString(t);s=i===r||n(i).isEqualNode(n(r))}return s},isInDOM:function(e){return document.querySelector("body").contains(e)},isVisible:function(e){return null!==e&&(!rT("hidden",e)&&(e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0))},nextUntil:function(e,t){const s=[];let n=e.nextElementSibling;for(;null!==n&&!n.matches(t);)s.push(n),n=n.nextElementSibling;return s},removeClass:oT,removeElement:function(e){return e instanceof Element&&e.parentNode&&e.parentNode.removeChild(e),e},showElement:function(e){oT("collapsed",e),oT("hidden",e)},slideIn:lT,slideOut:cT,unescapeHTML:function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerText},xFormField2TemplateResult:dT});const uT=Ef,hT={execute:HS("Execute"),prev:HS("Previous"),next:HS("Next"),complete:HS("Complete")},mT={info:"primary",warn:"secondary",error:"danger"};const gT=(e,t)=>{const s=HS("Cancel");return fp`<span><form class="converse-form">${t.alert?fp`<div class="alert alert-${t.alert_type}" role="alert">${t.alert}</div>`:""} ${t.note?fp`<div class="alert alert-${mT[t.note.type||"info"]}" role="alert">${t.note.text}</div>`:""} ${"result"===t.type&&t.title?fp`<div class="alert alert-info">${t.title}</div>`:""} ${"form"===t.type&&t.title?fp`<h6>${t.title}</h6>`:""}<fieldset><input type="hidden" name="command_node" value="${t.node}"> <input type="hidden" name="command_jid" value="${t.jid}"> ${t.instructions?fp`<p class="form-instructions">${t.instructions}</p>`:""} ${"result"===t.type?function(e){return fp`<table class="table"><thead class="thead-light">${e.reported?.map((e=>fp`<th scope="col" data-var="${e.var}">${e.label}</th>`))}</thead><tbody>${e.items?.map((e=>fp`<tr>${e.map((e=>fp`<td data-var="${e.var}">${e.value}</td>`))}</tr>`))}</tbody></table>`}(t):""} ${t.fields?.map((e=>dT(e)),{domain:t.jid})??""}</fieldset>${t.actions?.length?fp`<fieldset>${t.actions?.map((t=>fp`<input data-action="${t}" @click="${t=>e.executeAction(t)}" type="button" class="btn btn-primary" value="${hT[t]}">`))} <input type="button" class="btn btn-secondary button-cancel" value="${s}" @click="${t=>e.cancel(t)}"></fieldset>`:""}</form></span>`};var pT=s(2470),fT={};fT.styleTagTransform=I(),fT.setAttributes=j(),fT.insert=C().bind(null,"head"),fT.domAPI=E(),fT.insertStyleElement=O();A()(pT.A,fT);pT.A&&pT.A.locals&&pT.A.locals;const vT=(e={})=>fp`<div class="d-flex justify-content-center ${e.class}"><div class="spinner-grow" role="status"><span class="visually-hidden">Loading...</span></div></div>`,{I:_T}=Vg,bT=()=>document.createComment(""),yT=(e,t,s)=>{const n=e._$AA.parentNode,i=void 0===t?e._$AB:t._$AA;if(void 0===s){const t=n.insertBefore(bT(),i),r=n.insertBefore(bT(),i);s=new _T(t,r,e,e.options)}else{const t=s._$AB.nextSibling,r=s._$AM,o=r!==e;if(o){let t;s._$AQ?.(e),s._$AM=e,void 0!==s._$AP&&(t=e._$AU)!==r._$AU&&s._$AP(t)}if(t!==i||o){let e=s._$AA;for(;e!==t;){const t=e.nextSibling;n.insertBefore(e,i),e=t}}}return s},wT=(e,t,s=e)=>(e._$AI(t,s),e),ST={},AT=e=>{e._$AP?.(!1,!0);let t=e._$AA;const s=e._$AB.nextSibling;for(;t!==s;){const e=t.nextSibling;t.remove(),t=e}},xT=2,ET=e=>(...t)=>({_$litDirective$:e,values:t});class $T{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,s){this._$Ct=e,this._$AM=t,this._$Ci=s}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}const CT=(e,t)=>{const s=e._$AN;if(void 0===s)return!1;for(const e of s)e._$AO?.(t,!1),CT(e,t);return!0},kT=e=>{let t,s;do{if(void 0===(t=e._$AM))break;s=t._$AN,s.delete(e),e=t}while(0===s?.size)},jT=e=>{for(let t;t=e._$AM;e=t){let s=t._$AN;if(void 0===s)t._$AN=s=new Set;else if(s.has(e))break;s.add(e),NT(t)}};function TT(e){void 0!==this._$AN?(kT(this),this._$AM=e,jT(this)):this._$AM=e}function OT(e,t=!1,s=0){const n=this._$AH,i=this._$AN;if(void 0!==i&&0!==i.size)if(t)if(Array.isArray(n))for(let e=s;e<n.length;e++)CT(n[e],!1),kT(n[e]);else null!=n&&(CT(n,!1),kT(n));else CT(this,e)}const NT=e=>{e.type==xT&&(e._$AP??=OT,e._$AQ??=TT)};class IT extends $T{constructor(){super(...arguments),this._$AN=void 0}_$AT(e,t,s){super._$AT(e,t,s),jT(this),this.isConnected=e._$AU}_$AO(e,t=!0){e!==this.isConnected&&(this.isConnected=e,e?this.reconnected?.():this.disconnected?.()),t&&(CT(this,e),kT(this))}setValue(e){if((e=>void 0===e.strings)(this._$Ct))this._$Ct._$AI(e,this);else{const t=[...this._$Ct._$AH];t[this._$Ci]=e,this._$Ct._$AI(t,this,0)}}disconnected(){}reconnected(){}}class MT{constructor(e){this.Y=e}disconnect(){this.Y=void 0}reconnect(e){this.Y=e}deref(){return this.Y}}class RT{constructor(){this.Z=void 0,this.q=void 0}get(){return this.Z}pause(){this.Z??=new Promise((e=>this.q=e))}resume(){this.q?.(),this.Z=this.q=void 0}}const DT=e=>!(e=>null===e||"object"!=typeof e&&"function"!=typeof e)(e)&&"function"==typeof e.then,zT=1073741823;const LT=ET(class extends IT{constructor(){super(...arguments),this._$Cwt=zT,this._$Cbt=[],this._$CK=new MT(this),this._$CX=new RT}render(...e){return e.find((e=>!DT(e)))??Ng}update(e,t){const s=this._$Cbt;let n=s.length;this._$Cbt=t;const i=this._$CK,r=this._$CX;this.isConnected||this.disconnected();for(let e=0;e<t.length&&!(e>this._$Cwt);e++){const o=t[e];if(!DT(o))return this._$Cwt=e,o;e<n&&o===s[e]||(this._$Cwt=zT,n=0,Promise.resolve(o).then((async e=>{for(;r.get();)await r.get();const t=i.deref();if(void 0!==t){const s=t._$Cbt.indexOf(o);s>-1&&s<t._$Cwt&&(t._$Cwt=s,t.setValue(e))}})))}return Ng}disconnected(){this._$CK.disconnect(),this._$CX.pause()}reconnected(){this._$CK.reconnect(this),this._$CX.resume()}}),PT=e=>{return e.image?fp`<svg xmlns="http://www.w3.org/2000/svg" class="avatar ${e.classes}" width="${e.width}" height="${e.height}" aria-label="${e.alt_text}" role="${e.alt_text?_p:"presentation"}"><image width="${e.width}" height="${e.height}" preserveAspectRatio="xMidYMid meet" href="${t=e.image,s=e.image_type,t.startsWith("data:")?t:`data:${s};base64,${t}`}"/></svg>`:"";var t,s};var FT=s(7983),UT={};UT.styleTagTransform=I(),UT.setAttributes=j(),UT.insert=C().bind(null,"head"),UT.domAPI=E(),UT.insertStyleElement=O();A()(FT.A,UT);FT.A&&FT.A.locals&&FT.A.locals;hm.elements.define("converse-avatar",class extends VS{static get properties(){return{model:{type:Object},pickerdata:{type:Object},name:{type:String},width:{type:String},height:{type:String},nonce:{type:String}}}constructor(){super(),this.model=null,this.pickerdata=null,this.width=36,this.height=36,this.name=""}render(){const{image_type:e,image:t,data_uri:s}=Object.assign({},this.pickerdata?.attributes,this.model?.vcard?.attributes);if(e&&(t||s))return PT({classes:this.getAttribute("class"),height:this.height,width:this.width,image:s||`data:${e};base64,${t}`,image_type:e,alt_text:this.name});const n=`\n            width: ${this.width}px;\n            height: ${this.height}px;\n            font: ${this.width/2}px Arial;\n            line-height: ${this.height}px;`,i=this.model.getAvatarStyle(n);return fp`<div class="avatar-initials" style="${LT(i,"background-color: gray;"+n)}" aria-label="${this.name}">${this.getInitials(this.name)}</div>`}getInitials(e){const t=e?.split(" ");return t?.length>1?t[0].charAt(0).toUpperCase()+t[t.length-1].charAt(0).toUpperCase():1===t?.length?t[0].charAt(0).toUpperCase():""}});const{u:BT}=Cf.env;function qT(e){return"moderator"===e?HS("Moderators are privileged users who can change the roles of other users (except those with admin or owner affiliations."):"participant"===e?HS("The default role, implies that you can read and write messages."):"visitor"==e?HS("Visitors aren't allowed to write messages in a moderated multi-user chat."):void 0}function HT(e){return"owner"===e?HS("Owner is the highest affiliation. Owners can modify roles and affiliations of all other users."):"admin"===e?HS("Admin is the 2nd highest affiliation. Admins can modify roles and affiliations of all other users except owners."):"outcast"===e?HS('To ban a user, you give them the affiliation of "outcast".'):void 0}hm.elements.define("converse-muc-occupant-modal",class extends uj{constructor(e){super(),this.message=e.message,this.addEventListener("affiliationChanged",(()=>this.alert(HS("Affiliation changed")))),this.addEventListener("roleChanged",(()=>this.alert(HS("role changed"))))}initialize(){super.initialize();const e=this.model??this.message;this.listenTo(e,"change",(()=>this.render())),hm.trigger("occupantModalInitialized",{model:this.model,message:this.message})}getVcard(){const e=this.model??this.message;if(e.vcard)return e.vcard;const t=e?.get("jid")||e?.get("from");return t?Bu.state.vcards.get(t):null}renderModal(){return(e=>{const t=e.model??e.message,s=t?.get("jid"),n=e.getVcard(),i=t.get("nick"),r=t.get("occupant_id"),o=e.model?.get("role"),a=e.model?.get("affiliation"),c=e.model?.get("hats")?.length?e.model.get("hats"):null,l=e.model.collection.chatroom,d=l.getAllowedCommands().includes("modtools"),u=HS("Add to Contacts"),h=l.features.get("nonanonymous")||"moderator"===l.getOwnRole(),m=s!=Bu.session.get("bare_jid"),g=hm.settings.get("singleton")?"":hm.contacts.get(s).then((e=>!e&&m&&h)).then((t=>t?fp`<li><button class="btn btn-primary" type="button" @click="${()=>e.addToContacts()}">${u}</button></li>`:""));return fp`<div class="row"><div class="col-auto"><converse-avatar .model="${e.model}" class="avatar modal-avatar" name="${e.model.getDisplayName()}" nonce="${n?.get("vcard_updated")}" height="120" width="120"></converse-avatar></div><div class="col"><ul class="occupant-details"><li>${i?fp`<div class="row"><strong class="g-0">${HS("Nickname")}:</strong></div><div class="row">${i}</div>`:""}</li><li>${s?fp`<div class="row"><strong class="g-0">${HS("XMPP Address")}:</strong></div><div class="row">${s}</div>`:""}</li><li><div class="row"><strong class="g-0">${HS("Affiliation")}:</strong></div><div class="row">${a}  ${d?fp`<a href="#" data-form="affiliation-form" class="toggle-form right" color="var(--secondary-color)" @click="${t=>e.toggleForm(t)}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>${e.show_affiliation_form?fp`<converse-muc-affiliation-form jid="${s}" .muc="${l}" affiliation="${a}"></converse-muc-affiliation-form>`:""}`:""}</div></li><li><div class="row"><strong class="g-0">${HS("Role")}:</strong></div><div class="row">${o}  ${d&&o?fp`<a href="#" data-form="row-form" class="toggle-form right" color="var(--secondary-color)" @click="${t=>e.toggleForm(t)}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>${e.show_role_form?fp`<converse-muc-role-form jid="${s}" .muc="${l}" role="${o}"></converse-muc-role-form>`:""}`:""}</div></li><li>${c?fp`<div class="row"><strong class="g-0">${HS("Hats")}:</strong></div><div class="row">${c}</div>`:""}</li><li>${r?fp`<div class="row"><strong class="g-0">${HS("Occupant Id")}:</strong></div><div class="row">${r}</div>`:""}</li>${LT(g,"")}</ul></div></div>`})(this)}getModalTitle(){const e=this.model??this.message;return e?.getDisplayName()}addToContacts(){const e=(this.model??this.message).get("jid");e&&hm.modal.show("converse-add-contact-modal",{model:new fd({jid:e})})}toggleForm(e){"row-form"===BT.ancestor(e.target,".toggle-form").getAttribute("data-form")?this.show_role_form=!this.show_role_form:this.show_affiliation_form=!this.show_affiliation_form,this.render()}});const GT=(e,t)=>fp`<li class="list-group-item" data-nick="${t.item.nick}"><ul class="list-group"><li class="list-group-item active"><div><strong>JID:</strong> ${t.item.jid}</div></li><li class="list-group-item"><div><strong>Nickname:</strong> ${t.item.nick}</div></li><li class="list-group-item"><div><strong>Role:</strong> ${t.item.role} ${t.assignable_roles.length?(e=>fp`<a href="#" data-form="converse-muc-role-form" class="toggle-form right" color="var(--secondary-color)" @click="${e.toggleForm}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`)(t):""}</div>${t.assignable_roles.length?fp`<converse-muc-role-form class="hidden" .muc="${e.muc}" jid="${t.item.jid}" role="${t.item.role}"></converse-muc-role-form>`:""}</li></ul></li>`,WT=(e,t)=>fp`<li class="list-group-item" data-nick="${t.item.nick}"><ul class="list-group"><li class="list-group-item active"><div><strong>JID:</strong> ${t.item.jid}</div></li><li class="list-group-item"><div><strong>Nickname:</strong> ${t.item.nick}</div></li><li class="list-group-item"><div><strong>Affiliation:</strong> ${t.item.affiliation} ${t.assignable_affiliations.length?(e=>fp`<a href="#" data-form="converse-muc-affiliation-form" class="toggle-form right" color="var(--secondary-color)" @click="${e.toggleForm}"><converse-icon class="fa fa-wrench" size="1em"></converse-icon></a>`)(t):""}</div>${t.assignable_affiliations.length?fp`<converse-muc-affiliation-form class="hidden" .muc="${e.muc}" jid="${t.item.jid}" affiliation="${t.item.affiliation}"></converse-muc-affiliation-form>`:""}</li></ul></li>`,VT=(e,t)=>{const s=HS("Affiliation"),n=HS("No users with that affiliation found."),i=HS("No users with that role found."),r=HS("Type here to filter the search results"),o=HS("Role"),a=HS("Show users"),c=HS("Roles are assigned to users to grant or deny them certain abilities in a multi-user chat. They're assigned either explicitly or implicitly as part of an affiliation. A role that's not due to an affiliation, is only valid for the duration of the user's session."),l=HS("An affiliation is a long-lived entitlement which typically implies a certain role and which grants privileges and responsibilities. For example admins and owners automatically have the moderator role."),d=t.queryable_roles.length&&t.queryable_affiliations.length;return fp`${t.alert_message?fp`<div class="alert alert-${t.alert_type}" role="alert">${t.alert_message}</div>`:""} ${d?(e=>fp`<ul class="nav nav-pills justify-content-center"><li role="presentation" class="nav-item"><a class="nav-link ${"affiliations"===e.tab?"active":""}" id="affiliations-tab" href="#affiliations-tabpanel" aria-controls="affiliations-tabpanel" role="tab" data-name="affiliations" @click="${e.switchTab}">Affiliations</a></li><li role="presentation" class="nav-item"><a class="nav-link ${"roles"===e.tab?"active":""}" id="roles-tab" href="#roles-tabpanel" aria-controls="roles-tabpanel" role="tab" data-name="roles" @click="${e.switchTab}">Roles</a></li></ul>`)(t):""}<div class="tab-content">${t.queryable_affiliations.length?fp`<div class="tab-pane tab-pane--columns ${"affiliations"===t.tab?"active":""}" id="affiliations-tabpanel" role="tabpanel" aria-labelledby="affiliations-tab"><form class="converse-form query-affiliation" @submit="${t.queryAffiliation}"><p class="helptext pb-3">${l}</p><div><label class="form-label" for="affiliation"><strong>${s}:</strong></label><div class="row"><div class="col"><select class="form-select select-affiliation" name="affiliation">${t.queryable_affiliations.map((e=>(e=>fp`<option value="${e.item||""}" ?selected="${e.item===e.affiliation}" title="${HT(e.item)}">${e.item}</option>`)(Object.assign({item:e},t))))}</select></div><div class="col"><input type="submit" class="btn btn-primary" name="users_with_affiliation" value="${a}"></div></div><div class="row"><div class="col mt-3">${Array.isArray(t.users_with_affiliation)&&t.users_with_affiliation.length>5?fp`<input class="form-control" .value="${t.affiliations_filter}" @keyup="${t.filterAffiliationResults}" type="text" name="filter" placeholder="${r}">`:""}</div></div>${HT(t.affiliation)?fp`<div class="row"><div class="col pt-2"><p class="helptext pb-3">${HT(t.affiliation)}</p></div></div>`:""}</div></form><div class="scrollable-container"><ul class="list-group list-group--users">${t.loading_users_with_affiliation?fp`<li class="list-group-item">${vT()}</li>`:""} ${Array.isArray(t.users_with_affiliation)&&0===t.users_with_affiliation.length?fp`<li class="list-group-item">${n}</li>`:""} ${t.users_with_affiliation instanceof Error?fp`<li class="list-group-item">${t.users_with_affiliation.message}</li>`:(t.users_with_affiliation||[]).map((s=>(s.nick||s.jid).match(new RegExp(t.affiliations_filter,"i"))?WT(e,Object.assign({item:s},t)):""))}</ul></div></div>`:""} ${t.queryable_roles.length?fp`<div class="tab-pane tab-pane--columns ${"roles"===t.tab?"active":""}" id="roles-tabpanel" role="tabpanel" aria-labelledby="roles-tab"><form class="converse-form query-role" @submit="${t.queryRole}"><p class="helptext pb-3">${c}</p><div><label class="form-label" for="role"><strong>${o}:</strong></label><div class="row"><div class="col"><select class="form-select select-role" name="role">${t.queryable_roles.map((e=>(e=>fp`<option value="${e.item||""}" ?selected="${e.item===e.role}" title="${qT(e.item)}">${e.item}</option>`)(Object.assign({item:e},t))))}</select></div><div class="col"><input type="submit" class="btn btn-primary" name="users_with_role" value="${a}"></div></div><div class="row"><div class="col mt-3">${Array.isArray(t.users_with_role)&&t.users_with_role.length>5?fp`<input class="form-control" .value="${t.roles_filter}" @keyup="${t.filterRoleResults}" type="text" name="filter" placeholder="${r}">`:""}</div></div>${qT(t.role)?fp`<div class="row"><div class="col pt-2"><p class="helptext pb-3">${qT(t.role)}</p></div></div>`:""}</div></form><div class="scrollable-container"><ul class="list-group list-group--users">${t.loading_users_with_role?fp`<li class="list-group-item">${vT()}</li>`:""} ${t.users_with_role&&0===t.users_with_role.length?fp`<li class="list-group-item">${i}</li>`:""} ${(t.users_with_role||[]).map((s=>s.nick.match(t.roles_filter)?GT(e,Object.assign({item:s},t)):""))}</ul></div></div>`:""}</div>`};var QT=s(1946),KT={};KT.styleTagTransform=I(),KT.setAttributes=j(),KT.insert=C().bind(null,"head"),KT.domAPI=E(),KT.insertStyleElement=O();A()(QT.A,KT);QT.A&&QT.A.locals&&QT.A.locals;const{u:JT}=Cf.env,{AFFILIATIONS:YT,ROLES:XT}=DS;hm.elements.define("converse-modtools",class extends VS{static get properties(){return{affiliation:{type:String},affiliations_filter:{type:String,attribute:!1},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1},jid:{type:String},muc:{type:Object,attribute:!1},role:{type:String},roles_filter:{type:String,attribute:!1},tab:{type:String},users_with_affiliation:{type:Array,attribute:!1},users_with_role:{type:Array,attribute:!1}}}constructor(){super(),this.jid=null,this.tab="affiliations",this.affiliation=null,this.affiliations_filter="",this.role="",this.roles_filter="",this.addEventListener("affiliationChanged",(()=>{this.alert(HS("Affiliation changed"),"primary"),this.onSearchAffiliationChange(),this.requestUpdate()})),this.addEventListener("roleChanged",(()=>{this.alert(HS("Role changed"),"primary"),this.requestUpdate()}))}updated(e){e.has("role")&&this.onSearchRoleChange(),e.has("affiliation")&&this.onSearchAffiliationChange(),e.has("jid")&&e.get("jid")&&this.initialize()}async initialize(){this.initialized=hc();const e=await hm.rooms.get(this.jid);await e.initialized,this.muc=e,this.initialized.resolve()}render(){if(this.muc?.occupants){const e=this.muc.occupants.getOwnOccupant();return VT(this,{affiliations_filter:this.affiliations_filter,alert_message:this.alert_message,alert_type:this.alert_type,assignable_affiliations:e.getAssignableAffiliations(),assignable_roles:e.getAssignableRoles(),filterAffiliationResults:e=>this.filterAffiliationResults(e),filterRoleResults:e=>this.filterRoleResults(e),loading_users_with_affiliation:this.loading_users_with_affiliation,queryAffiliation:e=>this.queryAffiliation(e),queryRole:e=>this.queryRole(e),queryable_affiliations:YT.filter((e=>!hm.settings.get("modtools_disable_query").includes(e))),queryable_roles:XT.filter((e=>!hm.settings.get("modtools_disable_query").includes(e))),roles_filter:this.roles_filter,switchTab:e=>this.switchTab(e),tab:this.tab,toggleForm:e=>this.toggleForm(e),users_with_affiliation:this.users_with_affiliation,users_with_role:this.users_with_role})}return""}switchTab(e){e.stopPropagation(),e.preventDefault(),this.tab=e.target.getAttribute("data-name"),this.requestUpdate()}async onSearchAffiliationChange(){if(this.affiliation){if(await this.initialized,this.clearAlert(),this.loading_users_with_affiliation=!0,this.users_with_affiliation=null,this.shouldFetchAffiliationsList()){const e=await hm.rooms.affiliations.get(this.affiliation,this.jid);e instanceof Error?(this.alert(e.message,"danger"),this.users_with_affiliation=[]):this.users_with_affiliation=e}else this.users_with_affiliation=this.muc.getOccupantsWithAffiliation(this.affiliation);this.loading_users_with_affiliation=!1}}async onSearchRoleChange(){this.role&&(await this.initialized,this.clearAlert(),this.users_with_role=this.muc.getOccupantsWithRole(this.role))}shouldFetchAffiliationsList(){const e=this.affiliation;if("none"===e)return!1;return!ob.getAutoFetchedAffiliationLists().includes(e)}toggleForm(e){e.stopPropagation(),e.preventDefault();const t=JT.ancestor(e.target,".toggle-form"),s=t.getAttribute("data-form"),n=JT.ancestor(t,".list-group-item").querySelector(s);JT.hasClass("hidden",n)?JT.removeClass("hidden",n):JT.addClass("hidden",n)}filterRoleResults(e){this.roles_filter=e.target.value,this.render()}filterAffiliationResults(e){this.affiliations_filter=e.target.value}queryRole(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("role");this.role=null,this.role=t}queryAffiliation(e){e.stopPropagation(),e.preventDefault();const t=new FormData(e.target).get("affiliation");this.affiliation=null,this.affiliation=t}alert(e,t){this.alert_message=e,this.alert_type=t}clearAlert(){this.alert_message=void 0,this.alert_type=void 0}});hm.elements.define("converse-modtools-modal",class extends uj{constructor(e){super(e),this.id="converse-modtools-modal",this.affiliation=e.affiliation,this.jid=e.jid}renderModal(){return fp`<converse-modtools jid="${this.jid}" affiliation="${this.affiliation}"></converse-modtools>`}getModalTitle(){return HS("Moderator Tools")}});const{Strophe:ZT,u:eO}=Cf.env,{CHATROOMS_TYPE:tO}=DS,sO={admin:"admin",ban:"outcast",member:"member",owner:"owner",revoke:"none"},nO={deop:"participant",kick:"none",mute:"visitor",op:"moderator",voice:"participant"};function iO({contact:e,jid:t,reason:s}){return s?hm.confirm(HS('%1$s has invited you to join a groupchat: %2$s, and left the following reason: "%3$s"',e,t,s)):hm.confirm(HS("%1$s has invited you to join a groupchat: %2$s",e,t))}async function rO(e){const t=[HS("Are you sure you want to destroy this groupchat?")];let s=[{name:"challenge",label:HS("Please enter the XMPP address of this groupchat to confirm"),challenge:e.get("jid"),placeholder:HS("name@example.org"),required:!0},{name:"reason",label:HS("Optional reason for destroying this groupchat"),placeholder:HS("Reason")},{name:"newjid",label:HS("Optional XMPP address for a new groupchat that replaces this one"),placeholder:HS("replacement@example.org")}];try{s=await hm.confirm(HS("Confirm"),t,s);const n=s.filter((e=>"reason"===e.name)).pop()?.value,i=s.filter((e=>"newjid"===e.name)).pop()?.value;return e.sendDestroyIQ(n,i).then((()=>e.close()))}catch(e){Ct.error(e)}}function oO(e){const t=e.session.get("view"),s=e.get("jid"),n=Cf.ROOMSTATUS,i=e.session.get("connection_status");return t===Cf.MUC.VIEWS.CONFIG?fp`<converse-muc-config-form class="muc-form-container" jid="${s}"></converse-muc-config-form>`:fp`${i==n.PASSWORD_REQUIRED?fp`<converse-muc-password-form class="muc-form-container" jid="${s}"></converse-muc-password-form>`:""} ${i==n.ENTERED?fp`<converse-muc-chatarea class="row g-0" jid="${s}"></converse-muc-chatarea>`:""} ${i==n.CONNECTING?vT({class:"vertically-centered"}):""} ${i==n.NICKNAME_REQUIRED?function(e){const t=e.get("jid");return hm.settings.get("muc_show_logs_before_join")?fp`<converse-muc-chatarea class="row g-0" jid="${t}"></converse-muc-chatarea>`:fp`<converse-muc-nickname-form jid="${t}"></converse-muc-nickname-form>`}(e):""} ${i==n.DISCONNECTED?fp`<converse-muc-disconnected jid="${s}"></converse-muc-disconnected>`:""} ${i==n.BANNED?fp`<converse-muc-disconnected jid="${s}"></converse-muc-disconnected>`:""} ${i==n.DESTROYED?fp`<converse-muc-destroyed jid="${s}"></converse-muc-destroyed>`:""}`}async function aO(){const e=[...await hm.rooms.get(),...await hm.contacts.get()],t=[...new Set(e.map((e=>ZT.getDomainFromJid(e.get("jid")))))];return t}function cO(e,t,s,n=[],i=[]){const r=nO[t];if(!r)throw Error(`ChatRoomView#setRole called with invalid command: ${t}`);if(!e.verifyAffiliations(n)||!e.verifyRoles(i))return!1;if(!e.validateRoleOrAffiliationChangeArgs(t,s))return!1;const o=e.getNickOrJIDFromCommandArgs(s);if(!o)return!1;const a=s.split(o,2)[1].trim(),c=e.getOccupant(o);return e.setRole(c,r,a,void 0,(t=>e.onCommandError(t))),!0}function lO(e,t,s,n){const i=sO[t];if(!i)throw Error(`verifyAffiliations called with invalid command: ${t}`);if(!e.verifyAffiliations(n))return!1;if(!e.validateRoleOrAffiliationChangeArgs(t,s))return!1;const r=e.getNickOrJIDFromCommandArgs(s);if(!r)return!1;let o;const a=s.split(r,2)[1].trim(),c=e.getOccupant(r);if(c)o=c.get("jid");else{if(!eO.isValidJID(r)){const t=HS("Couldn't find a participant with that nickname. They might have left the groupchat.");return void e.createMessage({message:t,type:"error"})}o=r}const l={jid:o,reason:a};c&&hm.settings.get("auto_register_muc_nickname")&&(l.nick=c.get("nick")),eO.muc.setAffiliation(i,e.get("jid"),[l]).then((()=>e.occupants.fetchMembers())).catch((t=>e.onCommandError(t)))}function dO(e,t){if(!e.verifyRoles(["moderator"]))return;let s=hm.modal.get("converse-modtools-modal");s?(s.affiliation=t,s.render()):s=hm.modal.create("converse-modtools-modal",{affiliation:t,jid:e.get("jid")}),s.show()}function uO(e,t){const s=e.model;if(t||s.get("type")!==tO||hm.settings.get("muc_disable_slash_commands")&&!Array.isArray(hm.settings.get("muc_disable_slash_commands")))return t;let n=e.text;n=n.replace(/^\s*/,"");const i=(n.match(/^\/([a-zA-Z]*) ?/)||[""]).pop().toLowerCase();if(!i)return!1;const r=n.slice(("/"+i).length+1).trim(),o=s.getAllowedCommands()??[];if("admin"===i&&o.includes(i))return lO(s,i,r,["owner"]),!0;if("ban"===i&&o.includes(i))return lO(s,i,r,["admin","owner"]),!0;if("modtools"===i&&o.includes(i))return dO(s,r),!0;if("deop"===i&&o.includes(i))return cO(s,i,r,["admin","owner"]),!0;if("destroy"===i&&o.includes(i))return!s.verifyAffiliations(["owner"])||(rO(s).catch((e=>s.onCommandError(e))),!0);if("help"===i&&o.includes(i))return s.set({show_help_messages:!1},{silent:!0}),s.set({show_help_messages:!0}),!0;if("kick"===i&&o.includes(i))return cO(s,i,r,[],["moderator"]),!0;if("mute"===i&&o.includes(i))return cO(s,i,r,[],["moderator"]),!0;if("member"===i&&o.includes(i))return lO(s,i,r,["admin","owner"]),!0;if("nick"===i&&o.includes(i)){if(!s.verifyRoles(["visitor","participant","moderator"]))return!0;if(0===r.length){const e=HS('Your nickname is "%1$s"',s.get("nick"));s.createMessage({message:e,type:"error"})}else s.setNickname(r);return!0}return"owner"===i&&o.includes(i)?(lO(s,i,r,["owner"]),!0):"op"===i&&o.includes(i)?(cO(s,i,r,["admin","owner"]),!0):"register"===i&&o.includes(i)?(r.length>1?s.createMessage({message:HS("Error: invalid number of arguments"),type:"error"}):s.registerNickname().then((e=>{e&&s.createMessage({message:e,type:"error"})})),!0):"revoke"===i&&o.includes(i)?(lO(s,i,r,["admin","owner"]),!0):"topic"===i&&o.includes(i)||"subject"===i&&o.includes(i)?(s.setSubject(r),!0):!("voice"!==i||!o.includes(i))&&(cO(s,i,r,[],["moderator"]),!0)}const hO=e=>{const t=HS("On which entity do you want to run commands?"),s=HS("Certain XMPP services and entities allow privileged users to execute ad-hoc commands on them."),n=HS("Commands found"),i=HS("List available commands"),r=HS("XMPP Address"),o=HS("No commands found");return fp`${e.alert?fp`<div class="alert alert-${e.alert_type}" role="alert">${e.alert}</div>`:""} ${e.note?fp`<p class="form-help">${e.note}</p>`:""}<form class="converse-form" @submit="${e.fetchCommands}"><fieldset><label class="form-label">${t}<p class="form-help">${s}</p><converse-autocomplete .getAutoCompleteList="${aO}" required placeholder="${r}" name="jid"></converse-autocomplete></label></fieldset><fieldset>${e.fetching?vT():fp`<input type="submit" class="btn btn-primary" value="${i}">`}</fieldset>${"list-commands"===e.view?fp`<fieldset><ul class="list-group"><li class="list-group-item active">${e.commands.length?n:o}:</li>${e.commands.map((t=>((e,t)=>fp`<li class="room-item list-group-item"><div class="available-chatroom d-flex flex-row"><a class="open-room available-room w-100" @click="${t=>e.toggleCommandForm(t)}" data-command-node="${t.node}" data-command-jid="${t.jid}" data-command-name="${t.name}" title="${t.name}" href="#">${t.name||t.jid}</a></div>${t.node===e.showform?gT(e,t):""}</li>`)(e,t)))}</ul></fieldset>`:""}</form>`},{Strophe:mO,sizzle:gO}=Cf.env;async function pO(e){e.preventDefault();const t=e.currentTarget,s=t.getAttribute("data-bookmark-name"),n=t.getAttribute("data-room-jid");await hm.confirm(HS('Are you sure you want to remove the bookmark "%1$s"?',s))&&Bu.state.bookmarks.where({jid:n}).forEach((e=>e.destroy()))}function fO(e){e.preventDefault();const t=e.currentTarget.getAttribute("data-room-jid");hm.modal.show("converse-bookmark-form-modal",{jid:t},e)}function vO(e){e.preventDefault();const{Strophe:t}=Cf.env,s=e.currentTarget,n=s.textContent,i=s.getAttribute("data-room-jid"),r={name:n||t.unescapeNode(t.getNodeFromJid(i))||i};hm.rooms.open(i,r,!0)}hm.elements.define("converse-adhoc-commands",class extends VS{static get properties(){return{alert:{type:String},alert_type:{type:String},commands:{type:Array},fetching:{type:Boolean},showform:{type:String},view:{type:String}}}constructor(){super(),this.view="choose-service",this.fetching=!1,this.showform="",this.commands=[]}render(){return hO(this)}async fetchCommands(e){if(e.preventDefault(),!(e.target instanceof HTMLFormElement))return this.alert_type="danger",void(this.alert="Form could not be submitted");this.fetching=!0,delete this.alert_type,delete this.alert;const t=new FormData(e.target).get("jid").trim();let s;try{s=await hm.disco.supports(mO.NS.ADHOC,t)}catch(e){Ct.error(e)}finally{this.fetching=!1}if(s)try{this.commands=await hm.adhoc.getCommands(t),this.view="list-commands"}catch(e){return Ct.error(e),this.alert_type="danger",this.alert=HS("Sorry, an error occurred while looking for commands on that entity."),this.commands=[],void Ct.error(e)}else this.commands=[],this.alert_type="danger",this.alert=HS("The specified entity doesn't support ad-hoc commands")}async toggleCommandForm(e){e.preventDefault();const t=e.target.getAttribute("data-command-node"),s=this.commands.filter((e=>e.node===t))[0],{jid:n}=s;if(this.showform===t)this.showform="",this.requestUpdate();else{try{const e=await hm.adhoc.fetchCommandForm(n,t);Object.assign(s,e)}catch(e){null===e?Ct.error(`Error: timeout while trying to execute command for ${n}`):(Ct.error(`Error while trying to execute command for ${n}`),Ct.error(e)),s.alert=HS("An error occurred while trying to fetch the command form"),s.alert_type="danger"}this.showform=t}}executeAction(e){e.preventDefault();const t=e.target,s=t.getAttribute("data-action");["execute","next","prev","complete"].includes(s)?this.runCommand(t.form,s):Ct.error(`Unknown action: ${s}`)}clearCommand(e){delete e.alert,delete e.instructions,delete e.sessionid,delete e.alert_type,delete e.status,e.fields=[],e.actions=[],this.showform=""}async runCommand(e,t){const s=new FormData(e),n=s.get("command_jid").trim(),i=s.get("command_node").trim(),r=this.commands.filter((e=>e.node===i))[0];delete r.alert,this.requestUpdate();const o="prev"===t?[]:gO(":input:not([type=button]):not([type=submit])",e).filter((e=>!["command_jid","command_node"].includes(e.getAttribute("name")))).map(tT).filter((e=>e)),a=await hm.adhoc.runCommand(n,r.sessionid,r.node,t,o),{fields:c,status:l,note:d,instructions:u,actions:h}=a;if("error"===l)return r.status=l,r.alert_type="danger",r.alert=HS("Sorry, an error occurred while trying to execute the command. See the developer console for details"),this.requestUpdate();"executing"===l?(Object.assign(r,{fields:c,instructions:u,actions:h,status:l}),r.alert=HS("Executing"),r.alert_type="primary"):"completed"===l?(this.alert_type="primary",this.alert=HS("Completed"),this.note=d,this.clearCommand(r)):(Ct.error(`Unexpected status for ad-hoc command: ${l}`),r.alert=HS("Completed"),r.alert_type="primary"),this.requestUpdate()}async cancel(e){e.preventDefault(),this.showform="",this.requestUpdate();const t=new FormData(e.target.form),s=t.get("command_jid").trim(),n=t.get("command_node").trim(),i=this.commands.filter((e=>e.node===n))[0];delete i.alert,this.requestUpdate();const{status:r}=await hm.adhoc.runCommand(s,i.sessionid,i.node,"cancel",[]);"error"===r?(i.alert_type="danger",i.alert=HS("An error occurred while trying to cancel the command. See the developer console for details")):"canceled"===r?(this.alert_type="",this.alert="",this.clearCommand(i)):(Ct.error(`Unexpected status for ad-hoc command: ${r}`),i.alert=HS("Error: unexpected result"),i.alert_type="danger"),this.requestUpdate()}}),Cf.plugins.add("converse-adhoc-views",{dependencies:["converse-controlbox","converse-muc"],initialize(){hm.settings.extend({allow_adhoc_commands:!0})}});const _O=e=>{const t=e.get("jid"),s=HS("Unbookmark this groupchat"),n=HS("Click to open this groupchat");return fp`<div class="list-item room-item available-chatroom d-flex flex-row" data-room-jid="${t}"><a class="list-item-link open-room w-100" data-room-jid="${t}" title="${n}" @click="${vO}">${e.getDisplayName()}</a> <a class="list-item-action remove-bookmark align-self-center ${e.get("bookmarked")?"button-on":""}" tabindex="0" data-room-jid="${t}" data-bookmark-name="${e.getDisplayName()}" title="${s}" @click="${pO}"><converse-icon class="fa fa-times" size="1em"></converse-icon></a></div>`};var bO=s(1205),yO={};yO.styleTagTransform=I(),yO.setAttributes=j(),yO.insert=C().bind(null,"head"),yO.domAPI=E(),yO.insertStyleElement=O();A()(bO.A,yO);bO.A&&bO.A.locals&&bO.A.locals;const{initStorage:wO}=Ef;class SO extends VS{async initialize(){await hm.waitUntil("bookmarksInitialized");const{bookmarks:e,chatboxes:t}=Bu.state;this.liveFilter=Wu((e=>this.model.set({text:e.target.value})),100),this.listenTo(e,"add",(()=>this.requestUpdate())),this.listenTo(e,"remove",(()=>this.requestUpdate())),this.listenTo(t,"add",(()=>this.requestUpdate())),this.listenTo(t,"remove",(()=>this.requestUpdate()));const s=`converse.bookmarks-list-model-${Bu.session.get("bare_jid")}`;this.model=new fd({id:s}),wO(this.model,s),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.model.fetch({success:()=>this.requestUpdate(),error:()=>this.requestUpdate()})}render(){return Bu.state.bookmarks&&this.model?(e=>{const t=HS("Filter"),s=e.model.get("text"),{bookmarks:n}=Bu.state,i=s?n.filter((e=>((e,t)=>e.get("name")?.includes(t)||e.get("jid")?.includes(t))(e,s))):n;return fp`<form class="converse-form bookmarks-filter"><div class="btn-group w-100"><input .value="${s??""}" @keydown="${t=>e.liveFilter(t)}" class="form-control" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${s?"":"hidden"}" @click="${e.clearFilter}"></converse-icon></div></form><div class="list-container list-container--bookmarks"><div class="items-list bookmarks rooms-list">${i.map((e=>_O(e)))}</div></div>`})(this):vT()}clearFilter(e){e?.stopPropagation?.(),this.model.set("text","")}}hm.elements.define("converse-bookmarks",SO);hm.elements.define("converse-bookmark-list-modal",class extends uj{renderModal(){return fp`<converse-bookmarks></converse-bookmarks>`}getModalTitle(){return HS("Bookmarks")}});class AO extends VS{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}willUpdate(e){const{chatboxes:t,bookmarks:s}=Bu.state;e.has("jid")&&(this.model=t.get(this.jid),this.bookmark=s.get(this.jid))}render(){return(e=>{const t=e.model.getDisplayName(),s=e.bookmark?.get("nick")??e.model.get("nick"),n=HS('Bookmark for "%1$s"',t),i=HS("Would you like this groupchat to be automatically joined upon startup?"),r=HS("Remove"),o=HS("Name"),a=HS("What should your nickname for this groupchat be?"),c=HS("Password (for a protected groupchat)"),l=HS("If the groupchat requires a password to enter, you can save it here. Note this is not intended to be a secure storage."),d=e.bookmark?HS("Update"):HS("Save");return fp`<form class="converse-form chatroom-form" @submit="${t=>e.onBookmarkFormSubmitted(t)}"><legend>${n}</legend><fieldset><label class="form-label" for="converse_muc_bookmark_name">${o}</label> <input class="form-control" type="text" value="${t}" name="name" required="required" id="converse_muc_bookmark_name"></fieldset><fieldset><label class="form-label" for="converse_muc_bookmark_nick">${a}</label> <input class="form-control" type="text" name="nick" value="${s||""}" id="converse_muc_bookmark_nick"></fieldset><fieldset><label for="muc-password" class="form-label">${c}</label><p class="form-help">${l}</p><input type="password" name="password" class="form-control" id="muc-password"></fieldset><fieldset class="form-group form-check"><input class="form-check-input" id="converse_muc_bookmark_autojoin" type="checkbox" ?checked="${e.bookmark?.get("autojoin")}" name="autojoin"> <label class="form-check-label" for="converse_muc_bookmark_autojoin">${i}</label></fieldset><fieldset><input class="btn btn-primary" type="submit" value="${d}"> ${e.bookmark?fp`<input class="btn btn-secondary button-remove" type="button" value="${r}" @click="${t=>e.removeBookmark(t)}">`:""}</fieldset></form>`})(this)}onBookmarkFormSubmitted(e){e.preventDefault();const{bookmarks:t}=Bu.state,s=e.target;t.setBookmark({jid:this.jid,autojoin:s.querySelector('input[name="autojoin"]')?.checked||!1,name:s.querySelector("input[name=name]")?.value,nick:s.querySelector("input[name=nick]")?.value,password:s.querySelector("input[name=password]")?.value}),this.closeBookmarkForm(e)}removeBookmark(e){this.bookmark?.destroy(),this.closeBookmarkForm(e)}closeBookmarkForm(e){e.preventDefault(),this.dispatchEvent(new Event("hide.bs.modal",{bubbles:!0,cancelable:!0}))}}hm.elements.define("converse-muc-bookmark-form",AO);const xO=AO;hm.elements.define("converse-bookmark-form-modal",class extends uj{constructor(e){super(e),this.jid=null}renderModal(){return fp`<converse-muc-bookmark-form class="muc-form-container" jid="${this.jid}"></converse-muc-bookmark-form>`}getModalTitle(){return HS("Bookmark")}});const{u:EO}=Cf.env,$O={setBookmarkState(){const{bookmarks:e}=Bu.state;if(e){e.where({jid:this.model.get("jid")}).length?this.model.save("bookmarked",!0):this.model.save("bookmarked",!1)}},renderBookmarkForm(){if(!this.bookmark_form){this.bookmark_form=new Bu.state.MUCBookmarkForm({model:this.model,chatroomview:this});this.querySelector(".chatroom-body").insertAdjacentElement("beforeend",this.bookmark_form.el)}EO.showElement(this.bookmark_form.el)},showBookmarkModal(e){e?.preventDefault();const t=this.model.get("jid");hm.modal.show("converse-bookmark-form-modal",{jid:t},e)}};Cf.plugins.add("converse-bookmark-views",{dependencies:["converse-chatboxes","converse-muc","converse-muc-views"],initialize(){hm.settings.extend({hide_open_bookmarks:!0});const e={removeBookmarkViaEvent:pO,addBookmarkViaEvent:fO,MUCBookmarkForm:xO,BookmarksView:SO};Object.assign(Bu,e),Object.assign(Bu.exports,e),Object.assign(Bu.exports.ChatRoomView.prototype,$O),hm.listen.on("chatRoomViewInitialized",(e=>e.setBookmarkState()))}});const CO=(e,t,s)=>{const n=new Map;for(let i=t;i<=s;i++)n.set(e[i],i);return n},kO=ET(class extends $T{constructor(e){if(super(e),e.type!==xT)throw Error("repeat() can only be used in text expressions")}dt(e,t,s){let n;void 0===s?s=t:void 0!==t&&(n=t);const i=[],r=[];let o=0;for(const t of e)i[o]=n?n(t,o):o,r[o]=s(t,o),o++;return{values:r,keys:i}}render(e,t,s){return this.dt(e,t,s).values}update(e,[t,s,n]){const i=(e=>e._$AH)(e),{values:r,keys:o}=this.dt(t,s,n);if(!Array.isArray(i))return this.ut=o,r;const a=this.ut??=[],c=[];let l,d,u=0,h=i.length-1,m=0,g=r.length-1;for(;u<=h&&m<=g;)if(null===i[u])u++;else if(null===i[h])h--;else if(a[u]===o[m])c[m]=wT(i[u],r[m]),u++,m++;else if(a[h]===o[g])c[g]=wT(i[h],r[g]),h--,g--;else if(a[u]===o[g])c[g]=wT(i[u],r[g]),yT(e,c[g+1],i[u]),u++,g--;else if(a[h]===o[m])c[m]=wT(i[h],r[m]),yT(e,i[u],i[h]),h--,m++;else if(void 0===l&&(l=CO(o,m,g),d=CO(a,u,h)),l.has(a[u]))if(l.has(a[h])){const t=d.get(o[m]),s=void 0!==t?i[t]:null;if(null===s){const t=yT(e,i[u]);wT(t,r[m]),c[m]=t}else c[m]=wT(s,r[m]),yT(e,i[u],s),i[t]=null;m++}else AT(i[h]),h--;else AT(i[u]),u++;for(;m<=g;){const t=yT(e,c[g+1]);wT(t,r[m]),c[m++]=t}for(;u<=h;){const e=i[u++];null!==e&&AT(e)}return this.ut=o,((e,t=ST)=>{e._$AH=t})(e,c),Ng}}),{CONTROLBOX_TYPE:jO,CHATROOMS_TYPE:TO,HEADLINES_TYPE:OO}=DS;function NO(e){const t="overlayed"===hm.settings.get("view_mode")&&e.get("hidden");return e.get("type")===jO||!(e.get("hidden")||t)}hm.elements.define("converse-chats",class extends VS{initialize(){this.model=Bu.state.chatboxes,this.listenTo(this.model,"add",(()=>this.requestUpdate())),this.listenTo(this.model,"change:closed",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden",(()=>this.requestUpdate())),this.listenTo(this.model,"change:jid",(()=>this.requestUpdate())),this.listenTo(this.model,"destroy",(()=>this.requestUpdate())),this.listenTo(Bu,"connected",(()=>this.requestUpdate())),this.listenTo(Bu,"reconnected",(()=>this.requestUpdate())),this.listenTo(Bu,"disconnected",(()=>this.requestUpdate()));const e=hm.settings.get();this.listenTo(e,"change:view_mode",(()=>this.requestUpdate())),this.listenTo(e,"change:singleton",(()=>this.requestUpdate()));document.querySelector("body").classList.add(`converse-${hm.settings.get("view_mode")}`),hm.trigger("chatBoxViewsInitialized")}render(){return(()=>{const{chatboxes:e}=Bu.state,t=hm.settings.get("view_mode"),s=hm.connection.get(),n=!s?.connected||!s?.authenticated||s?.disconnecting;return fp`${n||"overlayed"!==t?"":fp`<converse-minimized-chats class="col-auto"></converse-minimized-chats>`} ${kO(e.filter(NO),(e=>e.get("jid")),(e=>e.get("type")===jO?fp`${"overlayed"===t?fp`<converse-controlbox-toggle class="${e.get("closed")?"col-auto":"hidden"}"></converse-controlbox-toggle>`:""}<converse-controlbox id="controlbox" class="col-auto chatbox ${"overlayed"===t&&e.get("closed")?"hidden":""} ${n?"logged-out":""}" style="${e.get("width")?`width: ${e.get("width")}`:""}"></converse-controlbox>`:e.get("type")===TO?fp`<converse-muc jid="${e.get("jid")}" class="col-auto chatbox chatroom"></converse-muc>`:e.get("type")===OO?fp`<converse-headlines jid="${e.get("jid")}" class="col-auto chatbox headlines"></converse-headlines>`:fp`<converse-chat jid="${e.get("jid")}" class="col-auto chatbox"></converse-chat>`))}`})()}});const IO=class{constructor(){this.views={},this.el=null}add(e,t){this.views[e]=t}get(e){return this.views[e]}xget(e){return this.keys().filter((t=>t!==e)).reduce(((e,t)=>(e[t]=this.views[t],e)),{})}getAll(){return Object.values(this.views)}keys(){return Object.keys(this.views)}remove(e){delete this.views[e]}map(e){return Object.values(this.views).map(e)}forEach(e){return Object.values(this.views).forEach(e)}filter(e){return Object.values(this.views).filter(e)}closeAllChatBoxes(){return Promise.all(Object.values(this.views).map((e=>e.close({name:"closeAllChatBoxes"}))))}};function MO(){const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}var RO=s(3403),DO={};DO.styleTagTransform=I(),DO.setAttributes=j(),DO.insert=C().bind(null,"head"),DO.domAPI=E(),DO.insertStyleElement=O();A()(RO.A,DO);RO.A&&RO.A.locals&&RO.A.locals;Cf.plugins.add("converse-chatboxviews",{dependencies:["converse-chatboxes","converse-vcard"],initialize(){hm.promises.add(["chatBoxViewsInitialized"]),hm.settings.extend({animate:!0});const e=new IO;Object.assign(Bu,{chatboxviews:e}),Object.assign(Bu.state,{chatboxviews:e}),hm.listen.on("chatBoxesInitialized",(()=>{Bu.state.chatboxes.on("destroy",(t=>e.remove(t.get("jid"))))})),hm.listen.on("cleanup",(()=>Object.assign(Bu,{chatboxviews:null}))),hm.listen.on("cleanup",(()=>delete Bu.state.chatboxviews)),hm.listen.on("clearSession",(()=>e.closeAllChatBoxes())),hm.listen.on("chatBoxViewsInitialized",MO),window.addEventListener("resize",MO),Object.assign(Cf,{insertInto(t){const s=e.el;if(s&&!t.contains(s))t.insertAdjacentElement("afterbegin",s);else if(!s)throw new Error("Cannot insert non-existing #conversejs element into the DOM")}})}});const{dayjs:zO,u:LO}=Cf.env,{convertASCII2Emoji:PO,getShortnameReferences:FO,getCodePointReferences:UO}=LO;function BO(e){const t=e.get("num_unread")||0;return t<100?t:"99+"}async function qO(e){return(await e).filter((e=>e.standalone)).map((e=>async function(e){const t=await e;return fp`<button type="button" class="btn chatbox-btn ${t.a_class}" @click="${t.handler}" title="${t.i18n_title}"><converse-icon size="1em" class="fa ${t.icon_class}"></converse-icon></button>`}(e))).reverse().map((e=>LT(e,"")))}async function HO(e){const t=(await e).filter((e=>!e.standalone)).map((e=>async function(e){const t=await e;return t?fp`<a href="#" role="button" class="dropdown-item ${t.a_class}" @click="${t.handler}" title="${t.i18n_title}"><converse-icon size="1em" class="fa ${t.icon_class}"></converse-icon>${t.i18n_text}</a>`:""}(e)));return t.length?fp`<converse-dropdown class="chatbox-btn btn-group dropstart" .items="${t}"></converse-dropdown>`:""}function GO(e){if(!e.isHidden()&&hm.settings.get("allow_url_history_change")){const t=window.location.hash;t&&e.messages.get(t.slice(1))&&history.pushState(null,"",window.location.pathname)}}const WO=Wu((function(e){let t=!0;const s=e.target,n=0===Math.floor(s.scrollTop),i=Math.ceil(s.clientHeight-s.scrollTop)>=s.scrollHeight-Math.ceil(s.scrollHeight/20);n?(t=!1,GO(s.model)):i&&hm.trigger("chatBoxScrolledUp",s),s.model.get("scolled")!==t&&s.model.ui.set({scrolled:t})}),50);function VO(e){const t=e.collection?.models;if(!t)return;const s=t.indexOf(e),n=t[s-1];if(!n||zO(e.get("time")).isAfter(zO(n.get("time")),"day")){const t=zO(e.get("time")).startOf("day");return(e=>fp`<div class="message date-separator" data-isodate="${e.time}"><hr class="separator"><time class="separator-text" datetime="${e.time}"><span>${e.datestring}</span></time></div>`)({type:"date",time:t.toISOString(),datestring:t.format("dddd MMM Do YYYY")})}}function QO(){return Cf.emojis.toned||(Cf.emojis.toned=LO.unique(Object.values(Cf.emojis.json.people).filter((e=>e.sn.includes("_tone"))).map((e=>e.sn.replace(/_tone[1-5]/,""))))),Cf.emojis.toned}function KO(e,t={unicode_only:!1,add_title_wrapper:!1}){const s=e.emoji,n=e.shortname;if(s){if(t.unicode_only)return s;if(hm.settings.get("use_system_emojis"))return t.add_title_wrapper&&n?fp`<span title="${n}">${s}</span>`:s;{const t=hm.settings.get("emoji_image_path");return fp`<img class="emoji" loading="lazy" draggable="false" title="${n}" alt="${s}" src="${t}/72x72/${e.cp}.png">`}}if(t.unicode_only)return n;{const{url:e}=Cf.emojis.by_sn[n];return fp`<img class="emoji" loading="lazy" draggable="false" title="${n}" alt="${n}" src="${e.startsWith(".")?`${hm.settings.get("assets_path")}/${e}`:e}">`}}Object.assign(LO,{shortnamesToEmojis:function(e,t={unicode_only:!1,add_title_wrapper:!1}){return function(e,t){let s=[e];return[...FO(e),...UO(e)].sort(((e,t)=>t.begin-e.begin)).forEach((e=>{const n=s.shift(),i=KO(e,t);s="string"==typeof i?[n.slice(0,e.begin)+i+n.slice(e.end),...s]:[n.slice(0,e.begin),i,n.slice(e.end),...s]})),s}(e=PO(e),t)}});const{getURI:JO}=Ef;function YO(e,t){const s=JO(t),n=s.subdomain(),i=s.domain(),r=`${n?`${n}.`:""}${i}`;return e.includes(i)||e.includes(r)}function XO(e,t){const s=hm.settings.get(t);if(!Array.isArray(s))return!0;try{return YO(s,e)}catch(e){return Ct.debug(e),!1}}function ZO(e){return e.is_audio&&XO(e.url,"allowed_audio_domains")||e.is_video&&XO(e.url,"allowed_video_domains")||e.is_image&&XO(e.url,"allowed_image_domains")}function eN(e,t){if(!function(e){const t=JO(e),{protocol:s}=window.location;return!!["chrome-extension:","file:"].includes(s)||"http:"===s||"https:"===s&&["https","aesgcm"].includes(t.protocol().toLowerCase())}(e))return!1;const s=hm.settings.get("render_media"),n=XO(e,`allowed_${t}_domains`);return Array.isArray(s)?n&&YO(s,e):n&&s}var tN=s(7187),sN={};sN.styleTagTransform=I(),sN.setAttributes=j(),sN.insert=C().bind(null,"head"),sN.domAPI=E(),sN.insertStyleElement=O();A()(tN.A,sN);tN.A&&tN.A.locals&&tN.A.locals;const{getMediaURLs:nN}=Ef,{CHATROOMS_TYPE:iN}=DS;class rN extends VS{static get properties(){return{is_retracted:{type:Boolean},model:{type:Object}}}constructor(){super(),this.model=null,this.is_retracted=null}initialize(){const e=hm.settings.get();this.listenTo(e,"change:allowed_audio_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_video_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.chatbox.features,"change:moderated",(()=>this.requestUpdate())),this.listenTo(this.model.chatbox.occupants,"add",this.updateIfOwnOccupant),this.listenTo(this.model.chatbox.occupants,"change:role",this.updateIfOwnOccupant),this.listenTo(this.model.chatbox.session,"change:connection_status",(()=>this.requestUpdate()))}updateIfOwnOccupant(e){const t=Bu.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}render(){return fp`${LT(this.renderActions(),"")}`}async renderActions(){if(!this.model.collection)return"";const e=(await this.getActionButtons()).map((e=>rN.getActionsDropdownItem(e)));return e.length?fp`<converse-dropdown class="chat-msg__actions btn-group dropstart" .items="${e}"></converse-dropdown>`:""}static getActionsDropdownItem(e){return fp`<button type="button" class="dropdown-item chat-msg__action ${e.button_class}" @click="${e.handler}"><converse-icon class="${e.icon_class}" color="var(--foreground-color)" size="1em"></converse-icon> ${e.i18n_text}</button>`}async onMessageEditButtonClicked(e){e.preventDefault();const t=this.model.collection.findWhere("correcting"),s=Ef.ancestor(this,".chatbox")?.querySelector(".chat-textarea")?.value;if(s&&(!t||t.getMessageText()!==s)){if(!await hm.confirm(HS("You have an unsent message which will be lost if you continue. Are you sure?")))return}t!==this.model?(t?.save("correcting",!1),this.model.save("correcting",!0)):this.model.save("correcting",!1)}async onDirectMessageRetractButtonClicked(){if("me"!==this.model.get("sender"))return Ct.error("onMessageRetractButtonClicked called for someone else's message!");const e=HS("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere."),t=[HS("Are you sure you want to retract this message?")];hm.settings.get("show_retraction_warning")&&(t[1]=e);if(await hm.confirm(HS("Confirm"),t)){this.model.collection.chatbox.retractOwnMessage(this.model)}}async retractOtherMessage(e){const t=this.model.collection.chatbox,s=await t.retractOtherMessage(this.model,e);if(null===s){const e=HS("A timeout occurred while trying to retract the message");hm.alert("error",HS("Error"),e),Ct.warn(e)}else if(Ef.isErrorStanza(s)){const e=HS("Sorry, you're not allowed to retract this message.");hm.alert("error",HS("Error"),e),Ct.warn(e),Ct.error(s)}}async onMUCMessageRetractButtonClicked(){const e=HS("Be aware that other XMPP/Jabber clients (and servers) may not yet support retractions and that this message may not be removed everywhere.");if(this.model.mayBeRetracted()){const t=[HS("Are you sure you want to retract this message?")];if(hm.settings.get("show_retraction_warning")&&(t[1]=e),await hm.confirm(HS("Confirm"),t)){this.model.collection.chatbox.retractOwnMessage(this.model)}}else if(await this.model.mayBeModerated())if("me"===this.model.get("sender")){let t=[HS("Are you sure you want to retract this message?")];hm.settings.get("show_retraction_warning")&&(t=[t[0],e,t[1]]),await hm.confirm(HS("Confirm"),t)&&this.retractOtherMessage()}else{let t=[HS("You are about to retract this message."),HS("You may optionally include a message, explaining the reason for the retraction.")];hm.settings.get("show_retraction_warning")&&(t=[t[0],e,t[1]]);const s=await hm.prompt(HS("Message Retraction"),t,HS("Optional reason"));!1!==s&&this.retractOtherMessage(s)}else{const e=HS("Sorry, you're not allowed to retract this message");hm.alert("error",HS("Error"),e)}}onMessageRetractButtonClicked(e){e?.preventDefault?.();this.model.collection.chatbox.get("type")===iN?this.onMUCMessageRetractButtonClicked():this.onDirectMessageRetractButtonClicked()}onMediaToggleClicked(e){if(e?.preventDefault?.(),this.hasHiddenMedia(this.getMediaURLs()))this.model.save({hide_url_previews:!1,url_preview_transition:"fade-in"});else{(this.model.get("ogp_metadata")||[]).length?this.model.set("url_preview_transition","fade-out"):this.model.save({hide_url_previews:!0,url_preview_transition:"fade-in"})}}hasHiddenMedia(e){if("boolean"==typeof this.model.get("hide_url_previews"))return this.model.get("hide_url_previews");const t=hm.settings.get("render_media");return Array.isArray(t)?e.reduce(((e,s)=>e||!YO(t,s)),!1):!t}getMediaURLs(){const e=(this.model.get("ogp_metadata")||[]).map((e=>({url:e["og:image"],is_image:!0}))).filter((e=>ZO(e))),t=nN(this.model.get("media_urls")||[],this.model.get("body")).filter((e=>ZO(e)));return[...new Set([...t.map((e=>e.url)),...e.map((e=>e.url))])]}addMediaRenderingToggle(e){const t=this.getMediaURLs();if(t.length){const s=this.hasHiddenMedia(t);e.push({i18n_text:HS(s?"Show media":"Hide media"),handler:e=>this.onMediaToggleClicked(e),button_class:"chat-msg__action-hide-previews",icon_class:s?"fas fa-eye":"fas fa-eye-slash",name:"hide"})}}async onMessageCopyButtonClicked(e){e?.preventDefault?.(),await navigator.clipboard.writeText(this.model.getMessageText())}onMessageQuoteButtonClicked(e){e?.preventDefault?.();const{chatboxviews:t}=Bu.state,s=t.get(this.model.collection.chatbox.get("jid"));s?.getMessageForm().insertIntoTextArea(this.model.getMessageText().replaceAll(/^/gm,"> "),!1,!1,null,"\n")}async getActionButtons(){const e=[];this.model.get("editable")&&e.push({i18n_text:this.model.get("correcting")?HS("Cancel Editing"):HS("Edit"),handler:e=>this.onMessageEditButtonClicked(e),button_class:"chat-msg__action-edit",icon_class:"fa fa-pencil-alt",name:"edit"});const t=["groupchat","mep"].includes(this.model.get("type"))&&await this.model.mayBeModerated();return!this.is_retracted&&(this.model.mayBeRetracted()||t)&&e.push({i18n_text:HS("Retract"),handler:e=>this.onMessageRetractButtonClicked(e),button_class:"chat-msg__action-retract",icon_class:"fas fa-trash-alt",name:"retract"}),this.model.collection?(this.addMediaRenderingToggle(e),e.push({i18n_text:HS("Copy"),handler:e=>this.onMessageCopyButtonClicked(e),button_class:"chat-msg__action-copy",icon_class:"fas fa-copy",name:"copy"}),this.model.collection.chatbox.canPostMessages()&&e.push({i18n_text:HS("Quote"),handler:e=>this.onMessageQuoteButtonClicked(e),button_class:"chat-msg__action-quote",icon_class:"fas fa-quote-right",name:"quote"}),hm.hook("getMessageActionButtons",this,e)):[]}}hm.elements.define("converse-message-actions",rN);var oN=s(719),aN={};aN.styleTagTransform=I(),aN.setAttributes=j(),aN.insert=C().bind(null,"head"),aN.domAPI=E(),aN.insertStyleElement=O();A()(oN.A,aN);oN.A&&oN.A.locals&&oN.A.locals;hm.elements.define("converse-image-modal",class extends uj{constructor(e){super(e),this.src=e.src}renderModal(){return(e=>fp`<img class="chat-image chat-image--modal" src="${e.src}">`)({src:this.src})}getModalTitle(){return fp`${HS("Image: ")}<a target="_blank" rel="noopener" href="${this.src}">${sT(this.src)}</a>`}});var cN=s(9641);class lN{constructor(e,t){this.options=Object.assign({width:null,height:null,autoplay:!0,loop:!0,show_progress_bar:!0,progress_bg_color:"rgba(0,0,0,0.4)",progress_color:"rgba(255,0,22,.8)",progress_bar_height:5},t),this.el=e,this.gif_el=e.querySelector("img"),this.canvas=e.querySelector("canvas"),this.ctx=this.canvas.getContext("2d"),this.offscreenCanvas=document.createElement("canvas"),this.patchCanvas=document.createElement("canvas"),this.ctx_scaled=!1,this.frames=[],this.load_error=null,this.playing=this.options.autoplay,this.frame_idx=0,this.iteration_count=0,this.start=null,this.hovering=null,this.frameImageData=null,this.disposal_restore_from_idx=null,this.initialize()}async initialize(){this.options.width&&this.options.height&&this.setSizes(this.options.width,this.options.height);const e=await this.fetchGIF(this.gif_el.src);requestAnimationFrame((()=>this.handleGIFResponse(e)))}initPlayer(){if(!this.load_error&&(this.options.width&&this.options.height||this.ctx.scale(this.getCanvasScale(),this.getCanvasScale()),this.frame_idx=0,this.renderImage(),this.options.autoplay)){const e=this.frames[this.frame_idx]?.delay??0;setTimeout((()=>this.play()),e)}}getNextFrameNo(){return 0===this.frames.length?0:(this.frame_idx+1+this.frames.length)%this.frames.length}onIterationEnd(){return this.iteration_count++,this.options.onIterationEnd?.(this),!this.options.loop&&(this.pause(),!0)}onAnimationFrame(e,t,s){if(!this.playing)return;if(e-t<s)return this.hovering?this.drawPauseIcon():this.renderImage(),void requestAnimationFrame((e=>this.onAnimationFrame(e,t,s)));const n=this.getNextFrameNo();if(0===n&&this.onIterationEnd())return;this.frame_idx=n,this.renderImage();const i=this.frames[this.frame_idx]?.delay||8;requestAnimationFrame((t=>this.onAnimationFrame(t,e,i)))}setSizes(e,t){this.canvas.width=e*this.getCanvasScale(),this.canvas.height=t*this.getCanvasScale(),this.offscreenCanvas.width=e,this.offscreenCanvas.height=t,this.offscreenCanvas.style.width=e+"px",this.offscreenCanvas.style.height=t+"px",this.offscreenCanvas.getContext("2d").setTransform(1,0,0,1,0,0)}doShowProgress(e,t,s){if(s&&this.options.show_progress_bar){let s=this.options.progress_bar_height;const n=(this.canvas.height-s)/(this.ctx_scaled?this.getCanvasScale():1),i=e/t*this.canvas.width/(this.ctx_scaled?this.getCanvasScale():1),r=this.canvas.width/(this.ctx_scaled?this.getCanvasScale():1);s/=this.ctx_scaled?this.getCanvasScale():1,this.ctx.fillStyle=this.options.progress_bg_color,this.ctx.fillRect(i,n,r-i,s),this.ctx.fillStyle=this.options.progress_color,this.ctx.fillRect(0,n,i,s)}}handleGIFResponse(e){try{const t=(0,cN.O5)(e);this.hdr=t.header,this.lsd=t.lsd,this.setSizes(this.options.width??this.lsd.width,this.options.height??this.lsd.height),this.frames=(0,cN.Ud)(t,!0)}catch(e){this.showError()}this.initPlayer(),!this.options.autoplay&&this.drawPlayIcon()}drawError(){this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.options.width,this.options.height),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.moveTo(0,0),this.ctx.lineTo(this.options.width,this.options.height),this.ctx.moveTo(0,this.options.height),this.ctx.lineTo(this.options.width,0),this.ctx.stroke()}showError(){this.load_error=!0,this.hdr={width:this.gif_el.width,height:this.gif_el.height},this.frames=[],this.drawError(),this.el.requestUpdate()}manageDisposal(e){if(e<=0)return;const t=this.offscreenCanvas.getContext("2d"),s=this.frames[e-1].disposalType;e>1&&(3===s?null!=this.disposal_restore_from_idx&&t.putImageData(this.frames[this.disposal_restore_from_idx].data,0,0):this.disposal_restore_from_idx=e-1),2===s&&t.clearRect(this.last_frame.dims.left,this.last_frame.dims.top,this.last_frame.dims.width,this.last_frame.dims.height)}renderImage(e=!0){if(!this.frames.length)return;let t=this.frame_idx;t=parseInt(t.toString(),10),(t>this.frames.length-1||t<0)&&(t=0),this.manageDisposal(t);const s=this.frames[t],n=this.patchCanvas.getContext("2d"),i=this.offscreenCanvas.getContext("2d"),r=s.dims;this.frameImageData&&r.width==this.frameImageData.width&&r.height==this.frameImageData.height||(this.patchCanvas.width=r.width,this.patchCanvas.height=r.height,this.frameImageData=n.createImageData(r.width,r.height)),this.frameImageData.data.set(s.patch),n.putImageData(this.frameImageData,0,0),i.drawImage(this.patchCanvas,r.left,r.top);const o=i.getImageData(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height);this.ctx.putImageData(o,0,0),this.ctx.drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height),e&&this.hovering&&this.drawPauseIcon(),this.last_frame=s}play(){this.playing=!0,requestAnimationFrame((e=>this.onAnimationFrame(e,0,0)))}pause(){this.playing=!1,requestAnimationFrame((()=>this.drawPlayIcon()))}drawPauseIcon(){if(!this.playing)return;this.renderImage(!1),this.ctx.fillStyle="rgb(0, 0, 0, 0.25)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=.1*this.canvas.height;this.ctx.lineWidth=.04*this.canvas.height,this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2-e/2,this.canvas.height/2-e),this.ctx.lineTo(this.canvas.width/2-e/2,this.canvas.height/2+e),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(this.canvas.width/2+e/2,this.canvas.height/2-e),this.ctx.lineTo(this.canvas.width/2+e/2,this.canvas.height/2+e),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.stroke(),this.ctx.lineWidth=.02*this.canvas.height,this.ctx.strokeStyle="rgb(200, 200, 200, 0.75)",this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,1.5*e,0,2*Math.PI),this.ctx.stroke()}drawPlayIcon(){if(this.playing)return;this.renderImage(!1),this.ctx.fillStyle="rgb(0, 0, 0, 0.25)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const e=.1*this.canvas.height,t=new Path2D;t.moveTo(this.canvas.width/2+e,this.canvas.height/2),t.lineTo(this.canvas.width/2-e/2,this.canvas.height/2+e),t.lineTo(this.canvas.width/2-e/2,this.canvas.height/2-e),t.closePath(),this.ctx.fillStyle="rgb(200, 200, 200, 0.75)",this.ctx.fill(t);const s=1.5*e;this.ctx.lineWidth=.02*this.canvas.height,this.ctx.strokeStyle="rgb(200, 200, 200, 0.75)",this.ctx.beginPath(),this.ctx.arc(this.canvas.width/2,this.canvas.height/2,s,0,2*Math.PI),this.ctx.stroke()}getCanvasScale(){let e;return e=this.options.max_width&&this.hdr&&this.lsd.width>this.options.max_width?this.options.max_width/this.lsd.width:1,e}fetchGIF(e){const t=hc(),s=new XMLHttpRequest;return s.open("GET",e,!0),s.responseType="arraybuffer",s?.overrideMimeType("text/plain; charset=x-user-defined"),s.onload=()=>{if(200!=s.status)return this.showError(),t.reject();t.resolve(s.response)},s.onprogress=e=>e.lengthComputable&&this.doShowProgress(e.loaded,e.total,!0),s.onerror=e=>{Ct.error(e),this.showError()},s.send(),t}}var dN=s(1218),uN={};uN.styleTagTransform=I(),uN.setAttributes=j(),uN.insert=C().bind(null,"head"),uN.domAPI=E(),uN.insertStyleElement=O();A()(dN.A,uN);dN.A&&dN.A.locals&&dN.A.locals;hm.elements.define("converse-gif",class extends VS{static get properties(){return{autoplay:{type:Boolean},noloop:{type:Boolean},progress_color:{type:String},fallback:{type:String},src:{type:String}}}constructor(){super(),this.src=null,this.autoplay=!1,this.noloop=!1,this.fallback="url",this.progress_color=null}initGIF(){const e={autoplay:this.autoplay,loop:!this.noloop};this.progress_color&&(e.progress_color=this.progress_color),this.supergif=new lN(this,e)}updated(e){this.supergif&&!e.has("src")?(e.has("autoplay")&&(this.supergif.options.autoplay=this.autoplay),e.has("noloop")&&(this.supergif.options.loop=!this.noloop),e.has("progress_color")&&(this.supergif.options.progress_color=this.progress_color)):this.initGIF()}render(){return this.supergif?.load_error&&["url","empty"].includes(this.fallback)?this.renderErrorFallback():fp`<canvas class="gif-canvas" @mouseover="${()=>this.setHover()}" @mouseleave="${()=>this.unsetHover()}" @click="${e=>this.onControlsClicked(e)}"><img class="gif" src="${this.src}"></canvas>`}renderErrorFallback(){return"url"===this.fallback?aT(this.src):"empty"===this.fallback?"":void 0}setHover(){this.supergif&&(this.supergif.hovering=!0,this.hover_timeout&&clearTimeout(this.hover_timeout),this.hover_timeout=setTimeout((()=>this.unsetHover()),2e3))}unsetHover(){this.supergif&&(this.supergif.hovering=!1)}onControlsClicked(e){e.preventDefault(),this.supergif.playing?this.supergif.pause():this.supergif.frames.length>0&&(this.supergif.options.loop=!0,this.supergif.play())}});const hN=(e,t)=>fp`<converse-gif autoplay noloop fallback="empty" src="${e}"></converse-gif>${t?"":fp`<a target="_blank" rel="noopener" href="${e}">${e}</a>`}`,{URI:mN}=Cf.env,{isURLWithImageExtension:gN}=Ef;const pN=ET(class extends IT{render(e,t,s,n){return t?fp`<a href="${t}" class="chat-image__link" target="_blank" rel="noopener">${this.renderImage(e,t,s,n)}</a>`:this.renderImage(e,t,s,n)}renderImage(e,t,s,n){return fp`<img class="chat-image img-thumbnail" loading="lazy" src="${e}" @click="${n}" @error="${()=>this.onError(e,t,s,n)}" @load="${s}">`}onError(e,t,s,n){if(gN(e))t&&this.setValue(aT(t));else{const i=new mN(e),r=i.filename();i.filename(`${r}.png`),this.setValue(pN(i.toString(),t,s,n))}}}),fN=e=>fp`${pN(e.src||e.url,e.href,e.onLoad,e.onClick)}`,vN=["*","_","~","`"],_N=[...vN,"```",">"],bN={"*":{name:"strong",type:"span"},_:{name:"emphasis",type:"span"},"~":{name:"strike",type:"span"},"`":{name:"preformatted",type:"span"},"```":{name:"preformatted_block",type:"block"},">":{name:"quote",type:"block"}},yN=["_",">","`","~"];function wN(e){return"string"==typeof e}function SN(e,t,s=!0){let n;if(/(^```[\s,\u200B]*\n)|(^```[\s,\u200B]*$)/.test(e.slice(t))&&(0===t||">"===e[t-1]||/\n\u200B{0,2}$/.test(e.slice(0,t))))n=e.slice(t,t+3);else{if(!_N.includes(e.slice(t,t+1)))return null;if(n=e.slice(t,t+1),!function(e,t,s,n){if(n){const n=RegExp(yN.includes(e)?`^(\\p{L}|\\p{N})${e}`:`^(\\p{L}|\\p{N})\\${e}`,"u");if(s>1&&n.test(t.slice(s-1)))return!1;if(xN(e)&&s>0&&"\n"!==t[s-1])return!1;if(vN.includes(e)&&t[s+1]===e)return!1}else{const n=RegExp(yN.includes(e)?`^${e}(\\p{L}|\\p{N})`:`^\\${e}(\\p{L}|\\p{N})`,"u");if(s<t.length-1&&n.test(t.slice(s)))return!1;if(vN.includes(e)&&t[s-1]===e)return!1}return!0}(n,e,t,s))return null}return n}function AN(e,t){const s=SN(e,t),n=s?function(e,t,s){if(!e)return 0;const n=s;if(s+=e.length,xN(e))return(s+=t.slice(s).split(/\n\u200B*[^>\u200B]/).shift().length)-n;if("span"===bN[e].type){const n=t.slice(s).split("\n").shift();let i=0,r=n.indexOf(e);for(;-1!==r;){if(SN(t,s+r,!1)===e)return r+2*e.length;r=n.indexOf(e,i++)}return 0}{const n=t.slice(s+1);let i=0,r=n.indexOf(e);for(;-1!==r;){if(SN(t,s+1+r,!1)===e)return r+1+2*e.length;r=n.indexOf(e,i++)}return 0}}(s,e,t):0;return n>0?{d:s,length:n}:{}}function xN(e){return[">","&gt;"].includes(e)}const{convertASCII2Emoji:EN,filterQueryParamsFromURL:$N,getCodePointReferences:CN,getMediaURLs:kN,getMediaURLsMetadata:jN,getShortnameReferences:TN,isAudioURL:ON,isGIFURL:NN,isImageURL:IN,isVideoURL:MN}=Ef;class RN extends String{constructor(e,t=0,s={}){super(e),this.embed_audio=s?.embed_audio,this.embed_videos=s?.embed_videos,this.mentions=s?.mentions||[],this.media_urls=s?.media_urls,this.nick=s?.nick,this.offset=t,this.onImgClick=s?.onImgClick,this.onImgLoad=s?.onImgLoad,this.options=s,this.payload=[],this.references=[],this.render_styling=s?.render_styling,this.show_images=s?.show_images,this.hide_media_urls=s?.hide_media_urls}shouldRenderMedia(e,t){let s;return"image"===t?s=this.show_images:"audio"===t?s=this.embed_audio:"video"===t&&(s=this.embed_videos),"boolean"==typeof s?s:eN(e,t)}async addHyperlinkTemplate(e){const t=e.url,s=$N(t);let n;if(NN(t)&&this.shouldRenderMedia(t,"image"))n=hN(s,this.hide_media_urls);else if(IN(t)&&this.shouldRenderMedia(t,"image"))n=fN({src:s,href:this.hide_media_urls?null:s,onClick:this.onImgClick,onLoad:this.onImgLoad});else if(MN(t)&&this.shouldRenderMedia(t,"video"))n=Uj(s,this.hide_media_urls);else if(ON(t)&&this.shouldRenderMedia(t,"audio"))n=Ij(s,this.hide_media_urls);else if(hm.settings.get("embed_3rd_party_media_players")&&function(e){try{const{hostname:t,pathname:s}=new URL(e);return"open.spotify.com"===t&&s.startsWith("/track/")}catch(t){return console.warn(`Could not create URL object from ${e}`),!1}}(t)){n=((e,t,s)=>{const{hostname:n}=new URL(t);return fp`<figure><iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/${e}" width="100%" height="352" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>${s?"":fp`<a target="_blank" rel="noopener" title="${t}" href="${t}">${n}</a>`}</figure>`})(t.split("/track/")[1],t,this.hide_media_urls)}else if(this.shouldRenderMedia(t,"audio")&&hm.settings.get("fetch_url_headers")){const e=await async function(e){try{return(await fetch(e,{method:"HEAD"})).headers}catch(t){return console.warn(`Error calling HEAD on url ${e}: ${t}`),null}}(t);e?.get("content-type")?.startsWith("audio")&&(n=Ij(s,this.hide_media_urls,e.get("Icy-Name")))}return n||aT(s)}async addHyperlinks(e,t){const s=t+this.offset,n=this.media_urls||jN(e,t).media_urls||[],i=kN(n,e,s);await Promise.all(i.filter((e=>!e.is_encrypted)).map((async e=>{const s=await this.addHyperlinkTemplate(e);this.addTemplateResult(e.start+t,e.end+t,s)})))}addMapURLs(e,t){const s=/geo:([\-0-9.]+),([\-0-9.]+)(?:,([\-0-9.]+))?(?:\?(.*))?/g,n=e.matchAll(s);for(const e of n)this.addTemplateResult(e.index+t,e.index+e[0].length+t,aT(e[0].replace(s,hm.settings.get("geouri_replacement"))))}addEmojis(e,t){[...TN(e.toString()),...CN(e.toString())].forEach((e=>{this.addTemplateResult(e.begin+t,e.end+t,KO(e,{add_title_wrapper:!0}))}))}addMentions(e,t){const s=t+this.offset;this.mentions?.forEach((n=>{const i=Number(n.begin)-s;if(i<0||i>=s+e.length)return;const r=Number(n.end)-s,o=e.slice(i,r);o===this.nick?this.addTemplateResult(i+t,r+t,(e=>fp`<span class="mention mention--self badge badge-info" data-uri="${e.uri}">${e.mention}</span>`)({...n,mention:o})):this.addTemplateResult(i+t,r+t,function(e){return fp`<span class="mention" data-uri="${e.uri}">${e.mention}</span>`}({...n,mention:o}))}))}addStyling(){if(!function(e){for(let t=0;t<_N.length;t++)if(e.includes(_N[t]))return!0;return!1}(this))return;const e=[],t=this.mentions.map((e=>Array.from({length:Number(e.end)},((t,s)=>Number(e.begin)+s))));let s=0;for(;s<this.length;){if(t.filter((e=>e.includes(s))).length){s++;continue}const{d:n,length:i}=AN(this,s);if(n&&i){const t=xN(n),r=s+i,o=t?r:r-n.length;let a="```"===n?s+n.length+1:s+n.length;t&&" "===this[a]&&(a+=1);const c=a,l=this.slice(a,o);e.push({begin:s,template:PN(n,l,c,this.options),end:r}),s=r}s++}e.forEach((e=>this.addTemplateResult(e.begin,e.end,e.template)))}trimMeMessage(){0===this.offset&&this.isMeCommand()&&(this.payload[0]=this.payload[0].substring(4))}async addAnnotations(e){const t=this.marshall();let s=0;for(const n of t)n&&(wN(n)?(await e.call(this,n,s),s+=n.length):s=n.end)}async addTemplates(){await hm.trigger("beforeMessageBodyTransformed",this,{Synchronous:!0}),this.render_styling&&this.addStyling(),await this.addAnnotations(this.addMentions),await this.addAnnotations(this.addHyperlinks),await this.addAnnotations(this.addMapURLs),await hm.emojis.initialize(),await this.addAnnotations(this.addEmojis),await hm.trigger("afterMessageBodyTransformed",this,{Synchronous:!0}),this.payload=this.marshall(),this.options.show_me_message&&this.trimMeMessage(),this.payload=this.payload.map((e=>wN(e)?e:e.template))}addTemplateResult(e,t,s){this.references.push({begin:e,end:t,template:s})}isMeCommand(){const e=this.toString();return!!e&&e.startsWith("/me ")}marshall(){let e=[this.toString()];return this.references.sort(((e,t)=>t.begin-e.begin)).forEach((t=>{const s=e.shift();e=[s.slice(0,t.begin),t,s.slice(t.end),...e]})),e.reduce(((e,t)=>{return wN(t)?[...e,EN((s=t,s.replace(/\n(\u200B*\n)+/g,(e=>`\n${"​".repeat(e.length-2)}\n`))))]:[...e,t];var s}),[])}}class DN extends $T{static async transform(e){try{await e.addTemplates()}catch(e){console.error(e)}return e.payload}render(e,t,s){const n=new RN(e,t,Object.assign(s,{show_images:!1,embed_videos:!1,embed_audio:!1}));return fp`${LT(DN.transform(n),fp`${n}`)}`}}const zN=ET(DN),LN={emphasis:(e,t,s)=>fp`<span class="styling-directive">_</span><i>${zN(e,t,s)}</i><span class="styling-directive">_</span>`,preformatted:e=>fp`<span class="styling-directive">\`</span><code>${e}</code><span class="styling-directive">\`</span>`,preformatted_block:e=>fp`<div class="styling-directive">\`\`\`</div><pre><code class="block">${e}</code></pre><div class="styling-directive">\`\`\`</div>`,quote:(e,t,s)=>fp`<blockquote>${zN(e,t,s)}</blockquote>`,strike:(e,t,s)=>fp`<span class="styling-directive">~</span><del>${zN(e,t,s)}</del><span class="styling-directive">~</span>`,strong:(e,t,s)=>fp`<span class="styling-directive">*</span><b>${zN(e,t,s)}</b><span class="styling-directive">*</span>`};function PN(e,t,s,n){const i=LN[bN[e].name];if(xN(e)){const e=t.replace(/\n\u200B*>[ \f\r\t\v\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]?/g,(e=>`\n${"​".repeat(e.length-1)}`)).replace(/\n$/,"");return i(e,s,n)}return i(t,s,n)}class FN{constructor(e,t,s={}){this.offset=t,this.options=s,this.text=e}async transform(){const e=new RN(this.text,this.offset,this.options);try{await e.addTemplates()}catch(e){console.error(e)}return e.payload}render(){return fp`${LT(this.transform(),fp`${this.text}`)}`}}const UN=ET(class extends $T{render(e,t,s,n){const i=new FN(e,t,s).render();return n?.(),i}}),BN=UN;var qN=s(3796),HN={};HN.styleTagTransform=I(),HN.setAttributes=j(),HN.insert=C().bind(null,"head"),HN.domAPI=E(),HN.insertStyleElement=O();A()(qN.A,HN);qN.A&&qN.A.locals&&qN.A.locals;hm.elements.define("converse-chat-message-body",class extends VS{static get properties(){return{hide_url_previews:{type:String},is_me_message:{type:Boolean},model:{type:Object},text:{type:String}}}constructor(){super(),this.text=null,this.model=null,this.hide_url_previews=null}initialize(){const e=hm.settings.get();this.listenTo(e,"change:allowed_audio_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:allowed_video_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate()))}onImgClick(e){e.preventDefault(),hm.modal.show("converse-image-modal",{src:e.target.src},e)}onImgLoad(){this.dispatchEvent(new CustomEvent("imageLoaded",{detail:this,bubbles:!0}))}render(){const e={media_urls:this.model.get("media_urls"),mentions:this.model.get("references"),nick:this.model.chatbox.get("nick"),onImgClick:e=>this.onImgClick(e),onImgLoad:()=>this.onImgLoad(),render_styling:!this.model.get("is_unstyled")&&hm.settings.get("allow_message_styling"),show_me_message:!0};return"false"===this.hide_url_previews?(e.embed_audio=!0,e.embed_videos=!0,e.show_images=!0):"true"===this.hide_url_previews&&(e.embed_audio=!1,e.embed_videos=!1,e.show_images=!1),BN(this.text,0,e,(()=>this.model.collection?.trigger("rendered",this.model)))}});const{keycodes:GN}=Cf;function WN(e){let t=0;do{isNaN(e.offsetTop)||(t+=e.offsetTop)}while(e=e.offsetParent);return t}function VN(e){let t=0;do{isNaN(e.offsetLeft)||(t+=e.offsetLeft)}while(e=e.offsetParent);return t}class QN{static get DIRECTION(){return{down:"down",end:"end",home:"home",left:"left",right:"right",up:"up"}}static get DEFAULTS(){return{home:[`${GN.SHIFT}+${GN.UP_ARROW}`],end:[`${GN.SHIFT}+${GN.DOWN_ARROW}`],up:[GN.UP_ARROW],down:[GN.DOWN_ARROW],left:[GN.LEFT_ARROW,`${GN.SHIFT}+${GN.TAB}`],right:[GN.RIGHT_ARROW,GN.TAB],getSelector:null,jump_to_picked:null,jump_to_picked_direction:null,jump_to_picked_selector:"picked",onSelected:null,selected:"selected",selector:"li"}}static getClosestElement(e,t){return e.reduce(((e,s)=>{const n=t(s);return n<e.distance?{distance:n,element:s}:e}),{distance:1/0}).element}constructor(e,t){this.doc=window.document,this.container=e,this.scroll_container=t.scroll_container||e,this.options=Object.assign({},QN.DEFAULTS,t),this.init()}init(){this.selected=null,this.keydownHandler=null,this.elements={},this.keys={},this.options.down.forEach((e=>this.keys[e]=QN.DIRECTION.down)),this.options.end.forEach((e=>this.keys[e]=QN.DIRECTION.end)),this.options.home.forEach((e=>this.keys[e]=QN.DIRECTION.home)),this.options.left.forEach((e=>this.keys[e]=QN.DIRECTION.left)),this.options.right.forEach((e=>this.keys[e]=QN.DIRECTION.right)),this.options.up.forEach((e=>this.keys[e]=QN.DIRECTION.up))}enable(){this.getElements(),this.keydownHandler=e=>this.handleKeydown(e),this.doc.addEventListener("keydown",this.keydownHandler),this.enabled=!0}disable(){this.keydownHandler&&this.doc.removeEventListener("keydown",this.keydownHandler),this.unselect(),this.elements={},this.enabled=!1}destroy(){this.disable()}getNextElement(e){let t;if(e===QN.DIRECTION.home)t=this.getElements(e)[0];else if(e===QN.DIRECTION.end)t=Array.from(this.getElements(e)).pop();else if(this.selected)if(e===QN.DIRECTION.right){const s=this.getElements(e);t=s.slice(s.indexOf(this.selected))[1]}else if(e==QN.DIRECTION.left){const s=this.getElements(e);t=s.slice(0,s.indexOf(this.selected)).pop()||this.selected}else if(e==QN.DIRECTION.down){const e=this.selected.offsetLeft,s=this.selected.offsetTop+this.selected.offsetHeight,n=this.elementsAfter(0,s),i=t=>Math.abs(t.offsetLeft-e)+Math.abs(t.offsetTop-s);t=QN.getClosestElement(n,i)}else{if(e!=QN.DIRECTION.up)throw new Error("getNextElement: invalid direction value");{const e=this.selected.offsetLeft,s=this.selected.offsetTop-1,n=this.elementsBefore(1/0,s),i=t=>Math.abs(e-t.offsetLeft)+Math.abs(s-t.offsetTop);t=QN.getClosestElement(n,i)}}else t=e===QN.DIRECTION.right||e===QN.DIRECTION.down?this.getElements(e)[1]:this.getElements(e)[0];return this.options.jump_to_picked&&t&&t.matches(this.options.jump_to_picked)&&e===this.options.jump_to_picked_direction&&(t=this.container.querySelector(this.options.jump_to_picked_selector)||t),t}select(e,t){e&&e!==this.selected&&(this.unselect(),t&&this.scrollTo(e,t),e.matches("input")?e.focus():uT.addClass(this.options.selected,e),this.selected=e,this.options.onSelected&&this.options.onSelected(e))}unselect(){this.selected&&(uT.removeClass(this.options.selected,this.selected),delete this.selected)}scrollTo(e,t){if(this.inScrollContainerViewport(e)){if(!function(e){const t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=window.innerHeight&&t.right<=window.innerWidth}(e))switch(t){case QN.DIRECTION.left:document.body.scrollLeft=VN(e)-document.body.offsetLeft;break;case QN.DIRECTION.up:document.body.scrollTop=WN(e)-document.body.offsetTop;break;case QN.DIRECTION.right:document.body.scrollLeft=VN(e)-document.body.offsetLeft-(document.documentElement.clientWidth-e.offsetWidth);break;case QN.DIRECTION.down:document.body.scrollTop=WN(e)-document.body.offsetTop-(document.documentElement.clientHeight-e.offsetHeight)}}else{const s=this.scroll_container;if(!s.contains(e))return;switch(t){case QN.DIRECTION.left:s.scrollLeft=e.offsetLeft-s.offsetLeft,s.scrollTop=e.offsetTop-s.offsetTop;break;case QN.DIRECTION.up:s.scrollTop=e.offsetTop-s.offsetTop;break;case QN.DIRECTION.right:s.scrollLeft=e.offsetLeft-s.offsetLeft-(s.offsetWidth-e.offsetWidth),s.scrollTop=e.offsetTop-s.offsetTop-(s.offsetHeight-e.offsetHeight);break;case QN.DIRECTION.down:s.scrollTop=e.offsetTop-s.offsetTop-(s.offsetHeight-e.offsetHeight)}}}inScrollContainerViewport(e){const t=this.scroll_container;return!(e.offsetLeft-t.scrollLeft<t.offsetLeft)&&(!(e.offsetTop-t.scrollTop<t.offsetTop)&&(!(e.offsetLeft+e.offsetWidth-t.scrollLeft>t.offsetLeft+t.offsetWidth)&&!(e.offsetTop+e.offsetHeight-t.scrollTop>t.offsetTop+t.offsetHeight)))}getElements(e){const t=this.options.getSelector?this.options.getSelector(e):this.options.selector;return this.elements[t]||(this.elements[t]=Array.from(this.container.querySelectorAll(t))),this.elements[t]}elementsAfter(e,t){return this.getElements(QN.DIRECTION.down).filter((s=>s.offsetLeft>=e&&s.offsetTop>=t))}elementsBefore(e,t){return this.getElements(QN.DIRECTION.up).filter((s=>s.offsetLeft<=e&&s.offsetTop<=t))}handleKeydown(e){const t=GN,s=e.shiftKey?this.keys[`${t.SHIFT}+${e.which}`]:this.keys[e.which];if(s){e.preventDefault(),e.stopPropagation();const t=this.getNextElement(s);this.select(t,s)}}}const KN=QN;class JN extends VS{firstUpdated(e){super.firstUpdated(e),this.menu=this.querySelector(".dropdown-menu"),this.button=this.querySelector("button"),this.dropdown=new F$(this.button)}}var YN=s(1353),XN={};XN.styleTagTransform=I(),XN.setAttributes=j(),XN.insert=C().bind(null,"head"),XN.domAPI=E(),XN.insertStyleElement=O();A()(YN.A,XN);YN.A&&YN.A.locals&&YN.A.locals;hm.elements.define("converse-icon",class extends VS{static get properties(){return{color:{type:String},class_name:{attribute:"class"},css:{type:String},size:{type:String}}}constructor(){super(),this.class_name="",this.css="",this.size="",this.color=""}getSource(){return`#icon-${this.class_name.trim().split(" ")[1].replace("fa-","")}`}getStyles(){const e=this.color.match(/var\((--.*)\)/)?.[1],t=e?getComputedStyle(this).getPropertyValue(e):this.color;return`\n            ${this.size?`width: ${this.size};`:""}\n            ${this.size?`height: ${this.size};`:""}\n            ${t?`fill: ${t};`:""}\n            ${this.css}\n        `}render(){return fp`<svg .style="${this.getStyles()}"><use href="${this.getSource()}"></use></svg>`}});var ZN=s(3557),eI={};eI.styleTagTransform=I(),eI.setAttributes=j(),eI.insert=C().bind(null,"head"),eI.domAPI=E(),eI.insertStyleElement=O();A()(ZN.A,eI);ZN.A&&ZN.A.locals&&ZN.A.locals;const{KEYCODES:tI}=DS;class sI extends JN{static get properties(){return{icon_classes:{type:String},items:{type:Array}}}constructor(){super(),this.icon_classes="fa fa-bars",this.items=[],this.id=Ef.getUniqueId(),this.addEventListener("hidden.bs.dropdown",(()=>this.onHidden())),this.addEventListener("keyup",(e=>this.handleKeyUp(e)))}render(){return fp`<button class="btn btn--transparent btn--standalone dropdown-toggle dropdown-toggle--no-caret" id="${this.id}" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="${HS("Menu")}"><converse-icon aria-hidden="true" size="1em" class="${this.icon_classes}"></converse-icon></button><ul class="dropdown-menu" aria-labelledby="${this.id}">${this.items.map((e=>fp`<li>${LT(e,"")}</li>`))}</ul>`}firstUpdated(){super.firstUpdated(),this.initArrowNavigation()}onHidden(){this.navigator?.disable()}initArrowNavigation(){if(!this.navigator){const e={selector:".dropdown-item",onSelected:e=>e.focus()};this.navigator=new KN(this.menu,e)}}enableArrowNavigation(e){e&&(e.preventDefault(),e.stopPropagation()),this.navigator.enable(),this.navigator.select(this.menu.firstElementChild)}handleKeyUp(e){e.keyCode!==tI.DOWN_ARROW||this.navigator.enabled||this.enableArrowNavigation(e)}}hm.elements.define("converse-dropdown",sI);var nI=s(9495),iI={};iI.styleTagTransform=I(),iI.setAttributes=j(),iI.insert=C().bind(null,"head"),iI.domAPI=E(),iI.insertStyleElement=O();A()(nI.A,iI);nI.A&&nI.A.locals&&nI.A.locals;const{dayjs:rI}=Cf.env;hm.elements.define("converse-message-versions",class extends VS{static get properties(){return{model:{type:Object}}}constructor(){super(),this.model=null}render(){const e=this.model.get("older_versions"),t=Object.keys(e);return fp`${t.length?fp`<h4>${HS("Older versions")}</h4>${t.map((t=>((e,t)=>fp`<p class="older-msg"><time>${rI(e).format("MMM D, YYYY, HH:mm:ss")}</time>: ${t[e]}</p>`)(t,e)))}`:fp`<h4>${HS("No older versions found")}</h4>`}<hr><h4>${HS("Current version")}</h4><p><time>${rI(this.model.get("time")).format("MMM D, YYYY, HH:mm:ss")}</time>: ${this.model.getMessageText()}</p>`}});hm.elements.define("converse-message-versions-modal",class extends uj{renderModal(){return fp`<converse-message-versions .model="${this.model}"></converse-message-versions>`}getModalTitle(){return HS("Message versions")}});const{Strophe:oI}=Cf.env,{STATUS_WEIGHTS:aI}=DS;async function cI(e,t=!1){if(!hm.settings.get("allow_contact_removal"))return;if(!await hm.confirm(HS("Are you sure you want to remove this contact?")))return!1;const s=await hm.chats.get(e.get("jid"));s?.close();try{await e.remove(t)}catch(t){Ct.error(t),hm.alert("error",HS("Error"),[HS("Sorry, an error occurred while trying to remove %1$s as a contact",e.getDisplayName())])}return!0}async function lI(e){const t=Bu.session.get("domain");if(!await hm.disco.supports(oI.NS.BLOCKING,t))return!1;const s=HS("Do you want to block this contact, so they cannot send you messages?");if(!await hm.confirm(s))return!1;(await hm.chats.get(e.get("jid")))?.close();try{await Promise.all([hm.blocklist.add(e.get("jid")),e.remove(!0)])}catch(t){Ct.error(t),hm.alert("error",HS("Error"),[HS("Sorry, an error occurred while trying to block %1$s",e.getDisplayName())])}}function dI(e){Bu.state.roster?.get(e)?.trigger("highlight")}function uI(e,t){const s=Bu.state.roster_filter,n=s.get("type"),i="state"===n?s.get("state").toLowerCase():s.get("text").toLowerCase();if(!i)return!1;if("state"===n){return![Bu.labels.HEADER_REQUESTING_CONTACTS,Bu.labels.HEADER_UNREAD].includes(t)&&("unread_messages"===i?0===e.get("num_unread"):"online"===i?["offline","unavailable","dnd","away","xa"].includes(e.getStatus()):!e.getStatus().includes(i))}return"items"===n?!function(e){const t=e instanceof eS?e.getNickname():e.get("nickname"),s=e.get("jid");let n=e.getDisplayName();return n=n.includes(s)?n:n.concat(`   ${s}`),n=n.includes(t)?n:n.concat(`   ${t}`),n.toLowerCase()}(e).includes(i):void 0}function hI(e,t){const s=e.getStatus(),n=t.getStatus();if(aI[s]===aI[n]){const s=e.getDisplayName().toLowerCase(),n=t.getDisplayName().toLowerCase();return s<n?-1:s>n?1:0}return aI[s]<aI[n]?-1:1}function mI(e,t){const s={},{HEADER_UNREAD:n,HEADER_REQUESTING_CONTACTS:i,HEADER_CURRENT_CONTACTS:r,HEADER_UNGROUPED:o,HEADER_PENDING_CONTACTS:a}=Bu.labels;s[n]=0,s[i]=1,s[r]=2,s[o]=3,s[a]=4;const c=s,l=Object.keys(s),d=l.includes(e),u=l.includes(t);if(!d&&!u)return e.toLowerCase()<t.toLowerCase()?-1:e.toLowerCase()>t.toLowerCase()?1:0;if(d&&u)return c[e]<c[t]?-1:c[e]>c[t]?1:0;if(!d&&u){const e=r;return c[e]<c[t]?-1:c[e]>c[t]?1:0}if(d&&!u){const t=r;return c[e]<c[t]?-1:c[e]>c[t]?1:0}}async function gI(e){const t={mode:"cors",headers:{Accept:"text/json"}},s=`${hm.settings.get("xhr_user_search_url")}q=${encodeURIComponent(e)}`;let n;try{n=await fetch(s,t)}catch(t){return Ct.error(`Failed to fetch names for query "${e}"`),Ct.error(t),[]}const i=n.json;return Array.isArray(i)?i.map((e=>({label:e.fullname||e.jid,value:e.jid}))):(Ct.error('Invalid JSON returned"'),[])}const{Strophe:pI}=Cf.env;function fI(e){const t=HS("Add to blocklist");return fp`<button type="button" @click="${t=>e.blockContact(t)}" class="btn btn-danger"><converse-icon class="fas fa-times" color="var(--background-color)" size="1em"></converse-icon> ${t}</button>`}function vI(e){const t=e.model?.vcard,s=t?t.toJSON():{},n={...e.model.toJSON(),...s},i=void 0!==e.model.contact,r=hm.settings.get("allow_contact_removal"),o=Bu.session.get("domain"),a=hm.disco.supports(pI.NS.BLOCKING,o).then((async t=>{const s=await hm.blocklist.get();t&&(s.get(e.model.get("jid"))?function(e){const t=HS("Remove from blocklist");fp`<button type="button" @click="${t=>e.unblockContact(t)}" class="btn btn-danger"><converse-icon class="fas fa-times" color="var(--background-color)" size="1em"></converse-icon> ${t}</button>`}(e):fI(e))})),c=HS("XMPP Address"),l=HS("Email"),d=HS("Full Name"),u=HS("Nickname"),h=HS("The User's Profile Image"),m=HS("Role"),g=HS("URL"),p={alt_text:h,extra_classes:"mb-3",height:"120",width:"120"};return fp`<span>${n.image?fp`<div class="mb-4">${PT(Object.assign(n,p))}</div>`:""} ${n.fullname?fp`<p><label>${d}:</label> ${n.fullname}</p>`:""}<p><label>${c}:</label> <a href="xmpp:${n.jid}">${n.jid}</a></p>${n.nickname?fp`<p><label>${u}:</label> ${n.nickname}</p>`:""} ${n.url?fp`<p><label>${g}:</label> <a target="_blank" rel="noopener" href="${n.url}">${n.url}</a></p>`:""} ${n.email?fp`<p><label>${l}:</label> <a href="mailto:${n.email}">${n.email}</a></p>`:""} ${n.role?fp`<p><label>${m}:</label> ${n.role}</p>`:""}<hr><div>${r&&i?function(e){const t=HS("Remove as contact");return fp`<button type="button" @click="${t=>e.removeContact(t)}" class="btn btn-danger remove-contact"><converse-icon class="fas fa-trash-alt" color="var(--background-color)" size="1em"></converse-icon> ${t}</button>`}(e):""} ${LT(a.then((()=>fI(e))),"")}</div><converse-omemo-fingerprints jid="${n.jid}"></converse-omemo-fingerprints></span>`}var _I=s(8850),bI={};bI.styleTagTransform=I(),bI.setAttributes=j(),bI.insert=C().bind(null,"head"),bI.domAPI=E(),bI.insertStyleElement=O();A()(_I.A,bI);_I.A&&_I.A.locals&&_I.A.locals;hm.elements.define("converse-user-details-modal",class extends uj{initialize(){super.initialize(),this.model.rosterContactAdded.then((()=>{this.registerContactEventHandlers(),hm.vcard.update(this.model.contact.vcard,!0)})),this.listenTo(this.model,"change",this.render),void 0!==this.model.contact&&(this.registerContactEventHandlers(),hm.vcard.update(this.model.contact.vcard,!0)),hm.trigger("userDetailsModalInitialized",this.model)}renderModal(){return vI(this)}getModalTitle(){return this.model.getDisplayName()}registerContactEventHandlers(){this.listenTo(this.model.contact,"change",this.render),this.listenTo(this.model.contact.vcard,"change",this.render),this.model.contact.on("destroy",(()=>{delete this.model.contact,this.close()})),hm.vcard.update(this.model.contact.vcard,!0)}async removeContact(e){e?.preventDefault?.(),setTimeout((()=>cI(this.model.contact)),1),this.modal.hide()}async blockContact(e){e?.preventDefault?.(),setTimeout((()=>lI(this.model.contact)),1),this.modal.hide()}async unblockContact(e){e?.preventDefault?.(),setTimeout((()=>async function(e){const t=Bu.session.get("domain");if(!await hm.disco.supports(oI.NS.BLOCKING,t))return!1;const s=HS("Do you want to unblock this contact, so they can send you messages?");if(!await hm.confirm(s))return!1;try{await hm.blocklist.remove(e.get("jid"))}catch(t){Ct.error(t),hm.alert("error",HS("Error"),[HS("Sorry, an error occurred while trying to unblock %1$s",e.getDisplayName())])}}(this.model.contact)),1),this.modal.hide()}});const{filesize:yI}=Cf.env,{dayjs:wI}=Cf.env,{dayjs:SI}=Cf.env;function AI(e,t=""){return`color: ${e}!important;${t}`}function xI(e){if(hm.settings.get("colorize_username")){const t=e?.get("color");return t?AI(t):e?fp`${LT(e?.getColor().then(AI),"")}`:""}}const{filterQueryParamsFromURL:EI,isGIFURL:$I}=Ef;hm.elements.define("converse-image",class extends VS{static get properties(){return{src:{type:String},onImgLoad:{type:Function},href:{type:String}}}constructor(){super(),this.src=null,this.href=null,this.onImgClick=null,this.onImgLoad=null}render(){return $I(this.src)&&eN(this.src,"image")?hN(EI(this.src),!0):fN({src:EI(this.src),href:this.href,onClick:this.onImgClick,onLoad:this.onImgLoad})}});const{getURI:CI,isGIFURL:kI}=Ef;function jI(e){return!!CI(e).host()}const TI=e=>{const t=(s=e.image)&&XO(s,"allowed_image_domains")&&jI(s);var s;const n=e.title||e.description||e.url;return t||n?fp`<div class="card card--unfurl">${t?(e=>fp`<converse-image class="card-img-top hor_centered" href="${e.url}" src="${e.image}" .onImgLoad="${e.onload}"></converse-image>`)(e):""} ${n?fp`<div class="card-body">${e.title?((e,t)=>e.url&&jI(e.url)&&!kI(e.image)?fp`<a href="${e.url}" target="_blank" rel="noopener">${t(e)}</a>`:t(e))(e,(e=>fp`<h5 class="card-title">${e.title}</h5>`)):""} ${e.description?fp`<p class="card-text"><converse-texture text="${e.description}"></converse-texture></p>`:""} ${e.url?fp`<p class="card-text"><a href="${e.url}" target="_blank" rel="noopener">${CI(e.url).domain()}</a></p>`:""}</div>`:""}</div>`:""};var OI=s(1070),NI={};NI.styleTagTransform=I(),NI.setAttributes=j(),NI.insert=C().bind(null,"head"),NI.domAPI=E(),NI.insertStyleElement=O();A()(OI.A,NI);OI.A&&OI.A.locals&&OI.A.locals;hm.elements.define("converse-message-unfurl",class extends VS{static get properties(){return{description:{type:String},image:{type:String},jid:{type:String},title:{type:String},url:{type:String}}}constructor(){super(),this.jid=null,this.url=null,this.title=null,this.image=null,this.description=null}initialize(){const e=hm.settings.get();this.listenTo(e,"change:allowed_image_domains",(()=>this.requestUpdate())),this.listenTo(e,"change:render_media",(()=>this.requestUpdate()))}render(){return TI(Object.assign({onload:()=>this.onImageLoad()},{description:this.description||"",image:this.image||"",title:this.title||"",url:this.url||""}))}onImageLoad(){this.dispatchEvent(new CustomEvent("imageLoaded",{detail:this,bubbles:!0}))}});const{dayjs:II}=Cf.env,MI=e=>{const t=HS("New messages"),s=e.model.get("edited"),n=e.model_with_messages.get("first_unread_id")===e.model.get("id"),i=e.model.isFollowup(),r=e.model.isMeCommand(),o=e.isRetracted(),a=e.model.get("msgid"),c=e.model.get("sender"),l=e.model.get("time"),d=e.model.occupant||e.model.contact,u=xI(d),h=hm.settings.get("time_format"),m=II(s||l).format(h),g=function(e){if("groupchat"===e.get("type")){const t=hm.settings.get("muc_hats").filter((e=>e)).map((e=>e.toLowerCase()));let s=[];t.includes("vcard_roles")&&(s=e.vcard?e.vcard.get("role"):null,s=s?s.split(",").filter((e=>e)).map((e=>({title:e}))):[]);const n=[...e.occupant?[e.occupant.get("role")]:[],...e.occupant?[e.occupant.get("affiliation")]:[]].filter((e=>e)).filter((e=>t.includes(e.toLowerCase()))).map((e=>({title:e})));return[...t.includes("xep317")&&e.occupant?.get("hats")||[],...s,...n]}return[]}(e.model),p=e.model.getDisplayName(),f=e.shouldShowAvatar(),v=d?.vcard?d:e.model;return fp`${n?fp`<div class="message separator"><hr class="separator"><span class="separator-text">${t}</span></div>`:""}<div class="message chat-msg ${e.getExtraMessageClasses()}" data-isodate="${l}" data-msgid="${a}" data-from="${e.model.get("from")}" data-encrypted="${e.model.get("is_encrypted")}"><a id="${a}"></a> ${f&&!i?fp`<a class="show-msg-author-modal" @click="${e.showUserModal}"><converse-avatar .model="${v}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${v.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></a>`:""}<div class="chat-msg__content chat-msg__content--${c} ${r?"chat-msg__content--action":""}">${r||i?"":fp`<span class="chat-msg__heading"><span class="chat-msg__author"><a class="show-msg-author-modal" @click="${e.showUserModal}" style="${u}">${p}</a> </span>${g.map((e=>fp`<span class="badge badge-secondary">${e.title}</span>`))} <time timestamp="${s||l}" class="chat-msg__time">${m}</time> ${e.model.get("is_encrypted")?fp`<converse-icon class="fa fa-lock" size="1.1em"></converse-icon>`:""}</span>`}<div class="chat-msg__body chat-msg__body--${e.model.get("message_type")} ${e.model.get("received")?"chat-msg__body--received":""} ${e.model.get("is_delayed")?"chat-msg__body--delayed":""}"><div class="chat-msg__message">${r?fp`<time timestamp="${s||l}" class="chat-msg__time">${m}</time>  <span class="chat-msg__author" style="${u}">${r?"**":""}${p}</span> `:""} ${o?e.renderRetraction():e.renderMessageText()}</div><converse-message-actions .model="${e.model}" ?is_retracted="${o}"></converse-message-actions></div>${e.model.get("ogp_metadata")?.map((t=>!0===e.model.get("hide_url_previews")?"":eN(t["og:image"],"image")?fp`<converse-message-unfurl @animationend="${e.onUnfurlAnimationEnd}" class="${e.model.get("url_preview_transition")}" jid="${e.model_with_messages?.get("jid")}" description="${t["og:description"]||""}" title="${t["og:title"]||""}" image="${t["og:image"]||""}" url="${t["og:url"]||""}"></converse-message-unfurl>`:""))}</div></div>`};const RI=e=>{const t=HS("Show more"),s="groupchat"===e.model.get("type"),n=HS("Show less"),i=e.model.get("error_text")||e.model.get("error"),r=`${HS("Message delivery failed.")}\n${i}`,o=fp`<div class="chat-msg__spoiler-hint"><span class="spoiler-hint">${e.model.get("spoiler_hint")}</span> <a class="badge badge-info spoiler-toggle" href="#" @click="${e.toggleSpoilerMessage}"><converse-icon size="1em" color="var(--background-color)" class="fa ${e.model.get("is_spoiler_visible")?"fa-eye-slash":"fa-eye"}"></converse-icon>${e.model.get("is_spoiler_visible")?n:t}</a></div>`,a=e.model.get("is_spoiler")?"spoiler "+(e.model.get("is_spoiler_visible")?"":"hidden"):"",c=e.model.getMessageText(),l=e.model.get("oob_url")&&c!==e.model.get("oob_url");return fp`${e.model.get("is_spoiler")?o:""} ${e.model.get("subject")?fp`<div class="chat-msg__subject">${e.model.get("subject")}</div>`:""} <span class="chat-msg__body--wrapper ${i?"error":""}"><converse-chat-message-body class="chat-msg__text ${e.model.get("is_only_emojis")?"chat-msg__text--larger":""} ${a}" .model="${e.model}" hide_url_previews="${e.model.get("hide_url_previews")}" ?is_me_message="${e.model.isMeCommand()}" text="${c}"></converse-chat-message-body>${!e.model.get("received")||e.model.isMeCommand()||s?"":fp`<converse-icon size="0.75em" color="var(--chat-color)" class="fa fa-check chat-msg__receipt"></converse-icon>`} ${e.model.get("edited")?function(e){const t=HS("This message has been edited");return fp`<converse-icon title="${t}" class="fa fa-edit chat-msg__edit-modal" @click="${e.showMessageVersionsModal}" size="1em"></converse-icon>`}(e):""} </span>${l?fp`<div class="chat-msg__media">${nT(e.model.get("oob_url"))}</div>`:""} ${i?fp`<div class="chat-msg__error">${r}</div>`:""}`};var DI=s(4563),zI={};zI.styleTagTransform=I(),zI.setAttributes=j(),zI.insert=C().bind(null,"head"),zI.domAPI=E(),zI.insertStyleElement=O();A()(DI.A,zI);DI.A&&DI.A.locals&&DI.A.locals;const{Strophe:LI}=Cf.env,{SUCCESS:PI}=DS;hm.elements.define("converse-chat-message",class extends VS{constructor(){super(),this.model_with_messages=null,this.model=null}static get properties(){return{model_with_messages:{type:Object},model:{type:Object}}}async initialize(){super.initialize(),await this.model_with_messages.initialized,await this.model_with_messages.messages.fetched;const e=hm.settings.get();this.listenTo(e,"change:render_media",(()=>{this.model.save("hide_url_previews",void 0),this.requestUpdate()})),this.listenTo(this.model_with_messages,"change:first_unread_id",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"contact:change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.listenTo(this.model,"occupant:change",(()=>this.requestUpdate())),this.listenTo(this.model,"occupant:add",(()=>this.requestUpdate())),this.requestUpdate()}render(){return this.model?this.show_spinner?vT():this.model.get("file")&&this.model.get("upload")!==PI?this.renderFileProgress():["mep"].includes(this.model.get("type"))?this.renderMEPMessage():["error","info"].includes(this.model.get("type"))?this.renderInfoMessage():this.renderChatMessage():""}renderRetraction(){return(e=>{const t=e.isRetracted()?e.getRetractionText():null;return fp`<div class="retraction">${t}</div>${e.model.get("moderation_reason")?fp`<q class="chat-msg--retracted__reason">${e.model.get("moderation_reason")}</q>`:""}`})(this)}renderMessageText(){return RI(this)}renderMEPMessage(){return(e=>{const t=SI(e.model.get("time")).toISOString();return fp`<div class="message chat-info message--mep ${e.getExtraMessageClasses()}" data-isodate="${t}" data-type="${e.data_name}" data-value="${e.data_value}"><div class="chat-msg__content"><div class="chat-msg__body chat-msg__body--${e.model.get("type")} ${e.model.get("is_delayed")?"chat-msg__body--delayed":""}"><div class="chat-info__message">${e.isRetracted()?e.renderRetraction():fp`<converse-texture .mentions="${e.model.get("references")}" render_styling text="${e.model.getMessageText()}"></converse-texture>${e.model.get("reason")?fp`<q class="reason"><converse-texture text="${e.model.get("reason")}"></converse-texture></q>`:""}`}</div><converse-message-actions ?is_retracted="${e.isRetracted()}" .model="${e.model}"></converse-message-actions></div></div></div>`})(this)}renderInfoMessage(){return(e=>{const t=wI(e.model.get("time")).toISOString(),s=HS("Retry");return fp`<div class="message chat-info chat-${e.model.get("type")}" data-isodate="${t}" data-type="${e.data_name}" data-value="${e.data_value}"><div class="chat-info__message"><converse-texture .mentions="${e.model.get("references")}" render_styling text="${e.model.getMessageText()}"></converse-texture></div>${e.model.get("reason")?fp`<q class="reason">${e.model.get("reason")}</q>`:""} ${e.model.get("error_text")?fp`<q class="reason">${e.model.get("error_text")}</q>`:""} ${e.model.get("retry_event_id")?fp`<a class="retry" @click="${e.onRetryClicked}">${s}</a>`:""}</div>`})(this)}renderFileProgress(){return this.model.file?(e=>{const t=HS("Uploading file:"),s=e.model.file.name,n=yI(e.model.file.size),i=e.model.occupant||e.model.contact;return fp`<div class="message chat-msg">${e.shouldShowAvatar()?fp`<a class="show-msg-author-modal" @click="${e.showUserModal}"><converse-avatar .model="${i||e.model}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></a>`:""}<div class="chat-msg__content"><span class="chat-msg__text">${t} <strong>${s}</strong>, ${n}</span><progress value="${e.model.get("progress")}"></div></div>`})(this):""}renderChatMessage(){return MI(this)}shouldShowAvatar(){return hm.settings.get("show_message_avatar")&&!this.model.isMeCommand()&&["chat","groupchat","normal"].includes(this.model.get("type"))}onUnfurlAnimationEnd(){"fade-out"===this.model.get("url_preview_transition")&&this.model.save({hide_url_previews:!0,url_preview_transition:"fade-in"})}async onRetryClicked(){this.show_spinner=!0,this.requestUpdate(),await hm.trigger(this.model.get("retry_event_id"),{synchronous:!0}),this.model.destroy(),this.parentElement.removeChild(this)}isRetracted(){return this.model.get("retracted")||"retracted"===this.model.get("moderated")}hasMentions(){return"groupchat"===this.model.get("type")&&"them"===this.model.get("sender")&&this.model_with_messages.isUserMentioned(this.model)}getOccupantAffiliation(){return this.model.occupant?.get("affiliation")}getOccupantRole(){return this.model.occupant?.get("role")}getExtraMessageClasses(){const e=[this.model.isFollowup()?"chat-msg--followup":null,this.model.get("is_delayed")?"delayed":null,this.model.isMeCommand()?"chat-msg--action":null,this.isRetracted()?"chat-msg--retracted":null,this.model.get("type"),this.shouldShowAvatar()?"chat-msg--with-avatar":null].map((e=>e));return"groupchat"===this.model.get("type")&&(e.push(this.getOccupantRole()??""),e.push(this.getOccupantAffiliation()??""),"them"===this.model.get("sender")&&this.hasMentions()&&e.push("mentioned")),this.model.get("correcting")&&e.push("correcting"),e.filter((e=>e)).join(" ")}getRetractionText(){if(["groupchat","mep"].includes(this.model.get("type"))&&this.model.get("moderated_by")){const e=this.model.get("moderated_by");if(!this.model.mod){const{occupants:t}=this.model_with_messages;this.model.mod=t.findOccupant({jid:e})||t.findOccupant({nick:LI.getResourceFromJid(e)})}const t=this.model.mod?this.model.mod.getDisplayName():HS("A moderator");return HS("%1$s has removed this message",t)}return HS("%1$s has removed this message",this.model.getDisplayName())}showUserModal(e){"me"===this.model.get("sender")?hm.modal.show("converse-profile-modal",{model:Bu.state.xmppstatus},e):"groupchat"===this.model.get("type")?(e.preventDefault(),hm.modal.show("converse-muc-occupant-modal",{model:this.model.getOccupant(),message:this.model},e)):(e.preventDefault(),hm.modal.show("converse-user-details-modal",{model:this.model_with_messages},e))}showMessageVersionsModal(e){e.preventDefault(),hm.modal.show("converse-message-versions-modal",{model:this.model},e)}toggleSpoilerMessage(e){e?.preventDefault(),this.model.save({is_spoiler_visible:!this.model.get("is_spoiler_visible")})}});hm.elements.define("converse-message-history",class extends VS{constructor(){super(),this.model=null,this.messages=[]}static get properties(){return{model:{type:Object},messages:{type:Array}}}render(){const e=this.messages;return e.length?kO(e,(e=>e.get("id")),(e=>fp`${this.renderMessage(e)}`)):""}renderMessage(e){if(e.get("dangling_retraction")||e.get("dangling_moderation")||e.get("is_only_key"))return"";const t=e.get("template_hook");if("string"==typeof t){const s=hm.hook(t,e,"");return LT(s,"")}{const t=fp`<converse-chat-message .model_with_messages="${this.model}" .model="${e}"></converse-chat-message>`,s=VO(e);return s?[s,t]:t}}});var FI=s(6120),UI={};UI.styleTagTransform=I(),UI.setAttributes=j(),UI.insert=C().bind(null,"head"),UI.domAPI=E(),UI.insertStyleElement=O();A()(FI.A,UI);FI.A&&FI.A.locals&&FI.A.locals;class BI extends VS{constructor(){super(),this.model=null}static get properties(){return{model:{type:Object}}}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("scroll",WO)}connectedCallback(){super.connectedCallback(),this.addEventListener("scroll",WO)}async initialize(){await this.model.initialized,this.listenTo(this.model.messages,"add",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"change",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"remove",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"rendered",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"reset",(()=>this.requestUpdate())),this.listenTo(this.model.notifications,"change",(()=>this.requestUpdate())),this.listenTo(this.model.ui,"change",(()=>this.requestUpdate())),this.listenTo(this.model.ui,"change:scrolled",this.scrollDown),this.requestUpdate()}render(){return this.model?fp`<div class="chat-content__notifications">${this.model.getNotificationsText()}</div><converse-message-history .model="${this.model}" .messages="${[...this.model.messages.models]}"></converse-message-history>${this.model.ui?.get("chat-content-spinner-top")?vT():""}`:""}scrollDown(){if(!this.model.ui.get("scrolled")){if(this.scrollTo){const e=this.scrollTop?"smooth":"auto";this.scrollTo({top:0,behavior:e})}else this.scrollTop=0;hm.trigger("chatBoxScrolledDown",{chatbox:this.model})}}}hm.elements.define("converse-chat-content",BI);class qI extends $T{constructor(e){if(super(e),this.it=Ig,e.type!==xT)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===Ig||null==e)return this._t=void 0,this.it=e;if(e===Ng)return e;if("string"!=typeof e)throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}}qI.directiveName="unsafeHTML",qI.resultType=1;const HI=ET(qI);hm.elements.define("converse-chat-help",class extends VS{constructor(){super(),this.messages=[],this.model=null,this.type=null}static get properties(){return{chat_type:{type:String},messages:{type:Array},model:{type:Object},type:{type:String}}}render(){const e=(new Date).toISOString();return[fp`<converse-icon class="fas fa-times close-chat-help" @click="${this.close}" path-prefix="${hm.settings.get("assets_path")}" size="1em"></converse-icon>`,...this.messages.map((t=>this.renderHelpMessage({isodate:e,markup:G().sanitize(t,{ALLOWED_TAGS:["strong"]})})))]}close(){this.model.set({show_help_messages:!1})}renderHelpMessage(e){return fp`<div class="message chat-${this.type}" data-isodate="${e.isodate}">${HI(e.markup)}</div>`}});const GI=Cf.env.utils,WI=e=>{const t=hm.settings.get("emoji_categories");return fp`<ul>${Object.keys(t).map((s=>t[s]?(e=>fp`<li data-category="${e.category}" class="emoji-category ${e.category} ${e.current_category===e.category?"picked":""}" title="${HS(hm.settings.get("emoji_category_labels")[e.category])}"><a class="btn pick-category" @click="${e.onCategoryPicked}" href="#emoji-picker-${e.category}" data-category="${e.category}">${e.emoji}</a></li>`)(Object.assign({category:s,emoji:e.sn2Emoji(t[s])},e)):""))}</ul>`},VI=e=>fp`<li class="emoji insert-emoji ${e.shouldBeHidden(e.emoji.sn)?"hidden":""}" data-emoji="${e.emoji.sn}" title="${e.emoji.sn}"><a href="#" @click="${e.insertEmoji}" data-emoji="${e.emoji.sn}">${GI.shortnamesToEmojis(e.emoji.sn)}</a></li>`;function QI(e){const t=hm.settings.get("emoji_categories");return fp`<span ?hidden="${e.query}" class="emoji-lists__container emoji-lists__container--browse">${Object.keys(t).map((s=>t[s]?function(e){return fp`<a id="emoji-picker-${e.category}" class="emoji-category__heading" data-category="${e.category}">${HS(hm.settings.get("emoji_category_labels")[e.category])}</a><ul class="emoji-picker" data-category="${e.category}">${Object.values(Cf.emojis.json[e.category]).map((t=>VI(Object.assign({emoji:t},e))))}</ul>`}(Object.assign({category:s},e)):""))}</span>`}function KI(e,t){const s=HS("Search"),n={tone1:":raised_hand_tone1:",tone2:":raised_hand_tone2:",tone3:":raised_hand_tone3:",tone4:":raised_hand_tone4:",tone5:":raised_hand_tone5:"};return fp`<div class="emoji-picker__header"><input class="form-control emoji-search" name="emoji-search" placeholder="${s}" .value="${t.query||""}" @keydown="${t.onSearchInputKeyDown}" @blur="${t.onSearchInputBlurred}" @focus="${t.onSearchInputFocus}"> ${t.query?"":WI(t)}</div>${t.render_emojis?fp`<converse-emoji-picker-content .model="${e.state}" .search_results="${t.search_results}" current_skintone="${t.current_skintone}" query="${t.query}"></converse-emoji-picker-content>`:""}<div class="emoji-skintone-picker">Skin tone:<ul>${Object.keys(n).map((e=>function(e,t,s){return fp`<li data-skintone="${s}" class="emoji-skintone ${e.current_skintone===t?"picked":""}"><a class="pick-skintone" href="#" data-skintone="${t}" @click="${e.onSkintonePicked}">${GI.shortnamesToEmojis(s)}</a></li>`}(t,e,n[e])))}</ul></div>`}const{sizzle:JI}=Cf.env;hm.elements.define("converse-emoji-picker-content",class extends VS{static get properties(){return{search_results:{type:Array},current_skintone:{type:String},model:{type:Object},query:{type:String}}}constructor(){super(),this.model=null,this.current_skintone=null,this.query=null,this.search_results=null}render(){const e={current_skintone:this.current_skintone,insertEmoji:e=>this.insertEmoji(e),query:this.query,search_results:this.search_results,shouldBeHidden:e=>this.shouldBeHidden(e)};return fp`<div class="emoji-picker__lists">${function(e){const t=HS("Search results");return fp`<span ?hidden="${!e.query}" class="emoji-lists__container emojis-lists__container--search"><a id="emoji-picker-search-results" class="emoji-category__heading">${t}</a><ul class="emoji-picker">${e.search_results.map((t=>VI(Object.assign({emoji:t},e))))}</ul></span>`}(e)} ${QI(e)}</div>`}firstUpdated(){this.initIntersectionObserver()}initIntersectionObserver(){if(window.IntersectionObserver){if(this.observer)this.observer.disconnect();else{const e={root:this.querySelector(".emoji-picker__lists"),threshold:[.1]},t=e=>this.setCategoryOnVisibilityChange(e);this.observer=new IntersectionObserver(t,e)}JI(".emoji-picker",this).forEach((e=>this.observer.observe(e)))}}setCategoryOnVisibilityChange(e){const t=this.parentElement.navigator.selected,s=e.filter((e=>e.target.contains(t))).pop();let n;if(n=s||e.reduce(((e,t)=>t.intersectionRatio>=(e?.intersectionRatio||0)?t:e),null),n&&n.isIntersecting){const e=n.target.getAttribute("data-category");e!==this.model.get("current_category")&&(this.parentElement.preserve_scroll=!0,Ef.safeSave(this.model,{current_category:e}))}}insertEmoji(e){e.preventDefault(),e.stopPropagation();const t=e.target,s="IMG"===t.nodeName?t.parentElement:t;this.parentElement.selectEmoji(s.getAttribute("data-emoji"))}shouldBeHidden(e){if(e.includes("_tone")){if(!this.current_skintone||!e.includes(this.current_skintone))return!0}else if(this.current_skintone&&QO().includes(e))return!0;return!(!this.query||wj(e,this.query))}});const{CHATROOMS_TYPE:YI}=DS,{initStorage:XI}=Ef;hm.elements.define("converse-emoji-dropdown",class extends sI{static get properties(){return{icon_classes:{type:String},items:{type:Array},model:{type:Object}}}constructor(){super(),this.id=Ef.getUniqueId(),this.render_emojis=!1,this.state=null,this.model=null,this.addEventListener("shown.bs.dropdown",(()=>this.onShown()))}initModel(){return this.init_promise||(this.init_promise=(async()=>{await hm.emojis.initialize();const e=`converse.emoji-${Bu.session.get("bare_jid")}-${this.model.get("jid")}`;this.state=new ev({id:e}),XI(this.state,e),await new Promise((e=>this.state.fetch({success:e,error:e}))),this.state.set({autocompleting:null,ac_position:null})})()),this.init_promise}render(){const e=this.model.get("type")===YI?"--muc-color":"--chat-color";return fp`<button class="btn dropdown-toggle dropdown-toggle--no-caret toggle-emojis" type="button" id="${this.id}" title="${HS("Insert emojis")}" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><converse-icon color="var(${e})" class="fa fa-smile" path-prefix="${hm.settings.get("assets_path")}" size="1em"></converse-icon></button><ul class="dropdown-menu" aria-labelledby="${this.id}"><li>${LT(this.initModel().then((()=>fp`<converse-emoji-picker .state="${this.state}" .model="${this.model}" @emojiSelected="${()=>this.dropdown.hide()}" ?render_emojis="${this.render_emojis}" current_category="${this.state.get("current_category")||""}" current_skintone="${this.state.get("current_skintone")||""}" query="${this.state.get("query")||""}"></converse-emoji-picker>`)),"")}</li></ul>`}connectedCallback(){super.connectedCallback(),this.render_emojis=!1}async onShown(){await this.initModel(),this.render_emojis||(this.render_emojis=!0,this.requestUpdate(),await this.updateComplete),setTimeout((()=>this.querySelector(".emoji-search")?.focus()))}});var ZI=s(9440),eM={};eM.styleTagTransform=I(),eM.setAttributes=j(),eM.insert=C().bind(null,"head"),eM.domAPI=E(),eM.insertStyleElement=O();A()(ZI.A,eM);ZI.A&&ZI.A.locals&&ZI.A.locals;const{KEYCODES:tM}=DS;hm.elements.define("converse-emoji-picker",class extends VS{static get properties(){return{current_category:{type:String,reflect:!0},current_skintone:{type:String,reflect:!0},model:{type:Object},query:{type:String,reflect:!0},state:{type:Object},render_emojis:{type:Boolean}}}constructor(){super(),this.state=null,this.model=null,this.query="",this.render_emojis=null,this._search_results=[],this.debouncedFilter=Wu((e=>this.state.set({query:e.value})),250)}initialize(){super.initialize(),this.dropdown=this.closest("converse-emoji-dropdown")}firstUpdated(e){super.firstUpdated(e),this.listenTo(this.state,"change",(e=>this.onModelChanged(e.changed))),this.initArrowNavigation()}get search_results(){return this._search_results}set search_results(e){this._search_results=e,this.requestUpdate()}render(){return KI(this,{current_category:this.current_category,current_skintone:this.current_skintone,onCategoryPicked:e=>this.chooseCategory(e),onSearchInputFocus:()=>this.disableArrowNavigation(),onSearchInputKeyDown:e=>this.onSearchInputKeyDown(e),onSkintonePicked:e=>this.chooseSkinTone(e),query:this.query,search_results:this.search_results,render_emojis:this.render_emojis,sn2Emoji:e=>Ef.shortnamesToEmojis(this.getTonedShortname(e))})}updated(e){e.has("query")&&this.updateSearchResults(e),e.has("current_category")&&this.setScrollPosition()}onModelChanged(e){"current_category"in e&&(this.current_category=e.current_category),"current_skintone"in e&&(this.current_skintone=e.current_skintone),"query"in e&&(this.query=e.query)}setScrollPosition(){if(this.preserve_scroll)return void(this.preserve_scroll=!1);const e=this.querySelector(".emoji-lists__container--browse"),t=this.querySelector(`#emoji-picker-${this.current_category}`);t instanceof HTMLElement&&(e.scrollTop=t.offsetTop-3*t.offsetHeight+4)}updateSearchResults(e){const t=e.get("query"),s=wj;if(this.query){if(this.query===t)return this.search_results;t&&this.query.includes(t)?this.search_results=this.search_results.filter((e=>s(e.sn,this.query))):this.search_results=Cf.emojis.list.filter((e=>s(e.sn,this.query)))}else this.search_results.length&&(this.search_results=[])}registerEvents(){this.onGlobalKeyDown=e=>this.#a(e),this.dropdown.addEventListener("hide.bs.dropdown",(()=>this.onDropdownHide()));document.querySelector("body").addEventListener("keydown",this.onGlobalKeyDown)}connectedCallback(){super.connectedCallback(),this.registerEvents()}disconnectedCallback(){document.querySelector("body").removeEventListener("keydown",this.onGlobalKeyDown),this.disableArrowNavigation(),super.disconnectedCallback()}#a(e){this.navigator&&(e.keyCode===tM.ENTER&&Ef.isVisible(this)?this.onEnterPressed(e):e.keyCode===tM.DOWN_ARROW&&!this.navigator.enabled&&Ef.isVisible(this)&&this.enableArrowNavigation(e))}onDropdownHide(){this.disableArrowNavigation(),this.dispatchEvent(new CustomEvent("emojipickerblur",{bubbles:!0}))}setCategoryForElement(e){const t=this.current_category,s=e?.getAttribute("data-category")||t;t!==s&&this.state.save({current_category:s})}selectEmoji(e){const t=this.state.get("autocompleting"),s=this.state.get("ac_position");this.state.set({autocompleting:null,query:"",ac_position:null}),this.disableArrowNavigation();const n={bubbles:!0,detail:{value:e,autocompleting:t,ac_position:s,jid:this.model.get("jid")}};this.dispatchEvent(new CustomEvent("emojiSelected",n))}chooseSkinTone(e){e.preventDefault(),e.stopPropagation();const t=e.target,s=("IMG"===t.nodeName?t.parentElement:t).getAttribute("data-skintone").trim();this.current_skintone===s?this.state.save({current_skintone:""}):this.state.save({current_skintone:s})}chooseCategory(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();const t=e.target??e.relatedTarget,s=t.matches("li")?t:Ef.ancestor(t,"li");this.setCategoryForElement(s),this.navigator.select(s),!this.navigator.enabled&&this.navigator.enable()}onSearchInputKeyDown(e){const t=e.target;if(e.keyCode===tM.TAB)if(t.value){e.preventDefault();const s=Cf.emojis.shortnames.find((e=>wj(e,t.value)));s&&this.state.set({query:s})}else this.navigator.enabled||this.enableArrowNavigation(e);else e.keyCode!==tM.DOWN_ARROW||this.navigator.enabled?e.keyCode!==tM.ENTER&&e.keyCode!==tM.DOWN_ARROW&&this.debouncedFilter(t):this.enableArrowNavigation(e)}onEnterPressed(e){e.preventDefault(),e.stopPropagation();const t=e.target;Cf.emojis.shortnames.includes(t.value)?this.selectEmoji(t.value):1===this.search_results.length?this.selectEmoji(this.search_results[0].sn):this.navigator.selected&&this.navigator.selected.matches(".insert-emoji")?this.selectEmoji(this.navigator.selected.getAttribute("data-emoji")):this.navigator.selected&&this.navigator.selected.matches(".emoji-category")&&this.chooseCategory(new MouseEvent("click",{relatedTarget:this.navigator.selected}))}getTonedShortname(e){return QO().includes(e)&&this.current_skintone?`${e.slice(0,e.length-1)}_${this.current_skintone}:`:e}initArrowNavigation(){if(!this.navigator){const e="li:not(.hidden):not(.emoji-skintone), .emoji-search",t={jump_to_picked:".emoji-category",jump_to_picked_selector:".emoji-category.picked",jump_to_picked_direction:KN.DIRECTION.down,picked_selector:".picked",scroll_container:this.querySelector(".emoji-picker__lists"),getSelector:t=>{if(t===KN.DIRECTION.down){const t=this.navigator.selected&&this.navigator.selected.getAttribute("data-category");return t?`ul[data-category="${t}"] li:not(.hidden):not(.emoji-skintone), .emoji-search`:e}return e},onSelected:e=>{e.matches(".insert-emoji")&&this.setCategoryForElement(e.parentElement),e.matches(".insert-emoji, .emoji-category")&&e.firstElementChild.focus(),e.matches(".emoji-search")&&e.focus()}};this.navigator=new KN(this,t)}}disableArrowNavigation(){this.navigator?.disable()}enableArrowNavigation(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.disableArrowNavigation(),this.navigator.enable(),this.navigator.handleKeydown(e)}});hm.elements.define("converse-message-limit-indicator",class extends VS{constructor(){super(),this.model=null}static get properties(){return{model:{type:Object}}}connectedCallback(){super.connectedCallback(),this.listenTo(this.model,"change:draft",(()=>this.requestUpdate()))}render(){const e=hm.settings.get("message_limit");if(!e)return"";return(e=>{const t=HS("Message characters remaining");return fp`<span class="message-limit ${e<1?"error":""}" title="${t}">${e}</span>`})(e-(this.model.get("draft")||"").length)}});const sM=e=>fp`<span class="btn-group toolbar-buttons">${LT(e.getButtons(),"")}</span> ${e.show_send_button?function(){const e=HS("Send the message");return fp`<button type="submit" class="btn send-button" data-action="sendMessage" title="${e}"><converse-icon color="var(--background-color)" class="fa fa-paper-plane" size="1em"></converse-icon></button>`}():""}`;var nM=s(5501),iM={};iM.styleTagTransform=I(),iM.setAttributes=j(),iM.insert=C().bind(null,"head"),iM.domAPI=E(),iM.insertStyleElement=O();A()(nM.A,iM);nM.A&&nM.A.locals&&nM.A.locals;const rM=Cf.env.Strophe;hm.elements.define("converse-chat-toolbar",class extends VS{static get properties(){return{hidden_occupants:{type:Boolean},is_groupchat:{type:Boolean},message_limit:{type:Number},model:{type:Object},show_call_button:{type:Boolean},show_emoji_button:{type:Boolean},show_send_button:{type:Boolean},show_spoiler_button:{type:Boolean}}}constructor(){super(),this.model=null,this.is_groupchat=null,this.hidden_occupants=!1,this.show_send_button=!1,this.show_spoiler_button=!1,this.show_call_button=!1,this.show_emoji_button=!1}connectedCallback(){super.connectedCallback(),this.listenTo(this.model,"change:composing_spoiler",(()=>this.requestUpdate()))}render(){return sM(this)}firstUpdated(){hm.trigger("renderToolbar",this)}getButtons(){const e=[];if(this.show_emoji_button&&e.push(fp`<converse-emoji-dropdown .model="${this.model}"></converse-emoji-dropdown>`),this.show_call_button){const t=this.is_groupchat?"--muc-color":"--chat-color",s=HS("Start a call");e.push(fp`<button type="button" class="btn toggle-call" @click="${this.toggleCall}" title="${s}"><converse-icon color="var(${t})" class="fa fa-phone" size="1em"></converse-icon></button>`)}hm.settings.get("message_limit")&&e.push(fp`<converse-message-limit-indicator .model="${this.model}" class="right"></converse-message-limit-indicator>`),this.show_spoiler_button&&e.push(this.getSpoilerButton());const t=Bu.session.get("domain"),s=hm.disco.supports(rM.NS.HTTPUPLOAD,t);return e.push(fp`${LT(s.then((e=>this.getHTTPUploadButton(!!e))),"")}`),Bu.api.hook("getToolbarButtons",this,e)}getHTTPUploadButton(e){if(e){const e=HS("Choose a file to send");return fp`<button type="button" class="btn" title="${e}" @click="${this.toggleFileUpload}"><converse-icon class="fa fa-paperclip" size="1em"></converse-icon></button> <input type="file" @change="${this.onFileSelection}" class="fileupload" multiple="" style="display:none">`}return""}getSpoilerButton(){const e=this.model;if(!this.is_groupchat&&!e.presence?.resources.length)return;let t;t=e.get("composing_spoiler")?HS("Click to write as a normal (non-spoiler) message"):HS("Click to write your message as a spoiler");const s=this.is_groupchat?"--muc-color":"--chat-color",n=fp`<button type="button" class="btn toggle-compose-spoiler" title="${t}" @click="${this.toggleComposeSpoilerMessage}"><converse-icon color="var(${s})" class="fa ${e.get("composing_spoiler")?"fa-eye-slash":"fa-eye"}" size="1em"></converse-icon></button>`;if(this.is_groupchat)return n;{const t=e.get("jid"),s=Promise.all(e.presence.resources.map((e=>hm.disco.supports(rM.NS.SPOILER,`${t}/${e.get("name")}`)))).then((e=>e.reduce(((e,t)=>e&&t),!0)));return fp`${LT(s.then((()=>n)),"")}`}}toggleFileUpload(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.querySelector(".fileupload").click()}onFileSelection(e){this.model.sendFiles(e.target.files)}toggleComposeSpoilerMessage(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.model.set("composing_spoiler",!this.model.get("composing_spoiler"))}toggleCall(e){e?.preventDefault?.(),e?.stopPropagation?.(),hm.trigger("callButtonClicked",{connection:hm.connection.get(),model:this.model})}});const{HEADLINES_TYPE:oM}=DS;var aM=s(2995),cM={};cM.styleTagTransform=I(),cM.setAttributes=j(),cM.insert=C().bind(null,"head"),cM.domAPI=E(),cM.insertStyleElement=O();A()(aM.A,cM);aM.A&&aM.A.locals&&aM.A.locals;const{Strophe:lM}=Cf.env;hm.elements.define("converse-chat-heading",class extends VS{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}initialize(){const{chatboxes:e}=Bu.state;this.model=e.get(this.jid),this.listenTo(this.model,"change:status",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.model.contact&&this.listenTo(this.model.contact,"destroy",(()=>this.requestUpdate())),this.model.rosterContactAdded?.then((()=>{this.listenTo(this.model.contact,"change:nickname",(()=>this.requestUpdate())),this.requestUpdate()}))}render(){return(e=>{const{jid:t,status:s,type:n}=e.model.attributes,i=e.getHeadingButtons(),r=t=>e.showUserDetailsModal(t),o=HS("The User's Profile Image"),a=e.model.getDisplayName(),c=fp`<span title="${o}"><converse-avatar .model="${e.model.contact||e.model}" class="avatar chat-msg__avatar" name="${a}" nonce="${e.model.contact?.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></span>`;return fp`<div class="chatbox-title ${s?"":"chatbox-title--no-desc"}"><div class="chatbox-title--row">${Bu.api.settings.get("singleton")?"":fp`<converse-controlbox-navback jid="${t}"></converse-controlbox-navback>`} ${n!==oM?fp`<a class="show-msg-author-modal" @click="${r}">${c}</a>`:""}<div class="chatbox-title__text" title="${t}" role="heading" aria-level="2">${n!==oM?fp`<a class="user show-msg-author-modal" @click="${r}">${a}</a>`:a}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${LT(HO(i),"")} ${LT(qO(i),"")}</div></div>${s?fp`<p class="chat-head__desc">${s}</p>`:""}`})(this)}showUserDetailsModal(e){e.preventDefault(),hm.modal.show("converse-user-details-modal",{model:this.model},e)}close(e){e.preventDefault(),this.model.close()}async getHeadingButtons(){const e=[{a_class:"show-user-details-modal",handler:e=>this.showUserDetailsModal(e),i18n_text:HS("Details"),i18n_title:HS("See more information about this person"),icon_class:"fa-id-card",name:"details",standalone:"overlayed"===hm.settings.get("view_mode")}],t=Bu.session.get("domain");if(t&&await hm.disco.supports(lM.NS.BLOCKING,t)){(await hm.blocklist.get()).get(this.model.get("jid"))?e.push({a_class:"unblock-user",handler:async e=>{e.preventDefault();await hm.confirm(HS("Unblock user"),[HS("Are you sure you want to unblock this user?")])&&hm.blocklist.remove(this.model.get("jid"))},i18n_text:HS("Unblock this user"),i18n_title:HS("Allow this user to send you messages"),icon_class:"fa-check",name:"unblock",standalone:!1}):e.push({a_class:"block-user",handler:async e=>{e.preventDefault();if(await hm.confirm(HS("Block user"),[HS("Are you sure you want to block this user?")])){const e=this.model.get("jid");hm.blocklist.add(e),hm.contacts.remove(e,!0),this.model.close()}},i18n_text:HS("Block this user"),i18n_title:HS("Prevent this user from sending you any further messages"),icon_class:"fa-trash",name:"block",standalone:!1})}hm.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:HS("Close"),i18n_title:HS("Close and end this conversation"),icon_class:"fa-times",name:"close",standalone:"overlayed"===hm.settings.get("view_mode")});const{chatboxviews:s}=Bu.state,n=s.get(this.getAttribute("jid"));return n?Bu.api.hook("getHeadingButtons",n,e):e}});async function dM(e){await hm.confirm(HS("Are you sure you want to clear the messages from this conversation?"))&&await e.clearMessages()}function uM(e){if(!window.CSS?.supports("field-sizing","content"))if(e.target.value){const t=e.target.scrollHeight+"px";e.target.style.height!=t&&(e.target.style.height="auto",e.target.style.height=t)}else e.target.style=""}const{ACTIVE:hM,COMPOSING:mM}=DS;class gM extends VS{static get properties(){return{model:{type:Object}}}constructor(){super(),this.model=null}async initialize(){await this.model.initialized,this.listenTo(this.model.messages,"change:correcting",this.onMessageCorrecting),this.listenTo(this.model,"change:composing_spoiler",(()=>this.requestUpdate())),this.handleEmojiSelection=({detail:e})=>{this.model.get("jid")===e.jid&&this.insertIntoTextArea(e.value,e.autocompleting,!1,e.ac_position)},document.addEventListener("emojiSelected",this.handleEmojiSelection),this.requestUpdate()}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("emojiSelected",this.handleEmojiSelection)}render(){return(e=>{const t=e.model.get("composing_spoiler"),s=HS(t?"Hidden message":"Message"),n=HS("Optional hint"),i=hm.settings.get("message_limit"),r=hm.settings.get("visible_toolbar_buttons").call,o=hm.settings.get("visible_toolbar_buttons").emoji,a=hm.settings.get("show_send_button"),c=hm.settings.get("visible_toolbar_buttons").spoiler,l=hm.settings.get("show_toolbar"),d=e.querySelector(".spoiler-hint")?.value,u=e.querySelector(".chat-textarea")?.value;return fp`<form class="chat-message-form" @submit="${t=>e.onFormSubmitted(t)}">${l?fp`<converse-chat-toolbar class="btn-toolbar chat-toolbar no-text-select" .model="${e.model}" ?composing_spoiler="${t}" ?show_call_button="${r}" ?show_emoji_button="${o}" ?show_send_button="${a}" ?show_spoiler_button="${c}" ?show_toolbar="${l}" message_limit="${i}"></converse-chat-toolbar>`:""} <input type="text" enterkeyhint="send" placeholder="${n||""}" i value="${d||""}" class="${t?"":"hidden"} spoiler-hint"> <textarea autofocus type="text" enterkeyhint="send" .value="${u||""}" @drop="${t=>e.onDrop(t)}" @input="${uM}" @keydown="${t=>e.onKeyDown(t)}" @keyup="${t=>e.onKeyUp(t)}" @paste="${t=>e.onPaste(t)}" @change="${t=>e.model.set({draft:t.target.value})}" class="chat-textarea ${a?"chat-textarea-send-button":""} ${t?"spoiler":""}" placeholder="${s}"></textarea></form>`})(this)}insertIntoTextArea(e,t=!1,s=!1,n,i=" "){const r=this.querySelector(".chat-textarea");if(s?Ef.addClass("correcting",r):Ef.removeClass("correcting",r),t)r.value=n&&"string"==typeof t?r.value.replace(new RegExp(t,"g"),((s,r)=>r==n-t.length?e+i:s)):e;else{let t=r.value;t&&t[t.length-1]!==i&&(t+=i),r.value=t+e+i}const o=document.createEvent("HTMLEvents");o.initEvent("change",!1,!0),r.dispatchEvent(o),Ef.placeCaretAtEnd(r)}onMessageCorrecting(e){if(e.get("correcting"))this.insertIntoTextArea(Ef.prefixMentions(e),!0,!0);else{const t=this.model.messages.findWhere("correcting");t&&t!==e?this.insertIntoTextArea(Ef.prefixMentions(e),!0,!0):this.insertIntoTextArea("",!0,!1)}}onEscapePressed(e){const t=this.model.messages.findLastIndex("correcting"),s=t>=0?this.model.messages.at(t):null;s&&(e.preventDefault(),s.save("correcting",!1),this.insertIntoTextArea("",!0,!1))}onPaste(e){if(e.stopPropagation(),0!==e.clipboardData.files.length)return e.preventDefault(),void this.model.sendFiles(Array.from(e.clipboardData.files));this.model.set({draft:e.clipboardData.getData("text/plain")})}onDrop(e){0!=e.dataTransfer.files.length&&(e.preventDefault(),this.model.sendFiles(e.dataTransfer.files))}onKeyUp(e){this.model.set({draft:e.target.value})}onKeyDown(e){if(!e.ctrlKey){if(!e.shiftKey&&!e.altKey&&!e.metaKey)if(e.keyCode===Cf.keycodes.TAB){const t=Ef.getCurrentWord(e.target,null,/(:.*?:)/g);t.startsWith(":")&&(e.preventDefault(),e.stopPropagation(),this.model.trigger("emoji-picker-autocomplete",{target:e.target,value:t}))}else{if(e.keyCode===Cf.keycodes.FORWARD_SLASH)return;if(e.keyCode===Cf.keycodes.ESCAPE)return this.onEscapePressed(e);if(e.keyCode===Cf.keycodes.ENTER)return this.onFormSubmitted(e);if(e.keyCode!==Cf.keycodes.UP_ARROW||e.target.selectionEnd){if(e.keyCode===Cf.keycodes.DOWN_ARROW&&e.target.selectionEnd===e.target.value.length&&Ef.hasClass("correcting",this.querySelector(".chat-textarea")))return this.model.editLaterMessage()}else{const e=this.querySelector(".chat-textarea");if(!e.value||Ef.hasClass("correcting",e))return this.model.editEarlierMessage()}}[Cf.keycodes.SHIFT,Cf.keycodes.META,Cf.keycodes.META_RIGHT,Cf.keycodes.ESCAPE,Cf.keycodes.ALT].includes(e.keyCode)||this.model.get("chat_state")!==mM&&this.model.setChatState(mM)}}async onFormSubmitted(e){e?.preventDefault?.();const{chatboxviews:t}=Bu.state,s=this.querySelector(".chat-textarea"),n=s.value.trim();if(hm.settings.get("message_limit")&&n.length>hm.settings.get("message_limit")||!n.replace(/\s/g,"").length)return;if(!hm.connection.get().authenticated){const e=HS("Sorry, the connection has been lost, and your message could not be sent");return hm.alert("error",HS("Error"),e),void hm.connection.reconnect()}let i,r={};this.model.get("composing_spoiler")&&(r=this.querySelector("form.chat-message-form input.spoiler-hint"),i=r.value),Ef.addClass("disabled",s),s.setAttribute("disabled","disabled"),this.querySelector("converse-emoji-dropdown")?.dropdown.hide();const o=await async function(e,t){const s=t.replace(/^\s*/,"").match(/^\/(.*)\s*$/);if(s){let n=!1;if(n=await hm.hook("parseMessageForCommands",{model:e,text:t},n),n)return!0;if("clear"===s[1])return dM(e),!0;if("close"===s[1]){const{chatboxviews:t}=Bu.state;return t.get(e.get("jid"))?.close(),!0}if("help"===s[1])return e.set({show_help_messages:!1},{silent:!0}),e.set({show_help_messages:!0}),!0}return!1}(this.model,n),a=o?null:await this.model.sendMessage({body:n,spoiler_hint:i});if((o||a)&&(r.value="",s.value="",Ef.removeClass("correcting",s),s.style.height="auto",this.model.set({draft:""})),"overlayed"===hm.settings.get("view_mode")){t.get(this.model.get("jid")).querySelector(".chat-content__messages").parentElement.style.display="none"}if(s.removeAttribute("disabled"),Ef.removeClass("disabled",s),"overlayed"===hm.settings.get("view_mode")){t.get(this.model.get("jid")).querySelector(".chat-content__messages").parentElement.style.display=""}this.model.setChatState(hM,{silent:!0}),s.focus()}}hm.elements.define("converse-message-form",gM);var pM=s(1089),fM={};fM.styleTagTransform=I(),fM.setAttributes=j(),fM.insert=C().bind(null,"head"),fM.domAPI=E(),fM.insertStyleElement=O();A()(pM.A,fM);pM.A&&pM.A.locals&&pM.A.locals;class vM extends VS{constructor(){super(),this.model=null}static get properties(){return{model:{type:Object}}}async connectedCallback(){super.connectedCallback(),await this.initialize(),this.requestUpdate()}async initialize(){await this.model.initialized,this.listenTo(this.model,"change:num_unread",(()=>this.requestUpdate())),this.listenTo(this.model,"emoji-picker-autocomplete",this.autocompleteInPicker),this.addEventListener("click",(e=>this.sendButtonClicked(e))),this.addEventListener("emojipickerblur",(()=>this.querySelector(".chat-textarea").focus()))}render(){return this.model?(e=>{const t=HS("You have unread messages");return fp`${e.model.ui.get("scrolled")&&e.model.get("num_unread")?fp`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">▼ ${t} ▼</div>`:""}<converse-message-form .model="${e.model}"></converse-message-form>`})({model:this.model,viewUnreadMessages:e=>this.viewUnreadMessages(e)}):""}sendButtonClicked(e){if("sendMessage"===e.delegateTarget?.dataset.action){const t=this.querySelector("converse-message-form");t?.onFormSubmitted(e)}}viewUnreadMessages(e){e?.preventDefault?.(),this.model.ui.set({scrolled:!1})}onDragOver(e){e.preventDefault()}clearMessages(e){e?.preventDefault?.(),dM(this.model)}async autocompleteInPicker(e){const{target:t,value:s}=e;await hm.emojis.initialize();const n=this.querySelector("converse-emoji-picker");if(n){n.state.set({ac_position:t.selectionStart,autocompleting:s,query:s});const e=this.querySelector("converse-emoji-dropdown");e?.dropdown.show()}}}hm.elements.define("converse-chat-bottom-panel",vM);const{CHATROOMS_TYPE:_M,INACTIVE:bM}=DS;class yM extends VS{static get properties(){return{jid:{type:String}}}constructor(){super(),this.jid=null,this.model=null}disconnectedCallback(){super.disconnectedCallback(),Bu.state.chatboxviews.remove(this.jid,this)}updated(){this.model&&this.jid!==this.model.get("jid")&&(this.stopListening(),Bu.state.chatboxviews.remove(this.model.get("jid"),this),delete this.model,this.requestUpdate(),this.initialize())}close(e){return e?.preventDefault?.(),this.model.close(e)}maybeFocus(){hm.settings.get("auto_focus")&&this.focus()}focus(){const e=this.getElementsByClassName("chat-textarea")[0];return e&&document.activeElement!==e&&e.focus(),this}getBottomPanel(){return this.model.get("type")===_M?this.querySelector("converse-muc-bottom-panel"):this.querySelector("converse-chat-bottom-panel")}getMessageForm(){return this.model.get("type")===_M?this.querySelector("converse-muc-message-form"):this.querySelector("converse-message-form")}scrollDown(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.model.ui.get("scrolled")&&this.model.ui.set({scrolled:!1}),GO(this.model)}onWindowStateChanged(){document.hidden?this.model.setChatState(bM,{silent:!0}):this.model.isHidden()||this.model.clearUnreadMsgCounter()}}const{CHATROOMS_TYPE:wM}=DS,{ACTIVE:SM}=DS;class AM extends yM{length=200;async initialize(){const{chatboxviews:e,chatboxes:t}=Bu.state;e.add(this.jid,this),this.model=t.get(this.jid),this.listenTo(this.model,"change:hidden",(()=>!this.model.get("hidden")&&this.afterShown())),this.listenTo(this.model,"change:show_help_messages",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),await this.model.messages.fetched,!this.model.get("hidden")&&this.afterShown(),hm.trigger("chatBoxViewInitialized",this)}render(){return(e=>fp`<div class="flyout box-flyout">${"overlayed"===hm.settings.get("view_mode")?fp`<converse-dragresize></converse-dragresize>`:""} ${e.model?fp`<converse-chat-heading jid="${e.jid}" class="chat-head chat-head-chatbox row g-0"></converse-chat-heading><div class="chat-body"><div class="chat-content ${e.show_send_button?"chat-content-sendbutton":""}" aria-live="polite"><converse-chat-content class="chat-content__messages" .model="${e.model}"></converse-chat-content>${e.show_help_messages?fp`<div class="chat-content__help"><converse-chat-help .model="${e.model}" .messages="${e.help_messages}" ?hidden="${!e.show_help_messages}" type="info" chat_type="${wM}"></converse-chat-help></div>`:""}</div><converse-chat-bottom-panel .model="${e.model}" class="bottom-panel"></converse-chat-bottom-panel></div>`:""}</div>`)(Object.assign({model:this.model,help_messages:this.getHelpMessages(),show_help_messages:this.model.get("show_help_messages")},this.model.toJSON()))}getHelpMessages(){return[`<strong>/clear</strong>: ${HS("Remove messages")}`,`<strong>/close</strong>: ${HS("Close this chat")}`,`<strong>/me</strong>: ${HS("Write in the third person")}`,`<strong>/help</strong>: ${HS("Show this menu")}`]}afterShown(){this.model.setChatState(SM),this.model.clearUnreadMsgCounter(),this.maybeFocus()}}hm.elements.define("converse-chat",AM);var xM=s(2852),EM={};EM.styleTagTransform=I(),EM.setAttributes=j(),EM.insert=C().bind(null,"head"),EM.domAPI=E(),EM.insertStyleElement=O();A()(xM.A,EM);xM.A&&xM.A.locals&&xM.A.locals;const{Strophe:$M}=Cf.env;Cf.plugins.add("converse-chatview",{dependencies:["converse-chatboxviews","converse-chat","converse-disco","converse-modal"],initialize(){hm.settings.extend({fetch_url_headers:!0,allowed_audio_domains:null,allowed_image_domains:null,allowed_video_domains:null,auto_focus:!0,debounced_content_rendering:!0,filter_url_query_params:null,image_urls_regex:null,message_limit:0,muc_hats:["xep317"],render_media:!0,show_message_avatar:!0,show_retraction_warning:!0,show_send_button:!0,show_toolbar:!0,time_format:"HH:mm",use_system_emojis:!0,visible_toolbar_buttons:{call:!1,clear:!0,emoji:!0,spoiler:!1}});const e={ChatBoxView:AM,ChatView:AM};Object.assign(Bu,e),Object.assign(Bu.exports,e),hm.listen.on("connected",(()=>hm.disco.own.features.add($M.NS.SPOILER))),hm.listen.on("chatBoxClosed",(e=>{return t=e.get("jid"),void(location.hash===`converse/chat?jid=${t}`&&history.pushState(null,"",window.location.pathname));var t}))}});hm.elements.define("converse-brand-byline",class extends VS{render(){const e="fullscreen"===hm.settings.get("view_mode");return fp`${e?fp`<p class="brand-subtitle">${Bu.VERSION_NAME}</p><p class="brand-subtitle"><a target="_blank" rel="nofollow" href="https://conversejs.org">Open Source</a> XMPP chat client brought to you by <a target="_blank" rel="nofollow" href="https://opkode.com">Opkode</a></p><p class="brand-subtitle"><a target="_blank" rel="nofollow" href="https://hosted.weblate.org/projects/conversejs/#languages">Translate</a> it into your own language</p>`:""}`}});hm.elements.define("converse-brand-logo",class extends VS{render(){const e="fullscreen"===hm.settings.get("view_mode");return fp`<a class="brand-heading" href="https://conversejs.org" target="_blank" rel="noopener"><span class="brand-name-wrapper ${e?"brand-name-wrapper--fullscreen":""}"><svg class="converse-svg-logo" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 364 364"><title>Converse</title><g class="cls-1" id="g904"><g data-name="Layer 2"><g data-name="Layer 7"><path class="cls-3" d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z"/><path class="cls-4" d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z"/></g></g></g></svg> <span class="brand-name"><span class="brand-name__text">converse<span class="subdued">.js</span></span> ${e?fp`<p class="byline">messaging freedom</p>`:""}</span></span></a>`}});hm.elements.define("converse-brand-heading",class extends VS{render(){return Og`<converse-brand-logo></converse-brand-logo><converse-brand-byline></converse-brand-byline>`}});const{Strophe:CM,u:kM}=Cf.env;function jM(){const e=Bu.state.chatboxes.add(new Bu.exports.ControlBox({id:"controlbox"}));return Bu.state.chatboxviews.get("controlbox")?.setModel(),e}function TM(e){e?.preventDefault?.();const t=Bu.state.chatboxes.get("controlbox")||jM();kM.safeSave(t,{closed:!1})}function OM(){const e=Bu.state.chatboxes?.get("controlbox");e&&kM.safeSave(e,{connected:!1})}function NM(){const{chatboxviews:e}=Bu.state,t=e?.get("controlbox");t&&(kM.safeSave(t.model,{connected:!1}),t?.controlbox_pane&&(t.controlbox_pane.remove(),delete t.controlbox_pane))}async function IM(e){e?.preventDefault();await hm.confirm(HS("Are you sure you want to log out?"))&&hm.user.logout()}function MM(){(Bu.state.chatboxes.get("controlbox")||jM()).save({connected:!0})}const{Strophe:RM}=Cf.env,DM=[RM.Status.ERROR,RM.Status.CONNECTING,RM.Status.CONNFAIL,RM.Status.AUTHENTICATING,RM.Status.AUTHFAIL,RM.Status.DISCONNECTING,RM.Status.RECONNECTING],zM=Object.fromEntries([[RM.Status.ERROR,"Error"],[RM.Status.CONNECTING,"Connecting"],[RM.Status.CONNFAIL,"Connection failure"],[RM.Status.AUTHENTICATING,"Authenticating"],[RM.Status.AUTHFAIL,"Authentication failure"],[RM.Status.CONNECTED,"Connected"],[RM.Status.DISCONNECTED,"Disconnected"],[RM.Status.DISCONNECTING,"Disconnecting"],[RM.Status.ATTACHED,"Attached"],[RM.Status.REDIRECT,"Redirect"],[RM.Status.CONNTIMEOUT,"Connection timeout"],[RM.Status.RECONNECTING,"Reconnecting"]]),LM=Object.fromEntries([[RM.Status.ERROR,"error"],[RM.Status.CONNECTING,"info"],[RM.Status.CONNFAIL,"error"],[RM.Status.AUTHENTICATING,"info"],[RM.Status.AUTHFAIL,"error"],[RM.Status.CONNECTED,"info"],[RM.Status.DISCONNECTED,"error"],[RM.Status.DISCONNECTING,"warn"],[RM.Status.ATTACHED,"info"],[RM.Status.REDIRECT,"info"],[RM.Status.RECONNECTING,"warn"]]),{ANONYMOUS:PM,EXTERNAL:FM,LOGIN:UM,PREBIND:BM,CONNECTION_STATUS:qM}=DS,HM=e=>{const t=hm.settings.get("authentication"),s=HS("Log in"),n=HS("XMPP Address"),i=hm.settings.get("locked_domain"),r=hm.settings.get("default_domain"),o=(i||r)&&HS("Username")||HS("user@domain"),a=hm.settings.get("allow_user_trust_override");return fp`<fieldset class="form-group"><label for="converse-login-jid" class="form-label">${n}:</label> <input id="converse-login-jid" ?autofocus="${!!hm.settings.get("auto_focus")}" @changed="${e.validate}" value="${hm.settings.get("jid")??""}" required class="form-control" type="text" name="jid" placeholder="${o}"></fieldset>${t!==FM?(()=>{const e=HS("Password");return fp`<div><label for="converse-login-password" class="form-label">${e}</label> <input id="converse-login-password" class="form-control" required="required" value="${hm.settings.get("password")??""}" type="password" name="password" placeholder="${e}"></div>`})():""} ${hm.settings.get("show_connection_url_input")?(()=>{const e=HS("Connection URL"),t=HS("HTTP or websocket URL that is used to connect to your XMPP server"),s=HS("e.g. wss://example.org/xmpp-websocket");return fp`<div class="form-group fade-in"><label for="converse-conn-url" class="form-label">${e}</label><p class="form-help instructions">${t}</p><input id="converse-conn-url" class="form-control" type="url" name="connection-url" placeholder="${s}"></div>`})():""} ${a?(e=>{const t=HS("To improve performance, we cache your data in this browser. Uncheck this box if this is a public computer or if you want your data to be deleted when you log out. It's important that you explicitly log out, otherwise not all cached data might be deleted. Please note, when using an untrusted device, OMEMO encryption is NOT available."),s=HS("This is a trusted device");return fp`<div class="form-group form-check login-trusted"><input id="converse-login-trusted" type="checkbox" class="form-check-input p-1 me-1" name="trusted" ?checked="${e}"> <label for="converse-login-trusted" class="form-check-label login-trusted__desc">${s}</label> <button type="button" class="btn p-0" data-toggle="popover" title="${t}" data-content="${t}"><converse-icon class="fa fa-info-circle" size="1.2em"></converse-icon></button></div>`})("off"!==a):""}<fieldset class="form-group buttons"><input class="btn btn-primary" type="submit" value="${s}"></fieldset>${hm.settings.get("allow_registration")&&!hm.settings.get("auto_login")&&Bu.pluggable.plugins["converse-register"].enabled(Bu)?(()=>{const e=HS("Create an account"),t=HS("Don't have a chat account?");return fp`<fieldset class="switch-form"><p>${t}</p><p><a class="register-account toggle-register-login" href="#converse/register">${e}</a></p></fieldset>`})():""}`},GM=e=>{const{connfeedback:t}=Bu.state,s=t.get("connection_status");let n,i;DM.includes(s)&&(i=zM[s],n=LM[s]);const r=t.get("message");return fp`<converse-brand-heading></converse-brand-heading><form id="converse-login" class="converse-form" method="post" @submit="${e.onLoginFormSubmitted}"><div class="conn-feedback fade-in ${i?n:"hidden"}"><p class="feedback-subject">${i}</p><p class="feedback-message ${r?"":"hidden"}">${r}</p></div>${"CONNECTING"===qM[s]?vT():(e=>{const t=hm.settings.get("authentication"),s=HS("Disconnected"),n=HS("Click here to log in anonymously");return fp`${t==UM||t==FM?HM(e):""} ${t==PM?fp`<input class="btn btn-primary login-anon" type="submit" value="${n}">`:""} ${t==BM?fp`<p>${s}</p>`:""}`})(e)}</form>`};var WM=s(5832),VM={};VM.styleTagTransform=I(),VM.setAttributes=j(),VM.insert=C().bind(null,"head"),VM.domAPI=E(),VM.insertStyleElement=O();A()(WM.A,VM);WM.A&&WM.A.locals&&WM.A.locals;const{Strophe:QM}=Cf.env,{ANONYMOUS:KM}=DS;hm.elements.define("converse-login-form",class extends VS{initialize(){this.listenTo(Bu.state.connfeedback,"change",(()=>this.requestUpdate())),this.handler=()=>this.requestUpdate()}connectedCallback(){super.connectedCallback(),hm.settings.listen.on("change",this.handler)}disconnectedCallback(){super.disconnectedCallback(),hm.settings.listen.not("change",this.handler)}render(){return GM(this)}firstUpdated(){this.initPopovers()}async onLoginFormSubmitted(e){if(e?.preventDefault(),hm.settings.get("authentication")===KM){const e=Bu.session.get("jid");return this.connect(e)}const t=e.target;(function(e){const t=e.querySelector("input[name=jid]");return!t.value||hm.settings.get("locked_domain")||hm.settings.get("default_domain")||kM.isValidJID(t.value)?(t.setCustomValidity(""),!0):(t.setCustomValidity(HS("Please enter a valid XMPP address")),!1)})(t)&&(!function(e,t={}){const s=new FormData(e),n=s.get("connection-url");n?.startsWith("ws")?t.websocket_url=n:n?.startsWith("http")&&(t.bosh_service_url=n);let i=s.get("jid");if(hm.settings.get("locked_domain")){const e="@"+hm.settings.get("locked_domain");i.endsWith(e)&&(i=i.substr(0,i.length-e.length)),i=CM.escapeNode(i)+e}else hm.settings.get("default_domain")&&!i.includes("@")&&(i=i+"@"+hm.settings.get("default_domain"));t.jid=i,t.password=s.get("password"),hm.settings.set(t),Bu.state.config.save({trusted:!!s.get("trusted")})}(t),hm.settings.get("bosh_service_url")||hm.settings.get("websocket_url")||await this.discoverConnectionMethods(t),hm.settings.get("bosh_service_url")||hm.settings.get("websocket_url")?this.connect():hm.settings.set("show_connection_url_input",!0))}discoverConnectionMethods(e){if(!hm.settings.get("discover_connection_methods"))return;const t=new FormData(e).get("jid");if(t instanceof File)throw new Error('Found file instead of string for "jid" field in form');const s=QM.getDomainFromJid(t);return hm.connection.init(t),hm.connection.get().discoverConnectionMethods(s)}initPopovers(){Array.from(this.querySelectorAll('[data-toggle="popover"]')).forEach((e=>new dk(e)))}connect(e){["converse/login","converse/register"].includes(location.hash)&&history.pushState(null,"",window.location.pathname),hm.connection.get()?.reset(),hm.user.login(e)}});const JM=e=>fp`<converse-icon size="1em" class="fa fa-arrow-left" @click="${()=>function(e){TM();const t=Bu.state.chatboxes.get(e);kM.safeSave(t,{hidden:!0})}(e)}"></converse-icon>`;class YM extends VS{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}render(){return JM(this.jid)}}hm.elements.define("converse-controlbox-navback",YM);function XM(){const e=HS("Log out");return fp`<a class="controlbox-heading__btn logout align-self-center" title="${e}" @click="${IM}"><converse-icon class="fa fa-sign-out-alt" size="1em"></converse-icon></a>`}const ZM=e=>{const t=e.model.get("connected"),s=hm.settings.get("show_client_info")||hm.settings.get("allow_adhoc_commands");return fp`<div class="btn-toolbar g-0">${t&&s?function(e){const t=HS("Show details about this chat client");return fp`<a class="controlbox-heading__btn show-client-info align-self-center" title="${t}" @click="${e.showUserSettingsModal}"><converse-icon class="fa fa-cog" size="1em"></converse-icon></a>`}(e):""} ${t&&hm.settings.get("allow_logout")?XM():""} ${hm.settings.get("sticky_controlbox")?"":function(e){return fp`<a class="controlbox-heading__btn close align-self-center" @click="${t=>e.closeControlBox(t)}"><converse-icon class="fa fa-times" size="1em"></converse-icon></a>`}(e)}</div>`};var eR=s(7190),tR={};tR.styleTagTransform=I(),tR.setAttributes=j(),tR.insert=C().bind(null,"head"),tR.domAPI=E(),tR.insertStyleElement=O();A()(eR.A,tR);eR.A&&eR.A.locals&&eR.A.locals;class sR extends VS{initialize(){const{chatboxes:e}=Bu.state;this.model=e.get("controlbox")}render(){return ZM(this)}showUserSettingsModal(e){e?.preventDefault(),hm.modal.show("converse-user-settings-modal",{model:Bu.state.xmppstatus,_converse:Bu},e)}closeControlBox(e){e?.preventDefault();const t=Bu.state.chatboxviews.get("controlbox");t?.close()}}hm.elements.define("converse-controlbox-buttons",sR);const{dayjs:nR}=Cf.env,{CONTROLBOX_TYPE:iR}=DS;const rR=class extends fd{defaults(){return{bookmarked:!1,box_id:"controlbox",chat_state:void 0,closed:!hm.settings.get("show_controlbox_by_default"),num_unread:0,time_opened:nR(0).valueOf(),type:iR,url:""}}validate(e){return e.type===iR?"embedded"===hm.settings.get("view_mode")&&hm.settings.get("singleton")?"Controlbox not relevant in embedded view mode":void 0:Bu.state.ChatBox.prototype.validate.call(this,e)}maybeShow(e){return e||"controlbox"!==this.get("id")?Bu.state.ChatBox.prototype.maybeShow.call(this,e):this}onReconnection(){this.save("connected",!0)}};class oR extends VS{async connectedCallback(){super.connectedCallback(),await hm.waitUntil("initialized");const{chatboxes:e}=Bu.state;this.model=e.get("controlbox"),this.listenTo(this.model,"change:closed",(()=>this.requestUpdate())),this.requestUpdate()}render(){return(e=>{const t=hm.connection.connected()?HS("Chat Contacts"):HS("Toggle chat");return fp`<button type="button" class="btn toggle-controlbox ${e.model?.get("closed")?"":"hidden"}" @click="${e=>TM(e)}"><span class="toggle-feedback">${t}</span></button>`})(this)}}hm.elements.define("converse-controlbox-toggle",oR);const aR=oR,{Strophe:cR}=Cf.env,{ANONYMOUS:lR}=DS;const dR=e=>fp`<div class="flyout box-flyout"><converse-dragresize></converse-dragresize>${e.model.get("connected")?fp`<converse-user-profile></converse-user-profile>`:fp`<converse-controlbox-buttons class="controlbox-padded"></converse-controlbox-buttons>`}<div class="controlbox-pane">${e.model.get("connected")?fp`<converse-headlines-feeds-list class="controlbox-section"></converse-headlines-feeds-list><div id="chatrooms" class="controlbox-section"><converse-rooms-list></converse-rooms-list></div>${hm.settings.get("authentication")===lR?"":fp`<div id="converse-roster" class="controlbox-section"><converse-roster></converse-roster></div>`}`:function(e){const t=Bu.state.connfeedback.get("connection_status");return[cR.Status.RECONNECTING,cR.Status.CONNECTING].includes(t)?vT({class:"vertically-centered"}):"register"===e.model.get("active-form")?fp`<converse-register-panel></converse-register-panel>`:fp`<converse-login-form id="converse-login-panel" class="controlbox-pane fade-in"></converse-login-form>`}(e)}</div></div>`,{LOGOUT:uR}=DS;class hR extends VS{initialize(){this.setModel();const{chatboxviews:e}=Bu.state;e.add("controlbox",this),this.model.get("connected")&&void 0===this.model.get("closed")&&this.model.set("closed",!hm.settings.get("show_controlbox_by_default")),this.requestUpdate(),hm.trigger("controlBoxInitialized",this)}setModel(){this.model=Bu.state.chatboxes.get("controlbox"),this.listenTo(Bu.state.connfeedback,"change:connection_status",(()=>this.requestUpdate())),this.listenTo(this.model,"change:active-form",(()=>this.requestUpdate())),this.listenTo(this.model,"change:connected",(()=>this.requestUpdate())),this.listenTo(this.model,"change:closed",(()=>{this.requestUpdate(),this.model.get("closed")||this.afterShown()})),this.requestUpdate()}render(){return this.model&&!this.model.get("closed")?dR(this):""}close(e){e?.preventDefault?.();const t=hm.connection.get();if(("closeAllChatBoxes"!==e?.name||t.disconnection_cause===uR&&!hm.settings.get("show_controlbox_by_default"))&&!hm.settings.get("sticky_controlbox")&&"overlayed"===hm.settings.get("view_mode"))return Ef.safeSave(this.model,{closed:!0}),hm.trigger("controlBoxClosed",this),this}afterShown(){return hm.trigger("controlBoxOpened",this),this}}hm.elements.define("converse-controlbox",hR);const mR=hR,{u:gR}=Cf.env,pR={controlbox:{async open(){await hm.waitUntil("chatBoxesFetched");let e=await hm.chatboxes.get("controlbox");return e||(e=await hm.chatboxes.create("controlbox",{},rR)),gR.safeSave(e,{closed:!1}),e},get:()=>Bu.state.chatboxviews.get("controlbox")}};var fR=s(6264),vR={};vR.styleTagTransform=I(),vR.setAttributes=j(),vR.insert=C().bind(null,"head"),vR.domAPI=E(),vR.insertStyleElement=O();A()(fR.A,vR);fR.A&&fR.A.locals&&fR.A.locals;const{CONTROLBOX_TYPE:_R}=DS;Cf.plugins.add("converse-controlbox",{dependencies:["converse-modal","converse-chatboxes","converse-chat","converse-rosterview","converse-chatview"],enabled:e=>!e.api.settings.get("singleton"),initialize(){hm.settings.extend({allow_logout:!0,allow_user_trust_override:!0,default_domain:void 0,locked_domain:void 0,show_connection_url_input:!1,show_controlbox_by_default:!1,sticky_controlbox:!1}),hm.promises.add("controlBoxInitialized",!1),Object.assign(hm,pR);const e={ControlBox:rR,ControlBoxView:mR,ControlBoxToggle:aR};Object.assign(Bu,e),Object.assign(Bu.exports,e),hm.chatboxes.registry.add(_R,rR),hm.listen.on("chatBoxesFetched",MM),hm.listen.on("clearSession",NM),hm.listen.on("will-reconnect",OM),hm.waitUntil("chatBoxViewsInitialized").then(jM).catch((e=>Ct.fatal(e)))}});hm.elements.define("converse-headlines-heading",class extends VS{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}async initialize(){this.model=Bu.state.chatboxes.get(this.jid),await this.model.initialized,this.requestUpdate()}render(){return(e=>fp`<div class="chatbox-title ${e.status?"":"chatbox-title--no-desc"}"><div class="chatbox-title--row">${Bu.api.settings.get("singleton")?"":fp`<converse-controlbox-navback jid="${e.jid}"></converse-controlbox-navback>`}<div class="chatbox-title__text" title="${e.jid}">${e.display_name}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${LT(HO(e.heading_buttons_promise),"")} ${LT(qO(e.heading_buttons_promise),"")}</div></div>${e.status?fp`<p class="chat-head__desc">${e.status}</p>`:""}`)({...this.model.toJSON(),display_name:this.model.getDisplayName(),heading_buttons_promise:this.getHeadingButtons()})}getHeadingButtons(){const e=[];return hm.settings.get("singleton")||e.push({a_class:"close-chatbox-button",handler:e=>this.close(e),i18n_text:HS("Close"),i18n_title:HS("Close these announcements"),icon_class:"fa-times",name:"close",standalone:"overlayed"===hm.settings.get("view_mode")}),Bu.api.hook("getHeadingButtons",this,e)}close(e){e.preventDefault(),this.model.close()}});class bR extends yM{async initialize(){const{chatboxviews:e,chatboxes:t}=Bu.state;e.add(this.jid,this),this.model=t.get(this.jid),this.listenTo(this.model,"change:hidden",(()=>this.afterShown())),this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model.messages,"add",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"remove",(()=>this.requestUpdate())),this.listenTo(this.model.messages,"reset",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),await this.model.messages.fetched,this.model.maybeShow(),hm.trigger("headlinesBoxViewInitialized",this)}render(){return(e=>fp`<div class="flyout box-flyout"><converse-dragresize></converse-dragresize>${e?fp`<converse-headlines-heading jid="${e.get("jid")}" class="chat-head chat-head-chatbox row g-0"></converse-headlines-heading><div class="chat-body"><div class="chat-content" aria-live="polite"><converse-chat-content class="chat-content__messages" .model="${e}"></converse-chat-content></div></div>`:""}</div>`)(this.model)}async close(e){return e?.preventDefault?.(),location.hash==="converse/chat?jid="+this.model.get("jid")&&history.pushState(null,"",window.location.pathname),await this.model.close(e),this}getNotifications(){return[]}afterShown(){this.model.clearUnreadMsgCounter()}}hm.elements.define("converse-headlines",bR);const yR=bR,{HEADLINES_TYPE:wR}=DS;const SR=e=>{const t=e.model.filter((e=>e.get("type")===wR)),s=HS("Announcements");return fp`<div class="controlbox-section" id="headline"><div class="d-flex controlbox-padded ${t.length?"":"hidden"}"><span class="w-100 controlbox-heading controlbox-heading--headline" role="heading" aria-level="3">${s}</span></div></div><div class="list-container list-container--headline ${t.length?"":"hidden"}"><div class="items-list rooms-list headline-list">${t.map((t=>function(e,t){const s=HS("Click to open this server message");return fp`<div class="list-item controlbox-padded d-flex flex-row" data-headline-jid="${t.get("jid")}"><a class="list-item-link open-headline available-room w-100" data-headline-jid="${t.get("jid")}" title="${s}" @click="${t=>e.openHeadline(t)}" href="#">${t.get("jid")}</a></div>`}(e,t)))}</div></div>`},{HEADLINES_TYPE:AR}=DS;class xR extends VS{initialize(){this.model=Bu.state.chatboxes,this.listenTo(this.model,"add",(e=>this.renderIfHeadline(e))),this.listenTo(this.model,"remove",(e=>this.renderIfHeadline(e))),this.listenTo(this.model,"destroy",(e=>this.renderIfHeadline(e))),this.requestUpdate()}render(){return SR(this)}renderIfHeadline(e){return e?.get("type")===AR&&this.requestUpdate()}async openHeadline(e){e.preventDefault();const t=e.target.getAttribute("data-headline-jid");(await hm.headlines.get(t)).maybeShow(!0)}}hm.elements.define("converse-headlines-feeds-list",xR);var ER=s(3363),$R={};$R.styleTagTransform=I(),$R.setAttributes=j(),$R.insert=C().bind(null,"head"),$R.domAPI=E(),$R.insertStyleElement=O();A()(ER.A,$R);ER.A&&ER.A.locals&&ER.A.locals;var CR=s(6524),kR={};kR.styleTagTransform=I(),kR.setAttributes=j(),kR.insert=C().bind(null,"head"),kR.domAPI=E(),kR.insertStyleElement=O();A()(CR.A,kR);CR.A&&CR.A.locals&&CR.A.locals;Cf.plugins.add("converse-headlines-view",{dependencies:["converse-headlines","converse-chatview"],initialize(){const e={HeadlinesFeedView:yR,HeadlinesFeedsList:xR,HeadlinesPanel:xR};Object.assign(Bu,e),Object.assign(Bu.exports,e)}});var jR=s(304),TR={};TR.styleTagTransform=I(),TR.setAttributes=j(),TR.insert=C().bind(null,"head"),TR.domAPI=E(),TR.insertStyleElement=O();A()(jR.A,TR);jR.A&&jR.A.locals&&jR.A.locals;hm.elements.define("converse-mam-placeholder",class extends VS{static get properties(){return{model:{type:Object}}}constructor(){super(),this.model=null}render(){return(e=this).model.get("fetching")?vT({classes:"hor_centered"}):Og`<a @click="${t=>e.fetchMissingMessages(t)}" title="${HS("Click to load missing messages")}"><div class="message mam-placeholder"></div></a>`;var e}async fetchMissingMessages(e){e?.preventDefault?.(),this.model.set("fetching",!0);const t={before:this.model.get("before"),start:this.model.get("start")};await Ef.mam.fetchArchivedMessages(this.model.collection.chatbox,t),this.model.destroy()}});const{CHATROOMS_TYPE:OR}=DS;function NR(e,t){return e instanceof by?Og`<converse-mam-placeholder .model="${e}"></converse-mam-placeholder>`:t}async function IR(e){if(!e.model.ui.get("chat-content-spinner-top")&&e.model.messages.length){const t=e.model.get("type")===OR,s=e.model.getOldestMessage();if(s){const n=Bu.session.get("bare_jid"),i=t?e.model.get("jid"):n,r=s.get(`stanza_id ${i}`);e.model.ui.set("chat-content-spinner-top",!0);try{r?await Ef.mam.fetchArchivedMessages(e.model,{before:r}):await Ef.mam.fetchArchivedMessages(e.model,{end:s.get("time")})}catch(t){return Ct.error(t),void e.model.ui.set("chat-content-spinner-top",!1)}hm.settings.get("allow_url_history_change")&&history.pushState(null,"",`#${s.get("msgid")}`),setTimeout((()=>e.model.ui.set("chat-content-spinner-top",!1)),250)}}}Cf.plugins.add("converse-mam-views",{dependencies:["converse-mam","converse-chatview","converse-muc-views"],initialize(){hm.listen.on("chatBoxScrolledUp",IR),hm.listen.on("getMessageTemplate",NR)}});const{Strophe:MR,sizzle:RR}=Cf.env;hm.elements.define("converse-muc-affiliation-form",class extends VS{static get properties(){return{muc:{type:Object},jid:{type:String},affiliation:{type:String},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1}}}constructor(){super(),this.jid=null,this.muc=null}render(){return(e=>{const t=HS("Change affiliation"),s=HS("New affiliation"),n=HS("Reason"),i=e.muc.getOwnOccupant().getAssignableAffiliations();return fp`<form class="affiliation-form" @submit="${t=>e.assignAffiliation(t)}">${e.alert_message?fp`<div class="alert alert-${e.alert_type}" role="alert">${e.alert_message}</div>`:""}<div><div class="row"><div class="col"><label class="form-label"><strong>${s}:</strong></label> <select class="form-select select-affiliation" name="affiliation">${i.map((t=>fp`<option value="${t}" ?selected="${t===e.affiliation}">${t}</option>`))}</select></div><div class="col"><label class="form-label"><strong>${n}:</strong></label> <input class="form-control" type="text" name="reason"></div></div></div><div><div class="col"><input type="submit" class="btn btn-primary" name="change" value="${t}"></div></div></form>`})(this)}alert(e,t){this.alert_message=e,this.alert_type=t}async assignAffiliation(e){e.stopPropagation(),e.preventDefault(),this.alert();const t=new FormData(e.target),s=t.get("affiliation"),n={jid:this.jid,reason:t.get("reason")},i=this.muc.get("jid");try{await Ef.muc.setAffiliation(s,i,[n])}catch(e){return null===e?this.alert(HS("Timeout error while trying to set the affiliation"),"danger"):RR(`not-allowed[xmlns="${MR.NS.STANZAS}"]`,e).length?this.alert(HS("Sorry, you're not allowed to make that change"),"danger"):this.alert(HS("Sorry, something went wrong while trying to set the affiliation"),"danger"),void Ct.error(e)}await this.muc.occupants.fetchMembers();const r=new CustomEvent("affiliationChanged",{bubbles:!0});this.dispatchEvent(r)}});const{Strophe:DR,sizzle:zR}=Cf.env;hm.elements.define("converse-muc-role-form",class extends VS{static get properties(){return{muc:{type:Object},jid:{type:String},role:{type:String},alert_message:{type:String,attribute:!1},alert_type:{type:String,attribute:!1}}}constructor(){super(),this.muc=null}render(){return(e=>{const t=HS("Change role"),s=HS("New Role"),n=HS("Reason"),i=e.muc.getOwnOccupant().getAssignableRoles();return fp`<form class="role-form" @submit="${e.assignRole}"><div><input type="hidden" name="jid" value="${e.jid}"> <input type="hidden" name="nick" value="${e.nick}"><div class="row"><div class="col"><label class="form-label"><strong>${s}:</strong></label> <select class="form-select select-role" name="role">${i.map((t=>fp`<option value="${t}" ?selected="${t===e.role}">${t}</option>`))}</select></div><div class="col"><label class="form-label"><strong>${n}:</strong></label> <input class="form-control" type="text" name="reason"></div></div></div><div><div class="col"><input type="submit" class="btn btn-primary" value="${t}"></div></div></form>`})(this)}alert(e,t){this.alert_message=e,this.alert_type=t}assignRole(e){e.stopPropagation(),e.preventDefault(),this.alert();const t=new FormData(e.target),s=this.muc.getOccupant(t.get("jid")||t.get("nick")),n=t.get("role"),i=t.get("reason");this.muc.setRole(s,n,i,(()=>{const e=new CustomEvent("roleChanged",{bubbles:!0});this.dispatchEvent(e)}),(e=>{zR(`not-allowed[xmlns="${DR.NS.STANZAS}"]`,e).length?this.alert(HS("You're not allowed to make that change"),"danger"):(this.alert(HS("Sorry, something went wrong while trying to set the role"),"danger"),Ef.isErrorObject(e)&&Ct.error(e))}))}});var LR=s(4647),PR={};PR.styleTagTransform=I(),PR.setAttributes=j(),PR.insert=C().bind(null,"head"),PR.domAPI=E(),PR.insertStyleElement=O();A()(LR.A,PR);LR.A&&LR.A.locals&&LR.A.locals;const FR="_a",UR="_b",BR="_c",qR="horizontal",HR=()=>!1,GR="undefined"!=typeof window?window:null;hm.elements.define("converse-split-resize",class extends VS{initialize(){super.initialize()}constructor(){super(),this.pair=null}render(){return fp`<div class="gutter gutter-horizontal"></div>`}disconnectedCallback(){super.disconnectedCallback(),this.pair.gutter.removeEventListener("mousedown",this.pair[FR]),this.pair.gutter.removeEventListener("touchstart",this.pair[FR])}updated(e){super.updated(e),this.pair||this.setupSplit([this.previousElementSibling,this.nextElementSibling])}getOption(e,t,s){const n=e[t];return void 0!==n?n:s}getElementStyle(e,t,s){const n={};return Ef.isString(t)?n[e]=t:n[e]=`calc(${t}% - ${s}px)`,n}defaultGutterStyleFn(e,t){return{[e]:`${t}px`}}getGutterSize(e,t,s,n){if(t){if("end"===n)return 0;if("center"===n)return e/2}else if(s){if("start"===n)return 0;if("center"===n)return e/2}return e}setElementSize(e,t,s){const n=this.getElementStyle(this.dimension,t,s);Object.keys(n).forEach((t=>{e.style[t]=n[t]}))}getSizes(){return this.elements.map((e=>e.size))}getMousePosition(e){return"touches"in e?e.touches[0][this.clientAxis]:e[this.clientAxis]}adjust(e){const t=this.elements[this.pair.a],s=this.elements[this.pair.b],n=t.size+s.size;t.size=e/this.pair.size*n,s.size=n-e/this.pair.size*n,this.setElementSize(t.element,t.size,this.pair[UR]),this.setElementSize(s.element,s.size,this.pair[BR])}drag(e,t){let s;const n=this.elements[this.pair.a],i=this.elements[this.pair.b];this.pair.dragging&&(s=this.getMousePosition(e)-this.pair.start+(this.pair[UR]-this.pair.dragOffset),this.dragInterval>1&&(s=Math.round(s/this.dragInterval)*this.dragInterval),s<=n.minSize+n.snapOffset+this.pair[UR]?s=n.minSize+this.pair[UR]:s>=this.pair.size-(i.minSize+i.snapOffset+this.pair[BR])&&(s=this.pair.size-(i.minSize+this.pair[BR])),s>=n.maxSize-n.snapOffset+this.pair[UR]?s=n.maxSize+this.pair[UR]:s<=this.pair.size-(i.maxSize-i.snapOffset+this.pair[BR])&&(s=this.pair.size-(i.maxSize+this.pair[BR])),this.adjust(s),this.getOption(t,"onDrag",HR)(this.getSizes()))}calculateSizes(e){const t=this.elements[e.a].element,s=this.elements[e.b].element,n=t.getBoundingClientRect(),i=s.getBoundingClientRect();e.size=n[this.dimension]+i[this.dimension]+e[UR]+e[BR],e.start=n[this.position],e.end=n[this.positionEnd]}innerSize(e){if(!getComputedStyle)return null;const t=getComputedStyle(e);if(!t)return null;let s=e[this.clientSize];return 0===s?null:(this.direction===qR?s-=parseFloat(t.paddingLeft)+parseFloat(t.paddingRight):s-=parseFloat(t.paddingTop)+parseFloat(t.paddingBottom),s)}trimToMin(e){const t=this.innerSize(this.parent);if(null===t)return e;if(this.minSizes.reduce(((e,t)=>e+t),0)>t)return e;let s=0;const n=[],i=e.map(((i,r)=>{const o=t*i/100,a=this.getGutterSize(this.gutterSize,0===r,r===e.length-1,this.gutterAlign),c=this.minSizes[r]+a;return o<c?(s+=c-o,n.push(0),c):(n.push(o-c),o)}));return 0===s?e:i.map(((e,i)=>{let r=e;if(s>0&&n[i]-s>0){const t=Math.min(s,n[i]-s);s-=t,r=e-t}return r/t*100}))}stopDragging(e){const t=this.elements[this.pair.a].element,s=this.elements[this.pair.b].element;this.pair.dragging&&this.getOption(e,"onDragEnd",HR)(this.getSizes()),this.pair.dragging=!1,GR.removeEventListener("mouseup",this.pair.stop),GR.removeEventListener("touchend",this.pair.stop),GR.removeEventListener("touchcancel",this.pair.stop),GR.removeEventListener("mousemove",this.pair.move),GR.removeEventListener("touchmove",this.pair.move),this.pair.stop=null,this.pair.move=null,t.removeEventListener("selectstart",HR),t.removeEventListener("dragstart",HR),s.removeEventListener("selectstart",HR),s.removeEventListener("dragstart",HR),t.style.userSelect="",t.style.pointerEvents="",s.style.userSelect="",s.style.pointerEvents="",this.pair.gutter.style.cursor="",this.pair.parent.style.cursor="",document.body.style.cursor=""}startDragging(e,t){if("button"in e&&0!==e.button)return;const s=this.elements[this.pair.a].element,n=this.elements[this.pair.b].element;this.pair.dragging||this.getOption(t,"onDragStart",HR)(this.getSizes()),e.preventDefault(),this.pair.dragging=!0,this.pair.stop=()=>this.stopDragging(t),this.pair.move=e=>this.drag(e,t),GR.addEventListener("mouseup",this.pair.stop),GR.addEventListener("touchend",this.pair.stop),GR.addEventListener("touchcancel",this.pair.stop),GR.addEventListener("mousemove",this.pair.move),GR.addEventListener("touchmove",this.pair.move),s.addEventListener("selectstart",HR),s.addEventListener("dragstart",HR),n.addEventListener("selectstart",HR),n.addEventListener("dragstart",HR),s.style.userSelect="none",s.style.pointerEvents="none",n.style.userSelect="none",n.style.pointerEvents="none",this.pair.gutter.style.cursor=this.cursor,this.pair.parent.style.cursor=this.cursor,document.body.style.cursor=this.cursor,this.calculateSizes(this.pair),this.pair.dragOffset=this.getMousePosition(e)-this.pair.end}adjustToMin(e){this.calculateSizes(this.pair),this.adjust(this.pair.size-e.minSize-this.pair[BR])}setSizes(e){const t=this.trimToMin(e);t.forEach(((e,s)=>{if(s>0){const n=this.elements[this.pair.a],i=this.elements[this.pair.b];n.size=t[s-1],i.size=e,this.setElementSize(n.element,n.size,this.pair[UR]),this.setElementSize(i.element,i.size,this.pair[BR])}}))}setupSplit(e,t={}){const s=(e=Array.from(e))[0];this.parent=s.parentElement;const n=this.getOption(t,"minSize",100);this.minSizes=Array.isArray(n)?n:e.map((()=>n));const i=this.getOption(t,"expandToMin",!1);this.gutterSize=this.getOption(t,"gutterSize",5),this.gutterAlign=this.getOption(t,"gutterAlign","center"),this.dragInterval=this.getOption(t,"dragInterval",1),this.direction=this.getOption(t,"direction",qR),this.cursor=this.getOption(t,"cursor",this.direction===qR?"col-resize":"row-resize"),this.direction===qR?(this.dimension="width",this.clientAxis="clientX",this.position="left",this.positionEnd="right",this.clientSize="clientWidth"):"vertical"===this.direction&&(this.dimension="height",this.clientAxis="clientY",this.position="top",this.positionEnd="bottom",this.clientSize="clientHeight"),this.elements=e.map(((s,n)=>this.createElement(e,s,n,t))),this.elements.forEach((e=>{const t=e.element.getBoundingClientRect()[this.dimension];t<e.minSize&&(i?this.adjustToMin(e):e.minSize=t)})),this.createPair(t)}createElement(e,t,s,n){let i=this.getOption(n,"sizes")||e.map((()=>100/e.length));i=this.trimToMin(i);const r=this.getOption(n,"maxSize",1/0),o=Array.isArray(r)?r:e.map((()=>r)),a=this.getOption(n,"snapOffset",30),c=Array.isArray(a)?a:e.map((()=>a));return{element:t,size:i[s],minSize:this.minSizes[s],maxSize:o[s],snapOffset:c[s],i:s}}createPair(e){const t=getComputedStyle?getComputedStyle(this.parent):null,s=t?t.flexDirection:null;if(this.pair={a:0,b:1,dragging:!1,direction:this.direction,parent:this.parent},this.pair[UR]=this.getGutterSize(this.gutterSize,!0,!1,this.gutterAlign),this.pair[BR]=this.getGutterSize(this.gutterSize,!1,!0,this.gutterAlign),"row-reverse"===s||"column-reverse"===s){const e=this.pair.a;this.pair.a=this.pair.b,this.pair.b=e}const n=this.firstElementChild;this.pair[FR]=t=>this.startDragging(t,e),this.addEventListener("mousedown",this.pair[FR]),this.addEventListener("touchstart",this.pair[FR]),this.pair.gutter=n}});hm.elements.define("converse-muc-message-form",class extends gM{async initialize(){super.initialize(),await this.model.initialized,this.initMentionAutoComplete()}render(){return(e=>{const t=e.model.get("composing_spoiler"),s=HS(t?"Hidden message":"Message"),n=HS("Optional hint"),i=hm.settings.get("message_limit"),r=hm.settings.get("visible_toolbar_buttons").call,o=hm.settings.get("visible_toolbar_buttons").emoji,a=hm.settings.get("show_send_button"),c=hm.settings.get("visible_toolbar_buttons").spoiler,l=hm.settings.get("show_toolbar"),d=e.querySelector(".spoiler-hint")?.value,u=e.querySelector(".chat-textarea")?.value;return fp`<form class="setNicknameButtonForm hidden"><input type="submit" class="btn btn-primary" name="join" value="Join"></form><form class="chat-message-form" @submit="${t=>e.onFormSubmitted(t)}">${l?fp`<converse-chat-toolbar class="btn-toolbar chat-toolbar no-text-select" .model="${e.model}" ?hidden_occupants="${e.model.get("hidden_occupants")}" ?is_groupchat="${"groupchat"===e.model.get("message_type")}" ?show_call_button="${r}" ?show_emoji_button="${o}" ?show_send_button="${a}" ?show_spoiler_button="${c}" ?show_toolbar="${l}" message_limit="${i}"></converse-chat-toolbar>`:""} <input type="text" placeholder="${n||""}" value="${d||""}" class="${t?"":"hidden"} spoiler-hint"><div class="suggestion-box"><ul class="suggestion-box__results suggestion-box__results--above" hidden=""></ul><textarea autofocus type="text" @drop="${t=>e.onDrop(t)}" @input="${uM}" @keydown="${t=>e.onKeyDown(t)}" @keyup="${t=>e.onKeyUp(t)}" @paste="${t=>e.onPaste(t)}" @change="${t=>e.model.set({draft:t.target.value})}" class="chat-textarea suggestion-box__input ${a?"chat-textarea-send-button":""} ${t?"spoiler":""}" placeholder="${s}">${u||""}</textarea> <span class="suggestion-box__additions visually-hidden" role="status" aria-live="assertive" aria-relevant="additions"></span></div></form>`})(this)}shouldAutoComplete(){return this.model.session.get("connection_status")===Cf.ROOMSTATUS.ENTERED&&!(this.model.features.get("moderated")&&"visitor"===this.model.getOwnRole())}initMentionAutoComplete(){this.mention_auto_complete=new Cj(this,{auto_first:!0,auto_evaluate:!1,min_chars:hm.settings.get("muc_mention_autocomplete_min_chars"),match_current_word:!0,list:()=>this.getAutoCompleteList(),filter:"contains"==hm.settings.get("muc_mention_autocomplete_filter")?wj:Sj,ac_triggers:["Tab","@"],include_triggers:[],item:(e,t)=>function(e,t,s){s=s.trim();const n=document.createElement("li");if(n.setAttribute("aria-selected","false"),hm.settings.get("muc_mention_autocomplete_show_avatar")){const s=t.label.toLowerCase(),i=document.createElement("converse-avatar");i.model=e.occupants.findWhere((e=>e.getDisplayName()?.toLowerCase()?.startsWith(s)||e.get("nickname")?.toLowerCase()?.startsWith(s)||e.get("jid")?.toLowerCase()?.startsWith(s)?e:void 0)),i.setAttribute("name",i.model.getDisplayName()),i.setAttribute("height","22"),i.setAttribute("width","22"),i.setAttribute("class","avatar avatar-autocomplete"),n.appendChild(i)}const i=new RegExp("("+s+")","ig");return(s?t.split(i):[t]).forEach((e=>{if(s&&e.match(i)){const t=document.createElement("mark");t.textContent=e,n.appendChild(t)}else n.appendChild(document.createTextNode(e))})),n}(this.model,e,t)}),this.mention_auto_complete.on("suggestion-box-selectcomplete",(()=>this.auto_completing=!1))}getAutoCompleteList(){return this.model.getAllKnownNicknames().map((e=>({label:e,value:`@${e}`})))}onKeyDown(e){this.shouldAutoComplete()&&this.mention_auto_complete.onKeyDown(e)||super.onKeyDown(e)}onKeyUp(e){this.shouldAutoComplete()&&this.mention_auto_complete.evaluate(e),super.onKeyUp(e)}});var WR=s(4734),VR={};VR.styleTagTransform=I(),VR.setAttributes=j(),VR.insert=C().bind(null,"head"),VR.domAPI=E(),VR.insertStyleElement=O();A()(WR.A,VR);WR.A&&WR.A.locals&&WR.A.locals;class QR extends VS{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback();const{chatboxes:e}=Bu.state;this.model=e.get(this.jid)}render(){return(e=>{const t=HS("Nickname"),s=e.model?.isEntered()?HS("Change nickname"):HS("Enter groupchat"),n=hm.settings.get("muc_show_logs_before_join")?HS("Choose a nickname to enter"):HS("Please choose your nickname"),i=e.model?.get("nickname_validation_message");return fp`<div class="chatroom-form-container muc-nickname-form"><form class="converse-form chatroom-form converse-centered-form" @submit="${t=>e.submitNickname(t)}"><fieldset><label class="form-label">${n}</label><p class="validation-message">${i}</p><input type="text" required="required" name="nick" value="${e.model?.get("nick")||""}" class="form-control ${i?"error":""}" placeholder="${t}"></fieldset><fieldset><input type="submit" class="btn btn-primary" name="join" value="${s}"></fieldset></form></div>`})(this)}submitNickname(e){e.preventDefault();const t=e.target.nick.value.trim();t&&(this.model.isEntered()?(this.model.setNickname(t),this.closeModal()):this.model.join(t))}closeModal(){document.querySelector("converse-muc-nickname-modal").close()}}hm.elements.define("converse-muc-nickname-form",QR);var KR=s(6215),JR={};JR.styleTagTransform=I(),JR.setAttributes=j(),JR.insert=C().bind(null,"head"),JR.domAPI=E(),JR.insertStyleElement=O();A()(KR.A,JR);KR.A&&KR.A.locals&&KR.A.locals;hm.elements.define("converse-muc-bottom-panel",class extends vM{async initialize(){await super.initialize(),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model,"change:num_unread_general",(()=>this.requestUpdate())),this.listenTo(this.model.features,"change:moderated",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"add",this.renderIfOwnOccupant),this.listenTo(this.model.occupants,"change:role",this.renderIfOwnOccupant),this.listenTo(this.model.session,"change:connection_status",(()=>this.requestUpdate()))}render(){return this.model?(e=>{const t=HS("You have unread messages"),s=e.model.session.get("connection_status"),n=HS("You're not allowed to send messages in this room");return s===Cf.ROOMSTATUS.ENTERED?fp`${e.model.ui.get("scrolled")&&e.model.get("num_unread_general")?fp`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">▼ ${t} ▼</div>`:""} ${e.model.canPostMessages()?fp`<converse-muc-message-form .model="${e.model}"></converse-muc-message-form>`:fp`<span class="muc-bottom-panel muc-bottom-panel--muted">${n}</span>`}`:s!=Cf.ROOMSTATUS.NICKNAME_REQUIRED?"":hm.settings.get("muc_show_logs_before_join")?fp`<span class="muc-bottom-panel muc-bottom-panel--nickname"><converse-muc-nickname-form .model="${e.model}"></converse-muc-nickname-form></span>`:void 0})(this):""}renderIfOwnOccupant(e){const t=Bu.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}sendButtonClicked(e){if("sendMessage"===e.delegateTarget?.dataset.action){const t=this.querySelector("converse-muc-message-form");t?.onFormSubmitted(e)}}});const YR=Cf.env.utils;hm.elements.define("converse-muc-invite-modal",class extends uj{constructor(e){super(e),this.id="converse-muc-invite-modal",this.muc=e.muc}initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render()))}renderModal(){return(e=>{const t=HS("Invite"),s=HS("user@example.org"),n=HS("Please enter a valid XMPP address"),i=HS("XMPP Address"),r=HS("Optional reason for the invitation");return fp`<form class="converse-form" @submit="${t=>e.submitInviteForm(t)}"><fieldset><label class="form-label clearfix" for="invitee_jids">${i}:</label> ${e.model.get("invalid_invite_jid")?fp`<div class="error error-feedback">${n}</div>`:""}<converse-autocomplete .getAutoCompleteList="${()=>e.getAutoCompleteList()}" ?autofocus="${!0}" min_chars="1" position="below" required="required" name="invitee_jids" id="invitee_jids" placeholder="${s}"></converse-autocomplete></fieldset><fieldset><label class="form-label">${r}:</label> <textarea class="form-control" name="reason"></textarea></fieldset><fieldset><input type="submit" class="btn btn-primary" value="${t}"></fieldset></form>`})(this)}getModalTitle(){return HS("Invite someone to this groupchat")}getAutoCompleteList(){return Bu.state.roster.map((e=>({label:e.getDisplayName(),value:e.get("jid")})))}submitInviteForm(e){e.preventDefault();const t=new FormData(e.target),s=t.get("invitee_jids")?.trim(),n=t.get("reason");YR.isValidJID(s)?(this.muc.directInvite(s,n),this.modal.hide()):this.model.set({invalid_invite_jid:!0})}});var XR=s(1709),ZR={};ZR.styleTagTransform=I(),ZR.setAttributes=j(),ZR.insert=C().bind(null,"head"),ZR.domAPI=E(),ZR.insertStyleElement=O();A()(XR.A,ZR);XR.A&&XR.A.locals&&XR.A.locals;hm.elements.define("converse-list-filter",class extends VS{constructor(){super(),this.items=null,this.model=null,this.template=null,this.promise=Promise.resolve()}static get properties(){return{items:{type:Array},model:{type:Object},promise:{type:Promise},template:{type:Object}}}initialize(){this.liveFilter=Wu((e=>this.model.save({text:e.target.value})),250),this.listenTo(this.items,"add",(()=>this.requestUpdate())),this.listenTo(this.items,"destroy",(()=>this.requestUpdate())),this.listenTo(this.items,"remove",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>{this.dispatchUpdateEvent(),this.requestUpdate()})),this.promise.then((()=>this.requestUpdate())),this.requestUpdate()}render(){return this.shouldBeVisible()?this.template(this):""}dispatchUpdateEvent(){this.dispatchEvent(new CustomEvent("update",{detail:this.model.changed}))}changeChatStateFilter(e){e&&e.preventDefault();const t=this.querySelector(".state-type").value;this.model.save({state:t})}changeTypeFilter(e){e&&e.preventDefault();const t=e.target,s=t.closest("converse-icon")?.dataset.type||"items";if("state"===s){const e=this.querySelector(".state-type").value;this.model.save({type:s,state:e})}else{const e=this.querySelector(".items-filter").value;this.model.save({type:s,text:e})}}submitFilter(e){e?.preventDefault(),this.liveFilter()}isActive(){return"state"===this.model.get("type")||this.model.get("text")}shouldBeVisible(){return this.items?.length>=5||this.isActive()}clearFilter(e){e&&e.preventDefault(),this.model.save({text:""})}});const eD={offline:"Offline",unavailable:"Unavailable",xa:"Extended Away",away:"Away",dnd:"Do not disturb",chat:"Chattty",online:"Online"};let tD;function sD(e){tD||function(){let e;tD={},tD.owner={label:HS("Owner"),classname:"badge-groupchat"},tD.admin={label:HS("Admin"),classname:"badge-info"},tD.member={label:HS("Member"),classname:"badge-info"},tD.moderator={label:HS("Moderator"),classname:"badge-info"},tD.visitor={label:HS("Visitor"),classname:"badge-secondary"};for(let t=1;t<5&&(!e||Object.values(e).find((e=>e>1)));t++){const s={};for(const n of Object.values(tD))(!e||(e[n.shortlabel]??0)>=2)&&(n.shortlabel=n.label.substr(0,t).toLocaleUpperCase(),s[n.shortlabel]??=0,s[n.shortlabel]++);e=s}}();const t=tD[e];return t?fp`<span title="${t.label}" aria-label="${t.label}" class="badge ${t.classname??"badge-info"}">${t.shortlabel}</span>`:""}function nD(e){const t=e.get("role"),s=(e=>HS("Click to mention %1$s in your message.",e.get("nick")))(e),n=HS("This user is a moderator."),i=HS("This user can send messages in this groupchat."),r=HS("This user can NOT send messages in this groupchat."),o=e.get("jid")?`${e.get("jid")} `:"";return"moderator"===t?`${o}${n} ${s}`:"participant"===t?`${o}${i} ${s}`:"visitor"===t?`${o}${r} ${s}`:["visitor","participant","moderator"].includes(t)?void 0:`${o}${s}`}const iD=(e,t)=>{const s=t.get("affiliation"),n=eD[t.get("show")],i=t.get("role"),r=t.get("show");let o,a;[o,a]="online"===r?["fa fa-circle","chat-status-online"]:"dnd"===r?["fa fa-minus-circle","chat-status-busy"]:"away"===r?["fa fa-circle","chat-status-away"]:["fa fa-circle","chat-status-offline"];const c=BO(t);return fp`<li class="list-item occupant" id="${t.id}"><a @click="${s=>e.onOccupantClicked(s,t)}"><div class="row g-0"><div class="col-auto"><converse-avatar .model="${t}" class="avatar chat-msg__avatar" name="${t.getDisplayName()}" nonce="${t.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar><converse-icon title="${n}" color="var(--${a})" style="margin-top:-.1em" size="0.82em" class="${o} chat-status chat-status--avatar"></converse-icon>${c?fp`<span class="msgs-indicator badge">${c}</span>`:""}</div><div class="col occupant-nick-badge"><span class="occupant-nick" title="${nD(t)}" style="${xI(t)}">${t.getDisplayName()}</span> <span class="occupant-badges">${"owner"===s?sD("owner"):""} ${"admin"===s?sD("admin"):""} ${"member"===s?sD("member"):""} ${"moderator"===i?sD("moderator"):""} ${"visitor"===i?sD("visitor"):""} </span>${LT(async function(e){const t=await hm.hook("getOccupantActionButtons",e,[]);if(!t?.length)return"";const s=t.map((e=>fp`<button class="dropdown-item ${e.button_class}" @click="${e.handler}" type="button"><converse-icon class="${e.icon_class}" color="var(--foreground-color)" size="1em" aria-hidden="true"></converse-icon> ${e.i18n_text}</button>`));return fp`<converse-dropdown class="occupant-actions chatbox-btn" .items="${s}"></converse-dropdown>`}(t))}</div></div></a></li>`},rD=e=>{const t=HS("Filter"),s=HS("Filter by name"),n=HS("Filter by status"),i=HS("Any"),r=HS("Online"),o=HS("Chatty"),a=HS("Busy"),c=HS("Away"),l=HS("Extended Away"),d=HS("Offline"),u=e.model.get("state"),h=e.model.get("text"),m=e.model.get("type"),g="overlayed"===hm.settings.get("view_mode");return fp`<form class="items-filter-form input-button-group ${e.shouldBeVisible()?"fade-in":"hidden"}" @submit="${t=>e.submitFilter(t)}"><div class="${g?"":"flex-nowrap"}"><div class="filter-by d-flex flex-nowrap"><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-user clickable ${"items"===m?"selected":""}" data-type="items" title="${s}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-circle clickable ${"state"===m?"selected":""}" data-type="state" title="${n}"></converse-icon></div><div class="btn-group"><input .value="${h||""}" @keydown="${t=>e.liveFilter(t)}" class="items-filter form-control ${"state"===m?"hidden":""}" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${h&&"state"!==m?"":"hidden"}" @click="${t=>e.clearFilter(t)}"></converse-icon></div><select class="form-control state-type ${"state"!==m?"hidden":""}" @change="${t=>e.changeChatStateFilter(t)}"><option value="">${i}</option><option ?selected="${"online"===u}" value="online">${r}</option><option ?selected="${"chat"===u}" value="chat">${o}</option><option ?selected="${"dnd"===u}" value="dnd">${a}</option><option ?selected="${"away"===u}" value="away">${c}</option><option ?selected="${"xa"===u}" value="xa">${l}</option><option ?selected="${"offline"===u}" value="offline">${d}</option></select></div></form>`};const oD=e=>{const t=1===e.model.occupants?HS("Participant"):HS("Participants"),s=HS("Hide"),n=HS("Show filter"),i=HS("Hide filter"),r=e.model.get("filter_visible"),o=HS("Invite someone"),a=HS("Invite someone to join this groupchat"),c=[];return e.model.invitesAllowed()&&c.push(fp`<a href="#" class="dropdown-item open-invite-modal" role="button" title="${a}" @click="${t=>e.showInviteModal(t)}"><converse-icon size="1em" class="fa fa-user-plus"></converse-icon>${o}</a>`),e.model.occupants.length>5&&c.push(fp`<a href="#" class="dropdown-item toggle-filter" role="button" @click="${t=>e.toggleFilter(t)}"><converse-icon size="1em" class="fa fa-filter"></converse-icon>${r?i:n}</a>`),c.length?c.push(fp`<a href="#" class="dropdown-item" role="button" @click="${t=>e.closeSidebar(t)}"><converse-icon size="1em" class="fa fa-times"></converse-icon>${s}</a>`):c.push(fp`<i class="hide-occupants" @click="${t=>e.closeSidebar(t)}"><converse-icon class="fa fa-times" size="1em"></converse-icon></i>`),fp`<div class="occupants"><div class="occupants-header"><div class="occupants-header--title"><span class="occupants-heading sidebar-heading">${e.model.occupants.length} ${t}</span> ${1===c.length?c[0]:fp`<converse-dropdown class="chatbox-btn btn-group dropstart" .items="${c}"></converse-dropdown>`}</div></div><ul class="items-list occupant-list">${r?fp`<converse-list-filter @update="${()=>e.requestUpdate()}" .promise="${e.model.initialized}" .items="${e.model.occupants}" .template="${rD}" .model="${e.filter}"></converse-list-filter>`:""} ${kO(e.model.occupants.models,(e=>e.get("jid")),(t=>function(e,t){if(!e.model.get("filter_visible"))return!1;const s=e.filter.get("type"),n="state"===s?e.filter.get("state").toLowerCase():e.filter.get("text").toLowerCase();if(!n)return!1;if("state"===s){const e=t.get("show");return"online"===n?["offline","unavailable"].includes(e):!e.includes(n)}return"items"===s?!t.getDisplayName().toLowerCase().includes(n):void 0}(e,t)?"":iD(e,t)))}</ul></div>`};var aD=s(9613),cD={};cD.styleTagTransform=I(),cD.setAttributes=j(),cD.insert=C().bind(null,"head"),cD.domAPI=E(),cD.insertStyleElement=O();A()(aD.A,cD);aD.A&&aD.A.locals&&aD.A.locals;hm.elements.define("converse-occupant-bottom-panel",class extends vM{static get properties(){return{model:{type:Object,noAccessor:!0},muc:{type:Object}}}constructor(){super(),this.muc=null}async initialize(){await super.initialize(),this.listenTo(this.muc.session,"change:connection_status",(()=>this.requestUpdate()))}render(){return this.model?(e=>{const t=HS("You have unread messages"),s=e.muc.session.get("connection_status"),n=HS("This user is not currently in this groupchat and can't receive messages."),i=HS("Invite this user to join this groupchat"),r=HS("Open a one-on-one chat with this user"),o=HS("Open Chat"),a=HS("Invite");return s===Cf.ROOMSTATUS.ENTERED?fp`${e.muc.ui.get("scrolled")&&e.model.get("num_unread")?fp`<div class="new-msgs-indicator" @click="${t=>e.viewUnreadMessages(t)}">▼ ${t} ▼</div>`:""} ${e.canPostMessages()?fp`<converse-muc-message-form .model="${e.model}"></converse-muc-message-form>`:fp`<div class="bottom-panel bottom-panel--muted"><p class="bottom-panel--muted__msg">${n}</p>${e.model.get("jid")?fp`<button @click="${e.openChat}" type="button" class="btn btn-primary" title="${r}">${o}</button> <button @click="${e.invite}" type="button" class="btn btn-secondary" title="${i}">${a}</button>`:""}</div>`}`:""})(this):""}canPostMessages(){return this.muc.isEntered()&&"offline"!==this.model.get("show")}openChat(){const e=this.model.get("jid");return e?hm.chats.open(e,{},!0):hm.alert("error",HS("Error"),"Could not find XMPP address")}invite(){const e=this.model.get("jid");return hm.listen.once("roomInviteSent",(()=>hm.alert("info",HS("Success"),HS("The user has been invited to join this groupchat")))),e?this.muc.directInvite(e):hm.alert("error",HS("Error"),"Could not find XMPP address")}});var lD=s(3952),dD={};dD.styleTagTransform=I(),dD.setAttributes=j(),dD.insert=C().bind(null,"head"),dD.domAPI=E(),dD.insertStyleElement=O();A()(lD.A,dD);lD.A&&lD.A.locals&&lD.A.locals;const{u:uD}=Cf.env;hm.elements.define("converse-muc-occupant",class extends VS{constructor(){super(),this.muc_jid=null,this.occupant_id=null}static get properties(){return{muc_jid:{type:String},occupant_id:{type:String}}}async initialize(){super.initialize();const{chatboxes:e}=Bu.state;this.muc=e.get(this.muc_jid),await this.muc.initialized,this.model=this.muc.occupants.get(this.occupant_id),this.requestUpdate()}render(){return this.muc?(e=>{const t=HS("Hide"),s=HS("No participant data found"),n=HS("Participants"),i=HS("Show details"),r=e.model?.get("jid"),o=e.model?.get("nick"),a=Ef.firstCharToUpperCase(e.model?.get("role")),c=Ef.firstCharToUpperCase(e.model?.get("affiliation")),l=e.model?.get("hats")?.length?e.model.get("hats").map((({title:e})=>e)):[];return fp`<span class="sidebar-occupant"><div class="sidebar-heading"><span><button type="button" class="btn btn--transparent back-button" @click="${()=>e.muc.save({sidebar_view:"occupants"})}"><converse-icon size="1em" class="fa fa-arrow-left"></converse-icon></button> <a @click="${t=>{t.preventDefault(),e.muc.save({sidebar_view:"occupants"})}}">${n}</a></span><converse-dropdown .items="${[fp`<a class="dropdown-item show-occupant-modal" role="button" title="${i}" @click="${()=>e.showOccupantModal()}"><converse-icon class="fa fa-id-card" size="1em"></converse-icon>${i}</a>`,fp`<a href="#" class="dropdown-item" role="button" @click="${()=>e.closeSidebar()}"><converse-icon size="1em" class="fa fa-times"></converse-icon>${t}</a>`]}"></converse-dropdown></div>${e.model?fp`<div class="row"><div class="col"><converse-avatar .model="${e.model}" class="avatar modal-avatar justify-content-center" name="${e.model.getDisplayName()}" nonce="${e.getVcard()?.get("vcard_updated")}" height="120" width="120"></converse-avatar></div></div>`:""}<ul class="occupant-details">${e.model?fp`${o?fp`<li class="occupant-details-nickname">${o}</li>`:""}<li class="occupant-details-jid">${r?fp`<a @click="${()=>e.openChat(r)}">${r}</a>`:""}</li><li>${c&&"None"!==c?fp`<span class="badge text-bg-primary">${c}</span>`:""} ${a?fp`<span class="badge text-bg-secondary">${a}</span>`:""} ${l.length?fp`${l.map((e=>fp`<span class="badge text-bg-info">${e}</span>`))}`:""}</li>`:fp`<li>${s}</li>`}</ul>${e.model?fp`<div class="chat-body"><div class="chat-content chat-content-sendbutton" aria-live="polite"><converse-chat-content class="chat-content__messages" .model="${e.model}"></converse-chat-content></div><converse-occupant-bottom-panel .model="${e.model}" .muc="${e.muc}" class="bottom-panel"></converse-occupant-bottom-panel></div>`:""}</span>`})(this):""}openChat(e){hm.chats.open(e,{},!0)}closeSidebar(){uD.safeSave(this.muc,{hidden_occupants:!0})}showOccupantModal(e){e?.preventDefault?.(),hm.modal.show("converse-muc-occupant-modal",{model:this.model},e)}getVcard(){const e=this.model;if(e.vcard)return e.vcard;const t=e?.get("jid")||e?.get("from");return t?Bu.state.vcards.get(t):null}addToContacts(){const e=this.model.get("jid");e&&hm.modal.show("converse-add-contact-modal",{model:new fd({jid:e})})}toggleForm(e){"row-form"===uD.ancestor(e.target,".toggle-form").getAttribute("data-form")?this.show_role_form=!this.show_role_form:this.show_affiliation_form=!this.show_affiliation_form,this.render()}});var hD=s(8945),mD={};mD.styleTagTransform=I(),mD.setAttributes=j(),mD.insert=C().bind(null,"head"),mD.domAPI=E(),mD.insertStyleElement=O();A()(hD.A,mD);hD.A&&hD.A.locals&&hD.A.locals;var gD=s(33),pD={};pD.styleTagTransform=I(),pD.setAttributes=j(),pD.insert=C().bind(null,"head"),pD.domAPI=E(),pD.insertStyleElement=O();A()(gD.A,pD);gD.A&&gD.A.locals&&gD.A.locals;const{initStorage:fD}=Ef;hm.elements.define("converse-muc-occupants",class extends VS{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}initialize(){const e=`_converse.occupants-filter-${this.jid}`;this.filter=new cw,this.filter.id=e,fD(this.filter,e),this.filter.fetch();const{chatboxes:t}=Bu.state;this.model=t.get(this.jid);const s=Wu((()=>this.requestUpdate()),200,{maxWait:1e3});this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"add",s),this.listenTo(this.model.occupants,"remove",s),this.listenTo(this.model.occupants,"change",s),this.listenTo(this.model.occupants,"sort",s),this.listenTo(this.model.occupants,"vcard:change",s),this.listenTo(this.model.occupants,"vcard:add",s),this.listenTo(this.model.features,"change:open",(()=>this.requestUpdate())),this.model.initialized.then((()=>this.requestUpdate()))}render(){return oD(this)}showInviteModal(e){e.preventDefault(),hm.modal.show("converse-muc-invite-modal",{model:new fd,muc:this.model},e)}toggleFilter(e){e?.preventDefault?.(),Ef.safeSave(this.model,{filter_visible:!this.model.get("filter_visible")})}closeSidebar(e){e?.preventDefault?.(),Ef.safeSave(this.model,{hidden_occupants:!0})}onOccupantClicked(e,t){e.preventDefault(),this.model.getOwnOccupant()===t?hm.modal.show("converse-profile-modal",{model:Bu.state.xmppstatus},e):this.model.save({sidebar_view:`occupant:${t.id}`})}});var vD=s(8853),_D={};_D.styleTagTransform=I(),_D.setAttributes=j(),_D.insert=C().bind(null,"head"),_D.domAPI=E(),_D.insertStyleElement=O();A()(vD.A,_D);vD.A&&vD.A.locals&&vD.A.locals;hm.elements.define("converse-muc-sidebar",class extends VS{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}initialize(){const{chatboxes:e}=Bu.state;this.model=e.get(this.jid),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model.features,"change:open",(()=>this.requestUpdate())),this.model.initialized.then((()=>this.requestUpdate()))}render(){return(e=>{const t=e.model.get("sidebar_view")||"",s=t.split("occupant:").pop();return fp`${t?.startsWith("occupant:")?fp`<converse-muc-occupant muc_jid="${e.jid}" occupant_id="${s}"></converse-muc-occupant>`:fp`<converse-muc-occupants jid="${e.jid}"></converse-muc-occupants>`}`})(this)}closeSidebar(e){e?.preventDefault?.(),Ef.safeSave(this.model,{hidden_occupants:!0})}});var bD=s(4641),yD={};yD.styleTagTransform=I(),yD.setAttributes=j(),yD.insert=C().bind(null,"head"),yD.domAPI=E(),yD.insertStyleElement=O();A()(bD.A,yD);bD.A&&bD.A.locals&&bD.A.locals;hm.elements.define("converse-muc-chat-content",class extends BI{async initialize(){await super.initialize(),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model.occupants,"change",(()=>this.requestUpdate()))}});const{CHATROOMS_TYPE:wD}=DS;hm.elements.define("converse-muc-chatarea",class extends VS{static get properties(){return{jid:{type:String},show_help_messages:{type:Boolean},type:{type:String}}}constructor(){super(),this.jid=null,this.type=null,this.split=null}async initialize(){this.model=await hm.rooms.get(this.jid),this.listenTo(this.model,"change:show_help_messages",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden_occupants",(()=>this.requestUpdate())),this.listenTo(this.model.session,"change:connection_status",(()=>this.requestUpdate())),this.requestUpdate()}render(){return this.model?(e=>{const t=hm.settings.get("show_send_button");let s,n;return"overlayed"===hm.settings.get("view_mode")?(s="d-none d-md-flex col-s-10 col-md-8",n="col-xs-12 col-s-2 col-md-4"):(s="d-none d-md-flex col-md-8 col-xl-10",n="col-xs-12 col-md-4 col-xl-2"),fp`<div class="chat-area ${e.shouldShowSidebar()?s:"col-xs-12"}"><div class="chat-content ${t?"chat-content-sendbutton":""}" aria-live="polite"><converse-muc-chat-content class="chat-content__messages" .model="${e.model}"></converse-muc-chat-content>${e.model?.get("show_help_messages")?fp`<div class="chat-content__help"><converse-chat-help .model="${e.model}" .messages="${e.getHelpMessages()}" type="info" chat_type="${wD}"></converse-chat-help></div>`:""}</div><converse-muc-bottom-panel .model="${e.model}" class="bottom-panel"></converse-muc-bottom-panel></div>${e.model?fp`<converse-split-resize></converse-split-resize><converse-muc-sidebar class="${e.shouldShowSidebar()?n:"col-xs-0 hidden"}" jid="${e.jid}"></converse-muc-sidebar>`:""}`})(this):""}shouldShowSidebar(){return!this.model.get("hidden_occupants")&&this.model.session.get("connection_status")===Cf.ROOMSTATUS.ENTERED}getHelpMessages(){const e=hm.settings.get("muc_disable_slash_commands"),t=Array.isArray(e)?e:[];return[`<strong>/admin</strong>: ${HS("Change user's affiliation to admin")}`,`<strong>/ban</strong>: ${HS("Ban user by changing their affiliation to outcast")}`,`<strong>/clear</strong>: ${HS("Clear the chat area")}`,`<strong>/close</strong>: ${HS("Close this groupchat")}`,`<strong>/deop</strong>: ${HS("Change user role to participant")}`,`<strong>/destroy</strong>: ${HS("Remove this groupchat")}`,`<strong>/help</strong>: ${HS("Show this menu")}`,`<strong>/kick</strong>: ${HS("Kick user from groupchat")}`,`<strong>/me</strong>: ${HS("Write in 3rd person")}`,`<strong>/member</strong>: ${HS("Grant membership to a user")}`,`<strong>/modtools</strong>: ${HS("Opens up the moderator tools GUI")}`,`<strong>/mute</strong>: ${HS("Remove user's ability to post messages")}`,`<strong>/nick</strong>: ${HS("Change your nickname")}`,`<strong>/op</strong>: ${HS("Grant moderator role to user")}`,`<strong>/owner</strong>: ${HS("Grant ownership of this groupchat")}`,`<strong>/register</strong>: ${HS("Register your nickname")}`,`<strong>/revoke</strong>: ${HS("Revoke the user's current affiliation")}`,`<strong>/subject</strong>: ${HS("Set groupchat subject")}`,`<strong>/topic</strong>: ${HS("Set groupchat subject (alias for /subject)")}`,`<strong>/voice</strong>: ${HS("Allow muted user to post messages")}`].filter((e=>t.every((t=>!e.startsWith(t+"<",9))))).filter((e=>this.model.getAllowedCommands().some((t=>e.startsWith(t+"<",9)))))}});const SD=e=>{const t=HS("This groupchat no longer exists"),s=HS('The following reason was given: "%1$s"',e.reason||"");return fp`<div class="alert alert-danger"><h3 class="alert-heading disconnect-msg">${t}</h3></div>${e.reason?fp`<p class="destroyed-reason">${s}</p>`:""} ${e.moved_jid?(e=>{const t=HS("The conversation has moved to a new address. Click the link below to enter.");return fp`<p class="moved-label">${t}</p><p class="moved-link"><a class="switch-chat" @click="${t=>e.onSwitch(t)}">${e.moved_jid}</a></p>`})(e):""}`};hm.elements.define("converse-muc-destroyed",class extends VS{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=Bu.state.chatboxes.get(this.jid)}render(){const e=this.model.get("destroyed_reason"),t=this.model.get("moved_jid");return SD({moved_jid:t,reason:e,onSwitch:e=>this.onSwitch(e)})}async onSwitch(e){e.preventDefault();const t=this.model.get("moved_jid");(await hm.rooms.get(t,{},!0)).maybeShow(!0),this.model.destroy()}});hm.elements.define("converse-muc-disconnected",class extends VS{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}connectedCallback(){super.connectedCallback(),this.model=Bu.state.chatboxes.get(this.jid)}render(){const e=this.model.session.get("disconnection_message");if(!e)return;const t=[e],s=this.model.session.get("disconnection_actor");s&&t.push(HS("This action was done by %1$s.",s));const n=this.model.session.get("disconnection_reason");return n&&t.push(HS('The reason given is: "%1$s".',n)),(e=>fp`<div class="alert alert-danger"><h3 class="alert-heading disconnect-msg">${e[0]}</h3>${e.slice(1).map((e=>fp`<p class="disconnect-msg">${e}</p>`))}</div>`)(t)}});const AD=HS("Click to set a new picture");hm.elements.define("converse-image-picker",class extends VS{constructor(){super(),this.model=null,this.width=null,this.height=null,this.data=new fd,this.nonce=null}static get properties(){return{height:{type:Number},model:{type:Object},width:{type:Number}}}render(){return fp`<a class="change-avatar" @click="${this.openFileSelection}" title="${AD}"><converse-avatar .model="${this.model}" .pickerdata="${this.data}" class="avatar" name="${this.model.getDisplayName()}" height="${this.height}" nonce="${this.nonce||this.model.vcard?.get("vcard_updated")}" width="${this.width}"></converse-avatar></a><input @change="${this.updateFilePreview}" class="hidden" name="avatar_image" type="file">`}openFileSelection(e){e.preventDefault(),this.querySelector('input[type="file"]').click()}updateFilePreview(e){const t=e.target.files[0],s=new FileReader;s.onloadend=()=>{this.data.set({data_uri:s.result,image_type:t.type}),this.nonce=(new Date).toISOString(),this.requestUpdate()},s.readAsDataURL(t)}});var xD=s(998),ED={};ED.styleTagTransform=I(),ED.setAttributes=j(),ED.insert=C().bind(null,"head"),ED.domAPI=E(),ED.insertStyleElement=O();A()(xD.A,ED);xD.A&&xD.A.locals&&xD.A.locals;const $D=Cf.env.utils;var CD=s(4026),kD=s.n(CD);const jD={aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",cda:"application/x-cdf",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",gz:"application/gzip",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",m4a:"audio/mp4",mid:"audio/midi",midi:"audio/midi",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"text/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"};async function TD(e){if(e.type===jD.png){const t=new FileReader;return await new Promise((s=>{t.onloadend=e=>{const t=new DataView(e.target.result);if(2303741511===t.getUint32(0)&&218765834===t.getUint32(4)){const e=t.getUint8(25);s(e===4||e===6)}s(!1)},t.readAsArrayBuffer(e)}))}return!1}async function OD(e,t={targetSize:.1,quality:.75,maxWidth:256,maxHeight:256}){const s=new(kD())(t),n=await s.compress([e]),{photo:i}=n[0];return i.data}const{sizzle:ND}=Cf.env,ID=Cf.env.utils;hm.elements.define("converse-muc-config-modal",class extends uj{constructor(e){super(e),this.id="converse-muc-config-modal"}initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render())),this.listenTo(this.model.features,"change:passwordprotected",(()=>this.render())),this.listenTo(this.model.session,"change:config_stanza",(()=>this.render()))}renderModal(){return(e=>{const t=hm.settings.get("roomconfig_whitelist");let s=[],n="",i=HS("Loading configuration form");const r=e.model.session.get("config_stanza");if(r){const o=$D.toStanza(r);let{fields:a}=Zf(o);t.length&&(a=a.filter((e=>t.includes(e.var))));const c={new_password:!e.model.features.get("passwordprotected"),fixed_username:e.model.get("jid")};s=a.map((e=>$D.xFormField2TemplateResult(e,c))),n=o.querySelector("instructions")?.textContent,i=o.querySelector("title")?.textContent}const o=HS("Save");return fp`<form class="converse-form chatroom-form ${s.length?"":"converse-form--spinner"}" autocomplete="off" @submit="${t=>e.submitConfigForm(t)}"><fieldset><legend class="centered">${i}</legend>${i!==n?fp`<p class="form-help">${n}</p>`:""} ${s.length&&e.model.features.get("vcard-temp")?fp`<div class="row py-2"><converse-image-picker .model="${e.model}" width="96" height="96"></converse-image-picker></div>`:""} ${s.length?s:vT({classes:"hor_centered"})}</fieldset>${s.length?fp`<fieldset><input type="submit" class="btn btn-primary" value="${o}"></fieldset>`:""}</form>`})(this)}connectedCallback(){super.connectedCallback(),this.getConfig()}getModalTitle(){return HS("Configure %1$s",this.model.getDisplayName())}async getConfig(){const e=await this.model.fetchRoomConfiguration();this.model.session.set("config_stanza",e.outerHTML)}async setAvatar(e){if(!this.model.features.get("vcard-temp"))return;const t=new FormData(e.target).get("avatar_image");if(t?.size){const e=TD?t:await OD(t),s=new FileReader;s.onloadend=async()=>{const e={image:btoa(s.result),image_type:t.type};await hm.vcard.set(this.model.get("jid"),e)},s.readAsBinaryString(e)}}async submitConfigForm(e){e.preventDefault();const t=ND(':input:not([type=button]):not([type=submit]):not([name="avatar_image"][type="file"])',e.target).map(ID.webForm2xForm).filter((e=>e));try{await this.model.sendConfiguration(t)}catch(e){Ct.error(e);const t=HS("Sorry, an error occurred while trying to submit the config form.")+" "+HS("Check your browser's developer console for details.");hm.alert("error",HS("Error"),t)}try{await this.setAvatar(e)}catch(e){return Ct.fatal(e),void this.alert([HS("Sorry, an error happened while trying to save the groupchat avatar."),HS("You can check your browser's developer console for any error output.")].join(" "))}await this.model.refreshDiscoInfo(),this.modal.hide()}});const MD=e=>{const t=e.config.toJSON(),s=e.features.toJSON(),n=e.occupants.filter((e=>"offline"!==e.get("show"))).length,i=HS("XMPP address"),r=HS("Message archiving"),o=HS("Messages are archived on the server"),a=HS("Description"),c=HS("Features"),l=HS("Hidden"),d=HS("This groupchat is not publicly searchable"),u=HS("This groupchat is restricted to members only"),h=HS("Members only"),m=HS("Moderated"),g=HS("Participants entering this groupchat need to request permission to write"),p=HS("Name"),f=HS("This groupchat does not require a password upon entry"),v=HS("No password required"),_=HS("Not anonymous"),b=HS("All other groupchat participants can see your XMPP address"),y=HS("Not moderated"),w=HS("Participants entering this groupchat can write right away"),S=HS("Online users"),A=HS("Open"),x=HS("Anyone can join this groupchat"),E=HS("This groupchat requires a password before entry"),$=HS("Password protected"),C=HS("Persistent"),k=HS("This groupchat persists even if it's unoccupied"),j=HS("Public"),T=HS("This groupchat is publicly searchable"),O=HS("Semi-anonymous"),N=HS("Only moderators can see your XMPP address"),I=HS("Temporary"),M=HS("This groupchat will disappear once the last person leaves");return fp`<div class="room-info"><converse-avatar .model="${e}" class="avatar align-self-center" name="${e.getDisplayName()}" nonce="${e.vcard?.get("vcard_updated")}" height="72" width="72"></converse-avatar><p class="room-info"><strong>${p}</strong>: ${e.get("name")}</p><p class="room-info"><strong>${i}</strong>:<converse-texture text="xmpp:${e.get("jid")}?join"></converse-texture></p><br><p class="room-info"><strong>${a}</strong>:<converse-texture text="${t.description}" render_styling></converse-texture></p>${e.get("subject")?(e=>{const t=e.get("subject"),s=HS("Topic"),n=HS("Topic author");return fp`<p class="room-info"><strong>${s}</strong>:<converse-texture text="${t.text}" render_styling></converse-texture></p><p class="room-info"><strong>${n}</strong>: ${t&&t.author}</p>`})(e):""}<p class="room-info"><strong>${S}</strong>: ${n}</p><p class="room-info"><strong>${c}</strong>:</p><div class="chatroom-features"><ul class="features-list">${s.passwordprotected?fp`<li class="feature"><converse-icon size="1em" class="fa fa-lock"></converse-icon>${$} - <em>${E}</em></li>`:""} ${s.unsecured?fp`<li class="feature"><converse-icon size="1em" class="fa fa-unlock"></converse-icon>${v} - <em>${f}</em></li>`:""} ${s.hidden?fp`<li class="feature"><converse-icon size="1em" class="fa fa-eye-slash"></converse-icon>${l} - <em>${d}</em></li>`:""} ${s.public_room?fp`<li class="feature"><converse-icon size="1em" class="fa fa-eye"></converse-icon>${j} - <em>${T}</em></li>`:""} ${s.membersonly?fp`<li class="feature"><converse-icon size="1em" class="fa fa-address-book"></converse-icon>${h} - <em>${u}</em></li>`:""} ${s.open?fp`<li class="feature"><converse-icon size="1em" class="fa fa-globe"></converse-icon>${A} - <em>${x}</em></li>`:""} ${s.persistent?fp`<li class="feature"><converse-icon size="1em" class="fa fa-save"></converse-icon>${C} - <em>${k}</em></li>`:""} ${s.temporary?fp`<li class="feature"><converse-icon size="1em" class="fa fa-snowflake"></converse-icon>${I} - <em>${M}</em></li>`:""} ${s.nonanonymous?fp`<li class="feature"><converse-icon size="1em" class="fa fa-id-card"></converse-icon>${_} - <em>${b}</em></li>`:""} ${s.semianonymous?fp`<li class="feature"><converse-icon size="1em" class="fa fa-user-secret"></converse-icon>${O} - <em>${N}</em></li>`:""} ${s.moderated?fp`<li class="feature"><converse-icon size="1em" class="fa fa-gavel"></converse-icon>${m} - <em>${g}</em></li>`:""} ${s.unmoderated?fp`<li class="feature"><converse-icon size="1em" class="fa fa-info-circle"></converse-icon>${y} - <em>${w}</em></li>`:""} ${s.mam_enabled?fp`<li class="feature"><converse-icon size="1em" class="fa fa-database"></converse-icon>${r} - <em>${o}</em></li>`:""}</ul></div><p></p></div>`};var RD=s(8011),DD={};DD.styleTagTransform=I(),DD.setAttributes=j(),DD.insert=C().bind(null,"head"),DD.domAPI=E(),DD.insertStyleElement=O();A()(RD.A,DD);RD.A&&RD.A.locals&&RD.A.locals;hm.elements.define("converse-muc-details-modal",class extends uj{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render())),this.listenTo(this.model.features,"change",(()=>this.render())),this.listenTo(this.model.occupants,"add",(()=>this.render())),this.listenTo(this.model.occupants,"change",(()=>this.render()))}renderModal(){return MD(this.model)}getModalTitle(){return HS("Groupchat info",this.model.getDisplayName())}});hm.elements.define("converse-muc-nickname-modal",class extends uj{renderModal(){return fp`<converse-muc-nickname-form jid="${this.model.get("jid")}"></converse-muc-nickname-form>`}getModalTitle(){return HS("Change your nickname")}});var zD=s(8283),LD={};LD.styleTagTransform=I(),LD.setAttributes=j(),LD.insert=C().bind(null,"head"),LD.domAPI=E(),LD.insertStyleElement=O();A()(zD.A,LD);zD.A&&zD.A.locals&&zD.A.locals;customElements.define("converse-texture",class extends Mp{static get properties(){return{embed_audio:{type:Boolean},embed_videos:{type:Boolean},mentions:{type:Array},nick:{type:String},offset:{type:Number},onImgClick:{type:Function},onImgLoad:{type:Function},render_styling:{type:Boolean},show_images:{type:Boolean},hide_media_urls:{type:Boolean},show_me_message:{type:Boolean},text:{type:String}}}createRenderRoot(){return this}constructor(){super(),this.nick=null,this.onImgClick=null,this.onImgLoad=null,this.text=null,this.embed_audio=!1,this.embed_videos=!1,this.hide_media_urls=!1,this.mentions=[],this.offset=0,this.render_styling=!1,this.show_image_urls=!0,this.show_images=!1,this.show_me_message=!1}render(){const e={embed_audio:this.embed_audio,embed_videos:this.embed_videos,hide_media_urls:this.hide_media_urls,mentions:this.mentions,nick:this.nick,onImgClick:this.onImgClick,onImgLoad:this.onImgLoad,render_styling:this.render_styling,show_images:this.show_images,show_me_message:this.show_me_message};return BN(this.text,this.offset,e)}});var PD=s(8185),FD={};FD.styleTagTransform=I(),FD.setAttributes=j(),FD.insert=C().bind(null,"head"),FD.domAPI=E(),FD.insertStyleElement=O();A()(PD.A,FD);PD.A&&PD.A.locals&&PD.A.locals;hm.elements.define("converse-muc-heading",class extends VS{async initialize(){const{chatboxes:e}=Bu.state;this.model=e.get(this.getAttribute("jid")),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.user_settings=await Bu.api.user.settings.getModel(),this.listenTo(this.user_settings,"change:mucs_with_hidden_subject",(()=>this.requestUpdate())),await this.model.initialized,this.model.occupants.forEach((e=>this.onOccupantAdded(e))),this.listenTo(this.model.occupants,"add",this.onOccupantAdded),this.listenTo(this.model.occupants,"change:affiliation",this.onOccupantAffiliationChanged),this.requestUpdate()}render(){return this.model&&this.user_settings?(e=>{const t=e.model.toJSON(),s=e.user_settings?.get("mucs_with_hidden_subject",[])?.includes(e.model.get("jid")),n=e.getHeadingButtons(s),i=HS("Hide the groupchat topic"),r=HS("This groupchat is bookmarked"),o=t.subject?t.subject.text:"",a=o&&!s;return fp`<div class="chatbox-title ${a?"":"chatbox-title--no-desc"}"><a data-room-jid="${e.model.get("jid")}" title="${HS("Show more information on this groupchat")}" @click="${t=>e.showRoomDetailsModal(t)}"><converse-avatar .model="${e.model}" class="avatar align-self-center" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></a><div class="chatbox-title--row">${Bu.api.settings.get("singleton")?"":fp`<converse-controlbox-navback jid="${t.jid}"></converse-controlbox-navback>`}<div class="chatbox-title__text" role="heading" aria-level="2" title="${"hidden"!==hm.settings.get("locked_muc_domain")?t.jid:""}">${e.model.getDisplayName()} ${t.bookmarked?fp`<converse-icon class="fa fa-bookmark chatbox-title__text--bookmarked" size="1em" color="var(--muc-color)" title="${r}"></converse-icon>`:""}</div></div><div class="chatbox-title__buttons btn-toolbar g-0">${LT(qO(n),"")} ${LT(HO(n),"")}</div></div>${a?fp`<p class="chat-head__desc" title="${i}"><converse-texture text="${o}" render_styling embed_audio></converse-texture></p>`:""}`})(this):""}onOccupantAdded(e){const t=Bu.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}onOccupantAffiliationChanged(e){const t=Bu.session.get("bare_jid");e.get("jid")===t&&this.requestUpdate()}showRoomDetailsModal(e){e.preventDefault(),hm.modal.show("converse-muc-details-modal",{model:this.model},e)}toggleTopic(e){e?.preventDefault?.(),this.model.toggleSubjectHiddenState()}toggleOccupants(e){e?.preventDefault?.(),e?.stopPropagation?.(),this.model.save({hidden_occupants:!this.model.get("hidden_occupants")})}showConfigModal(e){e.preventDefault(),hm.modal.show("converse-muc-config-modal",{model:this.model},e)}close(e){e.preventDefault(),this.model.close()}destroy(e){e.preventDefault(),rO(this.model)}getHeadingButtons(e){const t=[];t.push({i18n_text:HS("Details"),i18n_title:HS("Show more information about this groupchat"),handler:e=>this.showRoomDetailsModal(e),a_class:"show-muc-details-modal",icon_class:"fa-info-circle",name:"details"}),"owner"===this.model.getOwnAffiliation()&&t.push({i18n_text:HS("Configure"),i18n_title:HS("Configure this groupchat"),handler:e=>this.showConfigModal(e),a_class:"configure-chatroom-button",icon_class:"fa-wrench",name:"configure"}),t.push({i18n_text:HS("Nickname"),i18n_title:HS("Change the nickname you're using in this groupchat"),handler:e=>hm.modal.show("converse-muc-nickname-modal",{model:this.model},e),a_class:"open-nickname-modal",icon_class:"fa-smile",name:"nickname"});const s=this.model.get("subject");s&&s.text&&t.push({i18n_text:HS(e?"Show topic":"Hide topic"),i18n_title:HS(e?"Show the topic message in the heading":"Hide the topic in the heading"),handler:e=>this.toggleTopic(e),a_class:"hide-topic",icon_class:"fa-minus-square",name:"toggle-topic"}),t.push({i18n_text:this.model.get("hidden_occupants")?HS("Show participants"):HS("Hide participants"),i18n_title:this.model.get("hidden_occupants")?HS("Show the groupchat participants"):HS("Hide the groupchat participants"),handler:e=>this.toggleOccupants(e),icon_class:"fa-users"});if(this.model.session.get("connection_status")===Cf.ROOMSTATUS.ENTERED){const e=this.model.getAllowedCommands();e.includes("modtools")&&t.push({i18n_text:HS("Moderate"),i18n_title:HS("Moderate this groupchat"),handler:()=>dO(this.model),a_class:"moderate-chatroom-button",icon_class:"fa-user-cog",name:"moderate"}),e.includes("destroy")&&t.push({i18n_text:HS("Destroy"),i18n_title:HS("Remove this groupchat"),handler:e=>this.destroy(e),a_class:"destroy-chatroom-button",icon_class:"fa-trash",name:"destroy"})}hm.settings.get("singleton")||t.push({i18n_text:HS("Leave"),i18n_title:HS("Leave and close this groupchat"),handler:async e=>{e.stopPropagation();const t=[HS("Are you sure you want to leave this groupchat?")];await hm.confirm(HS("Confirm"),t)&&this.close(e)},a_class:"close-chatbox-button",standalone:"overlayed"===hm.settings.get("view_mode"),icon_class:"fa-sign-out-alt",name:"signout"});const{chatboxviews:n}=Bu.state,i=n.get(this.getAttribute("jid"));return i?Bu.api.hook("getHeadingButtons",i,t):Promise.resolve(t)}});class UD extends VS{static get properties(){return{jid:{type:String}}}constructor(){super(),this.jid=null}connectedCallback(){super.connectedCallback();const{chatboxes:e}=Bu.state;this.model=e.get(this.jid),this.listenTo(this.model,"change:password_validation_message",this.render),this.render()}render(){return(e=>{const t=HS("This groupchat requires a password"),s=HS("Password: "),n=HS("Submit");return fp`<form class="converse-form chatroom-form converse-centered-form" @submit="${e.submitPassword}"><fieldset><label class="form-label">${t}</label><p class="validation-message">${e.validation_message}</p><input class="hidden-username" aria-hidden="true" type="text" autocomplete="username" value="${e.jid}"><input type="password" name="password" required="required" class="form-control ${e.validation_message?"error":""}" placeholder="${s}"></fieldset><fieldset><input class="btn btn-primary" type="submit" value="${n}"></fieldset></form>`})({jid:this.model.get("jid"),submitPassword:e=>this.submitPassword(e),validation_message:this.model.get("password_validation_message")})}submitPassword(e){e.preventDefault();const t=this.querySelector("input[type=password]").value;this.model.join(this.model.get("nick"),t),this.model.set("password_validation_message",null)}}hm.elements.define("converse-muc-password-form",UD);class BD extends yM{length=300;is_chatroom=!0;async initialize(){this.model=await hm.rooms.get(this.jid),Bu.state.chatboxviews.add(this.jid,this),this.setAttribute("id",this.model.get("box_id")),this.listenTo(this.model.session,"change:connection_status",this.onConnectionStatusChanged),this.listenTo(this.model.session,"change:view",(()=>this.requestUpdate())),document.addEventListener("visibilitychange",(()=>this.onWindowStateChanged())),this.onConnectionStatusChanged(),this.model.maybeShow(),hm.trigger("chatRoomViewInitialized",this)}render(){return e=this,fp`<div class="flyout box-flyout">${"overlayed"===hm.settings.get("view_mode")?fp`<converse-dragresize></converse-dragresize>`:""} ${e.model?fp`<converse-muc-heading jid="${e.model.get("jid")}" class="chat-head chat-head-chatroom row g-0"></converse-muc-heading><div class="chat-body chatroom-body row g-0">${oO(e.model)}</div>`:""}</div>`;var e}onConnectionStatusChanged(){this.model.session.get("connection_status")===Cf.ROOMSTATUS.CONNECTING&&(this.model.session.save({disconnection_actor:void 0,disconnection_message:void 0,disconnection_reason:void 0}),this.model.save({moved_jid:void 0,password_validation_message:void 0,reason:void 0})),this.requestUpdate()}}hm.elements.define("converse-muc",BD);var qD=s(4659),HD={};HD.styleTagTransform=I(),HD.setAttributes=j(),HD.insert=C().bind(null,"head"),HD.domAPI=E(),HD.insertStyleElement=O();A()(qD.A,HD);qD.A&&qD.A.locals&&qD.A.locals;const{Strophe:GD}=Cf.env,{CHATROOMS_TYPE:WD}=DS;Cf.MUC.VIEWS={CONFIG:"config-form"},Cf.plugins.add("converse-muc-views",{dependencies:["converse-modal","converse-controlbox","converse-chatview"],initialize(){const{_converse:e}=this;hm.settings.extend({auto_list_rooms:!1,cache_muc_messages:!0,locked_muc_nickname:!1,modtools_disable_query:[],muc_disable_slash_commands:!1,muc_mention_autocomplete_filter:"contains",muc_mention_autocomplete_min_chars:0,muc_mention_autocomplete_show_avatar:!0,muc_roomid_policy:null,muc_roomid_policy_hint:null,muc_search_service:"api@search.jabber.network",roomconfig_whitelist:[],show_retraction_warning:!0});const t={ChatRoomView:BD,MUCView:BD};Object.assign(e,t),Object.assign(e.exports,t),hm.settings.get("muc_domain")||hm.listen.on("serviceDiscovered",(async e=>{if(e?.get("var")===GD.NS.MUC){if(e.entity.get("jid").includes("@"))return;await e.entity.getIdentity("conference","text")&&hm.settings.set("muc_domain",GD.getDomainFromJid(e.get("from")))}})),hm.listen.on("clearsession",(()=>{const t=e.chatboxviews.get("controlbox");t&&t.roomspanel&&(t.roomspanel.model.destroy(),t.roomspanel.remove(),delete t.roomspanel)})),hm.listen.on("chatBoxClosed",(e=>{var t;e.get("type")===WD&&(t=e.get("jid"),location.hash===`converse/room?jid=${t}`&&history.pushState(null,"",window.location.pathname))})),hm.listen.on("parseMessageForCommands",uO),hm.listen.on("confirmDirectMUCInvitation",iO)}});const VD=class extends fd{defaults(){return{collapsed:!1}}},{dayjs:QD}=Cf.env,{ACTIVE:KD}=DS;function JD(e){e.on("change:hidden",(()=>function(e){e.get("hidden")?function(e){hm.trigger("chatBoxMinimized",e)}(e):function(e){e.isScrolledUp()||e.clearUnreadMsgCounter();e.setChatState(KD),hm.trigger("chatBoxMaximized",e)}(e)}(e))),"controlbox"!==e.get("id")&&e.save({hidden:!!e.get("hidden"),time_minimized:e.get("time_minimized")})}function YD(e){if("controlbox"===e.model.get("id")){if(Ef.isVisible(e))return Ef.getOuterWidth(e,!0);{const e=document.querySelector("converse-controlbox-toggle");return e?Ef.getOuterWidth(e,!0):0}}return!e.model.get("hidden")&&Ef.isVisible(e)?Ef.getOuterWidth(e,!0):0}function XD(){const e=document.querySelector("converse-minimized-chats");return Bu.state.chatboxes.pluck("hidden").includes(!0)?Ef.getOuterWidth(e,!0):0}function ZD(e){const t=e?e.model.get("id"):null,s=e?Ef.getOuterWidth(e,!0):0;return Object.values(Bu.state.chatboxviews.xget(t)).reduce(((e,t)=>e+YD(t)),s)}function ez(e){if(hm.settings.get("no_trimming")||"overlayed"!==hm.settings.get("view_mode"))return;const t=Bu.state.chatboxviews.filter((e=>!e.model.get("hidden")&&!e.model.get("closed")&&Ef.isVisible(e)));if(t.length<=1)return;const s=Ef.getOuterWidth(document.querySelector("body"),!0);if(YD(t[0])===s)return;if(document.querySelector("converse-minimized-chats"))for(;XD()+ZD(e)>s;){const t=tz([e?e.model.get("id"):null]);if(!t)break;{const e=Bu.state.chatboxes.get(t.get("id"));e?.save("hidden",!0),nz(t)}}}function tz(e){e.push("controlbox");let t=0,s=Bu.state.chatboxes.sort().at(t);for(;e.includes(s.get("id"))||!0===s.get("hidden");)if(t++,s=Bu.state.chatboxes.at(t),!s)return null;return s}function sz(e,t){e?.preventDefault?e.preventDefault():t=e,Ef.safeSave(t,{hidden:!1,time_opened:(new Date).getTime()})}function nz(e,t){e?.preventDefault?e.preventDefault():t=e,Ef.safeSave(t,{hidden:!0,time_minimized:(new Date).toISOString()})}hm.elements.define("converse-minimized-chats",class extends VS{async initialize(){this.model=Bu.state.chatboxes,await this.initToggle(),this.listenTo(this.minchats,"change:collapsed",(()=>this.requestUpdate())),this.listenTo(this.model,"add",(()=>this.requestUpdate())),this.listenTo(this.model,"change:fullname",(()=>this.requestUpdate())),this.listenTo(this.model,"change:jid",(()=>this.requestUpdate())),this.listenTo(this.model,"change:hidden",(()=>this.requestUpdate())),this.listenTo(this.model,"change:name",(()=>this.requestUpdate())),this.listenTo(this.model,"change:num_unread",(()=>this.requestUpdate())),this.listenTo(this.model,"remove",(()=>this.requestUpdate())),this.listenTo(Bu,"connected",(()=>this.requestUpdate())),this.listenTo(Bu,"reconnected",(()=>this.requestUpdate())),this.listenTo(Bu,"disconnected",(()=>this.requestUpdate()))}render(){return(e=>{const t=e.model.where({hidden:!0}),s=t.reduce(((e,t)=>e+t.get("num_unread")),0),n=t.reduce(((e,t)=>e+(t.get("hidden")?1:0)),0),i=e.minchats.get("collapsed");return fp`<div id="minimized-chats" class="${t.length?"":"hidden"}"><button type="button" class="btn btn-primary" @click="${t=>e.toggle(t)}">${n} ${HS("hidden")} <span class="badge bg-secondary unread-message-count ${s?"":"hidden"}">${s}</span></button><div class="flyout minimized-chats-flyout row g-0 ${i?"hidden":""}">${t.map((e=>fp`<converse-minimized-chat .model="${e}" title="${e.getDisplayName()}" type="${e.get("type")}" num_unread="${e.get("num_unread")}"></converse-minimized-chat>`))}</div></div>`})(this)}async initToggle(){const e=`converse.minchatstoggle-${Bu.session.get("bare_jid")}`;this.minchats=new VD({id:e}),Ef.initStorage(this.minchats,e,"session"),await new Promise((e=>this.minchats.fetch({success:e,error:e})))}toggle(e){e?.preventDefault(),this.minchats.save({collapsed:!this.minchats.get("collapsed")})}});hm.elements.define("converse-minimized-chat",class extends VS{static get properties(){return{model:{type:Object},title:{type:String},type:{type:String},num_unread:{type:Number}}}constructor(){super(),this.model=null,this.num_unread=null,this.type=null,this.title=null}render(){return(e=>{const t=HS("Click to restore this chat");let s;return s="chatroom"===e.type?"var(--muc-color)":"headline"===e.type?"var(--headlines-color)":"var(--chat-color)",fp`<div class="chat-head-${e.type} chat-head row g-0"><a class="col-10 restore-chat align-self-center" title="${t}" @click="${t=>e.restore(t)}">${e.num_unread?fp`<span class="message-count badge badge-light">${e.num_unread}</span>`:""} ${e.title} </a><a class="col-2 pl-1" @click="${t=>e.close(t)}"><converse-icon color="${s}" class="fas fa-times" @click="${t=>e.close(t)}" size="1em"></converse-icon></a></div>`})(this)}close(e){e?.preventDefault(),this.model.close()}restore(e){e?.preventDefault(),sz(this.model)}});var iz=s(3195),rz={};rz.styleTagTransform=I(),rz.setAttributes=j(),rz.insert=C().bind(null,"head"),rz.domAPI=E(),rz.insertStyleElement=O();A()(iz.A,rz);iz.A&&iz.A.locals&&iz.A.locals;const{CHATROOMS_TYPE:oz}=DS;Cf.plugins.add("converse-minimize",{dependencies:["converse-chatview","converse-controlbox","converse-muc-views","converse-headlines-view","converse-dragresize"],enabled:e=>"overlayed"===e.api.settings.get("view_mode"),initialize(){hm.settings.extend({no_trimming:!1}),hm.promises.add("minimizedChatsInitialized");const e={MinimizedChatsToggle:VD};Object.assign(Bu,e),Object.assign(Bu.exports,e),Object.assign(Bu,{minimize:{trimChats:ez,minimize:nz,maximize:sz}}),Object.assign(Bu.exports,{minimize:{trimChats:ez,minimize:nz,maximize:sz}}),Object.assign(Ef,{trimChats:ez,minimize:nz,maximize:sz}),hm.listen.on("chatBoxViewInitialized",(e=>ez(e))),hm.listen.on("chatRoomViewInitialized",(e=>ez(e))),hm.listen.on("controlBoxOpened",(e=>ez(e))),hm.listen.on("chatBoxInitialized",JD),hm.listen.on("chatRoomInitialized",JD),hm.listen.on("getHeadingButtons",((e,t)=>e.model.get("type")===oz?function(e,t){const s={a_class:"toggle-chatbox-button",handler:t=>nz(t,e.model),i18n_text:HS("Minimize"),i18n_title:HS("Minimize this groupchat"),icon_class:"fa-minus",name:"minimize",standalone:"overlayed"===Bu.api.settings.get("view_mode")},n=t.map((e=>e.name)),i=n.indexOf("signout");return i>-1?[...t.slice(0,i),s,...t.slice(i)]:[s,...t]}(e,t):function(e,t){const s={a_class:"toggle-chatbox-button",handler:t=>nz(t,e.model),i18n_text:HS("Minimize"),i18n_title:HS("Minimize this chat"),icon_class:"fa-minus",name:"minimize",standalone:"overlayed"===Bu.api.settings.get("view_mode")},n=t.map((e=>e.name)),i=n.indexOf("close");return i>-1?[...t.slice(0,i),s,...t.slice(i)]:[s,...t]}(e,t)));const t=Wu((()=>ez()),250);hm.listen.on("registeredGlobalEventHandlers",(()=>window.addEventListener("resize",t))),hm.listen.on("unregisteredGlobalEventHandlers",(()=>window.removeEventListener("resize",t)))}});var az=s(5838),cz=s.n(az);const{Strophe:lz,u:dz}=Cf.env,{isEmptyMessage:uz,isTestEnv:hz}=dz,mz="Notification"in window;let gz;function pz(e){return hz()||(Bu.state.chatboxes.get(e.from)?.isHidden()??!1)}function fz(){return hz()||mz&&hm.settings.get("show_desktop_notifications")&&"granted"===Notification.permission}function vz(){gz?.badge(0),gz=null,navigator.clearAppBadge?.().catch((e=>Ct.error("Could not clear unread count in app badge "+e)))}function _z(){if(hm.settings.get("show_tab_notifications")){gz=gz??new Cf.env.Favico({type:"circle",animation:"pop"});const e=Bu.state.chatboxes.models.reduce(((e,t)=>e+(t.get("num_unread")||0)),0);gz.badge(e),navigator.setAppBadge?.(e).catch((e=>Ct.error("Could set unread count in app badge - "+e)))}}function bz(e,t,s){const n=Bu.session.get("bare_jid");return e.reduce(((e,i)=>e||i.uri&&(e=>[n,`${t}/${s}`].includes(e.uri.replace(/^xmpp:/,"")))(i)),!1)}function yz(e){const{attrs:t}=e;if(!t||t.is_forwarded)return!1;if("groupchat"===t.type)return async function(e){if(!e?.body&&!e?.message)return!1;const t=e.from,s=e.from_muc,n=hm.settings.get("notify_all_room_messages"),i=Bu.state.chatboxes.get(s),r=lz.getResourceFromJid(t),o=r&&lz.unescapeNode(r)||"";let a=!1;const c=i.get("nick");hm.settings.get("notify_nicknames_without_references")&&(a=new RegExp(`\\b${c}\\b`).test(e.body));const l=o!==c,d=!0===n||Array.isArray(n)&&n.includes(s)||bz(e.references,s,c)||a;if(l&&d)return await hm.hook("shouldNotifyOfGroupMessage",e,!0);return!1}(t);if("info"===t.type)return async function(e){if(!e.from_muc)return!1;const t=await hm.rooms.get(e.from_muc);if(!t)return!1;const s=t.get("nick"),n=e.from_muc,i=hm.settings.get("notify_all_room_messages");return!0===i||Array.isArray(i)&&i.includes(n)||bz(e.references,n,s)}(t);if(t.is_headline)return pz(t);const s=Bu.session.get("bare_jid"),n=lz.getBareJidFromJid(t.from)===s;return!uz(t)&&!n&&("all"===hm.settings.get("show_desktop_notifications")||pz(t))}async function wz(e){if(!await yz(e))return!1;hm.trigger("messageNotification",e);try{!function(){if(hm.settings.get("play_sounds")&&void 0!==window.Audio){const e=new Audio(hm.settings.get("sounds_path")+"msg_received.ogg"),t=e.canPlayType("audio/ogg");if("probably"===t)return e.play();const s=new Audio(hm.settings.get("sounds_path")+"msg_received.mp3"),n=s.canPlayType("audio/mp3");"probably"===n?s.play():"maybe"===t?e.play():"maybe"===n&&s.play()}}()}catch(e){Ct.error(e)}!function(e){const{attrs:t}=e;if(t.is_error)return;if(!fz())return;let s,n;const i=t.from,r=lz.getBareJidFromJid(i);if("info"==t.type)s=t.message;else if("headline"===t.type){if(r.includes("@")&&!hm.settings.get("allow_non_roster_messaging"))return;s=HS("Notification from %1$s",r)}else if(r.includes("@"))if("groupchat"===t.type)s=HS("%1$s says",lz.getResourceFromJid(i));else{if(void 0===Bu.state.roster)return void Ct.error("Could not send notification, because roster is undefined");if(n=Bu.state.roster.get(r),void 0!==n)s=HS("%1$s says",n.getDisplayName());else{if(!hm.settings.get("allow_non_roster_messaging"))return;s=HS("%1$s says",r)}}else s=HS("Notification from %1$s",r);let o;if("info"==t.type)o=t.reason;else if(o=t.is_encrypted?t.plaintext:t.body,!o)return;const a=new Notification(s,{body:o,lang:qS.getLocale(),icon:hm.settings.get("notification_icon"),requireInteraction:!hm.settings.get("notification_delay")});hm.settings.get("notification_delay")&&setTimeout((()=>a.close()),hm.settings.get("notification_delay")),a.onclick=function(e){e.preventDefault(),window.focus(),Bu.state.chatboxes.get(r).maybeShow(!0)}}(e)}function Sz(e){fz()&&function(e){if("error"===e.klass||"warn"===e.klass){const t=new Notification(e.subject,{body:e.message,lang:qS.getLocale(),icon:hm.settings.get("notification_icon")});setTimeout(t.close.bind(t),5e3)}}(e)}function Az(e){fz()&&hm.settings.get("show_chat_state_notifications")&&function(e){if(hm.settings.get("chatstate_notification_blacklist")?.includes(e.get("jid")))return;const t=e.presence.get("show");let s=null;if("offline"===t?s=HS("has gone offline"):"away"===t?s=HS("has gone away"):"dnd"===t?s=HS("is busy"):"online"===t&&(s=HS("has come online")),null===s)return;const n=new Notification(e.getDisplayName(),{body:s,lang:qS.getLocale(),icon:hm.settings.get("notification_icon")});setTimeout((()=>n.close()),5e3)}(e)}function xz(e){fz()&&function(e){const t=new Notification(e.getDisplayName(),{body:HS("wants to be your contact"),lang:qS.getLocale(),icon:hm.settings.get("notification_icon")});setTimeout((()=>t.close()),5e3)}(e)}function Ez(){mz&&!["denied","granted"].includes(Notification.permission)&&Notification.requestPermission()}Cf.env.Favico=cz(),Cf.plugins.add("converse-notification",{dependencies:["converse-chatboxes"],initialize(){hm.settings.extend({chatstate_notification_blacklist:[],notification_delay:5e3,notification_icon:"/images/logo/conversejs-filled.svg",notify_all_room_messages:!1,notify_nicknames_without_references:!1,play_sounds:!0,show_chat_state_notifications:!1,show_desktop_notifications:!0,show_tab_notifications:!0,sounds_path:hm.settings.get("assets_path")+"/sounds/"}),hm.listen.on("clearSession",vz),hm.waitUntil("chatBoxesInitialized").then((()=>{const{chatboxes:e}=Bu.state;e.on("change:num_unread",_z)})),hm.listen.on("pluginsInitialized",(function(){hm.listen.on("contactRequest",xz),hm.listen.on("contactPresenceChanged",Az),hm.listen.on("message",wz),hm.listen.on("feedback",Sz),hm.listen.on("connected",Ez)}))}});var $z=s(3546),Cz={};Cz.styleTagTransform=I(),Cz.setAttributes=j(),Cz.insert=C().bind(null,"head"),Cz.domAPI=E(),Cz.insertStyleElement=O();A()($z.A,Cz);$z.A&&$z.A.locals&&$z.A.locals;const kz=Cf.env.utils;hm.elements.define("converse-chat-status-modal",class extends uj{initialize(){super.initialize(),this.render(),this.addEventListener("shown.bs.modal",(()=>{this.querySelector('input[name="status_message"]').focus()}),!1)}renderModal(){return(e=>{const t=HS("Away"),s=HS("Busy"),n=HS("Online"),i=HS("Save"),r=HS("Away for long"),o=HS("Personal status message"),a=e.model.get("status"),c=e.model.get("status_message");return fp`<form class="converse-form set-xmpp-status" id="set-xmpp-status" @submit="${t=>e.onFormSubmitted(t)}"><div><div class="custom-control custom-radio"><input ?checked="${"online"===a}" type="radio" id="radio-online" value="online" name="chat_status" class="custom-control-input"> <label class="custom-control-label" for="radio-online"><converse-icon size="1em" class="fa fa-circle chat-status chat-status--online"></converse-icon>${n}</label></div><div class="custom-control custom-radio"><input ?checked="${"busy"===a}" type="radio" id="radio-busy" value="dnd" name="chat_status" class="custom-control-input"> <label class="custom-control-label" for="radio-busy"><converse-icon size="1em" class="fa fa-minus-circle chat-status chat-status--busy"></converse-icon>${s}</label></div><div class="custom-control custom-radio"><input ?checked="${"away"===a}" type="radio" id="radio-away" value="away" name="chat_status" class="custom-control-input"> <label class="custom-control-label" for="radio-away"><converse-icon size="1em" class="fa fa-circle chat-status chat-status--away"></converse-icon>${t}</label></div><div class="custom-control custom-radio"><input ?checked="${"xa"===a}" type="radio" id="radio-xa" value="xa" name="chat_status" class="custom-control-input"> <label class="custom-control-label" for="radio-xa"><converse-icon size="1em" class="far fa-circle chat-status chat-status--xa"></converse-icon>${r}</label></div></div><div><div class="btn-group w-100"><input name="status_message" type="text" class="form-control" autofocus value="${c||""}" placeholder="${o}"><converse-icon size="1em" class="fa fa-times clear-input ${c?"":"hidden"}" @click="${t=>e.clearStatusMessage(t)}"></converse-icon></div></div><button type="submit" class="btn btn-primary">${i}</button></form>`})(this)}getModalTitle(){return HS("Change chat status")}clearStatusMessage(e){e&&e.preventDefault&&(e.preventDefault(),kz.hideElement(this.querySelector(".clear-input")));this.querySelector('input[name="status_message"]').value=""}onFormSubmitted(e){e.preventDefault();const t=new FormData(e.target);this.model.save({status_message:t.get("status_message"),status:t.get("chat_status")}),this.close()}});const jz=e=>{const t={...e.model.toJSON(),...e.model.vcard.toJSON()},s=HS("Email"),n=HS("Full Name"),i=HS("XMPP Address"),r=HS("Nickname"),o=HS("Role"),a=HS("Save and close"),c=HS("Use commas to separate multiple roles. Your roles are shown next to your name on your chat messages."),l=HS("URL"),d=HS("OMEMO"),u=HS("Profile"),h=HS("Reset Password"),m=[fp`<li role="presentation" class="nav-item"><a class="nav-link ${"profile"===e.tab?"active":""}" id="profile-tab" href="#profile-tabpanel" aria-controls="profile-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="profile" data-toggle="tab">${u}</a></li>`];return m.push(fp`<li role="presentation" class="nav-item"><a class="nav-link ${"passwordreset"===e.tab?"active":""}" id="passwordreset-tab" href="#passwordreset-tabpanel" aria-controls="passwordreset-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="passwordreset" data-toggle="tab">${h}</a></li>`),Bu.pluggable.plugins["converse-omemo"]?.enabled(Bu)&&m.push(fp`<li role="presentation" class="nav-item"><a class="nav-link ${"omemo"===e.tab?"active":""}" id="omemo-tab" href="#omemo-tabpanel" aria-controls="omemo-tabpanel" role="tab" @click="${t=>e.switchTab(t)}" data-name="omemo" data-toggle="tab">${d}</a></li>`),fp`<ul class="nav nav-pills justify-content-center">${m}</ul><div class="tab-content"><div class="tab-pane ${"profile"===e.tab?"active":""}" id="profile-tabpanel" role="tabpanel" aria-labelledby="profile-tab"><form class="converse-form converse-form--modal" action="#" @submit="${t=>e.onFormSubmitted(t)}"><div class="row py-2"><div class="col-auto"><converse-image-picker .model="${e.model}" width="128" height="128"></converse-image-picker></div><div class="col"><div class="px-3"><label class="col-form-label">${i}:</label><div>${t.jid}</div></div></div></div><div><label for="vcard-fullname" class="col-form-label">${n}:</label> <input id="vcard-fullname" type="text" class="form-control" name="fn" value="${t.fullname||""}"></div><div><label for="vcard-nickname" class="col-form-label">${r}:</label> <input id="vcard-nickname" type="text" class="form-control" name="nickname" value="${t.nickname||""}"></div><div><label for="vcard-url" class="col-form-label">${l}:</label> <input id="vcard-url" type="url" class="form-control" name="url" value="${t.url||""}"></div><div><label for="vcard-email" class="col-form-label">${s}:</label> <input id="vcard-email" type="email" class="form-control" name="email" value="${t.email||""}"></div><div><label for="vcard-role" class="col-form-label">${o}:</label> <input id="vcard-role" type="text" class="form-control" name="role" value="${t.role||""}" aria-describedby="vcard-role-help"> <small id="vcard-role-help" class="form-text text-muted">${c}</small></div><hr><div><button type="submit" class="save-form btn btn-primary">${a}</button></div></form></div><div class="tab-pane ${"passwordreset"===e.tab?"active":""}" id="passwordreset-tabpanel" role="tabpanel" aria-labelledby="passwordreset-tab">${"passwordreset"===e.tab?fp`<converse-change-password-form></converse-change-password-form>`:""}</div>${Bu.pluggable.plugins["converse-omemo"]?.enabled(Bu)?(e=>fp`<div class="tab-pane ${"omemo"===e.tab?"active":""}" id="omemo-tabpanel" role="tabpanel" aria-labelledby="omemo-tab">${"omemo"===e.tab?fp`<converse-omemo-profile></converse-omemo-profile>`:""}</div>`)(e):""}</div>`},{Strophe:Tz,$iq:Oz,sizzle:Nz,u:Iz}=Cf.env;hm.elements.define("converse-change-password-form",class extends VS{static get properties(){return{passwords_mismatched:{type:Boolean},alert_message:{type:String}}}initialize(){this.passwords_mismatched=!1,this.alert_message=""}render(){return(e=>{const t=HS("Submit"),s=HS("The new passwords must match"),n=HS("New password"),i=HS("Confirm new password");return fp`<form class="converse-form passwordreset-form" method="POST" @submit="${t=>e.onSubmit(t)}">${e.alert_message?fp`<div class="alert alert-danger" role="alert">${e.alert_message}</div>`:""}<div class="py-2"><label for="converse_password_reset_new" class="form-label">${n}</label> <input class="form-control ${e.passwords_mismatched?"error":""}" type="password" name="password" required="required" id="converse_password_reset_new" autocomplete="new-password" minlength="8" ?disabled="${e.alert_message}"></div><div class="py-2"><label for="converse_password_reset_check" class="form-label">${i}</label> <input class="form-control ${e.passwords_mismatched?"error":""}" type="password" name="password_check" required="required" id="converse_password_reset_check" autocomplete="new-password" minlength="8" ?disabled="${e.alert_message}" @input="${t=>e.checkPasswordsMatch(t)}"> ${e.passwords_mismatched?fp`<span class="error">${s}</span>`:""}</div><input class="save-form btn btn-primary" type="submit" value="${t}" ?disabled="${e.alert_message}"></form>`})(this)}checkPasswordsMatch(e){const t=new FormData(e.target.form??e.target),s=t.get("password"),n=t.get("password_check");return this.passwords_mismatched=s&&s!==n,this.passwords_mismatched}async onSubmit(e){if(e.preventDefault(),this.checkPasswordsMatch(e))return;const t=Bu.session.get("domain"),s=Oz({type:"get",to:t}).c("query",{xmlns:Tz.NS.REGISTER}),n=await hm.sendIQ(s);if(null===n)return void(this.alert_message=HS("Timeout error"));if(Nz(`error service-unavailable[xmlns="${Tz.NS.STANZAS}"]`,n).length)return void(this.alert_message=HS("Your server does not support password reset"));if(Iz.isErrorStanza(n))return this.alert_message=HS("Your server responded with an unknown error, check the console for details"),Ct.error("Could not set password"),void Ct.error(n);const i=n.querySelector("username").textContent,r=new FormData(e.target).get("password"),o=Oz({type:"set",to:t}).c("query",{xmlns:Tz.NS.REGISTER}).c("username",{},i).c("password",{},r),a=await hm.sendIQ(o);null===a?this.alert_message=HS("Timeout error while trying to set your password"):Nz(`error not-allowed[xmlns="${Tz.NS.STANZAS}"]`,a).length?this.alert_message=HS("Your server does not allow password reset"):Nz(`error forbidden[xmlns="${Tz.NS.STANZAS}"]`,a).length||Iz.isErrorStanza(a)?this.alert_message=HS("You are not allowed to change your password"):hm.alert("info",HS("Success"),[HS("Your new password has been set")])}});var Mz=s(7808),Rz={};Rz.styleTagTransform=I(),Rz.setAttributes=j(),Rz.insert=C().bind(null,"head"),Rz.domAPI=E(),Rz.insertStyleElement=O();A()(Mz.A,Rz);Mz.A&&Mz.A.locals&&Mz.A.locals;hm.elements.define("converse-profile-modal",class extends uj{constructor(e){super(e),this.tab="profile"}initialize(){super.initialize(),this.listenTo(this.model,"change",this.render),hm.trigger("profileModalInitialized",this.model)}renderModal(){return jz(this)}getModalTitle(){return HS("Your Profile")}async setVCard(e){const t=Bu.session.get("bare_jid");try{await hm.vcard.set(t,e)}catch(e){return Ct.fatal(e),void this.alert([HS("Sorry, an error happened while trying to save your profile data."),HS("You can check your browser's developer console for any error output.")].join(" "))}}async onFormSubmitted(e){e.preventDefault();const t=new FormData(e.target),s=t.get("avatar_image"),n={fn:t.get("fn"),nickname:t.get("nickname"),role:t.get("role"),email:t.get("email"),url:t.get("url")};if(s?.size){const e=TD?s:await OD(s),t=new FileReader;t.onloadend=async()=>{Object.assign(n,{image:btoa(t.result),image_type:s.type}),await this.setVCard(n),this.modal.hide()},t.readAsBinaryString(e)}else Object.assign(n,{image:this.model.vcard.get("image"),image_type:this.model.vcard.get("image_type")}),await this.setVCard(n),this.modal.hide()}});const Dz=e=>{const t=HS("%1$s Open Source %2$s XMPP chat client brought to you by %3$s Opkode %2$s",'<a target="_blank" rel="nofollow" href="https://conversejs.org">',"</a>",'<a target="_blank" rel="nofollow" href="https://opkode.com">'),s=HS("%1$s Translate %2$s it into your own language",'<a target="_blank" rel="nofollow" href="https://hosted.weblate.org/projects/conversejs/#languages">',"</a>"),n=hm.settings.get("show_client_info"),i=hm.settings.get("allow_adhoc_commands");return fp`${n&&i?(e=>{const t=HS("About"),s=HS("Commands");return fp`<ul class="nav nav-pills justify-content-center"><li role="presentation" class="nav-item"><a class="nav-link ${"about"===e.tab?"active":""}" id="about-tab" href="#about-tabpanel" aria-controls="about-tabpanel" role="tab" data-toggle="tab" data-name="about" @click="${t=>e.switchTab(t)}">${t}</a></li><li role="presentation" class="nav-item"><a class="nav-link ${"commands"===e.tab?"active":""}" id="commands-tab" href="#commands-tabpanel" aria-controls="commands-tabpanel" role="tab" data-toggle="tab" data-name="commands" @click="${t=>e.switchTab(t)}">${s}</a></li></ul>`})(e):""}<div class="tab-content">${n?fp`<div class="tab-pane tab-pane--columns ${"about"===e.tab?"active":""}" id="about-tabpanel" role="tabpanel" aria-labelledby="about-tab"><span class="modal-alert"></span><br><div class="container"><h6 class="brand-heading">Converse</h6><p class="brand-subtitle">${Bu.VERSION_NAME}</p><p class="brand-subtitle">${HI(G().sanitize(t))}</p><p class="brand-subtitle">${HI(G().sanitize(s))}</p></div></div>`:""} ${i?fp`<div class="tab-pane tab-pane--columns ${"commands"===e.tab?"active":""}" id="commands-tabpanel" role="tabpanel" aria-labelledby="commands-tab"><converse-adhoc-commands></div>`:""}</div>`};hm.elements.define("converse-user-settings-modal",class extends uj{constructor(e){super(e);const t=hm.settings.get("show_client_info"),s=hm.settings.get("allow_adhoc_commands");t&&s||t?this.tab="about":s&&(this.tab="commands")}renderModal(){return Dz(this)}getModalTitle(){return HS("Settings")}});const zz=e=>{const t=e.model.get("status")||"offline",s=e.model.get("status_message")||HS("I am %1$s","chat"===(n=t)?HS("online"):"dnd"===n?HS("busy"):"xa"===n?HS("away for long"):"away"===n?HS("away"):"offline"===n?HS("offline"):HS(n)||HS("online"));var n;const i=HS("Click to change your chat status");let r,o;return[r,o]="online"===t?["fa fa-circle chat-status","chat-status-online"]:"dnd"===t?["fa fa-minus-circle chat-status","chat-status-busy"]:"away"===t?["fa fa-circle chat-status","chat-status-away"]:["fa fa-circle chat-status","comment"],fp`<div class="userinfo"><div class="controlbox-section profile d-flex"><a class="show-profile" href="#" @click="${e.showProfileModal}"><converse-avatar class="avatar align-self-center" .model="${e.model}" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="40" width="40"></converse-avatar></a><span class="username w-100 align-self-center" role="heading" aria-level="2">${e.model.getDisplayName()}</span><converse-controlbox-buttons></converse-controlbox-buttons></div><div class="d-flex xmpp-status"><a class="change-status" title="${i}" data-toggle="modal" data-target="#changeStatusModal" @click="${e.showStatusChangeModal}"><span class="${t} w-100" data-value="${t}"><converse-icon color="var(--${o})" css="margin-top: -0.1em" size="0.82em" class="${r}"></converse-icon><span class="xmpp-status__msg">${s}</span></span></a></div></div>`};var Lz=s(9845),Pz={};Pz.styleTagTransform=I(),Pz.setAttributes=j(),Pz.insert=C().bind(null,"head"),Pz.domAPI=E(),Pz.insertStyleElement=O();A()(Lz.A,Pz);Lz.A&&Lz.A.locals&&Lz.A.locals;class Fz extends VS{initialize(){this.model=Bu.state.xmppstatus,this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate()))}render(){return zz(this)}showProfileModal(e){e?.preventDefault(),hm.modal.show("converse-profile-modal",{model:this.model},e)}showStatusChangeModal(e){e?.preventDefault(),hm.modal.show("converse-chat-status-modal",{model:this.model},e)}}hm.elements.define("converse-user-profile",Fz);Cf.plugins.add("converse-profile",{dependencies:["converse-status","converse-modal","converse-vcard","converse-chatboxviews","converse-adhoc-views"],initialize(){hm.settings.extend({show_client_info:!0})}});const Uz={name:"AES-GCM",length:128};class Bz extends Error{constructor(e,t){super(e),this.name="IQError",this.iq=t}}class qz extends Error{constructor(e){super(e),this.name="UserFacingError",this.user_facing=!0}}const{Strophe:Hz,$build:Gz,$iq:Wz,sizzle:Vz}=Cf.env;const Qz=class extends fd{get idAttribute(){return"jid"}async initialize(){super.initialize(),this.initialized=hc(),await this.initDevices(),this.initialized.resolve()}initDevices(){this.devices=new Bu.exports.Devices;const e=`converse.devicelist-${Bu.session.get("bare_jid")}-${this.get("jid")}`;return Ef.initStorage(this.devices,e),this.fetchDevices()}async onDevicesFound(e){if(0===e.length){let e=[];try{e=await this.fetchDevicesFromServer()}catch(e){null===e?Ct.error(`Timeout error while fetching devices for ${this.get("jid")}`):(Ct.error(`Could not fetch devices for ${this.get("jid")}`),Ct.error(e)),this.destroy()}const t=Bu.session.get("bare_jid");this.get("jid")===t&&this.publishCurrentDevice(e)}}fetchDevices(){return void 0===this._devices_promise&&(this._devices_promise=new Promise((e=>{this.devices.fetch({success:t=>e(this.onDevicesFound(t)),error:(t,s)=>{Ct.error(s),e()}})}))),this._devices_promise}async getOwnDeviceId(){const{omemo_store:e}=Bu.state;let t=e.get("device_id");return this.devices.get(t)||(await e.generateBundle(),t=e.get("device_id")),t}async publishCurrentDevice(e){const t=Bu.session.get("bare_jid");if(this.get("jid")===t){if(await hm.omemo.session.restore(),Bu.state.omemo_store)return e.includes(await this.getOwnDeviceId())?void 0:this.publishDevices();Ct.warn("publishCurrentDevice: omemo_store is not defined, likely a timing issue")}}async fetchDevicesFromServer(){const e=Bu.session.get("bare_jid"),t=Wz({type:"get",from:e,to:this.get("jid")}).c("pubsub",{xmlns:Hz.NS.PUBSUB}).c("items",{node:Hz.NS.OMEMO_DEVICELIST}),s=await hm.sendIQ(t),n=`list[xmlns="${Hz.NS.OMEMO}"] device`,i=Vz(n,s).map((e=>e.getAttribute("id"))),r=this.get("jid");return Promise.all(i.map((e=>this.devices.create({id:e,jid:r},{promise:!0}))))}publishDevices(){const e=Gz("item",{id:"current"}).c("list",{xmlns:Hz.NS.OMEMO});this.devices.filter((e=>e.get("active"))).forEach((t=>e.c("device",{id:t.get("id")}).up()));return hm.pubsub.publish(null,Hz.NS.OMEMO_DEVICELIST,e,{access_model:"open"},!1)}async removeOwnDevices(e){const t=Bu.session.get("bare_jid");if(this.get("jid")!==t)throw new Error("Cannot remove devices from someone else's device list");return await Promise.all(e.map((e=>this.devices.get(e))).map((e=>new Promise((t=>e.destroy({success:t,error:(e,s)=>{Ct.error(s),t()}})))))),this.publishDevices()}};const Kz=class extends Fd{constructor(){super(),this.model=Qz}},{Strophe:Jz,URI:Yz,sizzle:Xz,stx:Zz}=Cf.env,{CHATROOMS_TYPE:eL,PRIVATE_CHAT_TYPE:tL}=DS,{appendArrayBuffer:sL,arrayBufferToBase64:nL,arrayBufferToHex:iL,arrayBufferToString:rL,base64ToArrayBuffer:oL,getURI:aL,hexToArrayBuffer:cL,initStorage:lL,isAudioURL:dL,isError:uL,isImageURL:hL,isVideoURL:mL,stringToArrayBuffer:gL}=Ef;function pL(e){e=e.replace(/^05/,"");for(let t=1;t<8;t++){const s=8*t+t-1;e=e.slice(0,s)+" "+e.slice(s)}return e}async function fL(e){return(await OL(e)).length>0}function vL(e,t){return e.get("omemo_active")&&t.body&&(t.is_encrypted=!0,t.plaintext=t.body,t.body=HS("This is an OMEMO encrypted message which your client doesn’t seem to support. Find more information on https://conversations.im/omemo")),t}async function _L(e){const t="localhost"===window.location.hostname&&"localhost"===e.domain()?"http":"https",s=e.toString().replace(/^aesgcm/,t),n=await async function(e){let t;try{t=await fetch(e)}catch(t){return Ct.error(`${t.name}: Failed to download encrypted media: ${e}`),Ct.error(t),null}if(t.status>=200&&t.status<400)return t.arrayBuffer()}(s);if(null===n)return Ct.error(`Could not decrypt a received encrypted file ${e.toString()} since it could not be downloaded`),new Error(HS("Error: could not decrypt a received encrypted file, because it could not be downloaded"));const i=e.hash().slice(1),r=i.substring(i.length-64),o=i.replace(r,"");let a;try{a=await async function(e,t,s){const n=await crypto.subtle.importKey("raw",cL(t),"AES-GCM",!1,["decrypt"]),i={name:"AES-GCM",iv:cL(e)};return crypto.subtle.decrypt(i,n,s)}(o,r,n)}catch(t){return Ct.error(`Could not decrypt file ${e.toString()}`),Ct.error(t),null}const[c,l]=e.filename().split("."),d=jD[l];try{const e=new File([a],c,{type:d});return URL.createObjectURL(e)}catch(t){return Ct.error(`Could not decrypt file ${e.toString()}`),Ct.error(t),null}}function bL(e,t,s){const n=[];try{const t={start:/\b(aesgcm:\/\/)/gi};Yz.withinString(e,((e,t,s)=>(n.push({url:e,start:t,end:s}),e)),t)}catch(e){return void Ct.debug(e)}n.forEach((n=>{const i=aL(e.slice(n.start,n.end)),r=_L(i).then((e=>function(e,t,s){if(uL(t))return fp`<p class="error">${t.message}</p>`;const n=e.toString();return hL(n)?fN({src:t,onClick:s.onImgClick,onLoad:s.onImgLoad}):dL(n)?Ij(t):mL(n)?Uj(t):Mj(t,e.filename())}(i,e,s))),o=fp`${LT(r,"")}`;s.addTemplateResult(n.start+t,n.end+t,o)}))}function yL(e){Bu.state.config.get("trusted")&&e.addAnnotations(((t,s)=>bL(t,s,e)))}async function wL(e,t){if(hm.settings.get("clear_cache_on_logout")||!t.is_encrypted||t.encryption_namespace!==Jz.NS.OMEMO)return t;const s=Xz(`encrypted[xmlns="${Jz.NS.OMEMO}"]`,e).pop(),n=s.querySelector("header");t.encrypted={device_id:n.getAttribute("sid")};const i=await(hm.omemo?.getDeviceID()),r=i&&Xz(`key[rid="${i}"]`,s).pop();return r?(Object.assign(t.encrypted,{iv:n.querySelector("iv").textContent,key:r.textContent,payload:s.querySelector("payload")?.textContent||null,prekey:["true","1"].includes(r.getAttribute("prekey"))}),!0===t.encrypted.prekey?async function(e){const t=EL(e),s=xL(t,parseInt(e.encrypted.device_id,10)),n=oL(e.encrypted.key);let i;try{i=await s.decryptPreKeyWhisperMessage(n,"binary")}catch(t){return Ct.error(`${t.name} ${t.message}`),Object.assign(e,CL(t))}try{const t=await $L(e,i),{omemo_store:s}=Bu.state;return await s.generateMissingPreKeys(),await s.publishBundle(),t?Object.assign(e,{plaintext:t}):Object.assign(e,{is_only_key:!0})}catch(t){return Ct.error(`${t.name} ${t.message}`),Object.assign(e,CL(t))}}(t):async function(e){const t=EL(e),s=xL(t,parseInt(e.encrypted.device_id,10)),n=oL(e.encrypted.key);try{const t=await s.decryptWhisperMessage(n,"binary"),i=await $L(e,t);return Object.assign(e,{plaintext:i})}catch(t){return Ct.error(`${t.name} ${t.message}`),Object.assign(e,CL(t))}}(t)):Object.assign(t,{error_condition:"not-encrypted-for-this-device",error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"})}function SL(){Bu.state.chatboxes.on("add",(e=>{RL(e),e.get("type")===eL&&(e.occupants.on("add",(t=>async function(e,t){if(t.isSelf()||!e.features.get("nonanonymous")||!e.features.get("membersonly"))return;if(e.get("omemo_active")){await fL(t.get("jid"))||(e.createMessage({message:HS("%1$s doesn't appear to have a client that supports OMEMO. Encrypted chat will no longer be possible in this grouchat.",t.get("nick")),type:"error"}),e.save({omemo_active:!1,omemo_supported:!1}))}}(e,t))),e.features.on("change",(()=>RL(e))))}))}function AL(e){e.listenTo(e.model.messages,"add",(t=>{t.get("is_encrypted")&&!t.get("is_error")&&e.model.save("omemo_supported",!0)})),e.listenTo(e.model,"change:omemo_supported",(()=>{!e.model.get("omemo_supported")&&e.model.get("omemo_active")?e.model.set("omemo_active",!1):e.querySelector("converse-chat-toolbar")?.requestUpdate()})),e.listenTo(e.model,"change:omemo_active",(()=>{e.querySelector("converse-chat-toolbar").requestUpdate()}))}function xL(e,t){const{libsignal:s}=window,n=new s.SignalProtocolAddress(e,t);return new s.SessionCipher(Bu.state.omemo_store,n)}function EL(e){const t=e.from_muc?e.from_real_jid:e.from;if(!t)throw Object.assign(e,{error_text:HS("Sorry, could not decrypt a received OMEMO message because we don't have the XMPP address for that user."),error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"}),new Error("Could not find JID to decrypt OMEMO message for");return t}async function $L(e,t){const s=EL(e),n=await hm.omemo.devicelists.get(s,!0),i=e.encrypted;let r=n.devices.get(i.device_id);if(r||(r=await n.devices.create({id:i.device_id,jid:s},{promise:!0})),i.payload){const e=t.slice(0,16),s=t.slice(16),n=await PL.decryptMessage(Object.assign(i,{key:e,tag:s}));return r.save("active",!0),n}}function CL(e){return{error_text:HS("Sorry, could not decrypt a received OMEMO message due to an error.")+` ${e.name} ${e.message}`,error_condition:e.name,error_message:e.message,error_type:"Decryption",is_ephemeral:!0,is_error:!0,type:"error"}}function kL(e){const t=e.querySelector("signedPreKeyPublic"),s=e.querySelector("signedPreKeySignature"),n=Xz("prekeys > preKeyPublic",e).map((e=>({id:parseInt(e.getAttribute("preKeyId"),10),key:e.textContent})));return{identity_key:e.querySelector("identityKey").textContent.trim(),signed_prekey:{id:parseInt(t.getAttribute("signedPreKeyId"),10),public_key:t.textContent,signature:s.textContent},prekeys:n}}async function jL(e){const t=await OL(e);return Promise.all(t.map((e=>TL(e))))}async function TL(e){if(e.get("bundle")?.fingerprint)return;const t=await e.getBundle();t.fingerprint=iL(oL(t.identity_key)),e.save("bundle",t),e.trigger("change:bundle")}async function OL(e){await hm.waitUntil("OMEMOInitialized");const t=await hm.omemo.devicelists.get(e,!0);return await t.fetchDevices(),t.devices}async function NL(e){if(!e.get("bundle"))return Ct.error(`Could not build an OMEMO session for device ${e.get("id")} because we don't have its bundle`),null;const{libsignal:t}=window,s=new t.SignalProtocolAddress(e.get("jid"),e.get("id")),n=await Bu.state.omemo_store.loadSession(s.toString());if(n)return n;try{const t=await async function(e){const{libsignal:t}=window,s=new t.SignalProtocolAddress(e.get("jid"),e.get("id")),n=new t.SessionBuilder(Bu.state.omemo_store,s),i=e.getRandomPreKey(),r=await e.getBundle();return n.processPreKey({registrationId:parseInt(e.get("id"),10),identityKey:oL(r.identity_key),signedPreKey:{keyId:r.signed_prekey.id,publicKey:oL(r.signed_prekey.public_key),signature:oL(r.signed_prekey.signature)},preKey:{keyId:i.id,publicKey:oL(i.key)}})}(e);return t}catch(t){return Ct.error(`Could not build an OMEMO session for device ${e.get("id")}`),Ct.error(t),null}}function IL(){hm.connection.get().addHandler((async e=>{try{Xz(`event[xmlns="${Jz.NS.PUBSUB}#event"]`,e).length&&(await hm.waitUntil("OMEMOInitialized"),await async function(e){const t=Xz(`items[node="${Jz.NS.OMEMO_DEVICELIST}"]`,e).pop();if(!t)return;const s=`item list[xmlns="${Jz.NS.OMEMO}"] device`,n=Xz(s,t).map((e=>e.getAttribute("id"))),i=e.getAttribute("from"),r=await hm.omemo.devicelists.get(i,!0),o=r.devices,a=o.pluck("id").filter((e=>!n.includes(e))),c=Bu.session.get("bare_jid");a.forEach((e=>{i===c&&e===Bu.state.omemo_store.get("device_id")||o.get(e).save("active",!1)})),n.forEach((e=>{const t=o.get(e);t?t.save("active",!0):o.create({id:e,jid:i})})),Ef.isSameBareJID(i,i)&&r.publishCurrentDevice(n)}(e),await async function(e){const t=Xz("items",e).pop();if(!t||!t.getAttribute("node").startsWith(Jz.NS.OMEMO_BUNDLES))return;const s=t.getAttribute("node").split(":")[1],n=e.getAttribute("from"),i=Xz("item > bundle",t).pop(),r=await hm.omemo.devicelists.get(n,!0);(r.devices.get(s)||r.devices.create({id:s,jid:n})).save({bundle:kL(i)})}(e))}catch(e){Ct.error(e.message)}return!0}),null,"message","headline")}async function ML(e){if(!e)if(Bu.state.config.get("trusted")&&!hm.settings.get("clear_cache_on_logout")){try{await async function(){const e=Bu.session.get("bare_jid");Bu.state.devicelists=new Kz;const t=`converse.devicelists-${e}`;lL(Bu.state.devicelists,t),await new Promise((e=>{Bu.state.devicelists.fetch({success:e,error:(t,s)=>{Ct.error(s),e()}})})),await hm.omemo.devicelists.get(e,!0)}(),await hm.omemo.session.restore(),await Bu.state.omemo_store.publishBundle()}catch(e){return Ct.error("Could not initialize OMEMO support"),void Ct.error(e)}hm.trigger("OMEMOInitialized")}else Ct.warn("Not initializing OMEMO, since this browser is not trusted or clear_cache_on_logout is set to true")}async function RL(e){let t;e.get("type")===eL?(await hm.waitUntil("OMEMOInitialized"),t=e.features.get("nonanonymous")&&e.features.get("membersonly")):e.get("type")===tL&&(t=await fL(e.get("jid"))),e.set("omemo_supported",!!t),t&&hm.settings.get("omemo_default")&&e.set("omemo_active",!0)}function DL(e){e.stopPropagation(),e.preventDefault();const t=Ef.ancestor(e.target,"converse-chat-toolbar");if(!t.model.get("omemo_supported")){let e;return e=t.model.get("type")===eL?[HS("Cannot use end-to-end encryption in this groupchat, either the groupchat has some anonymity or not all participants support OMEMO.")]:[HS("Cannot use end-to-end encryption because %1$s uses a client that doesn't support OMEMO.",t.model.contact.getDisplayName())],hm.alert("error",HS("Error"),e)}t.model.save({omemo_active:!t.model.get("omemo_active")})}function zL(e,t){const s=e.model,n=s.get("type")===eL;let i,r;if(s.get("omemo_supported")){const e=HS("Messages are being sent in plaintext"),t=HS("Messages are sent encrypted");i=s.get("omemo_active")?t:e}else i=HS(n?"This groupchat needs to be members-only and non-anonymous in order to support OMEMO encrypted messages":"OMEMO encryption is not supported");return r=s.get("omemo_supported")?s.get("omemo_active")?n?"var(--muc-color)":"var(--chat-color)":"var(--error-color)":"var(--disabled-color)",t.push(fp`<button type="button" class="btn toggle-omemo" title="${i}" data-disabled="${!s.get("omemo_supported")}" @click="${DL}"><converse-icon class="fa ${s.get("omemo_active")?"fa-lock":"fa-unlock"}" path-prefix="${hm.settings.get("assets_path")}" size="1em" color="${r}"></converse-icon></button>`),t}async function LL(e,t){let{stanza:s}=t;const{message:n}=t;if(!n.get("is_encrypted"))return t;if(!n.get("body"))throw new Error("No message body to encrypt!");const i=await async function(e){const t=HS("Sorry, no devices found to which we can send an OMEMO encrypted message.");let s;if(e instanceof Z_){const t=await Promise.all(e.occupants.map((e=>OL(e.get("jid")))));s=t.reduce(((e,t)=>e.concat(t.models)),[])}else if(e.get("type")===tL){const n=await OL(e.get("jid"));if(0===n.length)throw new qz(t);const i=Bu.session.get("bare_jid"),r=(await hm.omemo.devicelists.get(i)).devices;s=[...r.models,...n.models]}const n=Bu.state.omemo_store.get("device_id");s=s.filter((e=>e.get("id")!==n)),await Promise.all(s.map((e=>e.getBundle())));const i=s.filter((e=>e)).map((e=>NL(e)));if(await Promise.all(i),i.includes(null)&&(s=s.filter((e=>i[s.indexOf(e)])),0===s.length))throw new qz(t);return s}(e),{key_and_tag:r,iv:o,payload:a}=await PL.encryptMessage(n.get("plaintext")),c=await Promise.all(i.filter((e=>-1!=e.get("trusted")&&e.get("active"))).map((e=>function(e,t){return xL(t.get("jid"),t.get("id")).encrypt(e).then((e=>({payload:e,device:t})))}(r,e))));return s.cnode(Zz`<encrypted xmlns="${Jz.NS.OMEMO}">
            <header sid="${Bu.state.omemo_store.get("device_id")}">
                ${c.map((({payload:e,device:t})=>3==parseInt(e.type,10)?Zz`<key rid="${t.get("id")}" prekey="true">${btoa(e.body)}</key>`:Zz`<key rid="${t.get("id")}">${btoa(e.body)}</key>`))}
                <iv>${o}</iv>
            </header>
            <payload>${a}</payload>
        </encrypted>`).root(),s.cnode(Zz`<store xmlns="${Jz.NS.HINTS}"/>`).root(),s.cnode(Zz`<encryption xmlns="${Jz.NS.EME}" namespace="${Jz.NS.OMEMO}"/>`).root(),{message:n,stanza:s}}const PL={decryptMessage:async function(e){const t=await crypto.subtle.importKey("raw",e.key,Uz,!0,["encrypt","decrypt"]),s=sL(oL(e.payload),e.tag),n={name:"AES-GCM",iv:oL(e.iv),tagLength:128};return rL(await crypto.subtle.decrypt(n,t,s))},encryptMessage:async function(e){const t=crypto.getRandomValues(new window.Uint8Array(12)),s=await crypto.subtle.generateKey(Uz,!0,["encrypt","decrypt"]),n={name:"AES-GCM",iv:t,tagLength:128},i=await crypto.subtle.encrypt(n,s,gL(e)),r=i.byteLength-16,o=i.slice(0,r),a=i.slice(r),c=await crypto.subtle.exportKey("raw",s);return{key:c,tag:a,key_and_tag:sL(c,a),payload:nL(o),iv:nL(t)}},formatFingerprint:pL},{u:FL}=Cf.env,UL=e=>{const t=HS("OMEMO Fingerprints"),s=HS("No OMEMO-enabled devices found"),n=e.devicelist.devices;return fp`<hr><ul class="list-group fingerprints"><li class="list-group-item active">${t}</li>${n.length?n.map((t=>((e,t)=>{const s=HS("Trusted"),n=HS("Untrusted"),i=HS("Choose which devices you trust for OMEMO encrypted communication"),r=FL.getUniqueId(),o=FL.getUniqueId(),a=-1!==t.get("trusted");return t.get("bundle")&&t.get("bundle").fingerprint?fp`<li class="list-group-item"><form class="fingerprint-trust"><div class="btn-group btn-group-toggle" role="group" aria-label="${i}"><input type="radio" class="btn-check" name="${t.get("id")}" id="${r}" autocomplete="off" value="1" @click="${e.toggleDeviceTrust}" ?checked="${a}"> <label class="btn ${a?"btn-primary active":"btn-outline-secondary"}" for="${r}">${s}</label> <input type="radio" class="btn-check" name="${t.get("id")}" id="${o}" autocomplete="off" value="-1" @click="${e.toggleDeviceTrust}" ?checked="${!a}"> <label class="btn ${a?"btn-outline-secondary":"btn-primary active"}" for="${o}">${n}</label></div><code class="fingerprint">${pL(t.get("bundle").fingerprint)}</code></form></li>`:""})(e,t))):fp`<li class="list-group-item">${s}</li>`}</ul>`};hm.elements.define("converse-omemo-fingerprints",class extends VS{constructor(){super(),this.jid=null}static get properties(){return{jid:{type:String}}}async initialize(){this.devicelist=await hm.omemo.devicelists.get(this.jid,!0),this.listenTo(this.devicelist.devices,"change:bundle",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"change:trusted",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"remove",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"add",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.requestUpdate()}render(){return this.devicelist?UL(this):""}toggleDeviceTrust(e){const t=e.target;this.devicelist.devices.get(t.getAttribute("name")).save("trusted",parseInt(t.value,10))}});const BL=e=>fp`${e.device.get("bundle")&&e.device.get("bundle").fingerprint?(e=>{const t=HS("Checkbox for selecting the following fingerprint");return fp`<li class="fingerprint-removal-item list-group-item"><label class="form-label"><input type="checkbox" value="${e.device.get("id")}" aria-label="${t}"> <span class="fingerprint">${pL(e.device.get("bundle").fingerprint)}</span></label></li>`})(e):(e=>{const t=HS("Device without a fingerprint"),s=HS("Checkbox for selecting the following device");return fp`<li class="fingerprint-removal-item list-group-item"><label class="form-label"><input type="checkbox" value="${e.device.get("id")}" aria-label="${s}"> <span>${t}</span></label></li>`})(e)}`,qL=e=>{const t=HS("This device's OMEMO fingerprint"),s=HS("Generate new keys and fingerprint");return fp`<form class="converse-form fingerprint-removal" @submit="${e.removeSelectedFingerprints}"><ul class="list-group fingerprints"><li class="list-group-item active">${t}</li><li class="list-group-item">${e.current_device&&e.current_device.get("bundle")&&e.current_device.get("bundle").fingerprint?(e=>fp`<span class="fingerprint">${pL(e.current_device.get("bundle").fingerprint)}</span>`)(e):vT()}</li></ul><div class="pb-3"><button type="button" class="generate-bundle btn btn-danger" @click="${e.generateOMEMODeviceBundle}">${s}</button></div>${e.other_devices?.length?(e=>{const t=HS("Other OMEMO-enabled devices"),s=HS("Checkbox to select fingerprints of all other OMEMO devices"),n=HS("Remove checked devices and close"),i=HS("Select all");return fp`<ul class="list-group fingerprints"><li class="list-group-item active"><label class="form-label"><input type="checkbox" class="select-all" @change="${e.selectAll}" title="${i}" aria-label="${s}"> ${t}</label></li>${e.other_devices?.map((t=>BL(Object.assign({device:t},e))))}</ul><div><button type="submit" class="save-form btn btn-primary">${n}</button></div>`})(e):""}</form>`},{Strophe:HL,sizzle:GL,u:WL}=Cf.env;hm.elements.define("converse-omemo-profile",class extends VS{async initialize(){const e=Bu.session.get("bare_jid");this.devicelist=await hm.omemo.devicelists.get(e,!0),await this.setAttributes(),this.listenTo(this.devicelist.devices,"change:bundle",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"reset",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"remove",(()=>this.requestUpdate())),this.listenTo(this.devicelist.devices,"add",(()=>this.requestUpdate())),this.requestUpdate()}async setAttributes(){this.device_id=await hm.omemo.getDeviceID(),this.current_device=this.devicelist.devices.get(this.device_id),this.other_devices=this.devicelist.devices.filter((e=>e.get("id")!==this.device_id))}render(){return this.devicelist?qL(this):vT()}selectAll(e){let t=WL.ancestor(e.target,"li");for(;t;)t.querySelector('input[type="checkbox"]').checked=e.target.checked,t=t.nextElementSibling}async removeSelectedFingerprints(e){e.preventDefault(),e.stopPropagation(),e.target.querySelector(".select-all").checked=!1;const t=GL('.fingerprint-removal-item input[type="checkbox"]:checked',e.target).map((e=>e.value));try{await this.devicelist.removeOwnDevices(t)}catch(e){Ct.error(e),Bu.api.alert(HL.LogLevel.ERROR,HS("Error"),[HS("Sorry, an error occurred while trying to remove the devices.")])}await this.setAttributes(),this.requestUpdate()}async generateOMEMODeviceBundle(e){e.preventDefault();await hm.confirm(HS("Are you sure you want to generate new OMEMO keys? This will remove your old keys and all previously encrypted messages will no longer be decryptable on this device."))&&(await hm.omemo.bundle.generate(),await this.setAttributes(),this.requestUpdate())}});const{Strophe:VL,sizzle:QL,$iq:KL}=Cf.env;const JL=class extends fd{defaults(){return{trusted:0,active:!0}}getRandomPreKey(){const e=this.get("bundle");return e.prekeys[Ef.getRandomInt(e.prekeys.length)]}async fetchBundleFromServer(){const e=Bu.session.get("bare_jid"),t=KL({type:"get",from:e,to:this.get("jid")}).c("pubsub",{xmlns:VL.NS.PUBSUB}).c("items",{node:`${VL.NS.OMEMO_BUNDLES}:${this.get("id")}`});let s;try{s=await hm.sendIQ(t)}catch(s){return Ct.error(`Could not fetch bundle for device ${this.get("id")} from ${this.get("jid")}`),Ct.error(s),null}if(s.querySelector("error"))throw new Bz("Could not fetch bundle",s);const n=QL(`items[node="${VL.NS.OMEMO_BUNDLES}:${this.get("id")}"]`,s).pop(),i=kL(QL(`bundle[xmlns="${VL.NS.OMEMO}"]`,n).pop());return this.save("bundle",i),i}getBundle(){return this.get("bundle")?Promise.resolve(this.get("bundle")):this.fetchBundleFromServer()}};const YL=class extends Fd{constructor(){super(),this.model=JL}};var XL=Math.ceil,ZL=Math.max;const eP=function(e,t,s,n){for(var i=-1,r=ZL(XL((t-e)/(s||1)),0),o=Array(r);r--;)o[n?r:++i]=e,e+=s;return o};const tP=function(e){return function(t,s,n){return n&&"number"!=typeof n&&ac(t,s,n)&&(s=n=void 0),t=Xs(t),void 0===s?(s=t,t=0):s=Xs(s),n=void 0===n?t<s?1:-1:Xs(n),eP(t,s,n,e)}};const sP=tP(),{Strophe:nP,$build:iP,u:rP}=Cf.env;const oP=class extends fd{get Direction(){return{SENDING:1,RECEIVING:2}}getIdentityKeyPair(){const e=this.get("identity_keypair");return Promise.resolve({privKey:rP.base64ToArrayBuffer(e.privKey),pubKey:rP.base64ToArrayBuffer(e.pubKey)})}getLocalRegistrationId(){return Promise.resolve(parseInt(this.get("device_id"),10))}isTrustedIdentity(e,t,s){if(null==e)throw new Error("Can't check identity key for invalid key");if(!(t instanceof ArrayBuffer))throw new Error("Expected identity_key to be an ArrayBuffer");const n=this.get("identity_key"+e);return void 0===n?Promise.resolve(!0):Promise.resolve(rP.arrayBufferToBase64(t)===n)}loadIdentityKey(e){if(null==e)throw new Error("Can't load identity_key for invalid identifier");return Promise.resolve(rP.base64ToArrayBuffer(this.get("identity_key"+e)))}saveIdentity(e,t){if(null==e)throw new Error("Can't save identity_key for invalid identifier");const{libsignal:s}=window,n=new s.SignalProtocolAddress.fromString(e),i=this.get("identity_key"+n.getName()),r=rP.arrayBufferToBase64(t);return this.save("identity_key"+n.getName(),r),i&&r!==i?Promise.resolve(!0):Promise.resolve(!1)}getPreKeys(){return this.get("prekeys")||{}}loadPreKey(e){const t=this.getPreKeys()[e];return t?Promise.resolve({privKey:rP.base64ToArrayBuffer(t.privKey),pubKey:rP.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()}storePreKey(e,t){const s={};return s[e]={pubKey:rP.arrayBufferToBase64(t.pubKey),privKey:rP.arrayBufferToBase64(t.privKey)},this.save("prekeys",Object.assign(this.getPreKeys(),s)),Promise.resolve()}removePreKey(e){const t={...this.getPreKeys()};return delete t[e],this.save("prekeys",t),Promise.resolve()}loadSignedPreKey(e){const t=this.get("signed_prekey");return t?Promise.resolve({privKey:rP.base64ToArrayBuffer(t.privKey),pubKey:rP.base64ToArrayBuffer(t.pubKey)}):Promise.resolve()}storeSignedPreKey(e){if("object"!=typeof e)throw new Error("storeSignedPreKey: expected an object");return this.save("signed_prekey",{id:e.keyId,privKey:rP.arrayBufferToBase64(e.keyPair.privKey),pubKey:rP.arrayBufferToBase64(e.keyPair.pubKey),signature:rP.arrayBufferToBase64(e.signature)}),Promise.resolve()}removeSignedPreKey(e){return this.get("signed_prekey").id===e&&(this.unset("signed_prekey"),this.save()),Promise.resolve()}loadSession(e){return Promise.resolve(this.get("session"+e))}storeSession(e,t){return Promise.resolve(this.save("session"+e,t))}removeSession(e){return Promise.resolve(this.unset("session"+e))}removeAllSessions(e){const t=Object.keys(this.attributes).filter((t=>!!t.startsWith("session"+e)&&t)),s={};return t.forEach((e=>{s[e]=void 0})),this.save(s),Promise.resolve()}publishBundle(){const e=this.get("signed_prekey"),t=`${nP.NS.OMEMO_BUNDLES}:${this.get("device_id")}`,s=iP("item").c("bundle",{xmlns:nP.NS.OMEMO}).c("signedPreKeyPublic",{signedPreKeyId:e.id}).t(e.pubKey).up().c("signedPreKeySignature").t(e.signature).up().c("identityKey").t(this.get("identity_keypair").pubKey).up().c("prekeys");Object.values(this.get("prekeys")).forEach(((e,t)=>s.c("preKeyPublic",{preKeyId:t}).t(e.pubKey).up()));return hm.pubsub.publish(null,t,s,{access_model:"open"},!1)}async generateMissingPreKeys(){const{libsignal:e}=window,{KeyHelper:t}=e,s=Object.keys(this.getPreKeys()),n=sP(0,Bu.NUM_PREKEYS).map((e=>e.toString())).filter((e=>!s.includes(e)));if(n.length<1)return Ct.debug("No missing prekeys to generate for our own device"),Promise.resolve();(await Promise.all(n.map((e=>t.generatePreKey(parseInt(e,10)))))).forEach((e=>this.storePreKey(e.keyId,e.keyPair)));const i=this.getPreKeys(),r=Object.keys(i).map((e=>({id:e,key:i[e].pubKey}))),o=Bu.session.get("bare_jid"),a=(await hm.omemo.devicelists.get(o)).devices.get(this.get("device_id")),c=await a.getBundle();a.save("bundle",Object.assign(c,{prekeys:r}))}async generatePreKeys(){const e=Bu.NUM_PREKEYS,{libsignal:t}=window,{KeyHelper:s}=t,n=await Promise.all(sP(0,e).map((e=>s.generatePreKey(e))));return n.forEach((e=>this.storePreKey(e.keyId,e.keyPair))),n.map((e=>({id:e.keyId,key:rP.arrayBufferToBase64(e.keyPair.pubKey)})))}async generateBundle(){const{libsignal:e}=window,t=await e.KeyHelper.generateIdentityKeyPair(),s=rP.arrayBufferToBase64(t.pubKey),n=await async function(){const{libsignal:e}=window,t=Bu.session.get("bare_jid"),s=(await hm.omemo.devicelists.get(t,!0)).devices.pluck("id");let n=e.KeyHelper.generateRegistrationId(),i=0;for(;s.includes(n);)if(n=e.KeyHelper.generateRegistrationId(),i++,10===i)throw new Error("Unable to generate a unique device ID");return n.toString()}();this.save({device_id:n,identity_keypair:{privKey:rP.arrayBufferToBase64(t.privKey),pubKey:s},identity_key:s});const i=await e.KeyHelper.generateSignedPreKey(t,0);this.storeSignedPreKey(i);const r={identity_key:s,device_id:n,prekeys:await this.generatePreKeys()};r.signed_prekey={id:i.keyId,public_key:rP.arrayBufferToBase64(i.keyPair.pubKey),signature:rP.arrayBufferToBase64(i.signature)};const o=Bu.session.get("bare_jid"),a=await hm.omemo.devicelists.get(o);(await a.devices.create({id:r.device_id,jid:o},{promise:!0})).save("bundle",r)}fetchSession(){return void 0===this._setup_promise&&(this._setup_promise=new Promise(((e,t)=>{this.fetch({success:()=>{this.get("device_id")?e():this.generateBundle().then(e).catch(t)},error:(s,n)=>{Ct.warn("Could not fetch OMEMO session from cache, we'll generate a new one."),Ct.warn(n),this.generateBundle().then(e).catch(t)}})}))),this._setup_promise}},aP={omemo:{getDeviceID:async()=>(await hm.waitUntil("OMEMOInitialized"),Bu.state.omemo_store.get("device_id")),session:{async restore(){const{state:e}=Bu;if(void 0===e.omemo_store){const t=`converse.omemosession-${Bu.session.get("bare_jid")}`;e.omemo_store=new oP({id:t}),Ef.initStorage(e.omemo_store,t)}await e.omemo_store.fetchSession()}},devicelists:{async get(e,t=!1){const s=Bu.state.devicelists.get(e)||(t?Bu.state.devicelists.create({jid:e}):null);return await(s?.initialized),s}},bundle:{async generate(){await hm.waitUntil("OMEMOInitialized");const e=Bu.session.get("bare_jid"),t=await hm.omemo.devicelists.get(e),{omemo_store:s}=Bu.state,n=s.get("device_id");if(n){const e=t.devices.get(n);s.unset(n),e&&await new Promise((t=>e.destroy({success:t,error:t}))),t.devices.trigger("remove")}await s.generateBundle(),await t.publishDevices();const i=TL(t.devices.get(s.get("device_id")));return await s.publishBundle(),i}}}};var cP=s(9569),lP={};lP.styleTagTransform=I(),lP.setAttributes=j(),lP.insert=C().bind(null,"head"),lP.domAPI=E(),lP.insertStyleElement=O();A()(cP.A,lP);cP.A&&cP.A.locals&&cP.A.locals;const{Strophe:dP}=Cf.env,{shouldClearCache:uP}=Ef;Cf.env.omemo=PL,dP.addNamespace("OMEMO_DEVICELIST",dP.NS.OMEMO+".devicelist"),dP.addNamespace("OMEMO_VERIFICATION",dP.NS.OMEMO+".verification"),dP.addNamespace("OMEMO_WHITELISTED",dP.NS.OMEMO+".whitelisted"),dP.addNamespace("OMEMO_BUNDLES",dP.NS.OMEMO+".bundles"),Cf.plugins.add("converse-omemo",{enabled:e=>window.libsignal&&e.config.get("trusted")&&!hm.settings.get("clear_cache_on_logout")&&!e.api.settings.get("blacklisted_plugins").includes("converse-omemo"),dependencies:["converse-chatview","converse-pubsub","converse-profile"],initialize(){hm.settings.extend({omemo_default:!1}),hm.promises.add(["OMEMOInitialized"]),Object.assign(Bu.api,aP);const e={OMEMOStore:oP,Device:JL,Devices:YL,DeviceList:Qz,DeviceLists:Kz};Object.assign(Bu,e),Object.assign(Bu.exports,e),hm.waitUntil("chatBoxesInitialized").then(SL),hm.listen.on("getOutgoingMessageAttributes",vL),hm.listen.on("createMessageStanza",(async(e,t)=>{try{t=await LL(e,t)}catch(t){!function(e,t){if(e instanceof Bz){t.save("omemo_supported",!1);const s=[];Xz(`presence-subscription-required[xmlns="${Jz.NS.PUBSUB_ERROR}"]`,e.iq).length?s.push(HS("Sorry, we're unable to send an encrypted message because %1$s requires you to be subscribed to their presence in order to see their OMEMO information",e.iq.getAttribute("from"))):Xz('remote-server-not-found[xmlns="urn:ietf:params:xml:ns:xmpp-stanzas"]',e.iq).length?s.push(HS("Sorry, we're unable to send an encrypted message because the remote server for %1$s could not be found",e.iq.getAttribute("from"))):(s.push(HS("Unable to send an encrypted message due to an unexpected error.")),s.push(e.iq.outerHTML)),hm.alert("error",HS("Error"),s)}else e instanceof qz&&hm.alert("error",HS("Error"),[e.message]);throw e}(t,e)}return t})),hm.listen.on("afterFileUploaded",((e,t)=>e.file.xep454_ivkey?function(e,t){const s=t.oob_url.replace(/^https?:/,"aesgcm:")+"#"+e.file.xep454_ivkey;return Object.assign(t,{oob_url:null,message:s,body:s})}(e,t):t)),hm.listen.on("beforeFileUpload",((e,t)=>e.get("omemo_active")?async function(e){const t=crypto.getRandomValues(new Uint8Array(12)),s=await crypto.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]),n=await crypto.subtle.encrypt({name:"AES-GCM",iv:t},s,await e.arrayBuffer()),i=await window.crypto.subtle.exportKey("raw",s),r=new File([n],e.name,{type:e.type,lastModified:e.lastModified});return Object.assign(r,{xep454_ivkey:iL(t)+iL(i)}),r}(t):t)),hm.listen.on("parseMessage",wL),hm.listen.on("parseMUCMessage",wL),hm.listen.on("chatBoxViewInitialized",AL),hm.listen.on("chatRoomViewInitialized",AL),hm.listen.on("connected",IL),hm.listen.on("getToolbarButtons",zL),hm.listen.on("statusInitialized",ML),hm.listen.on("addClientFeatures",(()=>hm.disco.own.features.add(`${dP.NS.OMEMO_DEVICELIST}+notify`))),hm.listen.on("afterMessageBodyTransformed",yL),hm.listen.on("userDetailsModalInitialized",(e=>{jL(e.get("jid")).catch((e=>Ct.error(e)))})),hm.listen.on("profileModalInitialized",(()=>{jL(Bu.session.get("bare_jid")).catch((e=>Ct.error(e)))})),hm.listen.on("clearSession",(()=>{delete Bu.state.omemo_store,uP(Bu)&&Bu.state.devicelists&&(Bu.state.devicelists.clearStore(),delete Bu.state.devicelists)}))}});const{Strophe:hP,$iq:mP}=Cf.env,{CHATROOMS_TYPE:gP}=DS;async function pP(e){if(!e){const t=Bu.session.get("bare_jid");e=t}const t=Bu.session.get("push_enabled")||[];if(t.includes(e))return;const s=hm.settings.get("push_app_servers").filter((e=>!e.disable)),n=hm.settings.get("push_app_servers").filter((e=>e.disable)),i=s.map((t=>async function(e,t){if(!t.jid||!t.node)return;if(!await hm.disco.getIdentity("pubsub","push",t.jid))return Ct.warn(`Not enabling push the service "${t.jid}", it doesn't have the right disco identtiy.`);const s=await Promise.all([hm.disco.supports(hP.NS.PUSH,t.jid),hm.disco.supports(hP.NS.PUSH,e)]);if(!s[0]&&!s[1])return void Ct.warn(`Not enabling push app server "${t.jid}", no disco support from your server.`);const n=mP({type:"set"});return e!==Bu.session.get("bare_jid")&&n.attrs({to:e}),n.c("enable",{xmlns:hP.NS.PUSH,jid:t.jid,node:t.node}),t.secret&&n.c("x",{xmlns:hP.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE"}).c("value").t(`${hP.NS.PUBSUB}#publish-options`).up().up().c("field",{var:"secret"}).c("value").t(t.secret),hm.sendIQ(n)}(e,t))),r=n.map((t=>async function(e,t){if(!t.jid)return;const s=Bu.session.get("bare_jid");if(!await hm.disco.supports(hP.NS.PUSH,e||s))return void Ct.warn(`Not disabling push app server "${t.jid}", no disco support from your server.`);const n=mP({type:"set"});e!==s&&n.attrs({to:e}),n.c("disable",{xmlns:hP.NS.PUSH,jid:t.jid}),t.node&&n.attrs({node:t.node}),hm.sendIQ(n).catch((e=>{Ct.error(`Could not disable push app server for ${t.jid}`),Ct.error(e)}))}(e,t)));try{await Promise.all(i.concat(r))}catch(e){Ct.error("Could not enable or disable push App Server"),e&&Ct.error(e)}finally{t.push(e)}Bu.session.save("push_enabled",t)}function fP(e){e.get("type")==gP&&pP(hP.getDomainFromJid(e.get("jid")))}const{Strophe:vP}=Cf.env;vP.addNamespace("PUSH","urn:xmpp:push:0"),Cf.plugins.add("converse-push",{initialize(){hm.settings.extend({push_app_servers:[],enable_muc_push:!1}),hm.listen.on("statusInitialized",(()=>pP())),hm.settings.get("enable_muc_push")&&hm.listen.on("chatBoxesInitialized",(()=>Bu.state.chatboxes.on("add",fP)))}});const _P=()=>{const e=HS("Already have a chat account?"),t=HS("Log in here");return fp`<div class="switch-form"><p>${e}</p><p><a class="login-here toggle-register-login" href="#converse/login">${t}</a></p></div>`},bP=e=>{const t=hm.settings.get("registration_domain"),s=HS("Create your account"),n=HS("Please enter the XMPP provider to register with:"),i=!t&&e.status===yP;return fp`<form id="converse-register" class="converse-form" @submit="${t=>e.onFormSubmission(t)}"><legend class="col-form-label">${s}</legend><div><label class="form-label">${n}</label> ${t||(()=>{const e=hm.settings.get("domain_placeholder"),t=HS("Tip: A list of public XMPP providers is available"),s=HS("here"),n=hm.settings.get("providers_link");return fp`<input class="form-control" required="required" type="text" name="domain" placeholder="${e}"><p class="form-text text-muted">${t} <a href="${n}" class="url" target="_blank" rel="noopener">${s}</a>.</p>`})()}</div>${i?(()=>{const e=HS("Fetch registration form"),t=HS("Already have a chat account?"),s=HS("Log in here");return fp`<fieldset class="form-group buttons"><input class="btn btn-primary" type="submit" value="${e}"></fieldset><div class="switch-form"><p>${t}</p><p><a class="login-here toggle-register-login" href="#converse/login">${s}</a></p></div>`})():""}</form>`},yP=0,wP=e=>fp`<converse-brand-logo></converse-brand-logo>${e.alert_message?fp`<div class="alert alert-${e.alert_type}" role="alert">${e.alert_message}</div>`:""} ${e.status===yP?bP(e):""} ${1===e.status?(e=>{const t=hm.settings.get("registration_domain"),s=HS("Cancel");return fp`<form id="converse-register" class="converse-form no-scrolling" @submit="${t=>e.onFormSubmission(t)}">${vT({classes:"hor_centered"})} ${t?"":fp`<button class="btn btn-secondary button-cancel hor_centered" @click="${t=>e.renderProviderChoiceForm(t)}">${s}</button>`}</form>`})(e):""} ${2===e.status?(e=>{const t=HS("Choose a different provider"),s=HS("Account Registration:"),n=HS("Register"),i=hm.settings.get("registration_domain");return fp`<form id="converse-register" class="converse-form" @submit="${t=>e.onFormSubmission(t)}"><legend class="col-form-label">${s} ${e.domain}</legend><p class="title">${e.title}</p><p class="form-help instructions">${e.instructions}</p><div class="form-errors hidden"></div>${e.form_fields}<fieldset class="buttons form-group">${e.fields?fp`<input type="submit" class="btn btn-primary" value="${n}">`:""} ${i?"":fp`<input type="button" class="btn btn-secondary button-cancel" value="${t}" @click="${t=>e.renderProviderChoiceForm(t)}">`} ${_P()}</fieldset></form>`})(e):""} ${3===e.status?_P():""}`;async function SP(e){await hm.waitUntil("controlBoxInitialized");const{chatboxes:t}=Bu.state;t.get("controlbox").set({"active-form":e})}function AP(e){"#converse/login"===location.hash?(e?.preventDefault(),SP("login")):"#converse/register"===location.hash&&(e?.preventDefault(),SP("register"))}var xP=s(9847),EP={};EP.styleTagTransform=I(),EP.setAttributes=j(),EP.insert=C().bind(null,"head"),EP.domAPI=E(),EP.insertStyleElement=O();A()(xP.A,EP);xP.A&&xP.A.locals&&xP.A.locals;const{Strophe:$P,sizzle:CP,$iq:kP}=Cf.env,{CONNECTION_STATUS:jP}=DS,TP=1,OP=2;hm.elements.define("converse-register-panel",class extends VS{static get properties(){return{status:{type:String},alert_message:{type:String},alert_type:{type:String}}}constructor(){super(),this.urls=[],this.fields={},this.domain=null,this.alert_type="info",this.setErrorMessage=e=>this.setMessage(e,"danger"),this.setFeedbackMessage=e=>this.setMessage(e,"info")}initialize(){this.reset(),this.listenTo(Bu,"connectionInitialized",(()=>this.registerHooks()));const e=hm.settings.get("registration_domain");e?this.fetchRegistrationForm(e):this.status=0}render(){return wP(this)}setMessage(e,t){this.alert_type=t,this.alert_message=e}registerHooks(){const e=hm.connection.get(),t=e._connect_cb.bind(e);e._connect_cb=(e,s,n)=>{this._registering?this.getRegistrationFields(e,s)&&(this._registering=!1):t(e,s,n)}}getRegistrationFields(e,t){const s=hm.connection.get();s.connected=!0;const n=s._proto._reqToData(e);if(!n)return;if(s._proto._connect_cb(n)===$P.Status.CONNFAIL)return this.status=0,this.setErrorMessage(HS("Sorry, we're unable to connect to your chosen provider.")),!1;const i=n.getElementsByTagName("register"),r=n.getElementsByTagName("mechanism");if(0===i.length&&0===r.length)return s._proto._no_auth_received(t),!1;if(0===i.length)return s._changeConnectStatus($P.Status.REGIFAIL),this.alert_type="danger",this.setErrorMessage(HS("Sorry, the given provider does not support in band account registration. Please try with a different provider.")),!0;s._addSysHandler((e=>this.onRegistrationFields(e)),null,"iq",null,null);const o=kP({type:"get"}).c("query",{xmlns:$P.NS.REGISTER}).tree();return o.setAttribute("id",s.getUniqueId("sendIQ")),s.send(o),s.connected=!1,!0}onRegistrationFields(e){return"error"===e.getAttribute("type")?(this.reportErrors(e),hm.settings.get("registration_domain")?this.status=3:this.status=0,!1):(this.setFields(e),this.status===TP&&this.renderRegistrationForm(e),!1)}reset(e){Object.assign(this,{fields:{},urls:[],title:"",instructions:"",registered:!1,_registering:!1,domain:null,form_type:null}),e&&Object.assign(this,e)}onFormSubmission(e){e?.preventDefault?.();const t=e.target;null===t.querySelector("input[name=domain]")?this.submitRegistrationForm(t):this.onProviderChosen(t)}onProviderChosen(e){const t=e.querySelector("input[name=domain]")?.value;t&&this.fetchRegistrationForm(t.trim())}fetchRegistrationForm(e){return this.status=TP,this.reset({domain:$P.getDomainFromJid(e),_registering:!0}),hm.connection.init(),hm.connection.get()?.connect(this.domain,"",(e=>this.onConnectStatusChanged(e))),!1}onConnectStatusChanged(e){if(Ct.debug("converse-register: onConnectStatusChanged"),[$P.Status.DISCONNECTED,$P.Status.CONNFAIL,$P.Status.REGIFAIL,$P.Status.NOTACCEPTABLE,$P.Status.CONFLICT].includes(e))Ct.error(`Problem during registration: Strophe.Status is ${jP[e]}`),this.abortRegistration();else if(e===$P.Status.REGISTERED){if(Ct.debug("Registered successfully."),hm.connection.get().reset(),["converse/login","converse/register"].includes(window.location.hash)&&history.pushState(null,"",window.location.pathname),SP("login"),this.fields.password&&this.fields.username){const e=hm.connection.get();e.connect(this.fields.username.toLowerCase()+"@"+this.domain.toLowerCase(),this.fields.password,e.onConnectStatusChanged),this.setFeedbackMessage(HS("Now logging you in"))}else this.setFeedbackMessage(HS("Registered successfully"));this.reset()}}getLegacyFormFields(){const e=Object.keys(this.fields).map((e=>"username"===e?Lj({domain:` @${this.domain}`,name:e,type:"text",label:e,value:"",required:!0}):Rj({label:e,name:e,placeholder:e,required:!0,type:"password"===e||"email"===e?e:"text",value:""}))),t=this.urls.map((e=>zj({label:"",value:e})));return[...e,...t]}getFormFields(e){if("xform"===this.form_type){const{fields:t}=Zf(e);return t?.map((e=>Ef.xFormField2TemplateResult(e,{domain:this.domain})))??[]}return this.getLegacyFormFields()}renderRegistrationForm(e){this.form_fields=this.getFormFields(e),this.status=OP}reportErrors(e){const t=Array.from(e.querySelectorAll("error"));t.length?this.setErrorMessage(t.reduce(((e,t)=>`${e}\n${t.textContent}`),"")):this.setErrorMessage(HS("The provider rejected your registration attempt. Please check the values you entered for correctness."))}renderProviderChoiceForm(e){e?.preventDefault?.();const t=hm.connection.get();t._proto._abortAllRequests(),t.reset(),this.status=0}abortRegistration(){const e=hm.connection.get();e._proto._abortAllRequests(),e.reset(),[TP,OP].includes(this.status)?hm.settings.get("registration_domain")&&this.fetchRegistrationForm(hm.settings.get("registration_domain")):this.requestUpdate()}submitRegistrationForm(e){const t=CP(":input:not([type=button]):not([type=submit])",e),s=kP({type:"set",id:Ef.getUniqueId()}).c("query",{xmlns:$P.NS.REGISTER});if("xform"===this.form_type){s.c("x",{xmlns:$P.NS.XFORM,type:"submit"});const e=t.map((e=>Ef.webForm2xForm(e))).filter((e=>e));e.forEach((e=>s.cnode(e).up()))}else t.forEach((e=>s.c(e.getAttribute("name"),{},e.value)));const n=hm.connection.get();n._addSysHandler((e=>this._onRegisterIQ(e)),null,"iq",null,null),n.send(s),this.setFields(s.tree())}setFields(e){const t=e.querySelector("query"),s=CP(`x[xmlns="${$P.NS.XFORM}"]`,t);s.length>0?this.setFieldsFromXForm(s.pop()):this.setFieldsFromLegacy(t)}setFieldsFromLegacy(e){[].forEach.call(e.children,(e=>{"instructions"!==e.tagName.toLowerCase()?"x"!==e.tagName.toLowerCase()?this.fields[e.tagName.toLowerCase()]=$P.getText(e):"jabber:x:oob"===e.getAttribute("xmlns")&&this.urls.concat(CP("url",e).map((e=>e.textContent))):this.instructions=$P.getText(e)})),this.form_type="legacy"}setFieldsFromXForm(e){this.title=e.querySelector("title")?.textContent??"",this.instructions=e.querySelector("instructions")?.textContent??"",e.querySelectorAll("field").forEach((e=>{const t=e.getAttribute("var");t?this.fields[t.toLowerCase()]=e.querySelector("value")?.textContent??"":Ct.warn("Found field we couldn't parse")})),this.form_type="xform"}_onRegisterIQ(e){const t=hm.connection.get();if("error"===e.getAttribute("type")){Ct.error("Registration failed."),this.reportErrors(e);const s=e.getElementsByTagName("error");if(1!==s.length)return t._changeConnectStatus($P.Status.REGIFAIL,"unknown"),!1;const n=s[0].firstElementChild.tagName.toLowerCase();"conflict"===n?t._changeConnectStatus($P.Status.CONFLICT,n):"not-acceptable"===n?t._changeConnectStatus($P.Status.NOTACCEPTABLE,n):t._changeConnectStatus($P.Status.REGIFAIL,n)}else t._changeConnectStatus($P.Status.REGISTERED,null);return!1}});const{Strophe:NP}=Cf.env,{CONNECTION_STATUS:IP}=DS;NP.addNamespace("REGISTER","jabber:iq:register");const MP=Object.keys(NP.Status).reduce(((e,t)=>Math.max(e,NP.Status[t])),0);NP.Status.REGIFAIL=MP+1,NP.Status.REGISTERED=MP+2,NP.Status.CONFLICT=MP+3,NP.Status.NOTACCEPTABLE=MP+5,Cf.plugins.add("converse-register",{dependencies:["converse-controlbox"],enabled:()=>!0,initialize(){IP[NP.Status.REGIFAIL]="REGIFAIL",IP[NP.Status.REGISTERED]="REGISTERED",IP[NP.Status.CONFLICT]="CONFLICT",IP[NP.Status.NOTACCEPTABLE]="NOTACCEPTABLE",hm.settings.extend({allow_registration:!0,domain_placeholder:HS(" e.g. conversejs.org"),providers_link:"https://compliance.conversations.im/",registration_domain:""}),AP(),addEventListener("hashchange",AP)}});const{Strophe:RP}=Cf.env,{OPENED:DP}=DS;const zP=class extends fd{defaults(){return{muc_domain:hm.settings.get("muc_domain"),toggle_state:DP,collapsed_domains:[]}}initialize(){super.initialize(),hm.settings.listen.on("change:muc_domain",(e=>this.setDomain(e)))}setDomain(e){hm.settings.get("locked_muc_domain")||this.save("muc_domain",RP.getDomainFromJid(e))}},{Strophe:LP,$iq:PP,sizzle:FP}=Cf.env;LP.addNamespace("MUCSEARCH","https://xmlns.zombofant.net/muclumbus/search/1.0");const UP={};function BP(e){return UP[e]||(UP[e]=async function(e){const t=hm.settings.get("muc_search_service"),s=Bu.session.get("bare_jid"),n=PP({type:"get",from:s,to:t}).c("search",{xmlns:LP.NS.MUCSEARCH}).c("set",{xmlns:LP.NS.RSM}).c("max").t(10).up().up().c("x",{xmlns:LP.NS.XFORM,type:"submit"}).c("field",{var:"FORM_TYPE",type:"hidden"}).c("value").t("https://xmlns.zombofant.net/muclumbus/search/1.0#params").up().up().c("field",{var:"q",type:"text-single"}).c("value").t(e).up().up().c("field",{var:"sinname",type:"boolean"}).c("value").t("true").up().up().c("field",{var:"sindescription",type:"boolean"}).c("value").t("false").up().up().c("field",{var:"sinaddr",type:"boolean"}).c("value").t("true").up().up().c("field",{var:"min_users",type:"text-single"}).c("value").t("1").up().up().c("field",{var:"key",type:"list-single"}).c("value").t("address").up().c("option").c("value").t("nusers").up().up().c("option").c("value").t("address");let i;try{i=await hm.sendIQ(n)}catch(e){return Ct.error(e),[]}const r=`result[xmlns="${LP.NS.MUCSEARCH}"] item`;return FP(r,i).map((e=>{const t=e.getAttribute("address");return{label:`${e.querySelector("name")?.textContent} (${t})`,value:t}}))}(e)),UP[e]}const qP=e=>{const t=HS("Join"),s=e.model.get("muc_domain")||hm.settings.get("muc_domain");let n="";hm.settings.get("locked_muc_domain")||(n=s?`name@${s}`:HS("name@conference.example.org"));const i=HS(s?"Groupchat name":"Groupchat address"),r=e.muc_roomid_policy_error_msg,o=hm.settings.get("muc_roomid_policy_hint"),a=hm.settings.get("muc_search_service");return fp`<form class="converse-form add-chatroom" @submit="${t=>e.openChatRoom(t)}"><div><label for="chatroom" class="form-label">${i}:</label> ${r?fp`<label class="form-label roomid-policy-error">${r}</label>`:""} ${a?fp`<converse-autocomplete .getAutoCompleteList="${BP}" ?autofocus="${!0}" min_chars="3" position="below" placeholder="${n}" class="add-muc-autocomplete" name="chatroom"></converse-autocomplete>`:""}</div>${o?fp`<div>${HI(G().sanitize(o,{ALLOWED_TAGS:["b","br","em"]}))}</div>`:""} ${hm.settings.get("locked_muc_nickname")?"":(()=>{const e=HS("Nickname"),t=HS("This field is required");return fp`<div><label for="nickname" class="form-label">${e}:</label> <input type="text" title="${t}" required="required" name="nickname" value="${Bu.exports.getDefaultMUCNickname()||""}" class="form-control"></div>`})()} <input type="submit" class="btn btn-primary" name="join" value="${t||""}" ?disabled="${r}"></form>`};var HP=s(3370),GP={};GP.styleTagTransform=I(),GP.setAttributes=j(),GP.insert=C().bind(null,"head"),GP.domAPI=E(),GP.insertStyleElement=O();A()(HP.A,GP);HP.A&&HP.A.locals&&HP.A.locals;const WP=Cf.env.utils,{Strophe:VP}=Cf.env;hm.elements.define("converse-add-muc-modal",class extends uj{initialize(){super.initialize(),this.listenTo(this.model,"change:muc_domain",(()=>this.render())),this.muc_roomid_policy_error_msg=null,this.render(),this.addEventListener("shown.bs.modal",(()=>{this.querySelector('input[name="chatroom"]').focus()}),!1)}renderModal(){return qP(this)}getModalTitle(){return HS("Enter a new Groupchat")}parseRoomDataFromEvent(e){const t=new FormData(e),s=t.get("chatroom")?.trim();let n;if(hm.settings.get("locked_muc_nickname")){if(n=Bu.exports.getDefaultMUCNickname(),!n)throw new Error("Using locked_muc_nickname but no nickname found!")}else n=t.get("nickname").trim();return{jid:s,nick:n}}openChatRoom(e){if(e.preventDefault(),this.checkRoomidPolicy())return;const t=this.parseRoomDataFromEvent(e.target);let s;""===t.nick&&(t.nick=void 0),hm.settings.get("locked_muc_domain")||hm.settings.get("muc_domain")&&!WP.isValidJID(t.jid)?s=`${VP.escapeNode(t.jid)}@${hm.settings.get("muc_domain")}`:(s=t.jid,this.model.setDomain(s)),hm.rooms.open(s,Object.assign(t,{jid:s}),!0),e.target.reset(),this.modal.hide()}checkRoomidPolicy(){if(hm.settings.get("muc_roomid_policy")&&hm.settings.get("muc_domain")){let e=this.querySelector("converse-autocomplete input").value;!hm.settings.get("locked_muc_domain")&&WP.isValidJID(e)||(e=`${VP.escapeNode(e)}@${hm.settings.get("muc_domain")}`);const t=VP.getNodeFromJid(e),s=VP.getDomainFromJid(e);if(hm.settings.get("muc_domain")===s&&!hm.settings.get("muc_roomid_policy").test(t))return this.muc_roomid_policy_error_msg=HS("Groupchat id is invalid."),!0;this.muc_roomid_policy_error_msg=null,this.render()}}});const QP=e=>{const t=HS("Description:"),s=HS("Groupchat XMPP Address:"),n=HS("Participants:"),i=HS("Features:"),r=HS("Requires authentication"),o=HS("Hidden"),a=HS("Requires an invitation"),c=HS("Moderated"),l=HS("Non-anonymous"),d=HS("Open"),u=HS("Permanent"),h=HS("Public"),m=HS("Semi-anonymous"),g=HS("Temporary"),p=HS("Unmoderated");return fp`<div class="room-info"><p class="room-info"><strong>${s}</strong> ${e.jid}</p><p class="room-info"><strong>${t}</strong> ${e.desc}</p><p class="room-info"><strong>${n}</strong> ${e.occ}</p><p class="room-info"><strong>${i}</strong></p><ul>${e.passwordprotected?fp`<li class="room-info locked">${r}</li>`:""} ${e.hidden?fp`<li class="room-info">${o}</li>`:""} ${e.membersonly?fp`<li class="room-info">${a}</li>`:""} ${e.moderated?fp`<li class="room-info">${c}</li>`:""} ${e.nonanonymous?fp`<li class="room-info">${l}</li>`:""} ${e.open?fp`<li class="room-info">${d}</li>`:""} ${e.persistent?fp`<li class="room-info">${u}</li>`:""} ${e.publicroom?fp`<li class="room-info">${h}</li>`:""} ${e.semianonymous?fp`<li class="room-info">${m}</li>`:""} ${e.temporary?fp`<li class="room-info">${g}</li>`:""} ${e.unmoderated?fp`<li class="room-info">${p}</li>`:""}</ul><p></p></div>`},KP=e=>fp`${e.show_form?(e=>{const t=HS("Show groupchats"),s=HS("Server address");return fp`<form class="converse-form list-chatrooms" @submit="${e.submitForm}"><div><label class="form-label" for="chatroom">${s}:</label> <input type="text" autofocus @change="${e.setDomainFromEvent}" value="${e.muc_domain||""}" required="required" name="server" class="form-control" placeholder="${e.server_placeholder}"></div><input type="submit" class="btn btn-primary" name="list" value="${t}"></form>`})(e):""}<ul class="available-chatrooms list-group">${e.loading_items?fp`<li class="list-group-item">${vT()}</li>`:""} ${e.feedback_text?fp`<li class="list-group-item active">${e.feedback_text}</li>`:""} ${kO(e.items,(e=>e.jid),(t=>((e,t)=>{const s=HS("Show more information on this groupchat"),n=HS("Click to open this groupchat");return fp`<li class="room-item list-group-item"><div class="available-chatroom d-flex flex-row"><a class="open-room available-room w-100" @click="${e.openRoom}" data-room-jid="${t.jid}" data-room-name="${t.name}" title="${n}" href="#">${t.name||t.jid}</a> <a class="right room-info icon-room-info" @click="${e.toggleRoomInfo}" data-room-jid="${t.jid}" title="${s}" href="#"></a></div></li>`})(e,t)))}</ul>`,{Strophe:JP,$iq:YP,sizzle:XP}=Cf.env,{getAttributes:ZP}=Ef;function eF(e){const t=Ef.ancestor(e.target,".room-item"),s=t.querySelector("div.room-info");s?(Ef.slideIn(s).then(Ef.removeElement),t.querySelector("a.room-info").classList.remove("selected")):(t.insertAdjacentElement("beforeend",Ef.getElementFromTemplateResult(vT())),hm.disco.info(e.target.getAttribute("data-room-jid"),null).then((e=>function(e,t){e.querySelector("span.spinner").remove(),e.querySelector("a.room-info").classList.add("selected"),e.insertAdjacentHTML("beforeend",Ef.getElementFromTemplateResult(QP({jid:t.getAttribute("from"),desc:XP('field[var="muc#roominfo_description"] value',t).shift()?.textContent,occ:XP('field[var="muc#roominfo_occupants"] value',t).shift()?.textContent,hidden:XP('feature[var="muc_hidden"]',t).length,membersonly:XP('feature[var="muc_membersonly"]',t).length,moderated:XP('feature[var="muc_moderated"]',t).length,nonanonymous:XP('feature[var="muc_nonanonymous"]',t).length,open:XP('feature[var="muc_open"]',t).length,passwordprotected:XP('feature[var="muc_passwordprotected"]',t).length,persistent:XP('feature[var="muc_persistent"]',t).length,publicroom:XP('feature[var="muc_publicroom"]',t).length,semianonymous:XP('feature[var="muc_semianonymous"]',t).length,temporary:XP('feature[var="muc_temporary"]',t).length,unmoderated:XP('feature[var="muc_unmoderated"]',t).length})))}(t,e))).catch((e=>Ct.error(e))))}hm.elements.define("converse-muc-list-modal",class extends uj{constructor(e){super(e),this.items=[],this.loading_items=!1}initialize(){super.initialize(),this.listenTo(this.model,"change:muc_domain",this.onDomainChange),this.listenTo(this.model,"change:feedback_text",(()=>this.render())),this.addEventListener("shown.bs.modal",(()=>hm.settings.get("locked_muc_domain")&&this.updateRoomsList())),this.model.save("feedback_text","")}renderModal(){return KP(Object.assign(this.model.toJSON(),{show_form:!hm.settings.get("locked_muc_domain"),server_placeholder:this.model.get("muc_domain")||HS("conference.example.org"),items:this.items,loading_items:this.loading_items,openRoom:e=>this.openRoom(e),setDomainFromEvent:e=>this.setDomainFromEvent(e),submitForm:e=>this.showRooms(e),toggleRoomInfo:e=>this.toggleRoomInfo(e)}))}getModalTitle(){return HS("Query for Groupchats")}openRoom(e){e.preventDefault();const t=e.target.getAttribute("data-room-jid"),s=e.target.getAttribute("data-room-name");this.modal.hide(),hm.rooms.open(t,{name:s},!0)}toggleRoomInfo(e){e.preventDefault(),eF(e)}onDomainChange(){hm.settings.get("auto_list_rooms")&&this.updateRoomsList()}onRoomsFound(e){this.loading_items=!1;const t=e?XP("query item",e):[];return t.length?(this.model.set({feedback_text:HS("Groupchats found")},{silent:!0}),this.items=t.map(ZP)):(this.items=[],this.model.set({feedback_text:HS("No groupchats found")},{silent:!0})),this.render(),!0}updateRoomsList(){const e=YP({to:this.model.get("muc_domain"),from:hm.connection.get().jid,type:"get"}).c("query",{xmlns:JP.NS.DISCO_ITEMS});hm.sendIQ(e).then((e=>this.onRoomsFound(e))).catch((()=>this.onRoomsFound()))}showRooms(e){e.preventDefault(),this.loading_items=!0,this.render();const t=new FormData(e.target);this.model.setDomain(t.get("server")),this.updateRoomsList()}setDomainFromEvent(e){this.model.setDomain(e.target.value)}setNick(e){this.model.save({nick:e.target.value})}});var tF=s(2579),sF={};sF.styleTagTransform=I(),sF.setAttributes=j(),sF.insert=C().bind(null,"head"),sF.domAPI=E(),sF.insertStyleElement=O();A()(tF.A,sF);tF.A&&tF.A.locals&&tF.A.locals;const{CHATROOMS_TYPE:nF,CLOSED:iF}=DS,{isUniView:rF}=Ef;function oF(e){return rF()&&!e.get("hidden")}function aF(e,t){const s=HS("Leave this groupchat"),n=t.get("num_unread_general")||t.get("has_activity");return fp`<li class="list-item controlbox-padded available-chatroom d-flex flex-row ${oF(t)?"open":""} ${n?"unread-msgs":""}" data-room-jid="${t.get("jid")}"><a class="list-item-link open-room available-room w-100" data-room-jid="${t.get("jid")}" data-room-name="${t.getDisplayName()}" title="${HS("Click to open this groupchat")}" @click="${t=>e.openRoom(t)}"><converse-avatar .model="${t}" class="avatar avatar-muc" name="${t.getDisplayName()}" nonce="${t.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar><span>${t.get("num_unread")?function(e){return fp`<span class="list-item-badge badge badge--muc msgs-indicator">${BO(e)}</span>`}(t):t.get("has_activity")?fp`<span class="list-item-badge badge badge--muc msgs-indicator"></span>`:""} ${t.getDisplayName()}</span> </a>${hm.settings.get("allow_bookmarks")?function(e){const t=e.get("bookmarked")??!1,s=HS("Bookmark");return fp`<a class="list-item-action add-bookmark" tabindex="0" data-room-jid="${e.get("jid")}" data-bookmark-name="${e.getDisplayName()}" @click="${e=>fO(e)}" title="${s}"><converse-icon class="fa ${t?"fa-bookmark":"fa-bookmark-empty"}" size="1.2em" color="${oF(e)?"var(--foreground-color)":""}"></converse-icon></a>`}(t):""} <a class="list-item-action close-room" tabindex="0" data-room-jid="${t.get("jid")}" data-room-name="${t.getDisplayName()}" title="${s}" @click="${t=>e.closeRoom(t)}"><converse-icon class="fa fa-sign-out-alt" size="1.2em" color="${oF(t)?"var(--foreground-color)":""}"></converse-icon></a></li>`}function cF(e,t){const s=new Map;for(const e of t){const t=e.get("jid").split("@").at(-1).toLowerCase();s.has(t)?s.get(t).push(e):s.set(t,[e])}const n=Array.from(s.keys());return n.sort(),n.map((t=>function(e,t,s){const n=HS("Click to hide these rooms"),i=e.model.get("collapsed_domains").includes(t);return fp`<div class="muc-domain-group" data-domain="${t}"><a href="#" class="list-toggle muc-domain-group-toggle controlbox-padded" title="${n}" @click="${s=>e.toggleDomainList(s,t)}"><converse-icon class="fa ${i?"fa-caret-right":"fa-caret-down"}" size="1em" color="var(--muc-color)"></converse-icon>${t}</a><ul class="items-list muc-domain-group-rooms ${i?"collapsed":""}" data-domain="${t}">${s.map((t=>aF(e,t)))}</ul></div>`}(e,t,s.get(t))))}const{Strophe:lF}=Cf.env,{initStorage:dF}=Ef,{CLOSED:uF,OPENED:hF}=DS;hm.elements.define("converse-rooms-list",class extends VS{initialize(){const e=`converse.roomspanel${Bu.session.get("bare_jid")}`;this.model=new zP({id:e}),dF(this.model,e),this.model.fetch();const{chatboxes:t}=Bu.state;this.listenTo(t,"add",this.renderIfChatRoom),this.listenTo(t,"remove",this.renderIfChatRoom),this.listenTo(t,"destroy",this.renderIfChatRoom),this.listenTo(t,"change",this.renderIfRelevantChange),this.listenTo(t,"vcard:add",(()=>this.requestUpdate())),this.listenTo(t,"vcard:change",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.requestUpdate()}render(){return(e=>{const t=hm.settings.get("muc_grouped_by_domain"),{chatboxes:s}=Bu.state,n=s.filter((e=>e.get("type")===nF));n.sort(((e,t)=>e.getDisplayName().toLowerCase()<=t.getDisplayName().toLowerCase()?-1:1));const i=HS("Click to toggle the list of open groupchats"),r=HS("Groupchats"),o=HS("Query server"),a=HS("Add groupchat"),c=HS("Bookmarks"),l=e.model.get("toggle_state")===iF,d=[fp`<a class="dropdown-item show-bookmark-list-modal" role="button" @click="${t=>hm.modal.show("converse-bookmark-list-modal",{model:e.model},t)}" data-toggle="modal"><converse-icon class="fa fa-bookmark" size="1em"></converse-icon>${c}</a>`,fp`<a class="dropdown-item show-list-muc-modal" role="button" @click="${t=>hm.modal.show("converse-muc-list-modal",{model:e.model},t)}" data-toggle="modal" data-target="#muc-list-modal"><converse-icon class="fa fa-list-ul" size="1em"></converse-icon>${o}</a>`,fp`<a class="dropdown-item show-add-muc-modal" role="button" @click="${t=>hm.modal.show("converse-add-muc-modal",{model:e.model},t)}" data-toggle="modal" data-target="#add-chatrooms-modal"><converse-icon class="fa fa-plus" size="1em"></converse-icon>${a}</a>`];return fp`<div class="d-flex controlbox-padded"><span class="w-100 controlbox-heading controlbox-heading--groupchats"><a class="list-toggle open-rooms-toggle" role="heading" aria-level="3" title="${i}" @click="${t=>e.toggleRoomsList(t)}">${r} ${n.length?fp`<converse-icon class="fa ${l?"fa-caret-right":"fa-caret-down"}" size="1em" color="var(--muc-color)"></converse-icon>`:""}</a></span><converse-dropdown class="btn-group dropstart" .items="${d}"></converse-dropdown></div><div class="list-container list-container--openrooms ${n.length?"":"hidden"}"><ul class="items-list rooms-list open-rooms-list ${l?"collapsed":""}">${t?cF(e,n):n.map((t=>aF(e,t)))}</ul></div>`})(this)}renderIfChatRoom(e){Ef.muc.isChatRoom(e)&&this.requestUpdate()}renderIfRelevantChange(e){const t=["bookmarked","hidden","name","num_unread","num_unread_general","has_activity"],s=e.changed||{};Ef.muc.isChatRoom(e)&&Object.keys(s).filter((e=>t.includes(e))).length&&this.requestUpdate()}async openRoom(e){e.preventDefault();const t=Ef.ancestor(e.target,".open-room"),s=t.getAttribute("data-room-name"),n=t.getAttribute("data-room-jid"),i={name:s||lF.unescapeNode(lF.getNodeFromJid(n))||n};await hm.rooms.open(n,i,!0)}async closeRoom(e){e.preventDefault();const t=e.currentTarget,s=t.getAttribute("data-room-name"),n=t.getAttribute("data-room-jid");if(await hm.confirm(HS("Are you sure you want to leave the groupchat %1$s?",s))){(await hm.rooms.get(n)).close()}}toggleRoomsList(e){e?.preventDefault?.();const t=this.querySelector(".open-rooms-list");this.model.get("toggle_state")===uF?Ef.slideOut(t).then((()=>this.model.save({toggle_state:hF}))):Ef.slideIn(t).then((()=>this.model.save({toggle_state:uF})))}toggleDomainList(e,t){e?.preventDefault?.();const s=this.model.get("collapsed_domains");s.includes(t)?this.model.save({collapsed_domains:s.filter((e=>e!==t))}):this.model.save({collapsed_domains:[...s,t]})}}),Cf.plugins.add("converse-roomslist",{dependencies:["converse-singleton","converse-controlbox","converse-muc","converse-bookmarks"],initialize(){hm.settings.extend({muc_grouped_by_domain:!1})}});hm.elements.define("converse-fontawesome",class extends VS{render(){return fp`<?xml version="1.0" encoding="UTF-8"?> <svg xmlns="http://www.w3.org/2000/svg" style="display:none"><symbol id="icon-filter" viewBox="0 0 512 512"><path d="M3.9 54.9C10.5 40.9 24.5 32 40 32H472c15.5 0 29.5 8.9 36.1 22.9s4.6 30.5-5.2 42.5L320 320.9V448c0 12.1-6.8 23.2-17.7 28.6s-23.8 4.3-33.5-3l-64-48c-8.1-6-12.8-15.5-12.8-25.6V320.9L9 97.3C-.7 85.4-2.8 68.8 3.9 54.9z"/></symbol><symbol id="icon-address-book" viewBox="0 0 448 512"><path d="M436 160c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20V48c0-26.5-21.5-48-48-48H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h320c26.5 0 48-21.5 48-48v-48h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20c6.6 0 12-5.4 12-12v-40c0-6.6-5.4-12-12-12h-20v-64h20zm-228-32c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm112 236.8c0 10.6-10 19.2-22.4 19.2H118.4C106 384 96 375.4 96 364.8v-19.2c0-31.8 30.1-57.6 67.2-57.6h5c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h5c37.1 0 67.2 25.8 67.2 57.6v19.2z"></path></symbol><symbol id="icon-angle-double-down" viewBox="0 0 320 512"><path d="M143 256.3L7 120.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0L313 86.3c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.4 9.5-24.6 9.5-34 .1zm34 192l136-136c9.4-9.4 9.4-24.6 0-33.9l-22.6-22.6c-9.4-9.4-24.6-9.4-33.9 0L160 352.1l-96.4-96.4c-9.4-9.4-24.6-9.4-33.9 0L7 278.3c-9.4 9.4-9.4 24.6 0 33.9l136 136c9.4 9.5 24.6 9.5 34 .1z"></path></symbol><symbol id="icon-angle-double-left" viewBox="0 0 448 512"><path d="M223.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L319.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L393.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34zm-192 34l136 136c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9L127.9 256l96.4-96.4c9.4-9.4 9.4-24.6 0-33.9L201.7 103c-9.4-9.4-24.6-9.4-33.9 0l-136 136c-9.5 9.4-9.5 24.6-.1 34z"></path></symbol><symbol id="icon-angle-double-right" viewBox="0 0 448 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34zm192-34l-136-136c-9.4-9.4-24.6-9.4-33.9 0l-22.6 22.6c-9.4 9.4-9.4 24.6 0 33.9l96.4 96.4-96.4 96.4c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l136-136c9.4-9.2 9.4-24.4 0-33.8z"></path></symbol><symbol id="icon-angle-double-up" viewBox="0 0 320 512"><path d="M177 255.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 351.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 425.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1zm-34-192L7 199.7c-9.4 9.4-9.4 24.6 0 33.9l22.6 22.6c9.4 9.4 24.6 9.4 33.9 0l96.4-96.4 96.4 96.4c9.4 9.4 24.6 9.4 33.9 0l22.6-22.6c9.4-9.4 9.4-24.6 0-33.9l-136-136c-9.2-9.4-24.4-9.4-33.8 0z"></path></symbol><symbol id="icon-angle-down" viewBox="0 0 320 512"><path d="M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"></path></symbol><symbol id="icon-angle-left" viewBox="0 0 256 512"><path d="M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"></path></symbol><symbol id="icon-angle-right" viewBox="0 0 256 512"><path d="M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"></path></symbol><symbol id="icon-angle-up" viewBox="0 0 320 512"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6 0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9 0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9 0L7 329.7c-9.4-9.4-9.4-24.6 0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"></path></symbol><symbol id="icon-arrow-alt-circle-down" viewBox="0 0 512 512"><path d="M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zM212 140v116h-70.9c-10.7 0-16.1 13-8.5 20.5l114.9 114.3c4.7 4.7 12.2 4.7 16.9 0l114.9-114.3c7.6-7.6 2.2-20.5-8.5-20.5H300V140c0-6.6-5.4-12-12-12h-64c-6.6 0-12 5.4-12 12z"></path></symbol><symbol id="icon-arrow-alt-circle-left" viewBox="0 0 512 512"><path d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zm116-292H256v-70.9c0-10.7-13-16.1-20.5-8.5L121.2 247.5c-4.7 4.7-4.7 12.2 0 16.9l114.3 114.9c7.6 7.6 20.5 2.2 20.5-8.5V300h116c6.6 0 12-5.4 12-12v-64c0-6.6-5.4-12-12-12z"></path></symbol><symbol id="icon-arrow-alt-circle-right" viewBox="0 0 512 512"><path d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zM140 300h116v70.9c0 10.7 13 16.1 20.5 8.5l114.3-114.9c4.7-4.7 4.7-12.2 0-16.9l-114.3-115c-7.6-7.6-20.5-2.2-20.5 8.5V212H140c-6.6 0-12 5.4-12 12v64c0 6.6 5.4 12 12 12z"></path></symbol><symbol id="icon-arrow-alt-circle-up" viewBox="0 0 512 512"><path d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm292 116V256h70.9c10.7 0 16.1-13 8.5-20.5L264.5 121.2c-4.7-4.7-12.2-4.7-16.9 0l-115 114.3c-7.6 7.6-2.2 20.5 8.5 20.5H212v116c0 6.6 5.4 12 12 12h64c6.6 0 12-5.4 12-12z"></path></symbol><symbol id="icon-arrow-circle-down" viewBox="0 0 512 512"><path d="M504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-143.6-28.9L288 302.6V120c0-13.3-10.7-24-24-24h-16c-13.3 0-24 10.7-24 24v182.6l-72.4-75.5c-9.3-9.7-24.8-9.9-34.3-.4l-10.9 11c-9.4 9.4-9.4 24.6 0 33.9L239 404.3c9.4 9.4 24.6 9.4 33.9 0l132.7-132.7c9.4-9.4 9.4-24.6 0-33.9l-10.9-11c-9.5-9.5-25-9.3-34.3.4z"></path></symbol><symbol id="icon-arrow-circle-left" viewBox="0 0 512 512"><path d="M256 504C119 504 8 393 8 256S119 8 256 8s248 111 248 248-111 248-248 248zm28.9-143.6L209.4 288H392c13.3 0 24-10.7 24-24v-16c0-13.3-10.7-24-24-24H209.4l75.5-72.4c9.7-9.3 9.9-24.8.4-34.3l-11-10.9c-9.4-9.4-24.6-9.4-33.9 0L107.7 239c-9.4 9.4-9.4 24.6 0 33.9l132.7 132.7c9.4 9.4 24.6 9.4 33.9 0l11-10.9c9.5-9.5 9.3-25-.4-34.3z"></path></symbol><symbol id="icon-arrow-circle-right" viewBox="0 0 512 512"><path d="M256 8c137 0 248 111 248 248S393 504 256 504 8 393 8 256 119 8 256 8zm-28.9 143.6l75.5 72.4H120c-13.3 0-24 10.7-24 24v16c0 13.3 10.7 24 24 24h182.6l-75.5 72.4c-9.7 9.3-9.9 24.8-.4 34.3l11 10.9c9.4 9.4 24.6 9.4 33.9 0L404.3 273c9.4-9.4 9.4-24.6 0-33.9L271.6 106.3c-9.4-9.4-24.6-9.4-33.9 0l-11 10.9c-9.5 9.6-9.3 25.1.4 34.4z"></path></symbol><symbol id="icon-arrow-circle-up" viewBox="0 0 512 512"><path d="M8 256C8 119 119 8 256 8s248 111 248 248-111 248-248 248S8 393 8 256zm143.6 28.9l72.4-75.5V392c0 13.3 10.7 24 24 24h16c13.3 0 24-10.7 24-24V209.4l72.4 75.5c9.3 9.7 24.8 9.9 34.3.4l10.9-11c9.4-9.4 9.4-24.6 0-33.9L273 107.7c-9.4-9.4-24.6-9.4-33.9 0L106.3 240.4c-9.4 9.4-9.4 24.6 0 33.9l10.9 11c9.6 9.5 25.1 9.3 34.4-.4z"></path></symbol><symbol id="icon-arrow-down" viewBox="0 0 448 512"><path d="M413.1 222.5l22.2 22.2c9.4 9.4 9.4 24.6 0 33.9L241 473c-9.4 9.4-24.6 9.4-33.9 0L12.7 278.6c-9.4-9.4-9.4-24.6 0-33.9l22.2-22.2c9.5-9.5 25-9.3 34.3.4L184 343.4V56c0-13.3 10.7-24 24-24h32c13.3 0 24 10.7 24 24v287.4l114.8-120.5c9.3-9.8 24.8-10 34.3-.4z"></path></symbol><symbol id="icon-arrow-left" viewBox="0 0 448 512"><path d="M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"></path></symbol><symbol id="icon-arrow-right" viewBox="0 0 448 512"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"></path></symbol><symbol id="icon-arrow-up" viewBox="0 0 448 512"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6 0-33.9L207 39c9.4-9.4 24.6-9.4 33.9 0l194.3 194.3c9.4 9.4 9.4 24.6 0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3 0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"></path></symbol><symbol id="icon-arrows-alt" viewBox="0 0 512 512"><path d="M352.201 425.775l-79.196 79.196c-9.373 9.373-24.568 9.373-33.941 0l-79.196-79.196c-15.119-15.119-4.411-40.971 16.971-40.97h51.162L228 284H127.196v51.162c0 21.382-25.851 32.09-40.971 16.971L7.029 272.937c-9.373-9.373-9.373-24.569 0-33.941L86.225 159.8c15.119-15.119 40.971-4.411 40.971 16.971V228H228V127.196h-51.23c-21.382 0-32.09-25.851-16.971-40.971l79.196-79.196c9.373-9.373 24.568-9.373 33.941 0l79.196 79.196c15.119 15.119 4.411 40.971-16.971 40.971h-51.162V228h100.804v-51.162c0-21.382 25.851-32.09 40.97-16.971l79.196 79.196c9.373 9.373 9.373 24.569 0 33.941L425.773 352.2c-15.119 15.119-40.971 4.411-40.97-16.971V284H284v100.804h51.23c21.382 0 32.09 25.851 16.971 40.971z"></path></symbol><symbol id="icon-arrows-alt-h" viewBox="0 0 512 512"><path d="M377.941 169.941V216H134.059v-46.059c0-21.382-25.851-32.09-40.971-16.971L7.029 239.029c-9.373 9.373-9.373 24.568 0 33.941l86.059 86.059c15.119 15.119 40.971 4.411 40.971-16.971V296h243.882v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.568 0-33.941l-86.059-86.059c-15.119-15.12-40.971-4.412-40.971 16.97z"></path></symbol><symbol id="icon-arrows-alt-v" viewBox="0 0 256 512"><path d="M214.059 377.941H168V134.059h46.059c21.382 0 32.09-25.851 16.971-40.971L144.971 7.029c-9.373-9.373-24.568-9.373-33.941 0L24.971 93.088c-15.119 15.119-4.411 40.971 16.971 40.971H88v243.882H41.941c-21.382 0-32.09 25.851-16.971 40.971l86.059 86.059c9.373 9.373 24.568 9.373 33.941 0l86.059-86.059c15.12-15.119 4.412-40.971-16.97-40.971z"></path></symbol><symbol id="icon-bars" viewBox="0 0 448 512"><path d="M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z"></path></symbol><symbol id="icon-bookmark" viewBox="0 0 384 512"><path d="M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"></path></symbol><symbol id="icon-bookmark-empty" viewBox="0 0 384 512"><path d="M0 48C0 21.5 21.5 0 48 0l0 48V441.4l130.1-92.9c8.3-6 19.6-6 27.9 0L336 441.4V48H48V0H336c26.5 0 48 21.5 48 48V488c0 9-5 17.2-13 21.3s-17.6 3.4-24.9-1.8L192 397.5 37.9 507.5c-7.3 5.2-16.9 5.9-24.9 1.8S0 497 0 488V48z"/></symbol><symbol id="icon-caret-down" viewBox="0 0 320 512"><path d="M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"></path></symbol><symbol id="icon-caret-right" viewBox="0 0 192 512"><path d="M0 384.662V127.338c0-17.818 21.543-26.741 34.142-14.142l128.662 128.662c7.81 7.81 7.81 20.474 0 28.284L34.142 398.804C21.543 411.404 0 402.48 0 384.662z"></path></symbol><symbol id="icon-check" viewBox="0 0 512 512"><path d="M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z"></path></symbol><symbol id="icon-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z"></path></symbol><symbol id="icon-cog" viewBox="0 0 512 512"><path d="M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"></path></symbol><symbol id="icon-database" viewBox="0 0 448 512"><path d="M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"></path></symbol><symbol id="icon-edit" viewBox="0 0 576 512"><path d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"></path></symbol><symbol id="icon-eye" viewBox="0 0 576 512"><path d="M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z"></path></symbol><symbol id="icon-eye-slash" viewBox="0 0 640 512"><path d="M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z"></path></symbol><symbol id="icon-gavel" viewBox="0 0 512 512"><path d="M504.971 199.362l-22.627-22.627c-9.373-9.373-24.569-9.373-33.941 0l-5.657 5.657L329.608 69.255l5.657-5.657c9.373-9.373 9.373-24.569 0-33.941L312.638 7.029c-9.373-9.373-24.569-9.373-33.941 0L154.246 131.48c-9.373 9.373-9.373 24.569 0 33.941l22.627 22.627c9.373 9.373 24.569 9.373 33.941 0l5.657-5.657 39.598 39.598-81.04 81.04-5.657-5.657c-12.497-12.497-32.758-12.497-45.255 0L9.373 412.118c-12.497 12.497-12.497 32.758 0 45.255l45.255 45.255c12.497 12.497 32.758 12.497 45.255 0l114.745-114.745c12.497-12.497 12.497-32.758 0-45.255l-5.657-5.657 81.04-81.04 39.598 39.598-5.657 5.657c-9.373 9.373-9.373 24.569 0 33.941l22.627 22.627c9.373 9.373 24.569 9.373 33.941 0l124.451-124.451c9.372-9.372 9.372-24.568 0-33.941z"></path></symbol><symbol id="icon-globe" viewBox="0 0 496 512"><path d="M336.5 160C322 70.7 287.8 8 248 8s-74 62.7-88.5 152h177zM152 256c0 22.2 1.2 43.5 3.3 64h185.3c2.1-20.5 3.3-41.8 3.3-64s-1.2-43.5-3.3-64H155.3c-2.1 20.5-3.3 41.8-3.3 64zm324.7-96c-28.6-67.9-86.5-120.4-158-141.6 24.4 33.8 41.2 84.7 50 141.6h108zM177.2 18.4C105.8 39.6 47.8 92.1 19.3 160h108c8.7-56.9 25.5-107.8 49.9-141.6zM487.4 192H372.7c2.1 21 3.3 42.5 3.3 64s-1.2 43-3.3 64h114.6c5.5-20.5 8.6-41.8 8.6-64s-3.1-43.5-8.5-64zM120 256c0-21.5 1.2-43 3.3-64H8.6C3.2 212.5 0 233.8 0 256s3.2 43.5 8.6 64h114.6c-2-21-3.2-42.5-3.2-64zm39.5 96c14.5 89.3 48.7 152 88.5 152s74-62.7 88.5-152h-177zm159.3 141.6c71.4-21.2 129.4-73.7 158-141.6h-108c-8.8 56.9-25.6 107.8-50 141.6zM19.3 352c28.6 67.9 86.5 120.4 158 141.6-24.4-33.8-41.2-84.7-50-141.6h-108z"></path></symbol><symbol id="icon-id-card" viewBox="0 0 576 512"><path d="M528 32H48C21.5 32 0 53.5 0 80v16h576V80c0-26.5-21.5-48-48-48zM0 432c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V128H0v304zm352-232c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zm0 64c0-4.4 3.6-8 8-8h144c4.4 0 8 3.6 8 8v16c0 4.4-3.6 8-8 8H360c-4.4 0-8-3.6-8-8v-16zM176 192c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zM67.1 396.2C75.5 370.5 99.6 352 128 352h8.2c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h8.2c28.4 0 52.5 18.5 60.9 44.2 3.2 9.9-5.2 19.8-15.6 19.8H82.7c-10.4 0-18.8-10-15.6-19.8z"></path></symbol><symbol id="icon-id-card-alt" viewBox="0 0 576 512"><path d="M528 64H384v96H192V64H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h480c26.5 0 48-21.5 48-48V112c0-26.5-21.5-48-48-48zM288 224c35.3 0 64 28.7 64 64s-28.7 64-64 64-64-28.7-64-64 28.7-64 64-64zm93.3 224H194.7c-10.4 0-18.8-10-15.6-19.8 8.3-25.6 32.4-44.2 60.9-44.2h8.2c12.3 5.1 25.7 8 39.8 8s27.6-2.9 39.8-8h8.2c28.4 0 52.5 18.5 60.9 44.2 3.2 9.8-5.2 19.8-15.6 19.8zM352 32c0-17.7-14.3-32-32-32h-64c-17.7 0-32 14.3-32 32v96h128V32z"></path></symbol><symbol id="icon-info" viewBox="0 0 192 512"><path d="M20 424.229h20V279.771H20c-11.046 0-20-8.954-20-20V212c0-11.046 8.954-20 20-20h112c11.046 0 20 8.954 20 20v212.229h20c11.046 0 20 8.954 20 20V492c0 11.046-8.954 20-20 20H20c-11.046 0-20-8.954-20-20v-47.771c0-11.046 8.954-20 20-20zM96 0C56.235 0 24 32.235 24 72s32.235 72 72 72 72-32.235 72-72S135.764 0 96 0z"></path></symbol><symbol id="icon-info-circle" viewBox="0 0 512 512"><path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path></symbol><symbol id="icon-list-ul" viewBox="0 0 512 512"><path d="M48 48a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm0 160a48 48 0 1 0 48 48 48 48 0 0 0-48-48zm448 16H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zm0-320H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16V80a16 16 0 0 0-16-16zm0 160H176a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h320a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16z"></path></symbol><symbol id="icon-lock" viewBox="0 0 448 512"><path d="M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"></path></symbol><symbol id="icon-lock-open" viewBox="0 0 576 512"><path d="M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"></path></symbol><symbol id="icon-minus" viewBox="0 0 448 512"><path d="M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path></symbol><symbol id="icon-minus-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zM124 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H124z"></path></symbol><symbol id="icon-minus-square" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM92 296c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h264c6.6 0 12 5.4 12 12v56c0 6.6-5.4 12-12 12H92z"></path></symbol><symbol id="icon-paper-plane" viewBox="0 0 512 512"><path d="M476 3.2L12.5 270.6c-18.1 10.4-15.8 35.6 2.2 43.2L121 358.4l287.3-253.2c5.5-4.9 13.3 2.6 8.6 8.3L176 407v80.5c0 23.6 28.5 32.9 42.5 15.8L282 426l124.6 52.2c14.2 6 30.4-2.9 33-18.2l72-432C515 7.8 493.3-6.8 476 3.2z"></path></symbol><symbol id="icon-paperclip" viewBox="0 0 448 512"><path d="M43.246 466.142c-58.43-60.289-57.341-157.511 1.386-217.581L254.392 34c44.316-45.332 116.351-45.336 160.671 0 43.89 44.894 43.943 117.329 0 162.276L232.214 383.128c-29.855 30.537-78.633 30.111-107.982-.998-28.275-29.97-27.368-77.473 1.452-106.953l143.743-146.835c6.182-6.314 16.312-6.422 22.626-.241l22.861 22.379c6.315 6.182 6.422 16.312.241 22.626L171.427 319.927c-4.932 5.045-5.236 13.428-.648 18.292 4.372 4.634 11.245 4.711 15.688.165l182.849-186.851c19.613-20.062 19.613-52.725-.011-72.798-19.189-19.627-49.957-19.637-69.154 0L90.39 293.295c-34.763 35.56-35.299 93.12-1.191 128.313 34.01 35.093 88.985 35.137 123.058.286l172.06-175.999c6.177-6.319 16.307-6.433 22.626-.256l22.877 22.364c6.319 6.177 6.434 16.307.256 22.626l-172.06 175.998c-59.576 60.938-155.943 60.216-214.77-.485z"></path></symbol><symbol id="icon-pencil-alt" viewBox="0 0 512 512"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"></path></symbol><symbol id="icon-phone" viewBox="0 0 512 512"><path d="M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"></path></symbol><symbol id="icon-plus" viewBox="0 0 448 512"><path d="M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"></path></symbol><symbol id="icon-plus-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92h-92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"></path></symbol><symbol id="icon-plus-square" viewBox="0 0 448 512"><path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zm-32 252c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6 0-12-5.4-12-12v-92H92c-6.6 0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6 0 12 5.4 12 12v92h92c6.6 0 12 5.4 12 12v56z"></path></symbol><symbol id="icon-save" viewBox="0 0 448 512"><path d="M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"></path></symbol><symbol id="icon-sign-out-alt" viewBox="0 0 512 512"><path d="M497 273L329 441c-15 15-41 4.5-41-17v-96H152c-13.3 0-24-10.7-24-24v-96c0-13.3 10.7-24 24-24h136V88c0-21.4 25.9-32 41-17l168 168c9.3 9.4 9.3 24.6 0 34zM192 436v-40c0-6.6-5.4-12-12-12H96c-17.7 0-32-14.3-32-32V160c0-17.7 14.3-32 32-32h84c6.6 0 12-5.4 12-12V76c0-6.6-5.4-12-12-12H96c-53 0-96 43-96 96v192c0 53 43 96 96 96h84c6.6 0 12-5.4 12-12z"></path></symbol><symbol id="icon-smile" viewBox="0 0 496 512"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm80 168c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm-160 0c17.7 0 32 14.3 32 32s-14.3 32-32 32-32-14.3-32-32 14.3-32 32-32zm194.8 170.2C334.3 380.4 292.5 400 248 400s-86.3-19.6-114.8-53.8c-13.6-16.3 11-36.7 24.6-20.5 22.4 26.9 55.2 42.2 90.2 42.2s67.8-15.4 90.2-42.2c13.4-16.2 38.1 4.2 24.6 20.5z"></path></symbol><symbol id="icon-snowflake" viewBox="0 0 448 512"><path d="M440.3 345.2l-33.8-19.5 26-7c8.2-2.2 13.1-10.7 10.9-18.9l-4-14.9c-2.2-8.2-10.7-13.1-18.9-10.9l-70.8 19-63.9-37 63.8-36.9 70.8 19c8.2 2.2 16.7-2.7 18.9-10.9l4-14.9c2.2-8.2-2.7-16.7-10.9-18.9l-26-7 33.8-19.5c7.4-4.3 9.9-13.7 5.7-21.1L430.4 119c-4.3-7.4-13.7-9.9-21.1-5.7l-33.8 19.5 7-26c2.2-8.2-2.7-16.7-10.9-18.9l-14.9-4c-8.2-2.2-16.7 2.7-18.9 10.9l-19 70.8-62.8 36.2v-77.5l53.7-53.7c6.2-6.2 6.2-16.4 0-22.6l-11.3-11.3c-6.2-6.2-16.4-6.2-22.6 0L256 56.4V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v40.4l-19.7-19.7c-6.2-6.2-16.4-6.2-22.6 0L138.3 48c-6.3 6.2-6.3 16.4 0 22.6l53.7 53.7v77.5l-62.8-36.2-19-70.8c-2.2-8.2-10.7-13.1-18.9-10.9l-14.9 4c-8.2 2.2-13.1 10.7-10.9 18.9l7 26-33.8-19.5c-7.4-4.3-16.8-1.7-21.1 5.7L2.1 145.7c-4.3 7.4-1.7 16.8 5.7 21.1l33.8 19.5-26 7c-8.3 2.2-13.2 10.7-11 19l4 14.9c2.2 8.2 10.7 13.1 18.9 10.9l70.8-19 63.8 36.9-63.8 36.9-70.8-19c-8.2-2.2-16.7 2.7-18.9 10.9l-4 14.9c-2.2 8.2 2.7 16.7 10.9 18.9l26 7-33.8 19.6c-7.4 4.3-9.9 13.7-5.7 21.1l15.5 26.8c4.3 7.4 13.7 9.9 21.1 5.7l33.8-19.5-7 26c-2.2 8.2 2.7 16.7 10.9 18.9l14.9 4c8.2 2.2 16.7-2.7 18.9-10.9l19-70.8 62.8-36.2v77.5l-53.7 53.7c-6.3 6.2-6.3 16.4 0 22.6l11.3 11.3c6.2 6.2 16.4 6.2 22.6 0l19.7-19.7V496c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-40.4l19.7 19.7c6.2 6.2 16.4 6.2 22.6 0l11.3-11.3c6.2-6.2 6.2-16.4 0-22.6L256 387.7v-77.5l62.8 36.2 19 70.8c2.2 8.2 10.7 13.1 18.9 10.9l14.9-4c8.2-2.2 13.1-10.7 10.9-18.9l-7-26 33.8 19.5c7.4 4.3 16.8 1.7 21.1-5.7l15.5-26.8c4.3-7.3 1.8-16.8-5.6-21z"></path></symbol><symbol id="icon-spinner" viewBox="0 0 512 512"><path d="M304 48c0 26.51-21.49 48-48 48s-48-21.49-48-48 21.49-48 48-48 48 21.49 48 48zm-48 368c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zm208-208c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48zM96 256c0-26.51-21.49-48-48-48S0 229.49 0 256s21.49 48 48 48 48-21.49 48-48zm12.922 99.078c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.491-48-48-48zm294.156 0c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48c0-26.509-21.49-48-48-48zM108.922 60.922c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.491-48-48-48z"></path></symbol><symbol id="icon-sync" viewBox="0 0 512 512"><path d="M440.65 12.57l4 82.77A247.16 247.16 0 0 0 255.83 8C134.73 8 33.91 94.92 12.29 209.82A12 12 0 0 0 24.09 224h49.05a12 12 0 0 0 11.67-9.26 175.91 175.91 0 0 1 317-56.94l-101.46-4.86a12 12 0 0 0-12.57 12v47.41a12 12 0 0 0 12 12H500a12 12 0 0 0 12-12V12a12 12 0 0 0-12-12h-47.37a12 12 0 0 0-11.98 12.57zM255.83 432a175.61 175.61 0 0 1-146-77.8l101.8 4.87a12 12 0 0 0 12.57-12v-47.4a12 12 0 0 0-12-12H12a12 12 0 0 0-12 12V500a12 12 0 0 0 12 12h47.35a12 12 0 0 0 12-12.6l-4.15-82.57A247.17 247.17 0 0 0 255.83 504c121.11 0 221.93-86.92 243.55-201.82a12 12 0 0 0-11.8-14.18h-49.05a12 12 0 0 0-11.67 9.26A175.86 175.86 0 0 1 255.83 432z"></path></symbol><symbol id="icon-times" viewBox="0 0 352 512"><path d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></symbol><symbol id="icon-times-circle" viewBox="0 0 512 512"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm121.6 313.1c4.7 4.7 4.7 12.3 0 17L338 377.6c-4.7 4.7-12.3 4.7-17 0L256 312l-65.1 65.6c-4.7 4.7-12.3 4.7-17 0L134.4 338c-4.7-4.7-4.7-12.3 0-17l65.6-65-65.6-65.1c-4.7-4.7-4.7-12.3 0-17l39.6-39.6c4.7-4.7 12.3-4.7 17 0l65 65.7 65.1-65.6c4.7-4.7 12.3-4.7 17 0l39.6 39.6c4.7 4.7 4.7 12.3 0 17L312 256l65.6 65.1z"></path></symbol><symbol id="icon-trash" viewBox="0 0 448 512"><path d="M432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16zM53.2 467a48 48 0 0 0 47.9 45h245.8a48 48 0 0 0 47.9-45L416 128H32z"></path></symbol><symbol id="icon-trash-alt" viewBox="0 0 448 512"><path d="M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z"></path></symbol><symbol id="icon-unlock" viewBox="0 0 448 512"><path d="M400 256H152V152.9c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v16c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-16C376 68 307.5-.3 223.5 0 139.5.3 72 69.5 72 153.5V256H48c-26.5 0-48 21.5-48 48v160c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48z"></path></symbol><symbol id="icon-user" viewBox="0 0 448 512"><path d="M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></symbol><symbol id="icon-user-cog" viewBox="0 0 640 512"><path d="M610.5 373.3c2.6-14.1 2.6-28.5 0-42.6l25.8-14.9c3-1.7 4.3-5.2 3.3-8.5-6.7-21.6-18.2-41.2-33.2-57.4-2.3-2.5-6-3.1-9-1.4l-25.8 14.9c-10.9-9.3-23.4-16.5-36.9-21.3v-29.8c0-3.4-2.4-6.4-5.7-7.1-22.3-5-45-4.8-66.2 0-3.3.7-5.7 3.7-5.7 7.1v29.8c-13.5 4.8-26 12-36.9 21.3l-25.8-14.9c-2.9-1.7-6.7-1.1-9 1.4-15 16.2-26.5 35.8-33.2 57.4-1 3.3.4 6.8 3.3 8.5l25.8 14.9c-2.6 14.1-2.6 28.5 0 42.6l-25.8 14.9c-3 1.7-4.3 5.2-3.3 8.5 6.7 21.6 18.2 41.1 33.2 57.4 2.3 2.5 6 3.1 9 1.4l25.8-14.9c10.9 9.3 23.4 16.5 36.9 21.3v29.8c0 3.4 2.4 6.4 5.7 7.1 22.3 5 45 4.8 66.2 0 3.3-.7 5.7-3.7 5.7-7.1v-29.8c13.5-4.8 26-12 36.9-21.3l25.8 14.9c2.9 1.7 6.7 1.1 9-1.4 15-16.2 26.5-35.8 33.2-57.4 1-3.3-.4-6.8-3.3-8.5l-25.8-14.9zM496 400.5c-26.8 0-48.5-21.8-48.5-48.5s21.8-48.5 48.5-48.5 48.5 21.8 48.5 48.5-21.7 48.5-48.5 48.5zM224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm201.2 226.5c-2.3-1.2-4.6-2.6-6.8-3.9l-7.9 4.6c-6 3.4-12.8 5.3-19.6 5.3-10.9 0-21.4-4.6-28.9-12.6-18.3-19.8-32.3-43.9-40.2-69.6-5.5-17.7 1.9-36.4 17.9-45.7l7.9-4.6c-.1-2.6-.1-5.2 0-7.8l-7.9-4.6c-16-9.2-23.4-28-17.9-45.7.9-2.9 2.2-5.8 3.2-8.7-3.8-.3-7.5-1.2-11.4-1.2h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c10.1 0 19.5-3.2 27.2-8.5-1.2-3.8-2-7.7-2-11.8v-9.2z"></path></symbol><symbol id="icon-user-plus" viewBox="0 0 640 512"><path d="M624 208h-64v-64c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v64h-64c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h64v64c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16v-64h64c8.8 0 16-7.2 16-16v-32c0-8.8-7.2-16-16-16zm-400 48c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"></path></symbol><symbol id="icon-user-secret" viewBox="0 0 448 512"><path d="M383.9 308.3l23.9-62.6c4-10.5-3.7-21.7-15-21.7h-58.5c11-18.9 17.8-40.6 17.8-64v-.3c39.2-7.8 64-19.1 64-31.7 0-13.3-27.3-25.1-70.1-33-9.2-32.8-27-65.8-40.6-82.8-9.5-11.9-25.9-15.6-39.5-8.8l-27.6 13.8c-9 4.5-19.6 4.5-28.6 0L182.1 3.4c-13.6-6.8-30-3.1-39.5 8.8-13.5 17-31.4 50-40.6 82.8-42.7 7.9-70 19.7-70 33 0 12.6 24.8 23.9 64 31.7v.3c0 23.4 6.8 45.1 17.8 64H56.3c-11.5 0-19.2 11.7-14.7 22.3l25.8 60.2C27.3 329.8 0 372.7 0 422.4v44.8C0 491.9 20.1 512 44.8 512h358.4c24.7 0 44.8-20.1 44.8-44.8v-44.8c0-48.4-25.8-90.4-64.1-114.1zM176 480l-41.6-192 49.6 32 24 40-32 120zm96 0l-32-120 24-40 49.6-32L272 480zm41.7-298.5c-3.9 11.9-7 24.6-16.5 33.4-10.1 9.3-48 22.4-64-25-2.8-8.4-15.4-8.4-18.3 0-17 50.2-56 32.4-64 25-9.5-8.8-12.7-21.5-16.5-33.4-.8-2.5-6.3-5.7-6.3-5.8v-10.8c28.3 3.6 61 5.8 96 5.8s67.7-2.1 96-5.8v10.8c-.1.1-5.6 3.2-6.4 5.8z"></path></symbol><symbol id="icon-users" viewBox="0 0 640 512"><path d="M96 224c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm448 0c35.3 0 64-28.7 64-64s-28.7-64-64-64-64 28.7-64 64 28.7 64 64 64zm32 32h-64c-17.6 0-33.5 7.1-45.1 18.6 40.3 22.1 68.9 62 75.1 109.4h66c17.7 0 32-14.3 32-32v-32c0-35.3-28.7-64-64-64zm-256 0c61.9 0 112-50.1 112-112S381.9 32 320 32 208 82.1 208 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C179.6 288 128 339.6 128 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zm-223.7-13.4C161.5 263.1 145.6 256 128 256H64c-35.3 0-64 28.7-64 64v32c0 17.7 14.3 32 32 32h65.9c6.3-47.4 34.9-87.3 75.2-109.4z"></path></symbol><symbol id="icon-wrench" viewBox="0 0 512 512"><path d="M507.73 109.1c-2.24-9.03-13.54-12.09-20.12-5.51l-74.36 74.36-67.88-11.31-11.31-67.88 74.36-74.36c6.62-6.62 3.43-17.9-5.66-20.16-47.38-11.74-99.55.91-136.58 37.93-39.64 39.64-50.55 97.1-34.05 147.2L18.74 402.76c-24.99 24.99-24.99 65.51 0 90.5 24.99 24.99 65.51 24.99 90.5 0l213.21-213.21c50.12 16.71 107.47 5.68 147.37-34.22 37.07-37.07 49.7-89.32 37.91-136.73zM64 472c-13.25 0-24-10.75-24-24 0-13.26 10.75-24 24-24s24 10.74 24 24c0 13.25-10.75 24-24 24z"></path></symbol><symbol id="icon-refresh" viewBox="0 0 512 512"><path d="M464 16c-17.67 0-32 14.31-32 32v74.09C392.1 66.52 327.4 32 256 32C161.5 32 78.59 92.34 49.58 182.2c-5.438 16.81 3.797 34.88 20.61 40.28c16.89 5.5 34.88-3.812 40.3-20.59C130.9 138.5 189.4 96 256 96c50.5 0 96.26 24.55 124.4 64H336c-17.67 0-32 14.31-32 32s14.33 32 32 32h128c17.67 0 32-14.31 32-32V48C496 30.31 481.7 16 464 16zM441.8 289.6c-16.92-5.438-34.88 3.812-40.3 20.59C381.1 373.5 322.6 416 256 416c-50.5 0-96.25-24.55-124.4-64H176c17.67 0 32-14.31 32-32s-14.33-32-32-32h-128c-17.67 0-32 14.31-32 32v144c0 17.69 14.33 32 32 32s32-14.31 32-32v-74.09C119.9 445.5 184.6 480 255.1 480c94.45 0 177.4-60.34 206.4-150.2C467.9 313 458.6 294.1 441.8 289.6z"></path></symbol><symbol id="icon-copy" viewBox="0 0 448 512"><path d="M320 448v40c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V120c0-13.3 10.7-24 24-24h72v296c0 30.9 25.1 56 56 56h168zm0-344V0H152c-13.3 0-24 10.7-24 24v368c0 13.3 10.7 24 24 24h272c13.3 0 24-10.7 24-24V128H344c-13.2 0-24-10.8-24-24zm121-31L375 7A24 24 0 0 0 358.1 0H352v96h96v-6.1a24 24 0 0 0 -7-17z"></path></symbol><symbol id="icon-quote-right" viewBox="0 0 512 512"><path d="M464 32H336c-26.5 0-48 21.5-48 48v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48zm-288 0H48C21.5 32 0 53.5 0 80v128c0 26.5 21.5 48 48 48h80v64c0 35.3-28.7 64-64 64h-8c-13.3 0-24 10.7-24 24v48c0 13.3 10.7 24 24 24h8c88.4 0 160-71.6 160-160V80c0-26.5-21.5-48-48-48z"></path></symbol></svg>`}});function mF(){return window.matchMedia("(prefers-color-scheme: dark)").matches?hm.settings.get("dark_theme"):hm.settings.get("theme")}function gF(){if(!hm.settings.get("auto_insert"))return;const e=hm.settings.get("root");if(!e.querySelector("converse-root")){const t=document.createElement("converse-root"),s=e.querySelector("body");s?s.appendChild(t):e.appendChild(t)}}var pF=s(5190),fF={};fF.styleTagTransform=I(),fF.setAttributes=j(),fF.insert=C().bind(null,"head"),fF.domAPI=E(),fF.insertStyleElement=O();A()(pF.A,fF);pF.A&&pF.A.locals&&pF.A.locals;class vF extends VS{render(){return(()=>{const e=hm.settings.get("singleton")?["converse-singleton"]:[];return e.push(`converse-${hm.settings.get("view_mode")}`),fp`${hm.settings.get("show_background")?fp`<converse-bg></converse-bg>`:""}<converse-chats class="converse-chatboxes row justify-content-start g-0 ${e.join(" ")}"></converse-chats><div id="converse-modals" class="modals"></div><converse-fontawesome></converse-fontawesome>`})()}initialize(){this.setAttribute("id","conversejs"),this.setThemeAttributes();const e=hm.settings.get();this.listenTo(e,"change:view_mode",(()=>this.setThemeAttributes())),this.listenTo(e,"change:singleton",(()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: dark)").addListener((()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: light)").addListener((()=>this.setThemeAttributes()))}setThemeAttributes(){const e=mF();this.className="",this.classList.add("container-fluid"),this.classList.add("g-0"),this.classList.add("conversejs"),this.classList.add(`converse-${hm.settings.get("view_mode")}`),this.classList.add(`theme-${e}`),this.setAttribute("data-bs-theme",e),this.setAttribute("data-converse-theme",e);const t=qS.getLocale();this.setAttribute("lang",t);hm.settings.get("rtl_langs").includes(t)?this.setAttribute("dir","rtl"):this.setAttribute("dir","ltr"),this.requestUpdate()}}var _F=s(4842),bF={};bF.styleTagTransform=I(),bF.setAttributes=j(),bF.insert=C().bind(null,"head"),bF.domAPI=E(),bF.insertStyleElement=O();A()(_F.A,bF);_F.A&&_F.A.locals&&_F.A.locals;class yF extends VS{initialize(){this.setThemeAttributes();const e=hm.settings.get();this.listenTo(e,"change:view_mode",(()=>this.setThemeAttributes())),this.listenTo(e,"change:singleton",(()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: dark)").addListener((()=>this.setThemeAttributes())),window.matchMedia("(prefers-color-scheme: light)").addListener((()=>this.setThemeAttributes()))}render(){return fp`${"cyberpunk"===hm.settings.get("theme")?fp`<section class="moving-grid"><div class="container"><div class="static-lines">${[...Array(20).keys()].map((()=>fp`<div class="vert"></div>`))}</div><div class="moving-lines">${[...Array(60).keys()].map((()=>fp`<div class="horz"></div>`))}</div></div></section>`:""}<div class="inner-content converse-brand row"><div class="converse-brand__heading"><svg height="160px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 364 364" version="1.1"><title>Logo Converse</title><defs><linearGradient id="gradient" x1="92.14" y1="27.64" x2="267.65" y2="331.62" gradientUnits="userSpaceOnUse"><stop offset="0" stop-color="#fff1d1"/><stop offset="0.05" stop-color="#fae8c1"/><stop offset="0.15" stop-color="#f0d5a1"/><stop offset="0.27" stop-color="#e7c687"/><stop offset="0.4" stop-color="#e1bb72"/><stop offset="0.54" stop-color="#dcb264"/><stop offset="0.71" stop-color="#daad5c"/><stop offset="1" stop-color="#d9ac59"/></linearGradient><filter id="shadow"><feGaussianBlur in="SourceAlpha" stdDeviation="2.3" result="blur1"/><feOffset in="blur1" dx="3" dy="3" result="blur2"/><feColorMatrix in="blur2" type="matrix" result="blur3" values="1 0 0 0 0.1                                    0 1 0 0 0.1                                    0 0 1 0 0.1                                    0 0 0 1 0"/><feMerge><feMergeNode in="blur3"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><g filter="url(#shadow)"><path d="M221.46,103.71c0,18.83-29.36,18.83-29.12,0C192.1,84.88,221.46,84.88,221.46,103.71Z" fill="#d9ac59"/><path d="M179.9,4.15A175.48,175.48,0,1,0,355.38,179.63,175.48,175.48,0,0,0,179.9,4.15Zm-40.79,264.5c-.23-17.82,27.58-17.82,27.58,0S138.88,286.48,139.11,268.65ZM218.6,168.24A79.65,79.65,0,0,1,205.15,174a12.76,12.76,0,0,0-6.29,4.65L167.54,222a1.36,1.36,0,0,1-2.46-.8v-35.8a2.58,2.58,0,0,0-3.06-2.53c-15.43,3-30.23,7.7-42.73,19.94-38.8,38-29.42,105.69,16.09,133.16a162.25,162.25,0,0,1-91.47-67.27C-3.86,182.26,34.5,47.25,138.37,25.66c46.89-9.75,118.25,5.16,123.73,62.83C265.15,120.64,246.56,152.89,218.6,168.24Z" fill="url(#gradient)"/></g></svg> <span class="converse-brand__text"><span>converse<span class="subdued">.js</span></span><p class="byline">messaging freedom</p></span></div>${"overlayed"===hm.settings.get("view_mode")?fp`<div class="converse-brand__padding"></div>`:""}</div>`}setThemeAttributes(){const e=mF();this.classList.add(`theme-${e}`),this.setAttribute("data-converse-theme",e),this.setAttribute("data-bs-theme",e),this.requestUpdate()}}hm.elements.define("converse-bg",yF);Cf.plugins.add("converse-rootview",{initialize(){hm.settings.extend({auto_insert:!0,dark_theme:"dracula",rtl_langs:["ar","fa","he","ur"],show_background:!1,theme:"classic"}),hm.listen.on("chatBoxesInitialized",gF),hm.elements.define("converse-root",vF)}});const wF={dnd:HS("This contact is busy"),online:HS("This contact is online"),offline:HS("This contact is offline"),unavailable:HS("This contact is unavailable"),xa:HS("This contact is away for an extended period"),away:HS("This contact is away")},SF=e=>{const t=e.model.getDisplayName(),s=HS("Click to remove %1$s as a contact",t);return fp`<a class="list-item-action remove-xmpp-contact" @click="${e.removeContact}" title="${s}" href="#"><converse-icon class="fa fa-trash-alt" size="1.5em"></converse-icon></a>`},{Strophe:AF}=Cf.env;class xF extends VS{static get properties(){return{model:{type:Object}}}constructor(){super(),this.model=null}initialize(){this.listenTo(this.model,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"highlight",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:add",(()=>this.requestUpdate())),this.listenTo(this.model,"vcard:change",(()=>this.requestUpdate())),this.listenTo(this.model,"presenceChanged",(()=>this.requestUpdate()))}render(){return!0===this.model.get("requesting")?(e=>{const t=BO(e.model),s=e.model.get("jid"),n=e.model.getDisplayName(),i=HS("Click to accept the contact request from %1$s (XMPP address: %2$s)",n,s),r=HS("Click to decline the contact request from %1$s (XMPP address: %2$s)",n,s),o=HS("Click to chat with %1$s (XMPP address: %2$s)",n,s);return fp`<a class="list-item-link cbox-list-item open-chat ${t?"unread-msgs":""}" title="${o}" href="#" data-jid="${s}" @click="${e.openChat}"><span><converse-avatar .model="${e.model}" class="avatar" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar></span>${t?fp`<span class="msgs-indicator badge">${t}</span>`:""} <span class="contact-name ${t?"unread-msgs":""}">${n}</span> </a><span class="contact-actions"><a class="accept-xmpp-request list-item-action list-item-action--visible" @click="${e.acceptRequest}" aria-label="${i}" title="${i}" href="#"><converse-icon class="fa fa-check" size="1.5em"></converse-icon></a><a class="decline-xmpp-request list-item-action list-item-action--visible" @click="${e.declineRequest}" aria-label="${r}" title="${r}" href="#"><converse-icon class="fa fa-times" size="1.5em"></converse-icon></a></span>`})(this):"none"===this.model.get("subscription")?(e=>{const t=BO(e.model),s=e.model.getDisplayName(),n=e.model.get("jid"),i=HS("Click to add %1$s to your roster",s),r=HS("Click to chat with %1$s (XMPP address: %2$s)",s,n);return fp`<a class="list-item-link cbox-list-item open-chat ${t?"unread-msgs":""}" title="${r}" href="#" data-jid="${n}" @click="${e.openChat}"><span><converse-avatar .model="${e.model}" class="avatar" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar></span>${t?fp`<span class="msgs-indicator badge">${t}</span>`:""} <span class="contact-name ${t?"unread-msgs":""}">${s}</span> </a><span class="contact-actions"><a class="add-contact list-item-action" @click="${t=>e.addContact(t)}" aria-label="${i}" title="${i}" href="#"><converse-icon class="fa fa-user-plus" size="1.5em"></converse-icon></a>${hm.settings.get("allow_contact_removal")?SF(e):""}</span>`})(this):(e=>{const t=Bu.session.get("bare_jid"),s=e.model.getStatus()||"offline";let n,i;[n,i]="online"===s?["fa fa-circle","chat-status-online"]:"dnd"===s?["fa fa-minus-circle","chat-status-busy"]:"away"===s?["fa fa-circle","chat-status-away"]:["fa fa-circle","comment"];const r=t===e.model.get("jid"),o=wF[s],a=BO(e.model),c=e.model.getDisplayName(),l=e.model.get("jid"),d=r?HS("Click to chat with yourself"):HS("Click to chat with %1$s (XMPP address: %2$s)",c,l);return fp`<a class="list-item-link cbox-list-item open-chat ${a?"unread-msgs":""}" title="${d}" href="#" data-jid="${l}" @click="${e.openChat}"><span><converse-avatar .model="${e.model}" class="avatar" name="${e.model.getDisplayName()}" nonce="${e.model.vcard?.get("vcard_updated")}" height="30" width="30"></converse-avatar><converse-icon title="${o}" color="var(--${i})" size="1em" class="${n} chat-status chat-status--avatar"></converse-icon></span>${a?fp`<span class="msgs-indicator badge">${a}</span>`:""} <span class="contact-name contact-name--${s} ${a?"unread-msgs":""}">${c+(r?` ${HS("(me)")}`:"")}</span> </a><span class="contact-actions">${hm.settings.get("allow_contact_removal")&&!r?SF(e):""}</span>`})(this)}openChat(e){e?.preventDefault?.(),hm.chats.open(this.model.get("jid"),this.model.attributes,!0)}addContact(e){e?.preventDefault?.(),hm.modal.show("converse-add-contact-modal",{model:new fd},e)}async removeContact(e){e?.preventDefault?.(),await cI(this.model)}async blockContact(e){e?.preventDefault?.(),await lI(this.model)}async acceptRequest(e){e?.preventDefault?.(),await Bu.state.roster.sendContactAddIQ({jid:this.model.get("jid"),name:this.model.getFullname(),groups:[]}),this.model.authorize().subscribe()}async declineRequest(e){e?.preventDefault?.();const t=Bu.session.get("domain"),s=await hm.disco.supports(AF.NS.BLOCKING,t),n=await hm.confirm(HS("Decline contact request"),[HS("Are you sure you want to decline this contact request?")],s?[{label:HS("Block this user from sending you further messages"),name:"block",type:"checkbox"}]:[]);if(n){const e=await hm.chats.get(this.model.get("jid"));if(e?.close(),this.model.unauthorize(),s&&Array.isArray(n)){const e="on"===n.find((e=>"block"===e.name))?.value;e&&hm.blocklist.add(this.model.get("jid"))}this.model.destroy()}return this}}hm.elements.define("converse-roster-contact",xF);const EF=e=>{const t=HS("Add"),s=HS("name@example.org"),n=HS("Group"),i=HS("Name"),r=HS("XMPP Address"),o=e.model.get("error");return fp`<div class="modal-body">${o?fp`<div class="alert alert-danger" role="alert">${o}</div>`:""}<form class="converse-form add-xmpp-contact" @submit="${t=>e.addContactFromForm(t)}"><div class="add-xmpp-contact__jid mb-3"><label class="form-label clearfix" for="jid">${r}:</label> ${hm.settings.get("autocomplete_add_contact")?fp`<converse-autocomplete .list="${function(){const e=Bu.state.roster;return[...new Set(e.map((e=>oI.getDomainFromJid(e.get("jid")))))]}()}" .data="${(e,t)=>`${t.slice(0,t.indexOf("@"))}@${e}`}" position="below" filter="${Sj}" ?required="${!hm.settings.get("xhr_user_search_url")}" value="${e.model.get("jid")||""}" placeholder="${s}" name="jid"></converse-autocomplete>`:fp`<input type="text" name="jid" ?required="${!hm.settings.get("xhr_user_search_url")}" value="${e.model.get("jid")||""}" class="form-control" placeholder="${s}">`}</div><div class="add-xmpp-contact__name mb-3"><label class="form-label clearfix" for="name">${i}:</label> ${hm.settings.get("autocomplete_add_contact")&&"string"==typeof hm.settings.get("xhr_user_search_url")?fp`<converse-autocomplete .getAutoCompleteList="${gI}" filter="${Sj}" value="${e.model.get("nickname")||""}" placeholder="${s}" name="name"></converse-autocomplete>`:fp`<input type="text" name="name" value="${e.model.get("nickname")||""}" class="form-control" placeholder="${s}">`}</div><div class="add-xmpp-contact__group mb-3"><label class="form-label clearfix" for="name">${n}:</label><converse-autocomplete .list="${function(){const e=Bu.state.roster.reduce(((e,t)=>e.concat(t.get("groups"))),[]);return[...new Set(e.filter((e=>e)))]}()}" name="group"></converse-autocomplete></div><button type="submit" class="btn btn-primary">${t}</button></form></div>`};hm.elements.define("converse-add-contact-modal",class extends uj{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render())),this.render(),this.addEventListener("shown.bs.modal",(()=>this.querySelector('input[name="jid"]')?.focus()),!1)}renderModal(){return EF(this)}getModalTitle(){return HS("Add a Contact")}validateSubmission(e){return!e||e.split("@").filter((e=>!!e)).length<2?(this.model.set("error",HS("Please enter a valid XMPP address")),!1):Bu.state.roster.get(ft.getBareJidFromJid(e))?(this.model.set("error",HS("This contact has already been added")),!1):(this.model.set("error",null),!0)}async afterSubmission(e,t,s,n){try{await hm.contacts.add({jid:t,name:s,groups:Array.isArray(n)?n:[n]})}catch(e){return Ct.error(e),void this.model.set("error",HS("Sorry, something went wrong"))}this.model.clear(),this.modal.hide()}async addContactFromForm(e){e.preventDefault();const t=e.target,s=new FormData(t);let n=(s.get("name")||"").trim(),i=(s.get("jid")||"").trim();if(!i&&"string"==typeof hm.settings.get("xhr_user_search_url")){const e=await gI(n);if(1!==e.length)return this.model.set("error",HS("Sorry, could not find a contact with that name")),void this.render();i=e[0].value,n=e[0].label}this.validateSubmission(i)&&this.afterSubmission(t,i,n,s.get("group"))}});hm.elements.define("converse-new-chat-modal",class extends uj{initialize(){super.initialize(),this.listenTo(this.model,"change",(()=>this.render())),this.render(),this.addEventListener("shown.bs.modal",(()=>this.querySelector('input[name="jid"]')?.focus()),!1)}renderModal(){return(e=>{const t=HS("Start Chat"),s=HS("XMPP Address"),n=e.model.get("error");return fp`<div class="modal-body">${n?fp`<div class="alert alert-danger" role="alert">${n}</div>`:""}<form @submit="${t=>e.startChatFromForm(t)}"><div class="mb-3"><label class="form-label" for="jid">${s}</label> <input type="text" name="jid" class="form-control" required></div><button type="submit" class="btn btn-primary">${t}</button></form></div>`})(this)}getModalTitle(){return HS("Start a new chat")}validateSubmission(e){return!e||e.split("@").filter((e=>!!e)).length<2?(this.model.set("error",HS("Please enter a valid XMPP address")),!1):(this.model.set("error",null),!0)}async afterSubmission(e,t){try{await hm.chats.open(t,{},!0)}catch(e){return Ct.error(e),void this.model.set("error",HS("Sorry, something went wrong"))}this.model.clear(),this.modal.hide()}async startChatFromForm(e){e.preventDefault();const t=e.target,s=(new FormData(t).get("jid")||"").trim();this.validateSubmission(s)&&this.afterSubmission(t,s)}});const{isUniView:$F}=Ef;function CF(e){const t=e.get("jid"),s=[];if($F()){const e=Bu.state.chatboxes.get(t);e&&!e.get("hidden")&&s.push("open")}const n=e.get("ask"),i=e.get("requesting"),r=e.get("subscription");return"subscribe"===n||"from"===r?s.push("pending-xmpp-contact"):!0===i?s.push("requesting-xmpp-contact"):("both"===r||"to"===r||Ef.isSameBareJID(t,hm.connection.get().jid))&&(s.push("current-xmpp-contact"),s.push(r),s.push(e.getStatus())),fp`<li class="list-item d-flex controlbox-padded ${s.join(" ")}" data-status="${e.getStatus()}"><converse-roster-contact .model="${e}"></converse-roster-contact></li>`}const kF=e=>{const t=HS("Click to hide these contacts"),s=Bu.state.roster.state.get("collapsed_groups");return fp`<div class="roster-group" data-group="${e.name}"><a href="#" class="list-toggle group-toggle controlbox-padded" title="${t}" @click="${t=>function(e,t){e?.preventDefault?.();const{roster:s}=Bu.state,n=s.state.get("collapsed_groups");n.includes(t)?s.state.save("collapsed_groups",n.filter((e=>e!==t))):s.state.save("collapsed_groups",[...n,t])}(t,e.name)}"><converse-icon color="var(--background-color)" size="1em" class="fa ${s.includes(e.name)?"fa-caret-right":"fa-caret-down"}"></converse-icon>${e.name}</a><ul class="items-list roster-group-contacts ${s.includes(e.name)?"collapsed":""}" data-group="${e.name}">${kO(e.contacts,(e=>e.get("jid")),CF)}</ul></div>`},jF=e=>{const t=HS("Filter"),s=HS("Filter by contact name"),n=HS("Filter by group name"),i=HS("Filter by status"),r=HS("Any"),o=HS("Unread"),a=HS("Available"),c=HS("Chatty"),l=HS("Busy"),d=HS("Away"),u=HS("Extended Away"),h=HS("Offline"),m=e.model.get("state"),g=e.model.get("text"),p=e.model.get("type");return fp`<form class="controlbox-padded items-filter-form input-button-group ${e.shouldBeVisible()?"fade-in":"hidden"}" @submit="${t=>e.submitFilter(t)}"><div class="flex-nowrap"><div class="filter-by d-flex flex-nowrap"><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-user clickable ${"items"===p?"selected":""}" data-type="items" title="${s}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-users clickable ${"groups"===p?"selected":""}" data-type="groups" title="${n}"></converse-icon><converse-icon size="1em" @click="${t=>e.changeTypeFilter(t)}" class="fa fa-circle clickable ${"state"===p?"selected":""}" data-type="state" title="${i}"></converse-icon></div><div class="btn-group"><input .value="${g||""}" @keydown="${t=>e.liveFilter(t)}" class="items-filter form-control ${"state"===p?"hidden":""}" placeholder="${t}"><converse-icon size="1em" class="fa fa-times clear-input ${g&&"state"!==p?"":"hidden"}" @click="${t=>e.clearFilter(t)}"></converse-icon></div><select class="form-control state-type ${"state"!==p?"hidden":""}" @change="${t=>e.changeChatStateFilter(t)}"><option value="">${r}</option><option ?selected="${"unread_messages"===m}" value="unread_messages">${o}</option><option ?selected="${"online"===m}" value="online">${a}</option><option ?selected="${"chat"===m}" value="chat">${c}</option><option ?selected="${"dnd"===m}" value="dnd">${l}</option><option ?selected="${"away"===m}" value="away">${d}</option><option ?selected="${"xa"===m}" value="xa">${u}</option><option ?selected="${"offline"===m}" value="offline">${h}</option></select></div></form>`},{CLOSED:TF}=DS,OF=e=>{const t=HS("Contacts"),s=HS("Click to toggle contacts"),n=HS("Add a contact"),i=HS("Start a new chat"),{state:r}=Bu,o=[...r.roster||[],...hm.settings.get("show_self_in_roster")?[r.xmppstatus]:[]],a=o.reduce(((e,t)=>function(e,t){const{labels:s}=Bu,n=Ef.unique(t.get("groups")??[]);t.get("requesting")?n.push(s.HEADER_REQUESTING_CONTACTS):"subscribe"===t.get("ask")?n.push(s.HEADER_PENDING_CONTACTS):"none"===t.get("subscription")?n.push(s.HEADER_UNSAVED_CONTACTS):hm.settings.get("roster_groups")?n.length||n.push(s.HEADER_UNGROUPED):n.push(s.HEADER_CURRENT_CONTACTS);for(const s of n)e[s]?.includes(t)||(e[s]?e[s].push(t):e[s]=[t]);if(t.get("num_unread")){const n=s.HEADER_UNREAD;e[n]?e[n].push(t):e[n]=[t]}return e}(e,t)),{}),c=Object.keys(a).filter((t=>function(e,t){if(!t.get("filter_visible"))return!0;const s=Bu.state.roster_filter;if("groups"===s.get("type")){const t=s.get("text")?.toLowerCase();if(!t)return!0;if(!e.toLowerCase().includes(t))return!1}return!0}(t,e.model))),l=e.model.get("toggle_state")===TF;c.sort(mI);const d=HS("Show filter"),u=HS("Hide filter"),h=e.model.get("filter_visible"),m=[];if(hm.settings.get("allow_contact_requests")&&m.push(fp`<a href="#" class="dropdown-item add-contact" role="button" @click="${t=>e.showAddContactModal(t)}" title="${n}" data-toggle="modal" data-target="#add-contact-modal"><converse-icon class="fa fa-user-plus" size="1em"></converse-icon>${n}</a>`),hm.settings.get("allow_non_roster_messaging")&&m.push(fp`<a href="#" class="dropdown-item new-chat" role="button" @click="${t=>e.showNewChatModal(t)}" title="${i}" data-toggle="modal" data-target="#new-chat-modal"><converse-icon class="fa fa-user-plus" size="1em"></converse-icon>${i}</a>`),o.length>5&&m.push(fp`<a href="#" class="dropdown-item toggle-filter" role="button" @click="${t=>e.toggleFilter(t)}"><converse-icon size="1em" class="fa fa-filter"></converse-icon>${h?u:d}</a>`),"debug"===hm.settings.get("loglevel")){const t=HS("Re-sync contacts");m.push(fp`<a href="#" class="dropdown-item" role="button" @click="${t=>e.syncContacts(t)}" title="${t}"><converse-icon class="fa fa-sync sync-contacts" size="1em"></converse-icon>${t}</a>`)}return fp`<div class="d-flex controlbox-padded"><span class="w-100 controlbox-heading controlbox-heading--contacts"><a class="list-toggle open-contacts-toggle" title="${s}" role="heading" aria-level="3" @click="${e.toggleRoster}">${t} ${o.length?fp`<converse-icon class="fa ${l?"fa-caret-right":"fa-caret-down"}" size="1em" color="var(--chat-color)"></converse-icon>`:""}</a></span><converse-dropdown class="chatbox-btn btn-group dropstart dropdown--contacts" .items="${m}"></converse-dropdown></div><div class="list-container roster-contacts ${l?"hidden":""}">${h?fp`<converse-list-filter @update="${()=>e.requestUpdate()}" .promise="${hm.waitUntil("rosterInitialized")}" .items="${Bu.state.roster}" .template="${jF}" .model="${Bu.state.roster_filter}"></converse-list-filter>`:""} ${kO(c,(e=>e),(t=>{const s=a[t].filter((s=>function(e,t,s){if(!s.get("filter_visible"))return!0;const n=e.getStatus();return hm.settings.get("hide_offline_users")&&"offline"===n?("subscribe"===e.get("ask")||"from"===e.get("subscription")||!0===e.get("requesting"))&&!uI(e,t):!uI(e,t)}(s,t,e.model)));return s.sort(hI),s.length?kF({contacts:s,name:t}):""}))}</div>`},{initStorage:NF}=Ef,{CLOSED:IF,OPENED:MF}=DS;hm.elements.define("converse-roster",class extends VS{async initialize(){const e=`converse.contacts-panel${Bu.session.get("bare_jid")}`;this.model=new fd({id:e}),NF(this.model,e),this.model.fetch(),await hm.waitUntil("rosterInitialized");const{chatboxes:t,presences:s,roster:n}=Bu.state;this.listenTo(Bu,"rosterContactsFetched",(()=>this.requestUpdate())),this.listenTo(s,"change:show",(()=>this.requestUpdate())),this.listenTo(t,"change:hidden",(()=>this.requestUpdate())),this.listenTo(n,"add",(()=>this.requestUpdate())),this.listenTo(n,"destroy",(()=>this.requestUpdate())),this.listenTo(n,"remove",(()=>this.requestUpdate())),this.listenTo(n,"change",(()=>this.requestUpdate())),this.listenTo(n.state,"change",(()=>this.requestUpdate())),this.listenTo(this.model,"change",(()=>this.requestUpdate())),hm.trigger("rosterViewInitialized")}render(){return OF(this)}showAddContactModal(e){hm.modal.show("converse-add-contact-modal",{model:new fd},e)}showNewChatModal(e){hm.modal.show("converse-new-chat-modal",{model:new fd},e)}async syncContacts(e){e?.preventDefault();const{roster:t}=Bu.state;this.syncing_contacts=!0,this.requestUpdate(),t.data.save("version",null),await t.fetchFromServer(),hm.user.presence.send(),this.syncing_contacts=!1,this.requestUpdate()}toggleRoster(e){e?.preventDefault?.();const t=this.querySelector(".list-container.roster-contacts");this.model.get("toggle_state")===IF?cT(t).then((()=>this.model.save({toggle_state:MF}))):lT(t).then((()=>this.model.save({toggle_state:IF})))}toggleFilter(e){e?.preventDefault?.(),this.model.save({filter_visible:!this.model.get("filter_visible")})}});var RF=s(7702),DF={};DF.styleTagTransform=I(),DF.setAttributes=j(),DF.insert=C().bind(null,"head"),DF.domAPI=E(),DF.insertStyleElement=O();A()(RF.A,DF);RF.A&&RF.A.locals&&RF.A.locals;Cf.plugins.add("converse-rosterview",{dependencies:["converse-roster","converse-modal","converse-chatboxviews","converse-blocklist"],initialize(){hm.settings.extend({autocomplete_add_contact:!0,allow_contact_removal:!0,hide_offline_users:!1,roster_groups:!0,xhr_user_search_url:null}),hm.promises.add("rosterViewInitialized");const e={RosterFilter:cw,RosterContactView:xF};Object.assign(Bu,e),Object.assign(Bu.exports,e),hm.listen.on("chatBoxesInitialized",(()=>{Bu.state.chatboxes.on("destroy",(e=>dI(e.get("jid")))),Bu.state.chatboxes.on("change:hidden",(e=>dI(e.get("jid"))))}))}});var zF=s(8562),LF={};LF.styleTagTransform=I(),LF.setAttributes=j(),LF.insert=C().bind(null,"head"),LF.domAPI=E(),LF.insertStyleElement=O();A()(zF.A,LF);zF.A&&zF.A.locals&&zF.A.locals;Cf.plugins.add("converse-singleton",{enabled:e=>e.api.settings.get("singleton"),initialize(){hm.settings.extend({allow_logout:!1,allow_muc_invitations:!1,hide_muc_server:!0});const e=hm.settings.get("auto_join_rooms"),t=hm.settings.get("auto_join_private_chats");if(!Array.isArray(e)&&!Array.isArray(t))throw new Error("converse-singleton: auto_join_rooms must be an Array");if(0===e.length&&0===t.length)throw new Error("If you set singleton set to true, you need to specify auto_join_rooms or auto_join_private_chats");if(e.length>0&&t.length>0)throw new Error("It doesn't make sense to have singleton set to true and auto_join_rooms or auto_join_private_chats set to more then one, since only one chat room may be open at any time.")}});const{u:PF}=Cf.env;function FF(){document.addEventListener("mousemove",KF),document.addEventListener("mouseup",JF)}function UF(){document.removeEventListener("mousemove",KF),document.removeEventListener("mouseup",JF)}function BF(e){const t=Array.from(document.getElementsByTagName("iframe"));for(const s of t)e.addEventListener("mousedown",(()=>{s.style.pointerEvents="none"}),{once:!0}),e.addEventListener("mouseup",(()=>{s.style.pointerEvents="initial"}),{once:!0})}function qF(e){const t=e.get("height"),s=e.get("width");PF.safeSave(e,{height:QF(t,e.get("default_height")),width:QF(s,e.get("default_width"))})}const HF={};function GF(e,t=!0){if(!hm.settings.get("allow_dragresize"))return!0;e.preventDefault();const s=PF.ancestor(e.target,".box-flyout"),n=window.getComputedStyle(s),i=s.parentElement;i.height=parseInt(n.height.replace(/px$/,""),10),HF.chatbox=i,HF.direction="top",i.prev_pageY=e.pageY,t&&hm.trigger("startVerticalResize",i)}function WF(e,t=!0){if(!hm.settings.get("allow_dragresize"))return!0;e.preventDefault();const s=PF.ancestor(e.target,".box-flyout"),n=window.getComputedStyle(s),i=s.parentElement;i.width=parseInt(n.width.replace(/px$/,""),10),HF.chatbox=i,HF.direction="left",i.prev_pageX=e.pageX,t&&hm.trigger("startHorizontalResize",i)}function VF(e){WF(e,!1),GF(e,!1),HF.direction="topleft",hm.trigger("startDiagonalResize",this)}function QF(e,t){if(void 0===e)return;if(void 0===t)return e;return e!==t&&Math.abs(e-t)<10?t:e}function KF(e){if(!HF.chatbox||!hm.settings.get("allow_dragresize"))return!0;e.preventDefault(),HF.chatbox.resizeChatBox(e)}function JF(e){if(!HF.chatbox||!hm.settings.get("allow_dragresize"))return!0;e.preventDefault();const t=QF(HF.chatbox.height,HF.chatbox.model.get("default_height")),s=QF(HF.chatbox.width,HF.chatbox.model.get("default_width"));hm.connection.connected()?(HF.chatbox.model.save({height:t}),HF.chatbox.model.save({width:s})):(HF.chatbox.model.set({height:t}),HF.chatbox.model.set({width:s})),delete HF.chatbox,delete HF.direction}const YF=()=>fp`<div class="dragresize dragresize-top" @mousedown="${GF}"></div><div class="dragresize dragresize-topleft" @mousedown="${VF}"></div><div class="dragresize dragresize-left" @mousedown="${WF}"></div>`;hm.elements.define("converse-dragresize",class extends VS{render(){return YF()}});const XF={initDragResize(){const e=Wu((()=>this.setDimensions()));window.addEventListener("resize",e),this.listenTo(this.model,"destroy",(()=>window.removeEventListener("resize",e)));const t=this.querySelector(".box-flyout"),s=window.getComputedStyle(t);if(void 0===this.model.get("height")){const e=parseInt(s.height.replace(/px$/,""),10),t=parseInt(s.width.replace(/px$/,""),10);this.model.set("height",e),this.model.set("default_height",e),this.model.set("width",t),this.model.set("default_width",t)}const n=s["min-width"],i=s["min-height"];return this.model.set("min_width",n.endsWith("px")?Number(n.replace(/px$/,"")):0),this.model.set("min_height",i.endsWith("px")?Number(i.replace(/px$/,"")):0),this.prev_pageY=0,this.prev_pageX=0,hm.connection.get()?.connected&&(this.height=this.model.get("height"),this.width=this.model.get("width")),this},resizeChatBox(e){let t;const s=HF.direction;0===s.indexOf("top")&&(t=e.pageY-this.prev_pageY,t&&(this.height=this.height-t>(this.model.get("min_height")||0)?this.height-t:this.model.get("min_height"),this.prev_pageY=e.pageY,this.setChatBoxHeight(this.height))),s.includes("left")&&(t=this.prev_pageX-e.pageX,t&&(this.width=this.width+t>(this.model.get("min_width")||0)?this.width+t:this.model.get("min_width"),this.prev_pageX=e.pageX,this.setChatBoxWidth(this.width)))},setDimensions(){this.adjustToViewport(),this.setChatBoxWidth(this.model.get("width")),"overlayed"===hm.settings.get("view_mode")&&this.setChatBoxHeight(this.model.get("height"))},setChatBoxHeight(e){e=e?QF(e,this.model.get("default_height"))+"px":"";const t=this.querySelector(".box-flyout");null!==t&&(t.style.height=e)},setChatBoxWidth(e){e=e?QF(e,this.model.get("default_width"))+"px":"",this.style.width=e;const t=this.querySelector(".box-flyout");null!==t&&(t.style.width=e)},adjustToViewport(){const e=Math.max(document.documentElement.clientWidth,window.innerWidth||0),t=Math.max(document.documentElement.clientHeight,window.innerHeight||0);e<=480?(this.model.set("height",void 0),this.model.set("width",void 0)):e<=this.model.get("width")?this.model.set("width",void 0):t<=this.model.get("height")&&this.model.set("height",void 0)}};Cf.plugins.add("converse-dragresize",{dependencies:["converse-chatview","converse-headlines-view","converse-muc-views"],enabled:()=>"overlayed"==hm.settings.get("view_mode"),initialize(){hm.settings.extend({allow_dragresize:!0}),Object.assign(Bu.exports.ChatView?.prototype??{},XF),Object.assign(Bu.exports.MUCView?.prototype??{},XF),Object.assign(Bu.exports.HeadlinesFeedView?.prototype??{},XF),Object.assign(Bu.exports.ControlBoxView?.prototype??{},XF),hm.listen.on("headlinesFeedInitialized",qF),hm.listen.on("chatBoxInitialized",qF),hm.listen.on("chatRoomInitialized",qF),hm.listen.on("registeredGlobalEventHandlers",FF),hm.listen.on("unregisteredGlobalEventHandlers",UF),hm.listen.on("beforeShowingChatView",(e=>e.initDragResize().setDimensions())),hm.listen.on("startDiagonalResize",BF),hm.listen.on("startHorizontalResize",BF),hm.listen.on("startVerticalResize",BF)}});var ZF=s(5431),eU={};eU.styleTagTransform=I(),eU.setAttributes=j(),eU.insert=C().bind(null,"head"),eU.domAPI=E(),eU.insertStyleElement=O();A()(ZF.A,eU);ZF.A&&ZF.A.locals&&ZF.A.locals;const{isUniView:tU}=Ef;Cf.plugins.add("converse-fullscreen",{enabled:()=>tU(),initialize(){hm.settings.extend({chatview_avatar_height:50,chatview_avatar_width:50,hide_open_bookmarks:!0,show_controlbox_by_default:!0,sticky_controlbox:!0})}}),Bu.exports.CustomElement=VS;const sU=Cf.initialize;Cf.initialize=function(e,t){return Array.isArray(e.whitelisted_plugins)?e.whitelisted_plugins=e.whitelisted_plugins.concat(QS):e.whitelisted_plugins=QS,sU(e,t)};const nU=Cf},1205:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3403:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1089:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2995:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2852:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6264:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7190:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5832:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5431:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6524:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3363:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},304:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3195:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8610:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},998:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3370:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4659:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1946:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6215:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4641:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8011:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8185:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3952:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},33:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8853:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4734:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9613:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9569:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3546:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7808:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9845:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9847:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2579:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4842:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5190:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7702:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8562:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},593:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7983:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},6120:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9440:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},7187:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3796:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4563:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},5501:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1070:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},3557:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1218:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1353:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},1709:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9495:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},4647:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},719:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8850:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},845:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8945:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},8283:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},473:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},2470:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});var n=s(698),i=s.n(n),r=s(7370),o=s.n(r)()(i());o.push([e.id,"","",{version:3,sources:[],names:[],mappings:"",sourceRoot:""}]);const a=o},9499:(e,t,s)=>{var n={"./af.js":[734,5628],"./am.js":[5763,8489],"./ar-dz.js":[4121,3741],"./ar-iq.js":[9725,6605],"./ar-kw.js":[4985,861],"./ar-ly.js":[8280,1696],"./ar-ma.js":[4057,7385],"./ar-sa.js":[1643,131],"./ar-tn.js":[4645,7801],"./ar.js":[8994,8880],"./az.js":[8010,9080],"./be.js":[6604,2366],"./bg.js":[3046,1072],"./bi.js":[5704,1938],"./bm.js":[3204,6486],"./bn-bd.js":[6560,6124],"./bn.js":[5053,9423],"./bo.js":[7662,1464],"./br.js":[7817,2643],"./bs.js":[5290,1116],"./ca.js":[1065,9395],"./cs.js":[1175,5825],"./cv.js":[6204,2766],"./cy.js":[4049,7003],"./da.js":[5250,6208],"./de-at.js":[6846,5534],"./de-ch.js":[7160,6064],"./de.js":[9310,5036],"./dv.js":[9419,2993],"./el.js":[9144,9782],"./en-au.js":[8681,6121],"./en-ca.js":[4379,5611],"./en-gb.js":[2410,4094],"./en-ie.js":[817,1665],"./en-il.js":[8074,8178],"./en-in.js":[8224,7028],"./en-nz.js":[9059,8343],"./en-sg.js":[7745,3341],"./en-tt.js":[9355,7627],"./en.js":[5586,6824],"./eo.js":[3473,8031],"./es-do.js":[1603,9271],"./es-mx.js":[9871,591],"./es-pr.js":[6156,2856],"./es-us.js":[7570,4182],"./es.js":[7845,1827],"./et.js":[4048,385],"./eu.js":[5351,933],"./fa.js":[1636,598],"./fi.js":[8860,3166],"./fo.js":[4906,7596],"./fr-ca.js":[4658,9870],"./fr-ch.js":[6921,9101],"./fr.js":[573,8431],"./fy.js":[3244,9710],"./ga.js":[3821,7743],"./gd.js":[5074,5284],"./gl.js":[4090,5724],"./gom-latn.js":[8948,8630],"./gu.js":[6305,8443],"./he.js":[9242,2384],"./hi.js":[7902,4852],"./hr.js":[5571,2241],"./ht.js":[3881,6007],"./hu.js":[5178,1712],"./hy-am.js":[226,9589],"./id.js":[7180,4770],"./is.js":[5273,3359],"./it-ch.js":[1206,4718],"./it.js":[6444,4034],"./ja.js":[680,4434],"./jv.js":[7469,9007],"./ka.js":[9313,4523],"./kk.js":[7239,6641],"./km.js":[3045,3287],"./kn.js":[2268,4974],"./ko.js":[3555,8789],"./ku.js":[493,687],"./ky.js":[6713,7491],"./lb.js":[8567,1373],"./lo.js":[516,6042],"./lt.js":[5013,4859],"./lv.js":[6419,9593],"./me.js":[3167,4333],"./mi.js":[9971,3729],"./mk.js":[4245,5059],"./ml.js":[2032,5998],"./mn.js":[2458,1056],"./mr.js":[4830,4260],"./ms-my.js":[9072,4512],"./ms.js":[2221,2091],"./mt.js":[2872,3014],"./my.js":[4035,561],"./nb.js":[9749,7],"./ne.js":[832,5946],"./nl-be.js":[8961,9109],"./nl.js":[4495,7497],"./nn.js":[6481,1275],"./oc-lnc.js":[8033,1719],"./pa-in.js":[5092,2664],"./pl.js":[7001,6343],"./pt-br.js":[8954,2014],"./pt.js":[2129,6191],"./rn.js":[4237,3519],"./ro.js":[8222,4584],"./ru.js":[6684,7806],"./rw.js":[5142,8176],"./sd.js":[2982,3664],"./se.js":[1941,9975],"./si.js":[590,9547],"./sk.js":[7375,6537],"./sl.js":[5070,8232],"./sq.js":[1049,9411],"./sr-cyrl.js":[2863,9331],"./sr.js":[5568,4858],"./ss.js":[6071,2769],"./sv-fi.js":[1800,6660],"./sv.js":[1100,1982],"./sw.js":[2739,2389],"./ta.js":[7730,832],"./te.js":[2478,4636],"./tet.js":[192,8592],"./tg.js":[2244,7962],"./th.js":[2153,6655],"./tk.js":[9200,422],"./tl-ph.js":[5406,8022],"./tlh.js":[3297,8945],"./tr.js":[4655,9557],"./tzl.js":[5027,3683],"./tzm-latn.js":[5300,138],"./tzm.js":[4764,9052],"./ug-cn.js":[9191,3731],"./uk.js":[4413,4107],"./ur.js":[9894,1388],"./uz-latn.js":[9398,5970],"./uz.js":[4974,948],"./vi.js":[4988,3774],"./x-pseudo.js":[2112,5790],"./yo.js":[477,6803],"./zh-cn.js":[1105,4385],"./zh-hk.js":[4013,7013],"./zh-tw.js":[437,7981],"./zh.js":[3239,4497]};function i(e){if(!s.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return s.e(t[1]).then((()=>s.t(i,23)))}i.keys=()=>Object.keys(n),i.id=9499,e.exports=i},4026:e=>{window,e.exports=function(e){var t={};function s(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,s),i.l=!0,i.exports}return s.m=e,s.c=t,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},s.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=7)}([function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadImageElement=function(e,t){return new Promise((function(s,n){e.addEventListener("load",(function(){s(e)}),!1),e.addEventListener("error",(function(e){n(e)}),!1),e.src=t}))},t.resize=function(e,t,s,n){if(!s&&!n)return{currentWidth:e,currentHeight:t};var i=e/t,r=void 0,o=void 0;return i>s/n?o=(r=Math.min(e,s))/i:r=(o=Math.min(t,n))*i,{width:r,height:o}}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.base64ToFile=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",s=window.atob(e),n=[],i=0;i<s.length;i++)n[i]=s.charCodeAt(i);return new window.Blob([new Uint8Array(n)],{type:t})},t.imageToCanvas=function(e,t,s,n){var i=document.createElement("canvas"),r=i.getContext("2d");if(i.width=t,i.height=s,!n||n>8)return r.drawImage(e,0,0,i.width,i.height),i;switch(n>4&&(i.width=s,i.height=t),n){case 2:r.translate(t,0),r.scale(-1,1);break;case 3:r.translate(t,s),r.rotate(Math.PI);break;case 4:r.translate(0,s),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-s);break;case 7:r.rotate(.5*Math.PI),r.translate(t,-s),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-t,0)}return n>4?r.drawImage(e,0,0,i.height,i.width):r.drawImage(e,0,0,i.width,i.height),i},t.canvasToBlob=function(e,t){return new Promise((function(s,n){e.toBlob((function(e){s(e)}),"image/jpeg",t)}))},t.size=function(e){return{kB:.001*e,MB:1e-6*e}},t.blobToBase64=function(e){return new Promise((function(t,s){var n=new window.FileReader;n.addEventListener("load",(function(e){t(e.target.result)}),!1),n.addEventListener("error",(function(e){s(e)}),!1),n.readAsDataURL(e)}))}},function(e,t,s){e.exports=s(6)},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.extractOrientation=function(e){return new Promise((function(t,s){var n=new window.FileReader;n.onload=function(e){var s=new DataView(e.target.result);65496!==s.getUint16(0,!1)&&t(-2);for(var n=s.byteLength,i=2;i<n;){var r=s.getUint16(i,!1);if(i+=2,65505===r){1165519206!==s.getUint32(i+=2,!1)&&t(-1);var o=18761===s.getUint16(i+=6,!1);i+=s.getUint32(i+4,o);var a=s.getUint16(i,o);i+=2;for(var c=0;c<a;c++)274===s.getUint16(i+12*c,o)&&t(s.getUint16(i+12*c+8,o))}else{if(65280&~r)break;i+=s.getUint16(i,!1)}}t(-1)},n.readAsArrayBuffer(e.slice(0,65536))}))}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=(n=s(2))&&n.__esModule?n:{default:n},r=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),o=s(3),a=s(0),c=s(1);function l(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,s){return function n(i,r){try{var o=t[i](r),a=o.value}catch(e){return void s(e)}if(!o.done)return Promise.resolve(a).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(a)}("next")}))}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.name=t.name,this.type=t.type,this.size=t.size}return r(e,[{key:"setData",value:function(e){this.data=e,this.size=e.size,this.type=e.type}},{key:"_calculateOrientation",value:function(){var e=l(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,o.extractOrientation)(this.data);case 2:t=e.sent,this.orientation=t;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=l(i.default.mark((function e(){var t,s;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._calculateOrientation();case 2:return t=URL.createObjectURL(this.data),s=new window.Image,e.next=6,(0,a.loadImageElement)(s,t);case 6:URL.revokeObjectURL(t),this._img=s,this.width=s.naturalWidth,this.height=s.naturalHeight;case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getCanvas",value:function(e,t,s){return void 0!==s?(0,c.imageToCanvas)(this._img,e,t,s):(0,c.imageToCanvas)(this._img,e,t,this.orientation)}}]),e}();t.default=d,e.exports=t.default},function(e,t){!function(t){"use strict";var s,n=Object.prototype,i=n.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",c=r.toStringTag||"@@toStringTag",l="object"==typeof e,d=t.regeneratorRuntime;if(d)l&&(e.exports=d);else{(d=t.regeneratorRuntime=l?e.exports:{}).wrap=y;var u="suspendedStart",h="suspendedYield",m="executing",g="completed",p={},f={};f[o]=function(){return this};var v=Object.getPrototypeOf,_=v&&v(v(O([])));_&&_!==n&&i.call(_,o)&&(f=_);var b=x.prototype=S.prototype=Object.create(f);A.prototype=b.constructor=x,x.constructor=A,x[c]=A.displayName="GeneratorFunction",d.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===A||"GeneratorFunction"===(t.displayName||t.name))},d.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(b),e},d.awrap=function(e){return{__await:e}},E($.prototype),$.prototype[a]=function(){return this},d.AsyncIterator=$,d.async=function(e,t,s,n){var i=new $(y(e,t,s,n));return d.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},E(b),b[c]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"},d.keys=function(e){var t=[];for(var s in e)t.push(s);return t.reverse(),function s(){for(;t.length;){var n=t.pop();if(n in e)return s.value=n,s.done=!1,s}return s.done=!0,s}},d.values=O,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=s,this.done=!1,this.delegate=null,this.method="next",this.arg=s,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=s)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,i){return a.type="throw",a.arg=e,t.next=n,i&&(t.method="next",t.arg=s),!!i}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=i.call(o,"catchLoc"),l=i.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var n=this.tryEntries[s];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.finallyLoc===e)return this.complete(s.completion,s.afterLoc),j(s),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.tryLoc===e){var n=s.completion;if("throw"===n.type){var i=n.arg;j(s)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:O(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=s),p}}}function y(e,t,s,n){var i=t&&t.prototype instanceof S?t:S,r=Object.create(i.prototype),o=new T(n||[]);return r._invoke=function(e,t,s){var n=u;return function(i,r){if(n===m)throw new Error("Generator is already running");if(n===g){if("throw"===i)throw r;return N()}for(s.method=i,s.arg=r;;){var o=s.delegate;if(o){var a=C(o,s);if(a){if(a===p)continue;return a}}if("next"===s.method)s.sent=s._sent=s.arg;else if("throw"===s.method){if(n===u)throw n=g,s.arg;s.dispatchException(s.arg)}else"return"===s.method&&s.abrupt("return",s.arg);n=m;var c=w(e,t,s);if("normal"===c.type){if(n=s.done?g:h,c.arg===p)continue;return{value:c.arg,done:s.done}}"throw"===c.type&&(n=g,s.method="throw",s.arg=c.arg)}}}(e,s,o),r}function w(e,t,s){try{return{type:"normal",arg:e.call(t,s)}}catch(e){return{type:"throw",arg:e}}}function S(){}function A(){}function x(){}function E(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function $(e){var t;this._invoke=function(s,n){function r(){return new Promise((function(t,r){!function t(s,n,r,o){var a=w(e[s],e,n);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==typeof l&&i.call(l,"__await")?Promise.resolve(l.__await).then((function(e){t("next",e,r,o)}),(function(e){t("throw",e,r,o)})):Promise.resolve(l).then((function(e){c.value=e,r(c)}),o)}o(a.arg)}(s,n,t,r)}))}return t=t?t.then(r,r):r()}}function C(e,t){var n=e.iterator[t.method];if(n===s){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=s,C(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=w(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,p;var r=i.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=s),t.delegate=null,p):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function O(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=s,t.done=!0,t};return r.next=r}}return{next:N}}function N(){return{value:s,done:!0}}}(function(){return this}()||Function("return this")())},function(e,t,s){var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,r=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,e.exports=s(5),i)n.regeneratorRuntime=r;else try{delete n.regeneratorRuntime}catch(e){n.regeneratorRuntime=void 0}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=c(s(2)),i=function(){function e(e,t){for(var s=0;s<t.length;s++){var n=t[s];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,s,n){return s&&e(t.prototype,s),n&&e(t,n),t}}(),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t.default=e,t}(s(1)),o=s(0),a=c(s(4));function c(e){return e&&e.__esModule?e:{default:e}}function l(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,s){return function n(i,r){try{var o=t[i](r),a=o.value}catch(e){return void s(e)}if(!o.done)return Promise.resolve(a).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(a)}("next")}))}}var d=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.setOptions(t)}return i(e,[{key:"setOptions",value:function(e){var t={targetSize:1/0,quality:.75,minQuality:.5,qualityStepSize:.1,maxWidth:1920,maxHeight:1920,resize:!0,throwIfSizeNotReached:!1,autoRotate:!0},s=new Proxy(e,{get:function(e,s){return s in e?e[s]:t[s]}});this.options=s}},{key:"_compressFile",value:function(){var e=l(n.default.mark((function e(t){var s,i;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new a.default(t),(i={}).start=window.performance.now(),i.quality=this.options.quality,i.startType=s.type,e.next=7,s.load();case 7:return e.next=9,this._compressImage(s,i);case 9:return e.abrupt("return",e.sent);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_compressImage",value:function(){var e=l(n.default.mark((function e(t,s){var i,a,c,l,d;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.startWidth=t.width,s.startHeight=t.height,i=void 0,a=void 0,this.options.resize?(c=(0,o.resize)(t.width,t.height,this.options.maxWidth,this.options.maxHeight),i=c.width,a=c.height):(i=t.width,a=t.height),s.endWidth=i,s.endHeight=a,l=this.doAutoRotation?void 0:1,d=t.getCanvas(i,a,l),s.iterations=0,s.startSizeMB=r.size(t.size).MB,e.next=12,this._loopCompression(d,t,s);case 12:return s.endSizeMB=r.size(t.size).MB,s.sizeReducedInPercent=(s.startSizeMB-s.endSizeMB)/s.startSizeMB*100,s.end=window.performance.now(),s.elapsedTimeInSeconds=(s.end-s.start)/1e3,s.endType=t.type,e.abrupt("return",{photo:t,info:s});case 18:case"end":return e.stop()}}),e,this)})));return function(t,s){return e.apply(this,arguments)}}()},{key:"_loopCompression",value:function(){var e=l(n.default.mark((function e(t,s,i){var o;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.iterations++,e.t0=s,e.next=4,r.canvasToBlob(t,i.quality);case 4:if(e.t1=e.sent,e.t0.setData.call(e.t0,e.t1),1==i.iterations&&(s.width=i.endWidth,s.height=i.endHeight),!(r.size(s.size).MB>this.options.targetSize)){e.next=24;break}if(!(i.quality.toFixed(10)-.1<this.options.minQuality)){e.next=18;break}if(o="Couldn't compress image to target size while maintaining quality.\n        Target size: "+this.options.targetSize+"\n        Actual size: "+r.size(s.size).MB,this.options.throwIfSizeNotReached){e.next=14;break}console.error(o),e.next=15;break;case 14:throw new Error(o);case 15:case 24:return e.abrupt("return");case 18:return i.quality-=this.options.qualityStepSize,e.next=21,this._loopCompression(t,s,i);case 21:return e.abrupt("return",e.sent);case 22:e.next=25;break;case 25:case"end":return e.stop()}}),e,this)})));return function(t,s,n){return e.apply(this,arguments)}}()},{key:"setAutoRotate",value:function(){var t=l(n.default.mark((function t(){var s;return n.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.automaticRotationFeatureTest();case 2:s=t.sent,this.doAutoRotation=this.options.autoRotate&&!s;case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"compress",value:function(){var e=l(n.default.mark((function e(t){var s=this;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.setAutoRotate();case 2:return e.abrupt("return",Promise.all(t.map((function(e){return s._compressFile(e)}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}],[{key:"blobToBase64",value:function(){var e=l(n.default.mark((function e(){var t=arguments;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.blobToBase64.apply(r,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadImageElement",value:function(){var e=l(n.default.mark((function e(){var t=arguments;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.loadImageElement.apply(void 0,t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"automaticRotationFeatureTest",value:function(){return new Promise((function(e){var t=new Image;t.onload=function(){var s=1===t.width&&2===t.height;e(s)},t.src="data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q=="}))}}]),e}();t.default=d,e.exports=t.default}])},7370:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s="",n=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),n&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),n&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s})).join("")},t.i=function(e,s,n,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(n)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var l=0;l<e.length;l++){var d=[].concat(e[l]);n&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),s&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=s):d[2]=s),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},698:e=>{"use strict";e.exports=function(e){var t=e[1],s=e[3];if(!s)return t;if("function"==typeof btoa){var n=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(n),r="/*# ".concat(i," */");return[t].concat([r]).join("\n")}return[t].join("\n")}},5569:function(e){e.exports=function(){"use strict";var e=1e3,t=6e4,s=36e5,n="millisecond",i="second",r="minute",o="hour",a="day",c="week",l="month",d="quarter",u="year",h="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],s=e%100;return"["+e+(t[(s-20)%10]||t[s]||t[0])+"]"}},v=function(e,t,s){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(s)+e},_={s:v,z:function(e){var t=-e.utcOffset(),s=Math.abs(t),n=Math.floor(s/60),i=s%60;return(t<=0?"+":"-")+v(n,2,"0")+":"+v(i,2,"0")},m:function e(t,s){if(t.date()<s.date())return-e(s,t);var n=12*(s.year()-t.year())+(s.month()-t.month()),i=t.clone().add(n,l),r=s-i<0,o=t.clone().add(n+(r?-1:1),l);return+(-(n+(s-i)/(r?i-o:o-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:l,y:u,w:c,d:a,D:h,h:o,m:r,s:i,ms:n,Q:d}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},b="en",y={};y[b]=f;var w="$isDayjsObject",S=function(e){return e instanceof $||!(!e||!e[w])},A=function e(t,s,n){var i;if(!t)return b;if("string"==typeof t){var r=t.toLowerCase();y[r]&&(i=r),s&&(y[r]=s,i=r);var o=t.split("-");if(!i&&o.length>1)return e(o[0])}else{var a=t.name;y[a]=t,i=a}return!n&&i&&(b=i),i||!n&&b},x=function(e,t){if(S(e))return e.clone();var s="object"==typeof t?t:{};return s.date=e,s.args=arguments,new $(s)},E=_;E.l=A,E.i=S,E.w=function(e,t){return x(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var $=function(){function f(e){this.$L=A(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[w]=!0}var v=f.prototype;return v.parse=function(e){this.$d=function(e){var t=e.date,s=e.utc;if(null===t)return new Date(NaN);if(E.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(g);if(n){var i=n[2]-1||0,r=(n[7]||"0").substring(0,3);return s?new Date(Date.UTC(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,r)):new Date(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,r)}}return new Date(t)}(e),this.init()},v.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},v.$utils=function(){return E},v.isValid=function(){return!(this.$d.toString()===m)},v.isSame=function(e,t){var s=x(e);return this.startOf(t)<=s&&s<=this.endOf(t)},v.isAfter=function(e,t){return x(e)<this.startOf(t)},v.isBefore=function(e,t){return this.endOf(t)<x(e)},v.$g=function(e,t,s){return E.u(e)?this[t]:this.set(s,e)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(e,t){var s=this,n=!!E.u(t)||t,d=E.p(e),m=function(e,t){var i=E.w(s.$u?Date.UTC(s.$y,t,e):new Date(s.$y,t,e),s);return n?i:i.endOf(a)},g=function(e,t){return E.w(s.toDate()[e].apply(s.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(t)),s)},p=this.$W,f=this.$M,v=this.$D,_="set"+(this.$u?"UTC":"");switch(d){case u:return n?m(1,0):m(31,11);case l:return n?m(1,f):m(0,f+1);case c:var b=this.$locale().weekStart||0,y=(p<b?p+7:p)-b;return m(n?v-y:v+(6-y),f);case a:case h:return g(_+"Hours",0);case o:return g(_+"Minutes",1);case r:return g(_+"Seconds",2);case i:return g(_+"Milliseconds",3);default:return this.clone()}},v.endOf=function(e){return this.startOf(e,!1)},v.$set=function(e,t){var s,c=E.p(e),d="set"+(this.$u?"UTC":""),m=(s={},s[a]=d+"Date",s[h]=d+"Date",s[l]=d+"Month",s[u]=d+"FullYear",s[o]=d+"Hours",s[r]=d+"Minutes",s[i]=d+"Seconds",s[n]=d+"Milliseconds",s)[c],g=c===a?this.$D+(t-this.$W):t;if(c===l||c===u){var p=this.clone().set(h,1);p.$d[m](g),p.init(),this.$d=p.set(h,Math.min(this.$D,p.daysInMonth())).$d}else m&&this.$d[m](g);return this.init(),this},v.set=function(e,t){return this.clone().$set(e,t)},v.get=function(e){return this[E.p(e)]()},v.add=function(n,d){var h,m=this;n=Number(n);var g=E.p(d),p=function(e){var t=x(m);return E.w(t.date(t.date()+Math.round(e*n)),m)};if(g===l)return this.set(l,this.$M+n);if(g===u)return this.set(u,this.$y+n);if(g===a)return p(1);if(g===c)return p(7);var f=(h={},h[r]=t,h[o]=s,h[i]=e,h)[g]||1,v=this.$d.getTime()+n*f;return E.w(v,this)},v.subtract=function(e,t){return this.add(-1*e,t)},v.format=function(e){var t=this,s=this.$locale();if(!this.isValid())return s.invalidDate||m;var n=e||"YYYY-MM-DDTHH:mm:ssZ",i=E.z(this),r=this.$H,o=this.$m,a=this.$M,c=s.weekdays,l=s.months,d=s.meridiem,u=function(e,s,i,r){return e&&(e[s]||e(t,n))||i[s].slice(0,r)},h=function(e){return E.s(r%12||12,e,"0")},g=d||function(e,t,s){var n=e<12?"AM":"PM";return s?n.toLowerCase():n};return n.replace(p,(function(e,n){return n||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return E.s(t.$y,4,"0");case"M":return a+1;case"MM":return E.s(a+1,2,"0");case"MMM":return u(s.monthsShort,a,l,3);case"MMMM":return u(l,a);case"D":return t.$D;case"DD":return E.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return u(s.weekdaysMin,t.$W,c,2);case"ddd":return u(s.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(r);case"HH":return E.s(r,2,"0");case"h":return h(1);case"hh":return h(2);case"a":return g(r,o,!0);case"A":return g(r,o,!1);case"m":return String(o);case"mm":return E.s(o,2,"0");case"s":return String(t.$s);case"ss":return E.s(t.$s,2,"0");case"SSS":return E.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(n,h,m){var g,p=this,f=E.p(h),v=x(n),_=(v.utcOffset()-this.utcOffset())*t,b=this-v,y=function(){return E.m(p,v)};switch(f){case u:g=y()/12;break;case l:g=y();break;case d:g=y()/3;break;case c:g=(b-_)/6048e5;break;case a:g=(b-_)/864e5;break;case o:g=b/s;break;case r:g=b/t;break;case i:g=b/e;break;default:g=b}return m?g:E.a(g)},v.daysInMonth=function(){return this.endOf(l).$D},v.$locale=function(){return y[this.$L]},v.locale=function(e,t){if(!e)return this.$L;var s=this.clone(),n=A(e,t,!0);return n&&(s.$L=n),s},v.clone=function(){return E.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},f}(),C=$.prototype;return x.prototype=C,[["$ms",n],["$s",i],["$m",r],["$H",o],["$W",a],["$M",l],["$y",u],["$D",h]].forEach((function(e){C[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),x.extend=function(e,t){return e.$i||(e(t,$,x),e.$i=!0),x},x.locale=A,x.isDayjs=S,x.unix=function(e){return x(1e3*e)},x.en=y[b],x.Ls=y,x.p={},x}()},9807:function(e){e.exports=function(){"use strict";return function(e,t){var s=t.prototype,n=s.format;s.format=function(e){var t=this,s=this.$locale();if(!this.isValid())return n.bind(this)(e);var i=this.$utils(),r=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return s.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return s.ordinal(t.week(),"W");case"w":case"ww":return i.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return i.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return i.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}}));return n.bind(this)(r)}}}()},8870:function(e){e.exports=function(){"use strict";const{entries:e,setPrototypeOf:t,isFrozen:s,getPrototypeOf:n,getOwnPropertyDescriptor:i}=Object;let{freeze:r,seal:o,create:a}=Object,{apply:c,construct:l}="undefined"!=typeof Reflect&&Reflect;r||(r=function(e){return e}),o||(o=function(e){return e}),c||(c=function(e,t,s){return e.apply(t,s)}),l||(l=function(e,t){return new e(...t)});const d=S(Array.prototype.forEach),u=S(Array.prototype.pop),h=S(Array.prototype.push),m=S(String.prototype.toLowerCase),g=S(String.prototype.toString),p=S(String.prototype.match),f=S(String.prototype.replace),v=S(String.prototype.indexOf),_=S(String.prototype.trim),b=S(Object.prototype.hasOwnProperty),y=S(RegExp.prototype.test),w=A(TypeError);function S(e){return function(t){for(var s=arguments.length,n=new Array(s>1?s-1:0),i=1;i<s;i++)n[i-1]=arguments[i];return c(e,t,n)}}function A(e){return function(){for(var t=arguments.length,s=new Array(t),n=0;n<t;n++)s[n]=arguments[n];return l(e,s)}}function x(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:m;t&&t(e,null);let r=n.length;for(;r--;){let t=n[r];if("string"==typeof t){const e=i(t);e!==t&&(s(n)||(n[r]=e),t=e)}e[t]=!0}return e}function E(e){for(let t=0;t<e.length;t++)b(e,t)||(e[t]=null);return e}function $(t){const s=a(null);for(const[n,i]of e(t))b(t,n)&&(Array.isArray(i)?s[n]=E(i):i&&"object"==typeof i&&i.constructor===Object?s[n]=$(i):s[n]=i);return s}function C(e,t){for(;null!==e;){const s=i(e,t);if(s){if(s.get)return S(s.get);if("function"==typeof s.value)return S(s.value)}e=n(e)}function s(){return null}return s}const k=r(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),j=r(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),T=r(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),O=r(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),N=r(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),I=r(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),M=r(["#text"]),R=r(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),D=r(["accent-height","accumulate","additive","alignment-baseline","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),z=r(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),L=r(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),P=o(/\{\{[\w\W]*|[\w\W]*\}\}/gm),F=o(/<%[\w\W]*|[\w\W]*%>/gm),U=o(/\${[\w\W]*}/gm),B=o(/^data-[\-\w.\u00B7-\uFFFF]/),q=o(/^aria-[\-\w]+$/),H=o(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),G=o(/^(?:\w+script|data):/i),W=o(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),V=o(/^html$/i),Q=o(/^[a-z][.\w]*(-[.\w]+)+$/i);var K=Object.freeze({__proto__:null,MUSTACHE_EXPR:P,ERB_EXPR:F,TMPLIT_EXPR:U,DATA_ATTR:B,ARIA_ATTR:q,IS_ALLOWED_URI:H,IS_SCRIPT_OR_DATA:G,ATTR_WHITESPACE:W,DOCTYPE_NAME:V,CUSTOM_ELEMENT:Q});const J={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},Y=function(){return"undefined"==typeof window?null:window},X=function(e,t){if("object"!=typeof e||"function"!=typeof e.createPolicy)return null;let s=null;const n="data-tt-policy-suffix";t&&t.hasAttribute(n)&&(s=t.getAttribute(n));const i="dompurify"+(s?"#"+s:"");try{return e.createPolicy(i,{createHTML:e=>e,createScriptURL:e=>e})}catch(e){return console.warn("TrustedTypes policy "+i+" could not be created."),null}};function Z(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y();const s=e=>Z(e);if(s.version="3.1.5",s.removed=[],!t||!t.document||t.document.nodeType!==J.document)return s.isSupported=!1,s;let{document:n}=t;const i=n,o=i.currentScript,{DocumentFragment:c,HTMLTemplateElement:l,Node:S,Element:A,NodeFilter:E,NamedNodeMap:P=t.NamedNodeMap||t.MozNamedAttrMap,HTMLFormElement:F,DOMParser:U,trustedTypes:B}=t,q=A.prototype,G=C(q,"cloneNode"),W=C(q,"nextSibling"),Q=C(q,"childNodes"),ee=C(q,"parentNode");if("function"==typeof l){const e=n.createElement("template");e.content&&e.content.ownerDocument&&(n=e.content.ownerDocument)}let te,se="";const{implementation:ne,createNodeIterator:ie,createDocumentFragment:re,getElementsByTagName:oe}=n,{importNode:ae}=i;let ce={};s.isSupported="function"==typeof e&&"function"==typeof ee&&ne&&void 0!==ne.createHTMLDocument;const{MUSTACHE_EXPR:le,ERB_EXPR:de,TMPLIT_EXPR:ue,DATA_ATTR:he,ARIA_ATTR:me,IS_SCRIPT_OR_DATA:ge,ATTR_WHITESPACE:pe,CUSTOM_ELEMENT:fe}=K;let{IS_ALLOWED_URI:ve}=K,_e=null;const be=x({},[...k,...j,...T,...N,...M]);let ye=null;const we=x({},[...R,...D,...z,...L]);let Se=Object.seal(a(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),Ae=null,xe=null,Ee=!0,$e=!0,Ce=!1,ke=!0,je=!1,Te=!0,Oe=!1,Ne=!1,Ie=!1,Me=!1,Re=!1,De=!1,ze=!0,Le=!1;const Pe="user-content-";let Fe=!0,Ue=!1,Be={},qe=null;const He=x({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let Ge=null;const We=x({},["audio","video","img","source","image","track"]);let Ve=null;const Qe=x({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),Ke="http://www.w3.org/1998/Math/MathML",Je="http://www.w3.org/2000/svg",Ye="http://www.w3.org/1999/xhtml";let Xe=Ye,Ze=!1,et=null;const tt=x({},[Ke,Je,Ye],g);let st=null;const nt=["application/xhtml+xml","text/html"],it="text/html";let rt=null,ot=null;const at=n.createElement("form"),ct=function(e){return e instanceof RegExp||e instanceof Function},lt=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!ot||ot!==e){if(e&&"object"==typeof e||(e={}),e=$(e),st=-1===nt.indexOf(e.PARSER_MEDIA_TYPE)?it:e.PARSER_MEDIA_TYPE,rt="application/xhtml+xml"===st?g:m,_e=b(e,"ALLOWED_TAGS")?x({},e.ALLOWED_TAGS,rt):be,ye=b(e,"ALLOWED_ATTR")?x({},e.ALLOWED_ATTR,rt):we,et=b(e,"ALLOWED_NAMESPACES")?x({},e.ALLOWED_NAMESPACES,g):tt,Ve=b(e,"ADD_URI_SAFE_ATTR")?x($(Qe),e.ADD_URI_SAFE_ATTR,rt):Qe,Ge=b(e,"ADD_DATA_URI_TAGS")?x($(We),e.ADD_DATA_URI_TAGS,rt):We,qe=b(e,"FORBID_CONTENTS")?x({},e.FORBID_CONTENTS,rt):He,Ae=b(e,"FORBID_TAGS")?x({},e.FORBID_TAGS,rt):{},xe=b(e,"FORBID_ATTR")?x({},e.FORBID_ATTR,rt):{},Be=!!b(e,"USE_PROFILES")&&e.USE_PROFILES,Ee=!1!==e.ALLOW_ARIA_ATTR,$e=!1!==e.ALLOW_DATA_ATTR,Ce=e.ALLOW_UNKNOWN_PROTOCOLS||!1,ke=!1!==e.ALLOW_SELF_CLOSE_IN_ATTR,je=e.SAFE_FOR_TEMPLATES||!1,Te=!1!==e.SAFE_FOR_XML,Oe=e.WHOLE_DOCUMENT||!1,Me=e.RETURN_DOM||!1,Re=e.RETURN_DOM_FRAGMENT||!1,De=e.RETURN_TRUSTED_TYPE||!1,Ie=e.FORCE_BODY||!1,ze=!1!==e.SANITIZE_DOM,Le=e.SANITIZE_NAMED_PROPS||!1,Fe=!1!==e.KEEP_CONTENT,Ue=e.IN_PLACE||!1,ve=e.ALLOWED_URI_REGEXP||H,Xe=e.NAMESPACE||Ye,Se=e.CUSTOM_ELEMENT_HANDLING||{},e.CUSTOM_ELEMENT_HANDLING&&ct(e.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(Se.tagNameCheck=e.CUSTOM_ELEMENT_HANDLING.tagNameCheck),e.CUSTOM_ELEMENT_HANDLING&&ct(e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(Se.attributeNameCheck=e.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),e.CUSTOM_ELEMENT_HANDLING&&"boolean"==typeof e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements&&(Se.allowCustomizedBuiltInElements=e.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),je&&($e=!1),Re&&(Me=!0),Be&&(_e=x({},M),ye=[],!0===Be.html&&(x(_e,k),x(ye,R)),!0===Be.svg&&(x(_e,j),x(ye,D),x(ye,L)),!0===Be.svgFilters&&(x(_e,T),x(ye,D),x(ye,L)),!0===Be.mathMl&&(x(_e,N),x(ye,z),x(ye,L))),e.ADD_TAGS&&(_e===be&&(_e=$(_e)),x(_e,e.ADD_TAGS,rt)),e.ADD_ATTR&&(ye===we&&(ye=$(ye)),x(ye,e.ADD_ATTR,rt)),e.ADD_URI_SAFE_ATTR&&x(Ve,e.ADD_URI_SAFE_ATTR,rt),e.FORBID_CONTENTS&&(qe===He&&(qe=$(qe)),x(qe,e.FORBID_CONTENTS,rt)),Fe&&(_e["#text"]=!0),Oe&&x(_e,["html","head","body"]),_e.table&&(x(_e,["tbody"]),delete Ae.tbody),e.TRUSTED_TYPES_POLICY){if("function"!=typeof e.TRUSTED_TYPES_POLICY.createHTML)throw w('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if("function"!=typeof e.TRUSTED_TYPES_POLICY.createScriptURL)throw w('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');te=e.TRUSTED_TYPES_POLICY,se=te.createHTML("")}else void 0===te&&(te=X(B,o)),null!==te&&"string"==typeof se&&(se=te.createHTML(""));r&&r(e),ot=e}},dt=x({},["mi","mo","mn","ms","mtext"]),ut=x({},["foreignobject","annotation-xml"]),ht=x({},["title","style","font","a","script"]),mt=x({},[...j,...T,...O]),gt=x({},[...N,...I]),pt=function(e){let t=ee(e);t&&t.tagName||(t={namespaceURI:Xe,tagName:"template"});const s=m(e.tagName),n=m(t.tagName);return!!et[e.namespaceURI]&&(e.namespaceURI===Je?t.namespaceURI===Ye?"svg"===s:t.namespaceURI===Ke?"svg"===s&&("annotation-xml"===n||dt[n]):Boolean(mt[s]):e.namespaceURI===Ke?t.namespaceURI===Ye?"math"===s:t.namespaceURI===Je?"math"===s&&ut[n]:Boolean(gt[s]):e.namespaceURI===Ye?!(t.namespaceURI===Je&&!ut[n])&&!(t.namespaceURI===Ke&&!dt[n])&&!gt[s]&&(ht[s]||!mt[s]):!("application/xhtml+xml"!==st||!et[e.namespaceURI]))},ft=function(e){h(s.removed,{element:e});try{e.parentNode.removeChild(e)}catch(t){e.remove()}},vt=function(e,t){try{h(s.removed,{attribute:t.getAttributeNode(e),from:t})}catch(e){h(s.removed,{attribute:null,from:t})}if(t.removeAttribute(e),"is"===e&&!ye[e])if(Me||Re)try{ft(t)}catch(e){}else try{t.setAttribute(e,"")}catch(e){}},_t=function(e){let t=null,s=null;if(Ie)e="<remove></remove>"+e;else{const t=p(e,/^[\r\n\t ]+/);s=t&&t[0]}"application/xhtml+xml"===st&&Xe===Ye&&(e='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+e+"</body></html>");const i=te?te.createHTML(e):e;if(Xe===Ye)try{t=(new U).parseFromString(i,st)}catch(e){}if(!t||!t.documentElement){t=ne.createDocument(Xe,"template",null);try{t.documentElement.innerHTML=Ze?se:i}catch(e){}}const r=t.body||t.documentElement;return e&&s&&r.insertBefore(n.createTextNode(s),r.childNodes[0]||null),Xe===Ye?oe.call(t,Oe?"html":"body")[0]:Oe?t.documentElement:r},bt=function(e){return ie.call(e.ownerDocument||e,e,E.SHOW_ELEMENT|E.SHOW_COMMENT|E.SHOW_TEXT|E.SHOW_PROCESSING_INSTRUCTION|E.SHOW_CDATA_SECTION,null)},yt=function(e){return e instanceof F&&("string"!=typeof e.nodeName||"string"!=typeof e.textContent||"function"!=typeof e.removeChild||!(e.attributes instanceof P)||"function"!=typeof e.removeAttribute||"function"!=typeof e.setAttribute||"string"!=typeof e.namespaceURI||"function"!=typeof e.insertBefore||"function"!=typeof e.hasChildNodes)},wt=function(e){return"function"==typeof S&&e instanceof S},St=function(e,t,n){ce[e]&&d(ce[e],(e=>{e.call(s,t,n,ot)}))},At=function(e){let t=null;if(St("beforeSanitizeElements",e,null),yt(e))return ft(e),!0;const n=rt(e.nodeName);if(St("uponSanitizeElement",e,{tagName:n,allowedTags:_e}),e.hasChildNodes()&&!wt(e.firstElementChild)&&y(/<[/\w]/g,e.innerHTML)&&y(/<[/\w]/g,e.textContent))return ft(e),!0;if(e.nodeType===J.progressingInstruction)return ft(e),!0;if(Te&&e.nodeType===J.comment&&y(/<[/\w]/g,e.data))return ft(e),!0;if(!_e[n]||Ae[n]){if(!Ae[n]&&Et(n)){if(Se.tagNameCheck instanceof RegExp&&y(Se.tagNameCheck,n))return!1;if(Se.tagNameCheck instanceof Function&&Se.tagNameCheck(n))return!1}if(Fe&&!qe[n]){const t=ee(e)||e.parentNode,s=Q(e)||e.childNodes;if(s&&t)for(let n=s.length-1;n>=0;--n){const i=G(s[n],!0);i.__removalCount=(e.__removalCount||0)+1,t.insertBefore(i,W(e))}}return ft(e),!0}return e instanceof A&&!pt(e)?(ft(e),!0):"noscript"!==n&&"noembed"!==n&&"noframes"!==n||!y(/<\/no(script|embed|frames)/i,e.innerHTML)?(je&&e.nodeType===J.text&&(t=e.textContent,d([le,de,ue],(e=>{t=f(t,e," ")})),e.textContent!==t&&(h(s.removed,{element:e.cloneNode()}),e.textContent=t)),St("afterSanitizeElements",e,null),!1):(ft(e),!0)},xt=function(e,t,s){if(ze&&("id"===t||"name"===t)&&(s in n||s in at))return!1;if($e&&!xe[t]&&y(he,t));else if(Ee&&y(me,t));else if(!ye[t]||xe[t]){if(!(Et(e)&&(Se.tagNameCheck instanceof RegExp&&y(Se.tagNameCheck,e)||Se.tagNameCheck instanceof Function&&Se.tagNameCheck(e))&&(Se.attributeNameCheck instanceof RegExp&&y(Se.attributeNameCheck,t)||Se.attributeNameCheck instanceof Function&&Se.attributeNameCheck(t))||"is"===t&&Se.allowCustomizedBuiltInElements&&(Se.tagNameCheck instanceof RegExp&&y(Se.tagNameCheck,s)||Se.tagNameCheck instanceof Function&&Se.tagNameCheck(s))))return!1}else if(Ve[t]);else if(y(ve,f(s,pe,"")));else if("src"!==t&&"xlink:href"!==t&&"href"!==t||"script"===e||0!==v(s,"data:")||!Ge[e])if(Ce&&!y(ge,f(s,pe,"")));else if(s)return!1;return!0},Et=function(e){return"annotation-xml"!==e&&p(e,fe)},$t=function(e){St("beforeSanitizeAttributes",e,null);const{attributes:t}=e;if(!t)return;const n={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:ye};let i=t.length;for(;i--;){const r=t[i],{name:o,namespaceURI:a,value:c}=r,l=rt(o);let h="value"===o?c:_(c);if(n.attrName=l,n.attrValue=h,n.keepAttr=!0,n.forceKeepAttr=void 0,St("uponSanitizeAttribute",e,n),h=n.attrValue,n.forceKeepAttr)continue;if(vt(o,e),!n.keepAttr)continue;if(!ke&&y(/\/>/i,h)){vt(o,e);continue}if(Te&&y(/((--!?|])>)|<\/(style|title)/i,h)){vt(o,e);continue}je&&d([le,de,ue],(e=>{h=f(h,e," ")}));const m=rt(e.nodeName);if(xt(m,l,h)){if(!Le||"id"!==l&&"name"!==l||(vt(o,e),h=Pe+h),te&&"object"==typeof B&&"function"==typeof B.getAttributeType)if(a);else switch(B.getAttributeType(m,l)){case"TrustedHTML":h=te.createHTML(h);break;case"TrustedScriptURL":h=te.createScriptURL(h)}try{a?e.setAttributeNS(a,o,h):e.setAttribute(o,h),yt(e)?ft(e):u(s.removed)}catch(e){}}}St("afterSanitizeAttributes",e,null)},Ct=function e(t){let s=null;const n=bt(t);for(St("beforeSanitizeShadowDOM",t,null);s=n.nextNode();)St("uponSanitizeShadowNode",s,null),At(s)||(s.content instanceof c&&e(s.content),$t(s));St("afterSanitizeShadowDOM",t,null)};return s.sanitize=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=null,r=null,o=null,a=null;if(Ze=!e,Ze&&(e="\x3c!--\x3e"),"string"!=typeof e&&!wt(e)){if("function"!=typeof e.toString)throw w("toString is not a function");if("string"!=typeof(e=e.toString()))throw w("dirty is not a string, aborting")}if(!s.isSupported)return e;if(Ne||lt(t),s.removed=[],"string"==typeof e&&(Ue=!1),Ue){if(e.nodeName){const t=rt(e.nodeName);if(!_e[t]||Ae[t])throw w("root node is forbidden and cannot be sanitized in-place")}}else if(e instanceof S)n=_t("\x3c!----\x3e"),r=n.ownerDocument.importNode(e,!0),r.nodeType===J.element&&"BODY"===r.nodeName||"HTML"===r.nodeName?n=r:n.appendChild(r);else{if(!Me&&!je&&!Oe&&-1===e.indexOf("<"))return te&&De?te.createHTML(e):e;if(n=_t(e),!n)return Me?null:De?se:""}n&&Ie&&ft(n.firstChild);const l=bt(Ue?e:n);for(;o=l.nextNode();)At(o)||(o.content instanceof c&&Ct(o.content),$t(o));if(Ue)return e;if(Me){if(Re)for(a=re.call(n.ownerDocument);n.firstChild;)a.appendChild(n.firstChild);else a=n;return(ye.shadowroot||ye.shadowrootmode)&&(a=ae.call(i,a,!0)),a}let u=Oe?n.outerHTML:n.innerHTML;return Oe&&_e["!doctype"]&&n.ownerDocument&&n.ownerDocument.doctype&&n.ownerDocument.doctype.name&&y(V,n.ownerDocument.doctype.name)&&(u="<!DOCTYPE "+n.ownerDocument.doctype.name+">\n"+u),je&&d([le,de,ue],(e=>{u=f(u,e," ")})),te&&De?te.createHTML(u):u},s.setConfig=function(){lt(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),Ne=!0},s.clearConfig=function(){ot=null,Ne=!1},s.isValidAttribute=function(e,t,s){ot||lt({});const n=rt(e),i=rt(t);return xt(n,i,s)},s.addHook=function(e,t){"function"==typeof t&&(ce[e]=ce[e]||[],h(ce[e],t))},s.removeHook=function(e){if(ce[e])return u(ce[e])},s.removeHooks=function(e){ce[e]&&(ce[e]=[])},s.removeAllHooks=function(){ce={}},s}return Z()}()},5838:(e,t)=>{var s,n;n=function(e){"use strict";e=e||{};var t,s,n,i,r,o,a,c,l,d,u,h,m,g,p={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontStyle:"bold",type:"circle",position:"down",animation:"slide",elementId:!1,element:null,dataUrl:!1,win:window};(h={}).ff="undefined"!=typeof InstallTrigger,h.chrome=!!window.chrome,h.opera=!!window.opera||navigator.userAgent.indexOf("Opera")>=0,h.ie=!1,h.safari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,h.supported=h.chrome||h.ff||h.opera;var f=[];u=function(){},c=!1;var v={ready:function(){c=!0,v.reset(),u()},reset:function(){c&&(f=[],l=!1,d=!1,o.clearRect(0,0,i,n),o.drawImage(a,0,0,i,n),y.setIcon(r),window.clearTimeout(m),window.clearTimeout(void 0))},start:function(){if(c&&!d&&f.length>0){d=!0;var e=function(){["type","animation","bgColor","textColor","fontFamily","fontStyle"].forEach((function(e){e in f[0].options&&(t[e]=f[0].options[e])})),A.run(f[0].options,(function(){l=f[0],d=!1,f.length>0&&(f.shift(),v.start())}),!1)};l?A.run(l.options,(function(){e()}),!0):e()}}},_={},b=function(e){return e.n="number"==typeof e.n?Math.abs(0|e.n):e.n,e.x=i*e.x,e.y=n*e.y,e.w=i*e.w,e.h=n*e.h,e.len=(""+e.n).length,e};_.circle=function(e){var s=!1;2===(e=b(e)).len?(e.x=e.x-.4*e.w,e.w=1.4*e.w,s=!0):e.len>=3&&(e.x=e.x-.65*e.w,e.w=1.65*e.w,s=!0),o.clearRect(0,0,i,n),o.drawImage(a,0,0,i,n),o.beginPath(),o.font=t.fontStyle+" "+Math.floor(e.h*(e.n>99?.85:1))+"px "+t.fontFamily,o.textAlign="center",s?(o.moveTo(e.x+e.w/2,e.y),o.lineTo(e.x+e.w-e.h/2,e.y),o.quadraticCurveTo(e.x+e.w,e.y,e.x+e.w,e.y+e.h/2),o.lineTo(e.x+e.w,e.y+e.h-e.h/2),o.quadraticCurveTo(e.x+e.w,e.y+e.h,e.x+e.w-e.h/2,e.y+e.h),o.lineTo(e.x+e.h/2,e.y+e.h),o.quadraticCurveTo(e.x,e.y+e.h,e.x,e.y+e.h-e.h/2),o.lineTo(e.x,e.y+e.h/2),o.quadraticCurveTo(e.x,e.y,e.x+e.h/2,e.y)):o.arc(e.x+e.w/2,e.y+e.h/2,e.h/2,0,2*Math.PI),o.fillStyle="rgba("+t.bgColor.r+","+t.bgColor.g+","+t.bgColor.b+","+e.o+")",o.fill(),o.closePath(),o.beginPath(),o.stroke(),o.fillStyle="rgba("+t.textColor.r+","+t.textColor.g+","+t.textColor.b+","+e.o+")","number"==typeof e.n&&e.n>999?o.fillText((e.n>9999?9:Math.floor(e.n/1e3))+"k+",Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.2*e.h)):o.fillText(e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),o.closePath()},_.rectangle=function(e){2===(e=b(e)).len?(e.x=e.x-.4*e.w,e.w=1.4*e.w):e.len>=3&&(e.x=e.x-.65*e.w,e.w=1.65*e.w),o.clearRect(0,0,i,n),o.drawImage(a,0,0,i,n),o.beginPath(),o.font=t.fontStyle+" "+Math.floor(e.h*(e.n>99?.9:1))+"px "+t.fontFamily,o.textAlign="center",o.fillStyle="rgba("+t.bgColor.r+","+t.bgColor.g+","+t.bgColor.b+","+e.o+")",o.fillRect(e.x,e.y,e.w,e.h),o.fillStyle="rgba("+t.textColor.r+","+t.textColor.g+","+t.textColor.b+","+e.o+")","number"==typeof e.n&&e.n>999?o.fillText((e.n>9999?9:Math.floor(e.n/1e3))+"k+",Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.2*e.h)):o.fillText(e.n,Math.floor(e.x+e.w/2),Math.floor(e.y+e.h-.15*e.h)),o.closePath()};var y={};function w(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,s,n){return t+t+s+s+n+n}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return!!t&&{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}}function S(e,t){var s,n={};for(s in e)n[s]=e[s];for(s in t)n[s]=t[s];return n}y.getIcons=function(){var e=[];return t.element?e=[t.element]:t.elementId?(e=[g.getElementById(t.elementId)])[0].setAttribute("href",e[0].getAttribute("src")):0===(e=function(){for(var e=[],t=g.getElementsByTagName("head")[0].getElementsByTagName("link"),s=0;s<t.length;s++)/(^|\s)icon(\s|$)/i.test(t[s].getAttribute("rel"))&&e.push(t[s]);return e}()).length&&((e=[g.createElement("link")])[0].setAttribute("rel","icon"),g.getElementsByTagName("head")[0].appendChild(e[0])),e.forEach((function(e){e.setAttribute("type","image/png")})),e},y.setIcon=function(e){var t=e.toDataURL("image/png");y.setIconSrc(t)},y.setIconSrc=function(e){if(t.dataUrl&&t.dataUrl(e),t.element)t.element.setAttribute("href",e),t.element.setAttribute("src",e);else if(t.elementId){var n=g.getElementById(t.elementId);n.setAttribute("href",e),n.setAttribute("src",e)}else if(h.ff||h.opera){var i=s[s.length-1],r=g.createElement("link");s=[r],h.opera&&r.setAttribute("rel","icon"),r.setAttribute("rel","icon"),r.setAttribute("type","image/png"),g.getElementsByTagName("head")[0].appendChild(r),r.setAttribute("href",e),i.parentNode&&i.parentNode.removeChild(i)}else s.forEach((function(t){t.setAttribute("href",e)}))};var A={duration:40,types:{}};return A.types.fade=[{x:.4,y:.4,w:.6,h:.6,o:0},{x:.4,y:.4,w:.6,h:.6,o:.1},{x:.4,y:.4,w:.6,h:.6,o:.2},{x:.4,y:.4,w:.6,h:.6,o:.3},{x:.4,y:.4,w:.6,h:.6,o:.4},{x:.4,y:.4,w:.6,h:.6,o:.5},{x:.4,y:.4,w:.6,h:.6,o:.6},{x:.4,y:.4,w:.6,h:.6,o:.7},{x:.4,y:.4,w:.6,h:.6,o:.8},{x:.4,y:.4,w:.6,h:.6,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],A.types.none=[{x:.4,y:.4,w:.6,h:.6,o:1}],A.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:.9,y:.9,w:.1,h:.1,o:1},{x:.8,y:.8,w:.2,h:.2,o:1},{x:.7,y:.7,w:.3,h:.3,o:1},{x:.6,y:.6,w:.4,h:.4,o:1},{x:.5,y:.5,w:.5,h:.5,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],A.types.popFade=[{x:.75,y:.75,w:0,h:0,o:0},{x:.65,y:.65,w:.1,h:.1,o:.2},{x:.6,y:.6,w:.2,h:.2,o:.4},{x:.55,y:.55,w:.3,h:.3,o:.6},{x:.5,y:.5,w:.4,h:.4,o:.8},{x:.45,y:.45,w:.5,h:.5,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],A.types.slide=[{x:.4,y:1,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.8,w:.6,h:.6,o:1},{x:.4,y:.7,w:.6,h:.6,o:1},{x:.4,y:.6,w:.6,h:.6,o:1},{x:.4,y:.5,w:.6,h:.6,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],A.run=function(e,s,n,i){var o=A.types[g.hidden||g.msHidden||g.webkitHidden||g.mozHidden?"none":t.animation];i=!0===n?void 0!==i?i:o.length-1:void 0!==i?i:0,s=s||function(){},i<o.length&&i>=0?(_[t.type](S(e,o[i])),m=setTimeout((function(){n?i-=1:i+=1,A.run(e,s,n,i)}),A.duration),y.setIcon(r)):s()},function(){(t=S(p,e)).bgColor=w(t.bgColor),t.textColor=w(t.textColor),t.position=t.position.toLowerCase(),t.animation=A.types[""+t.animation]?t.animation:p.animation,g=t.win.document;var c=t.position.indexOf("up")>-1,l=t.position.indexOf("left")>-1;if(c||l)for(var d in A.types)for(var u=0;u<A.types[d].length;u++){var h=A.types[d][u];c&&(h.y<.6?h.y=h.y-.4:h.y=h.y-2*h.y+(1-h.w)),l&&(h.x<.6?h.x=h.x-.4:h.x=h.x-2*h.x+(1-h.h)),A.types[d][u]=h}t.type=_[""+t.type]?t.type:p.type,s=y.getIcons(),r=document.createElement("canvas"),a=document.createElement("img");var m=s[s.length-1];m.hasAttribute("href")?(a.setAttribute("crossOrigin","anonymous"),a.onload=function(){n=a.height>0?a.height:32,i=a.width>0?a.width:32,r.height=n,r.width=i,o=r.getContext("2d"),v.ready()},a.setAttribute("src",m.getAttribute("href"))):(n=32,i=32,a.height=n,a.width=i,r.height=n,r.width=i,o=r.getContext("2d"),v.ready())}(),{badge:function(e,t){t=("string"==typeof t?{animation:t}:t)||{},u=function(){try{if("number"==typeof e?e>0:""!==e){var s={type:"badge",options:{n:e}};if("animation"in t&&A.types[""+t.animation]&&(s.options.animation=""+t.animation),"type"in t&&_[""+t.type]&&(s.options.type=""+t.type),["bgColor","textColor"].forEach((function(e){e in t&&(s.options[e]=w(t[e]))})),["fontStyle","fontFamily"].forEach((function(e){e in t&&(s.options[e]=t[e])})),f.push(s),f.length>100)throw new Error("Too many badges requests in queue.");v.start()}else v.reset()}catch(e){throw new Error("Error setting badge. Message: "+e.message)}},c&&u()},setOpt:function(e,s){var n=e;null==s&&"[object Object]"==Object.prototype.toString.call(e)||((n={})[e]=s);for(var i=Object.keys(n),r=0;r<i.length;r++)"bgColor"==i[r]||"textColor"==i[r]?t[i[r]]=w(n[i[r]]):t[i[r]]=n[i[r]];f.push(l),v.start()},reset:v.reset,browser:{supported:h.supported}}},void 0===(s=function(){return n}.apply(t,[]))||(e.exports=s)},3077:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deinterlace=void 0;t.deinterlace=function(e,t){for(var s=new Array(e.length),n=e.length/t,i=function(n,i){var r=e.slice(i*t,(i+1)*t);s.splice.apply(s,[n*t,t].concat(r))},r=[0,4,2,1],o=[8,8,4,2],a=0,c=0;c<4;c++)for(var l=r[c];l<n;l+=o[c])i(l,a),a++;return s}},9641:(e,t,s)=>{"use strict";t.Ud=t.O5=void 0;var n,i=(n=s(4857))&&n.__esModule?n:{default:n},r=s(4088),o=s(3715),a=s(3077),c=s(7158);t.O5=function(e){var t=new Uint8Array(e);return(0,r.parse)((0,o.buildStream)(t),i.default)};var l=function(e,t,s){if(e.image){var n=e.image,i=n.descriptor.width*n.descriptor.height,r=(0,c.lzw)(n.data.minCodeSize,n.data.blocks,i);n.descriptor.lct.interlaced&&(r=(0,a.deinterlace)(r,n.descriptor.width));var o={pixels:r,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return n.descriptor.lct&&n.descriptor.lct.exists?o.colorTable=n.lct:o.colorTable=t,e.gce&&(o.delay=10*(e.gce.delay||10),o.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(o.transparentIndex=e.gce.transparentColorIndex)),s&&(o.patch=function(e){for(var t=e.pixels.length,s=new Uint8ClampedArray(4*t),n=0;n<t;n++){var i=4*n,r=e.pixels[n],o=e.colorTable[r]||[0,0,0];s[i]=o[0],s[i+1]=o[1],s[i+2]=o[2],s[i+3]=r!==e.transparentIndex?255:0}return s}(o)),o}console.warn("gif frame does not have associated image.")};t.Ud=function(e,t){return e.frames.filter((function(e){return e.image})).map((function(s){return l(s,e.gct,t)}))}},7158:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lzw=void 0;t.lzw=function(e,t,s){var n,i,r,o,a,c,l,d,u,h,m,g,p,f,v,_,b=4096,y=s,w=new Array(s),S=new Array(b),A=new Array(b),x=new Array(4097);for(a=(i=1<<(h=e))+1,n=i+2,l=-1,r=(1<<(o=h+1))-1,d=0;d<i;d++)S[d]=0,A[d]=d;for(m=g=p=f=v=_=0,u=0;u<y;){if(0===f){if(g<o){m+=t[_]<<g,g+=8,_++;continue}if(d=m&r,m>>=o,g-=o,d>n||d==a)break;if(d==i){r=(1<<(o=h+1))-1,n=i+2,l=-1;continue}if(-1==l){x[f++]=A[d],l=d,p=d;continue}for(c=d,d==n&&(x[f++]=p,d=l);d>i;)x[f++]=A[d],d=S[d];p=255&A[d],x[f++]=p,n<b&&(S[n]=l,A[n]=p,!(++n&r)&&n<b&&(o++,r+=n)),l=c}f--,w[v++]=x[f],u++}for(u=v;u<y;u++)w[u]=0;return w}},1066:(e,t,s)=>{"use strict";var n,i,r=s.g.MutationObserver||s.g.WebKitMutationObserver;if(r){var o=0,a=new r(u),c=s.g.document.createTextNode("");a.observe(c,{characterData:!0}),n=function(){c.data=o=++o%2}}else if(s.g.setImmediate||void 0===s.g.MessageChannel)n="document"in s.g&&"onreadystatechange"in s.g.document.createElement("script")?function(){var e=s.g.document.createElement("script");e.onreadystatechange=function(){u(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},s.g.document.documentElement.appendChild(e)}:function(){setTimeout(u,0)};else{var l=new s.g.MessageChannel;l.port1.onmessage=u,n=function(){l.port2.postMessage(0)}}var d=[];function u(){var e,t;i=!0;for(var s=d.length;s;){for(t=d,d=[],e=-1;++e<s;)t[e]();s=d.length}i=!1}e.exports=function(e){1!==d.push(e)||i||n()}},1615:function(e,t){!function(s,n){var i=Array.prototype,r=Object.prototype,o=i.slice,a=r.hasOwnProperty,c=i.forEach,l={},d={forEach:function(e,t,s){var n,i,r;if(null!==e)if(c&&e.forEach===c)e.forEach(t,s);else if(e.length===+e.length){for(n=0,i=e.length;n<i;n++)if(n in e&&t.call(s,e[n],n,e)===l)return}else for(r in e)if(a.call(e,r)&&t.call(s,e[r],r,e)===l)return},extend:function(e){return this.forEach(o.call(arguments,1),(function(t){for(var s in t)e[s]=t[s]})),e}},u=function(e){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages",debug:!1},this.options=d.extend({},this.defaults,e),this.textdomain(this.options.domain),e.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+e.domain+"`")};function h(e){return u.PF.compile(e||"nplurals=2; plural=(n != 1);")}function m(e,t){this._key=e,this._i18n=t}u.context_delimiter=String.fromCharCode(4),d.extend(m.prototype,{onDomain:function(e){return this._domain=e,this},withContext:function(e){return this._context=e,this},ifPlural:function(e,t){return this._val=e,this._pkey=t,this},fetch:function(e){return"[object Array]"!={}.toString.call(e)&&(e=[].slice.call(arguments,0)),(e&&e.length?u.sprintf:function(e){return e})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),e)}}),d.extend(u.prototype,{translate:function(e){return new m(e,this)},textdomain:function(e){if(!e)return this._textdomain;this._textdomain=e},gettext:function(e){return this.dcnpgettext.call(this,n,n,e)},dgettext:function(e,t){return this.dcnpgettext.call(this,e,n,t)},dcgettext:function(e,t){return this.dcnpgettext.call(this,e,n,t)},ngettext:function(e,t,s){return this.dcnpgettext.call(this,n,n,e,t,s)},dngettext:function(e,t,s,i){return this.dcnpgettext.call(this,e,n,t,s,i)},dcngettext:function(e,t,s,i){return this.dcnpgettext.call(this,e,n,t,s,i)},pgettext:function(e,t){return this.dcnpgettext.call(this,n,e,t)},dpgettext:function(e,t,s){return this.dcnpgettext.call(this,e,t,s)},dcpgettext:function(e,t,s){return this.dcnpgettext.call(this,e,t,s)},npgettext:function(e,t,s,i){return this.dcnpgettext.call(this,n,e,t,s,i)},dnpgettext:function(e,t,s,n,i){return this.dcnpgettext.call(this,e,t,s,n,i)},dcnpgettext:function(e,t,s,n,i){var r;if(n=n||s,e=e||this._textdomain,!this.options)return(r=new u).dcnpgettext.call(r,void 0,void 0,s,n,i);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[e])throw new Error("Domain `"+e+"` was not found.");if(!this.options.locale_data[e][""])throw new Error("No locale meta information provided.");if(!s)throw new Error("No translation key found.");var o,a,c,l=t?t+u.context_delimiter+s:s,d=this.options.locale_data,m=d[e],g=(d.messages||this.defaults.locale_data.messages)[""],p=m[""].plural_forms||m[""]["Plural-Forms"]||m[""]["plural-forms"]||g.plural_forms||g["Plural-Forms"]||g["plural-forms"];if(void 0===i)c=0;else{if("number"!=typeof i&&(i=parseInt(i,10),isNaN(i)))throw new Error("The number that was passed in is not a number.");c=h(p)(i)}if(!m)throw new Error("No domain named `"+e+"` could be found.");return!(o=m[l])||c>o.length?(this.options.missing_key_callback&&this.options.missing_key_callback(l,e),a=[s,n],!0===this.options.debug&&console.log(a[h(p)(i)]),a[h()(i)]):(a=o[c])||(a=[s,n])[h()(i)]}});var g,p,f=function(){function e(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function t(e,t){for(var s=[];t>0;s[--t]=e);return s.join("")}var s=function(){return s.cache.hasOwnProperty(arguments[0])||(s.cache[arguments[0]]=s.parse(arguments[0])),s.format.call(null,s.cache[arguments[0]],arguments)};return s.format=function(s,n){var i,r,o,a,c,l,d,u=1,h=s.length,m="",g=[];for(r=0;r<h;r++)if("string"===(m=e(s[r])))g.push(s[r]);else if("array"===m){if((a=s[r])[2])for(i=n[u],o=0;o<a[2].length;o++){if(!i.hasOwnProperty(a[2][o]))throw f('[sprintf] property "%s" does not exist',a[2][o]);i=i[a[2][o]]}else i=a[1]?n[a[1]]:n[u++];if(/[^s]/.test(a[8])&&"number"!=e(i))throw f("[sprintf] expecting number but found %s",e(i));switch(null==i&&(i=""),a[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=a[7]?i.toExponential(a[7]):i.toExponential();break;case"f":i=a[7]?parseFloat(i).toFixed(a[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&a[7]?i.substring(0,a[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase()}i=/[def]/.test(a[8])&&a[3]&&i>=0?"+"+i:i,l=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",d=a[6]-String(i).length,c=a[6]?t(l,d):"",g.push(a[5]?i+c:c+i)}return g.join("")},s.cache={},s.parse=function(e){for(var t=e,s=[],n=[],i=0;t;){if(null!==(s=/^[^\x25]+/.exec(t)))n.push(s[0]);else if(null!==(s=/^\x25{2}/.exec(t)))n.push("%");else{if(null===(s=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(t)))throw"[sprintf] huh?";if(s[2]){i|=1;var r=[],o=s[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(o)))throw"[sprintf] huh?";for(r.push(a[1]);""!==(o=o.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(o)))r.push(a[1]);else{if(null===(a=/^\[(\d+)\]/.exec(o)))throw"[sprintf] huh?";r.push(a[1])}s[2]=r}else i|=2;if(3===i)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";n.push(s)}t=t.substring(s[0].length)}return n},s}();u.parse_plural=function(e,t){return e=e.replace(/n/g,t),u.parse_expression(e)},u.sprintf=function(e,t){return"[object Array]"=={}.toString.call(t)?function(e,t){return t.unshift(e),f.apply(null,t)}(e,[].slice.call(t)):f.apply(this,[].slice.call(arguments))},u.prototype.sprintf=function(){return u.sprintf.apply(this,arguments)},(u.PF={}).parse=function(e){var t=u.PF.extractPluralExpr(e);return u.PF.parser.parse.call(u.PF.parser,t)},u.PF.compile=function(e){var t=u.PF.parse(e);return function(e){return!0===(s=u.PF.interpreter(t)(e))?1:s||0;var s}},u.PF.interpreter=function(e){return function(t){switch(e.type){case"GROUP":return u.PF.interpreter(e.expr)(t);case"TERNARY":return u.PF.interpreter(e.expr)(t)?u.PF.interpreter(e.truthy)(t):u.PF.interpreter(e.falsey)(t);case"OR":return u.PF.interpreter(e.left)(t)||u.PF.interpreter(e.right)(t);case"AND":return u.PF.interpreter(e.left)(t)&&u.PF.interpreter(e.right)(t);case"LT":return u.PF.interpreter(e.left)(t)<u.PF.interpreter(e.right)(t);case"GT":return u.PF.interpreter(e.left)(t)>u.PF.interpreter(e.right)(t);case"LTE":return u.PF.interpreter(e.left)(t)<=u.PF.interpreter(e.right)(t);case"GTE":return u.PF.interpreter(e.left)(t)>=u.PF.interpreter(e.right)(t);case"EQ":return u.PF.interpreter(e.left)(t)==u.PF.interpreter(e.right)(t);case"NEQ":return u.PF.interpreter(e.left)(t)!=u.PF.interpreter(e.right)(t);case"MOD":return u.PF.interpreter(e.left)(t)%u.PF.interpreter(e.right)(t);case"VAR":return t;case"NUM":return e.val;default:throw new Error("Invalid Token found.")}}},u.PF.extractPluralExpr=function(e){e=e.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(e)||(e=e.concat(";"));var t,s=/nplurals\=(\d+);/,n=e.match(s);if(!(n.length>1))throw new Error("nplurals not found in plural_forms string: "+e);if(n[1],!((t=(e=e.replace(s,"")).match(/plural\=(.*);/))&&t.length>1))throw new Error("`plural` expression not found: "+e);return t[1]},u.PF.parser=(g={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(e,t,s,n,i,r,o){var a=r.length-1;switch(i){case 1:return{type:"GROUP",expr:r[a-1]};case 2:this.$={type:"TERNARY",expr:r[a-4],truthy:r[a-2],falsey:r[a]};break;case 3:this.$={type:"OR",left:r[a-2],right:r[a]};break;case 4:this.$={type:"AND",left:r[a-2],right:r[a]};break;case 5:this.$={type:"LT",left:r[a-2],right:r[a]};break;case 6:this.$={type:"LTE",left:r[a-2],right:r[a]};break;case 7:this.$={type:"GT",left:r[a-2],right:r[a]};break;case 8:this.$={type:"GTE",left:r[a-2],right:r[a]};break;case 9:this.$={type:"NEQ",left:r[a-2],right:r[a]};break;case 10:this.$={type:"EQ",left:r[a-2],right:r[a]};break;case 11:this.$={type:"MOD",left:r[a-2],right:r[a]};break;case 12:this.$={type:"GROUP",expr:r[a-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(e)}}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,s=[0],n=[null],i=[],r=this.table,o="",a=0,c=0,l=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var d=this.lexer.yylloc;function u(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}i.push(d),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,m,g,p,f,v,_,b,y,w,S={};;){if(g=s[s.length-1],this.defaultActions[g]?p=this.defaultActions[g]:(null==h&&(h=u()),p=r[g]&&r[g][h]),void 0===p||!p.length||!p[0]){if(!l){for(v in y=[],r[g])this.terminals_[v]&&v>2&&y.push("'"+this.terminals_[v]+"'");var A="";A=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+y.join(", ")+", got '"+this.terminals_[h]+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(A,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:d,expected:y})}if(3==l){if(1==h)throw new Error(A||"Parsing halted.");c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,h=u()}for(;!(2..toString()in r[g]);){if(0==g)throw new Error(A||"Parsing halted.");w=1,s.length=s.length-2*w,n.length=n.length-w,i.length=i.length-w,g=s[s.length-1]}m=h,h=2,p=r[g=s[s.length-1]]&&r[g][2],l=3}if(p[0]instanceof Array&&p.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+h);switch(p[0]){case 1:s.push(h),n.push(this.lexer.yytext),i.push(this.lexer.yylloc),s.push(p[1]),h=null,m?(h=m,m=null):(c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,d=this.lexer.yylloc,l>0&&l--);break;case 2:if(_=this.productions_[p[1]][1],S.$=n[n.length-_],S._$={first_line:i[i.length-(_||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(_||1)].first_column,last_column:i[i.length-1].last_column},void 0!==(f=this.performAction.call(S,o,c,a,this.yy,p[1],n,i)))return f;_&&(s=s.slice(0,-1*_*2),n=n.slice(0,-1*_),i=i.slice(0,-1*_)),s.push(this.productions_[p[1]][0]),n.push(S.$),i.push(S._$),b=r[s[s.length-2]][s[s.length-1]],s.push(b);break;case 3:return!0}}return!0}},p=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parseError)throw new Error(e);this.yy.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.match+=e,this.matched+=e,e.match(/\n/)&&this.yylineno++,this._input=this._input.slice(1),e},unput:function(e){return this._input=e+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var s=this._currentRules(),n=0;n<s.length;n++)if(e=this._input.match(this.rules[s[n]]))return(t=e[0].match(/\n.*/g))&&(this.yylineno+=t.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:t?t[t.length-1].length-1:this.yylloc.last_column+e[0].length},this.yytext+=e[0],this.match+=e[0],this.matches=e,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(e[0].length),this.matched+=e[0],this.performAction.call(this,this.yy,this,s[n],this.conditionStack[this.conditionStack.length-1])||void 0;if(""===this._input)return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},performAction:function(e,t,s,n){switch(s){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return"INVALID"}},rules:[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}}};return e}(),g.lexer=p,g),e.exports&&(t=e.exports=u),t.Jed=u}()},4088:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loop=t.conditional=t.parse=void 0;t.parse=function e(t,s){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;if(Array.isArray(s))s.forEach((function(s){return e(t,s,n,i)}));else if("function"==typeof s)s(t,n,i,e);else{var r=Object.keys(s)[0];Array.isArray(s[r])?(i[r]={},e(t,s[r],n,i[r])):i[r]=s[r](t,n,i,e)}return n};t.conditional=function(e,t){return function(s,n,i,r){t(s,n,i)&&r(s,e,n,i)}};t.loop=function(e,t){return function(s,n,i,r){for(var o=[],a=s.pos;t(s,n,i);){var c={};if(r(s,e,n,c),s.pos===a)break;a=s.pos,o.push(c)}return o}}},3715:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readBits=t.readArray=t.readUnsigned=t.readString=t.peekBytes=t.readBytes=t.peekByte=t.readByte=t.buildStream=void 0;t.buildStream=function(e){return{data:e,pos:0}};var s=function(){return function(e){return e.data[e.pos++]}};t.readByte=s;t.peekByte=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return function(t){return t.data[t.pos+e]}};var n=function(e){return function(t){return t.data.subarray(t.pos,t.pos+=e)}};t.readBytes=n;t.peekBytes=function(e){return function(t){return t.data.subarray(t.pos,t.pos+e)}};t.readString=function(e){return function(t){return Array.from(n(e)(t)).map((function(e){return String.fromCharCode(e)})).join("")}};t.readUnsigned=function(e){return function(t){var s=n(2)(t);return e?(s[1]<<8)+s[0]:(s[0]<<8)+s[1]}};t.readArray=function(e,t){return function(s,i,r){for(var o="function"==typeof t?t(s,i,r):t,a=n(e),c=new Array(o),l=0;l<o;l++)c[l]=a(s);return c}};t.readBits=function(e){return function(t){for(var s=function(e){return e.data[e.pos++]}(t),n=new Array(8),i=0;i<8;i++)n[7-i]=!!(s&1<<i);return Object.keys(e).reduce((function(t,s){var i=e[s];return i.length?t[s]=function(e,t,s){for(var n=0,i=0;i<s;i++)n+=e[t+i]&&Math.pow(2,s-i-1);return n}(n,i.index,i.length):t[s]=n[i.index],t}),{})}}},4857:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=s(4088),i=s(3715),r={blocks:function(e){for(var t=[],s=e.data.length,n=0,r=(0,i.readByte)()(e);0!==r&&r;r=(0,i.readByte)()(e)){if(e.pos+r>=s){var o=s-e.pos;t.push((0,i.readBytes)(o)(e)),n+=o;break}t.push((0,i.readBytes)(r)(e)),n+=r}for(var a=new Uint8Array(n),c=0,l=0;l<t.length;l++)a.set(t[l],c),c+=t[l].length;return a}},o=(0,n.conditional)({gce:[{codes:(0,i.readBytes)(2)},{byteSize:(0,i.readByte)()},{extras:(0,i.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,i.readUnsigned)(!0)},{transparentColorIndex:(0,i.readByte)()},{terminator:(0,i.readByte)()}]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&249===t[1]})),a=(0,n.conditional)({image:[{code:(0,i.readByte)()},{descriptor:[{left:(0,i.readUnsigned)(!0)},{top:(0,i.readUnsigned)(!0)},{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{lct:(0,i.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,n.conditional)({lct:(0,i.readArray)(3,(function(e,t,s){return Math.pow(2,s.descriptor.lct.size+1)}))},(function(e,t,s){return s.descriptor.lct.exists})),{data:[{minCodeSize:(0,i.readByte)()},r]}]},(function(e){return 44===(0,i.peekByte)()(e)})),c=(0,n.conditional)({text:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{preData:function(e,t,s){return(0,i.readBytes)(s.text.blockSize)(e)}},r]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&1===t[1]})),l=(0,n.conditional)({application:[{codes:(0,i.readBytes)(2)},{blockSize:(0,i.readByte)()},{id:function(e,t,s){return(0,i.readString)(s.blockSize)(e)}},r]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&255===t[1]})),d=(0,n.conditional)({comment:[{codes:(0,i.readBytes)(2)},r]},(function(e){var t=(0,i.peekBytes)(2)(e);return 33===t[0]&&254===t[1]})),u=[{header:[{signature:(0,i.readString)(3)},{version:(0,i.readString)(3)}]},{lsd:[{width:(0,i.readUnsigned)(!0)},{height:(0,i.readUnsigned)(!0)},{gct:(0,i.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,i.readByte)()},{pixelAspectRatio:(0,i.readByte)()}]},(0,n.conditional)({gct:(0,i.readArray)(3,(function(e,t){return Math.pow(2,t.lsd.gct.size+1)}))},(function(e,t){return t.lsd.gct.exists})),{frames:(0,n.loop)([o,l,d,a,c],(function(e){var t=(0,i.peekByte)()(e);return 33===t||44===t}))}];t.default=u},5641:(e,t,s)=>{"use strict";var n=s(1066);function i(){}var r={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&m(this,e)}function d(e,t,s){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof s&&(this.onRejected=s,this.callRejected=this.otherCallRejected)}function u(e,t,s){n((function(){var n;try{n=t(s)}catch(t){return r.reject(e,t)}n===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,n)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function m(e,t){var s=!1;function n(t){s||(s=!0,r.reject(e,t))}function i(t){s||(s=!0,r.resolve(e,t))}var o=g((function(){t(i,n)}));"error"===o.status&&n(o.value)}function g(e,t){var s={};try{s.value=e(t),s.status="success"}catch(e){s.status="error",s.value=e}return s}e.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var s=new this.constructor(i);this.state!==c?u(s,this.state===a?e:t,this.outcome):this.queue.push(new d(s,e,t));return s},d.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){r.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},r.resolve=function(e,t){var s=g(h,t);if("error"===s.status)return r.reject(e,s.value);var n=s.value;if(n)m(e,n);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},r.reject=function(e,t){e.state=o,e.outcome=t;for(var s=-1,n=e.queue.length;++s<n;)e.queue[s].callRejected(t);return e},l.resolve=function(e){if(e instanceof this)return e;return r.resolve(new this(i),e)},l.reject=function(e){var t=new this(i);return r.reject(t,e)},l.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,n=!1;if(!s)return this.resolve([]);var o=new Array(s),a=0,c=-1,l=new this(i);for(;++c<s;)d(e[c],c);return l;function d(e,i){t.resolve(e).then((function(e){o[i]=e,++a!==s||n||(n=!0,r.resolve(l,o))}),(function(e){n||(n=!0,r.reject(l,e))}))}},l.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,n=!1;if(!s)return this.resolve([]);var o=-1,a=new this(i);for(;++o<s;)c=e[o],t.resolve(c).then((function(e){n||(n=!0,r.resolve(a,e))}),(function(e){n||(n=!0,r.reject(a,e))}));var c;return a}},1078:(e,t,s)=>{"use strict";"function"!=typeof s.g.Promise&&(s.g.Promise=s(5641))},8781:function(e,t){"undefined"!=typeof self&&self,function(e){"use strict";var t="localforage-driver-memory";function s(e){var t="function"==typeof Symbol&&e[Symbol.iterator],s=0;return t?t.call(e):{next:function(){return e&&s>=e.length&&(e=void 0),{value:e&&e[s++],done:!e}}}}function n(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var s=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)s.append(e[n]);return s.getBlob(t.type)}}var i=/^~~local_forage_type~([^~]+)~/,r=9,o=r+4,a=Object.prototype.toString;function c(e){var t=.75*e.length,s=e.length;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);for(var n=new ArrayBuffer(t),i=new Uint8Array(n),r=0,o=0;r<s;r+=4){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r]),c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+1]),l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+2]),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e[r+3]);i[o++]=a<<2|c>>4,i[o++]=(15&c)<<4|l>>2,i[o++]=(3&l)<<6|63&d}return n}function l(e){for(var t=new Uint8Array(e),s="",n=0;n<t.length;n+=3)s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t[n]>>2],s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(3&t[n])<<4|t[n+1]>>4],s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(15&t[n+1])<<2|t[n+2]>>6],s+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t[n+2]];return t.length%3==2?s=s.substring(0,s.length-1)+"=":t.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}function d(e,t){var s="";if(e&&(s=a.call(e)),e&&("[object ArrayBuffer]"===s||e.buffer&&"[object ArrayBuffer]"===a.call(e.buffer))){var n=void 0,i="__lfsc__:";e instanceof ArrayBuffer?(n=e,i+="arbf"):(n=e.buffer,"[object Int8Array]"===s?i+="si08":"[object Uint8Array]"===s?i+="ui08":"[object Uint8ClampedArray]"===s?i+="uic8":"[object Int16Array]"===s?i+="si16":"[object Uint16Array]"===s?i+="ur16":"[object Int32Array]"===s?i+="si32":"[object Uint32Array]"===s?i+="ui32":"[object Float32Array]"===s?i+="fl32":"[object Float64Array]"===s?i+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(i+l(n))}else if("[object Blob]"===s){var r=new FileReader;r.onload=function(){var s="~~local_forage_type~"+e.type+"~"+l(this.result);t("__lfsc__:blob"+s)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(s){console.error("Couldn't convert value into a JSON string: ",e),t(null,s)}}function u(e){if("__lfsc__:"!==e.substring(0,r))return JSON.parse(e);var t,s=e.substring(o),a=e.substring(r,o);if("blob"===a&&i.test(s)){var l=s.match(i);t=l[1],s=s.substring(l[0].length)}var d=c(s);switch(a){case"arbf":return d;case"blob":return n([d],{type:t});case"si08":return new Int8Array(d);case"ui08":return new Uint8Array(d);case"uic8":return new Uint8ClampedArray(d);case"si16":return new Int16Array(d);case"ur16":return new Uint16Array(d);case"si32":return new Int32Array(d);case"ui32":return new Uint32Array(d);case"fl32":return new Float32Array(d);case"fl64":return new Float64Array(d);default:throw new Error("Unkown type: "+a)}}function h(e){var t,n;if(null===e||"object"!=typeof e||"isActiveClone"in e)return e;var i=e instanceof Date?new Date(e):e.constructor();try{for(var r=s(Object.keys(e)),o=r.next();!o.done;o=r.next()){var a=o.value;Object.prototype.hasOwnProperty.call(e,a)&&(e.isActiveClone=null,i[a]=h(e[a]),delete e.isActiveClone)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return i}function m(e,t){return(e.name||t.name)+"/"+(e.storeName||t.storeName)+"/"}function g(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function p(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function f(e,t){var s=this;if(t=p.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}return{promise:e.name?new Promise((function(t){e.storeName?t(m(e,s._defaultConfig)):t(e.name+"/")})):Promise.reject("Invalid arguments"),callback:t}}function v(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}var _={bufferToString:l,deserialize:u,serialize:d,stringToBuffer:c},b={},y=function(){function e(e){this.kp=e,this.data={}}return e.resolve=function(t){return b[t]||(b[t]=new e(t)),b[t]},e.prototype.clear=function(){this.data={}},e.prototype.drop=function(){this.clear(),delete b[this.kp]},e.prototype.get=function(e){return this.data[e]},e.prototype.key=function(e){return this.keys()[e]},e.prototype.keys=function(){return Object.keys(this.data)},e.prototype.rm=function(e){delete this.data[e]},e.prototype.set=function(e,t){this.data[e]=t},e}();function w(e){var t=e?h(e):{},s=m(t,this._defaultConfig),n=y.resolve(s);return this._dbInfo=t,this._dbInfo.serializer=_,this._dbInfo.keyPrefix=s,this._dbInfo.mStore=n,Promise.resolve()}function S(e){var t=this,s=this.ready().then((function(){t._dbInfo.mStore.clear()}));return g(s,e),s}function A(e,t){var s=f.apply(this,arguments),n=s.promise,i=s.callback;return g(n.then((function(e){y.resolve(e).drop()})),i),n}function x(e,t){var s=this;e=v(e);var n=this.ready().then((function(){var t=s._dbInfo.mStore.get(e);return null==t?null:s._dbInfo.serializer.deserialize(t)}));return g(n,t),n}function E(e,t){var s=this,n=this.ready().then((function(){for(var t=s._dbInfo.mStore,n=t.keys(),i=0;i<n.length;i++){var r=t.get(n[i]);if(r&&(r=s._dbInfo.serializer.deserialize(r)),void 0!==(r=e(r,n[i],i+1)))return r}}));return g(n,t),n}function $(e,t){var s=this,n=this.ready().then((function(){var t;try{void 0===(t=s._dbInfo.mStore.key(e))&&(t=null)}catch(e){t=null}return t}));return g(n,t),n}function C(e){var t=this,s=this.ready().then((function(){return t._dbInfo.mStore.keys()}));return g(s,e),s}function k(e){var t=this.keys().then((function(e){return e.length}));return g(t,e),t}function j(e,t){var s=this;e=v(e);var n=this.ready().then((function(){s._dbInfo.mStore.rm(e)}));return g(n,t),n}function T(e,t,s){var n=this;e=v(e);var i=this.ready().then((function(){void 0===t&&(t=null);var s=t;return new Promise((function(i,r){n._dbInfo.serializer.serialize(t,(function(t,o){if(o)r(o);else try{n._dbInfo.mStore.set(e,t),i(s)}catch(e){r(e)}}))}))}));return g(i,s),i}var O=!0;e._support=O,e._driver=t,e._initStorage=w,e.clear=S,e.dropInstance=A,e.getItem=x,e.iterate=E,e.key=$,e.keys=C,e.length=k,e.removeItem=j,e.setItem=T,Object.defineProperty(e,"__esModule",{value:!0})}(t)},9212:function(e,t,s){!function(e,t){"use strict";function s(e){return s.result?s.result:e&&"function"==typeof e.getSerializer?(s.result=e.getSerializer(),s.result):Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!"))}function n(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function i(e,t,s,n){function i(e,t){var s=e||t;return e&&"function"==typeof e||"string"!=typeof s||(e=function(e){return e[s]}),e}var r=[];if("[object Array]"===Object.prototype.toString.call(e)){t=i(t,"key"),s=i(s,"value");for(var o=0,a=e.length;o<a;o++){var c=e[o];r.push(n(t(c),s(c)))}}else for(var l in e)e.hasOwnProperty(l)&&r.push(n(l,e[l]));return r}function r(e,t,s,r){var o=this,a=o.ready().then((function(){return new Promise((function(n,r){var a,c=o._dbInfo,l=c.db.transaction(c.storeName,"readwrite"),d=l.objectStore(c.storeName);function u(e){var t=e.target||this;a=t.error||t.transaction.error,r(a)}l.oncomplete=function(){n(e)},l.onabort=l.onerror=function(e){r(a||e.target)},i(e,t,s,(function(e,t){null===t&&(t=void 0),d.put(t,e).onerror=u}))}))}));return n(a,r),a}function o(e,t,r,o){var a=this,c=new Promise((function(n,o){a.ready().then((function(){return s(a)})).then((function(s){var c=a._dbInfo;c.db.transaction((function(a){var l="INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",d=i(e,t,r,(function(e,t){return new Promise((function(n,i){s.serialize(t,(function(t,s){s?i(s):a.executeSql(l,[e,t],(function(){n()}),(function(e,t){i(t)}))}))}))}));Promise.all(d).then((function(){n(e)}),o)}),(function(e){o(e)}))})).catch(o)}));return n(c,o),c}function a(e,t,s,r){var o=this,a=i(e,t,s,(function(e,t){return o.setItem(e,t)})),c=Promise.all(a);return n(c,r),c}function c(e,t,s,n){var i=this,c=i.driver();return c===i.INDEXEDDB?r.call(i,e,t,s,n):c===i.WEBSQL?o.call(i,e,t,s,n):a.call(i,e,t,s,n)}function l(e){var t=Object.getPrototypeOf(e);t&&(t.setItems=c,t.setItems.indexedDB=function(){return r.apply(this,arguments)},t.setItems.websql=function(){return o.apply(this,arguments)},t.setItems.generic=function(){return a.apply(this,arguments)})}var d=l(t="default"in t?t.default:t);e.setItemsGeneric=a,e.localforageSetItems=c,e.extendPrototype=l,e.extendPrototypeResult=d,Object.defineProperty(e,"__esModule",{value:!0})}(t,s(9214))},8372:(e,t,s)=>{"use strict";var n=s(4602);Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var s=(0,a.getStorage)(),n=!(!s||!s[t]),c=n?s[t]:{clear:function(){},get:function(){},remove:function(){},set:function(){}},l=c.clear.bind(c),d=c.get.bind(c),u=c.remove.bind(c),h=c.set.bind(c);return{_driver:e,_support:n,_initStorage:function(){return Promise.resolve()},clear:function(e){return(0,o.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:l(),e&&e();case 2:case"end":return t.stop()}}),t)})))()},iterate:function(e,t){return(0,o.default)(i.default.mark((function s(){var n;return i.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,a.usePromise)(d,null);case 2:n=s.sent,Object.keys(n).forEach((function(t,s){return e(n[t],t,s)})),t&&t();case 6:case"end":return s.stop()}}),s)})))()},getItem:function(e,t){return(0,o.default)(i.default.mark((function s(){var n;return i.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,a.usePromise)(d,e);case 3:return n=s.sent,n=void 0===(n="string"==typeof e?n[e]:n)?null:n,t&&t(null,n),s.abrupt("return",n);case 10:throw s.prev=10,s.t0=s.catch(0),t&&t(s.t0),s.t0;case 14:case"end":return s.stop()}}),s,null,[[0,10]])})))()},key:function(e,t){return(0,o.default)(i.default.mark((function s(){var n,r;return i.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,a.usePromise)(d,null);case 2:return n=s.sent,r=Object.keys(n)[e],t&&t(r),s.abrupt("return",r);case 6:case"end":return s.stop()}}),s)})))()},keys:function(e){return(0,o.default)(i.default.mark((function t(){var s,n;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(d,null);case 2:return s=t.sent,n=Object.keys(s),e&&e(n),t.abrupt("return",n);case 6:case"end":return t.stop()}}),t)})))()},length:function(e){return(0,o.default)(i.default.mark((function t(){var s,n,r;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,a.usePromise)(d,null);case 2:return s=t.sent,n=Object.keys(s),r=n.length,e&&e(r),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t)})))()},removeItem:function(e,t){return(0,o.default)(i.default.mark((function s(){return i.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,(0,a.usePromise)(u,e);case 2:t&&t();case 3:case"end":return s.stop()}}),s)})))()},setItem:function(e,t,s){return(0,o.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,(0,a.usePromise)(h,(0,r.default)({},e,t));case 2:s&&s();case 3:case"end":return n.stop()}}),n)})))()}}};var i=n(s(460)),r=n(s(2485)),o=n(s(6597)),a=s(9513)},4103:(e,t,s)=>{"use strict";var n=s(4602);t.A=void 0;var i=(0,n(s(8372)).default)("webExtensionLocalStorage","local");t.A=i},6245:(e,t,s)=>{"use strict";var n=s(4602);t.A=void 0;var i=(0,n(s(8372)).default)("webExtensionSyncStorage","sync");t.A=i},9513:(e,t)=>{"use strict";function s(){return"undefined"!=typeof browser&&browser.storage||"undefined"!=typeof chrome&&chrome.storage}Object.defineProperty(t,"__esModule",{value:!0}),t.getStorage=s,t.usePromise=function(e,t){if(function(){var e=s();try{return e&&e.local.get&&e.local.get()&&"function"==typeof e.local.get().then}catch(e){return!1}}())return e(t);return new Promise((function(s){e(t,(function(){s.apply(void 0,arguments)}))}))}},9214:(e,t,s)=>{e.exports=function e(t,s,n){function i(o,a){if(!s[o]){if(!t[o]){if(r)return r(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var l=s[o]={exports:{}};t[o][0].call(l.exports,(function(e){var s=t[o][1][e];return i(s||e)}),l,l.exports,e,t,s,n)}return s[o].exports}for(var r=void 0,o=0;o<n.length;o++)i(n[o]);return i}({1:[function(e,t,n){(function(e){"use strict";var s,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var r=0,o=new i(d),a=e.document.createTextNode("");o.observe(a,{characterData:!0}),s=function(){a.data=r=++r%2}}else if(e.setImmediate||void 0===e.MessageChannel)s="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){d(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(d,0)};else{var c=new e.MessageChannel;c.port1.onmessage=d,s=function(){c.port2.postMessage(0)}}var l=[];function d(){var e,t;n=!0;for(var s=l.length;s;){for(t=l,l=[],e=-1;++e<s;)t[e]();s=l.length}n=!1}function u(e){1!==l.push(e)||n||s()}t.exports=u}).call(this,void 0!==s.g?s.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,s){"use strict";var n=e(1);function i(){}var r={},o=["REJECTED"],a=["FULFILLED"],c=["PENDING"];function l(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==i&&m(this,e)}function d(e,t,s){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof s&&(this.onRejected=s,this.callRejected=this.otherCallRejected)}function u(e,t,s){n((function(){var n;try{n=t(s)}catch(t){return r.reject(e,t)}n===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,n)}))}function h(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function m(e,t){var s=!1;function n(t){s||(s=!0,r.reject(e,t))}function i(t){s||(s=!0,r.resolve(e,t))}function o(){t(i,n)}var a=g(o);"error"===a.status&&n(a.value)}function g(e,t){var s={};try{s.value=e(t),s.status="success"}catch(e){s.status="error",s.value=e}return s}function p(e){return e instanceof this?e:r.resolve(new this(i),e)}function f(e){var t=new this(i);return r.reject(t,e)}function v(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,n=!1;if(!s)return this.resolve([]);for(var o=new Array(s),a=0,c=-1,l=new this(i);++c<s;)d(e[c],c);return l;function d(e,i){function c(e){o[i]=e,++a!==s||n||(n=!0,r.resolve(l,o))}t.resolve(e).then(c,(function(e){n||(n=!0,r.reject(l,e))}))}}function _(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var s=e.length,n=!1;if(!s)return this.resolve([]);for(var o=-1,a=new this(i);++o<s;)c(e[o]);return a;function c(e){t.resolve(e).then((function(e){n||(n=!0,r.resolve(a,e))}),(function(e){n||(n=!0,r.reject(a,e))}))}}t.exports=l,l.prototype.catch=function(e){return this.then(null,e)},l.prototype.then=function(e,t){if("function"!=typeof e&&this.state===a||"function"!=typeof t&&this.state===o)return this;var s=new this.constructor(i);return this.state!==c?u(s,this.state===a?e:t,this.outcome):this.queue.push(new d(s,e,t)),s},d.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){r.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},r.resolve=function(e,t){var s=g(h,t);if("error"===s.status)return r.reject(e,s.value);var n=s.value;if(n)m(e,n);else{e.state=a,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},r.reject=function(e,t){e.state=o,e.outcome=t;for(var s=-1,n=e.queue.length;++s<n;)e.queue[s].callRejected(t);return e},l.resolve=p,l.reject=f,l.all=v,l.race=_},{1:1}],3:[function(e,t,n){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==s.g?s.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,s){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var o=r();function a(){try{if(!o||!o.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(i){if("TypeError"!==i.name)throw i;for(var s=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),n=0;n<e.length;n+=1)s.append(e[n]);return s.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var l=Promise;function d(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function u(e,t,s){"function"==typeof t&&e.then(t),"function"==typeof s&&e.catch(s)}function h(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function m(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var g="local-forage-detect-blob-support",p=void 0,f={},v=Object.prototype.toString,_="readonly",b="readwrite";function y(e){for(var t=e.length,s=new ArrayBuffer(t),n=new Uint8Array(s),i=0;i<t;i++)n[i]=e.charCodeAt(i);return s}function w(e){return new l((function(t){var s=e.transaction(g,b),n=c([""]);s.objectStore(g).put(n,"key"),s.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},s.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),s=navigator.userAgent.match(/Edge\//);t(s||!e||parseInt(e[1],10)>=43)}})).catch((function(){return!1}))}function S(e){return"boolean"==typeof p?l.resolve(p):w(e).then((function(e){return p=e}))}function A(e){var t=f[e.name],s={};s.promise=new l((function(e,t){s.resolve=e,s.reject=t})),t.deferredOperations.push(s),t.dbReady?t.dbReady=t.dbReady.then((function(){return s.promise})):t.dbReady=s.promise}function x(e){var t=f[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function E(e,t){var s=f[e.name].deferredOperations.pop();if(s)return s.reject(t),s.promise}function $(e,t){return new l((function(s,n){if(f[e.name]=f[e.name]||D(),e.db){if(!t)return s(e.db);A(e),e.db.close()}var i=[e.name];t&&i.push(e.version);var r=o.open.apply(o,i);t&&(r.onupgradeneeded=function(t){var s=r.result;try{s.createObjectStore(e.storeName),t.oldVersion<=1&&s.createObjectStore(g)}catch(s){if("ConstraintError"!==s.name)throw s;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),r.onerror=function(e){e.preventDefault(),n(r.error)},r.onsuccess=function(){var t=r.result;t.onversionchange=function(e){e.target.close()},s(t),x(e)}}))}function C(e){return $(e,!1)}function k(e){return $(e,!0)}function j(e,t){if(!e.db)return!0;var s=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,i=e.version>e.db.version;if(n&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),i||s){if(s){var r=e.db.version+1;r>e.version&&(e.version=r)}return!0}return!1}function T(e){return new l((function(t,s){var n=new FileReader;n.onerror=s,n.onloadend=function(s){var n=btoa(s.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:e.type})},n.readAsBinaryString(e)}))}function O(e){return c([y(atob(e.data))],{type:e.type})}function N(e){return e&&e.__local_forage_encoded_blob}function I(e){var t=this,s=t._initReady().then((function(){var e=f[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return u(s,e,e),s}function M(e){A(e);for(var t=f[e.name],s=t.forages,n=0;n<s.length;n++){var i=s[n];i._dbInfo.db&&(i._dbInfo.db.close(),i._dbInfo.db=null)}return e.db=null,C(e).then((function(t){return e.db=t,j(e)?k(e):t})).then((function(n){e.db=t.db=n;for(var i=0;i<s.length;i++)s[i]._dbInfo.db=n})).catch((function(t){throw E(e,t),t}))}function R(e,t,s,n){void 0===n&&(n=1);try{var i=e.db.transaction(e.storeName,t);s(null,i)}catch(i){if(n>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return l.resolve().then((function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),k(e)})).then((function(){return M(e).then((function(){R(e,t,s,n-1)}))})).catch(s);s(i)}}function D(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function z(e){var t=this,s={db:null};if(e)for(var n in e)s[n]=e[n];var i=f[s.name];i||(i=D(),f[s.name]=i),i.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=I);var r=[];function o(){return l.resolve()}for(var a=0;a<i.forages.length;a++){var c=i.forages[a];c!==t&&r.push(c._initReady().catch(o))}var d=i.forages.slice(0);return l.all(r).then((function(){return s.db=i.db,C(s)})).then((function(e){return s.db=e,j(s,t._defaultConfig.version)?k(s):e})).then((function(e){s.db=i.db=e,t._dbInfo=s;for(var n=0;n<d.length;n++){var r=d[n];r!==t&&(r._dbInfo.db=s.db,r._dbInfo.version=s.version)}}))}function L(e,t){var s=this;e=h(e);var n=new l((function(t,n){s.ready().then((function(){R(s._dbInfo,_,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),N(e)&&(e=O(e)),t(e)},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,t),n}function P(e,t){var s=this,n=new l((function(t,n){s.ready().then((function(){R(s._dbInfo,_,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).openCursor(),a=1;o.onsuccess=function(){var s=o.result;if(s){var n=s.value;N(n)&&(n=O(n));var i=e(n,s.key,a++);void 0!==i?t(i):s.continue()}else t()},o.onerror=function(){n(o.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,t),n}function F(e,t,s){var n=this;e=h(e);var i=new l((function(s,i){var r;n.ready().then((function(){return r=n._dbInfo,"[object Blob]"===v.call(t)?S(r.db).then((function(e){return e?t:T(t)})):t})).then((function(t){R(n._dbInfo,b,(function(r,o){if(r)return i(r);try{var a=o.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var c=a.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),s(t)},o.onabort=o.onerror=function(){var e=c.error?c.error:c.transaction.error;i(e)}}catch(e){i(e)}}))})).catch(i)}));return d(i,s),i}function U(e,t){var s=this;e=h(e);var n=new l((function(t,n){s.ready().then((function(){R(s._dbInfo,b,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName).delete(e);r.oncomplete=function(){t()},r.onerror=function(){n(o.error)},r.onabort=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}}))})).catch(n)}));return d(n,t),n}function B(e){var t=this,s=new l((function(e,s){t.ready().then((function(){R(t._dbInfo,b,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=r.error?r.error:r.transaction.error;s(e)}}catch(e){s(e)}}))})).catch(s)}));return d(s,e),s}function q(e){var t=this,s=new l((function(e,s){t.ready().then((function(){R(t._dbInfo,_,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){s(r.error)}}catch(e){s(e)}}))})).catch(s)}));return d(s,e),s}function H(e,t){var s=this,n=new l((function(t,n){e<0?t(null):s.ready().then((function(){R(s._dbInfo,_,(function(i,r){if(i)return n(i);try{var o=r.objectStore(s._dbInfo.storeName),a=!1,c=o.openKeyCursor();c.onsuccess=function(){var s=c.result;s?0===e||a?t(s.key):(a=!0,s.advance(e)):t(null)},c.onerror=function(){n(c.error)}}catch(e){n(e)}}))})).catch(n)}));return d(n,t),n}function G(e){var t=this,s=new l((function(e,s){t.ready().then((function(){R(t._dbInfo,_,(function(n,i){if(n)return s(n);try{var r=i.objectStore(t._dbInfo.storeName).openKeyCursor(),o=[];r.onsuccess=function(){var t=r.result;t?(o.push(t.key),t.continue()):e(o)},r.onerror=function(){s(r.error)}}catch(e){s(e)}}))})).catch(s)}));return d(s,e),s}function W(e,t){t=m.apply(this,arguments);var s=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||s.name,e.storeName=e.storeName||s.storeName);var n,i=this;if(e.name){var r=e.name===s.name&&i._dbInfo.db?l.resolve(i._dbInfo.db):C(e).then((function(t){var s=f[e.name],n=s.forages;s.db=t;for(var i=0;i<n.length;i++)n[i]._dbInfo.db=t;return t}));n=e.storeName?r.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var s=t.version+1;A(e);var n=f[e.name],i=n.forages;t.close();for(var r=0;r<i.length;r++){var a=i[r];a._dbInfo.db=null,a._dbInfo.version=s}var c=new l((function(t,n){var i=o.open(e.name,s);i.onerror=function(e){i.result.close(),n(e)},i.onupgradeneeded=function(){i.result.deleteObjectStore(e.storeName)},i.onsuccess=function(){var e=i.result;e.close(),t(e)}}));return c.then((function(e){n.db=e;for(var t=0;t<i.length;t++){var s=i[t];s._dbInfo.db=e,x(s._dbInfo)}})).catch((function(t){throw(E(e,t)||l.resolve()).catch((function(){})),t}))}})):r.then((function(t){A(e);var s=f[e.name],n=s.forages;t.close();for(var i=0;i<n.length;i++)n[i]._dbInfo.db=null;var r=new l((function(t,s){var n=o.deleteDatabase(e.name);n.onerror=function(){var e=n.result;e&&e.close(),s(n.error)},n.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},n.onsuccess=function(){var e=n.result;e&&e.close(),t(e)}}));return r.then((function(e){s.db=e;for(var t=0;t<n.length;t++)x(n[t]._dbInfo)})).catch((function(t){throw(E(e,t)||l.resolve()).catch((function(){})),t}))}))}else n=l.reject("Invalid arguments");return d(n,t),n}var V={_driver:"asyncStorage",_initStorage:z,_support:a(),iterate:P,getItem:L,setItem:F,removeItem:U,clear:B,length:q,key:H,keys:G,dropInstance:W};function Q(){return"function"==typeof openDatabase}var K="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",J="~~local_forage_type~",Y=/^~~local_forage_type~([^~]+)~/,X="__lfsc__:",Z=X.length,ee="arbf",te="blob",se="si08",ne="ui08",ie="uic8",re="si16",oe="si32",ae="ur16",ce="ui32",le="fl32",de="fl64",ue=Z+ee.length,he=Object.prototype.toString;function me(e){var t,s,n,i,r,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var l=new ArrayBuffer(o),d=new Uint8Array(l);for(t=0;t<a;t+=4)s=K.indexOf(e[t]),n=K.indexOf(e[t+1]),i=K.indexOf(e[t+2]),r=K.indexOf(e[t+3]),d[c++]=s<<2|n>>4,d[c++]=(15&n)<<4|i>>2,d[c++]=(3&i)<<6|63&r;return l}function ge(e){var t,s=new Uint8Array(e),n="";for(t=0;t<s.length;t+=3)n+=K[s[t]>>2],n+=K[(3&s[t])<<4|s[t+1]>>4],n+=K[(15&s[t+1])<<2|s[t+2]>>6],n+=K[63&s[t+2]];return s.length%3==2?n=n.substring(0,n.length-1)+"=":s.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}function pe(e,t){var s="";if(e&&(s=he.call(e)),e&&("[object ArrayBuffer]"===s||e.buffer&&"[object ArrayBuffer]"===he.call(e.buffer))){var n,i=X;e instanceof ArrayBuffer?(n=e,i+=ee):(n=e.buffer,"[object Int8Array]"===s?i+=se:"[object Uint8Array]"===s?i+=ne:"[object Uint8ClampedArray]"===s?i+=ie:"[object Int16Array]"===s?i+=re:"[object Uint16Array]"===s?i+=ae:"[object Int32Array]"===s?i+=oe:"[object Uint32Array]"===s?i+=ce:"[object Float32Array]"===s?i+=le:"[object Float64Array]"===s?i+=de:t(new Error("Failed to get type for BinaryArray"))),t(i+ge(n))}else if("[object Blob]"===s){var r=new FileReader;r.onload=function(){var s=J+e.type+"~"+ge(this.result);t(X+te+s)},r.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(s){console.error("Couldn't convert value into a JSON string: ",e),t(null,s)}}function fe(e){if(e.substring(0,Z)!==X)return JSON.parse(e);var t,s=e.substring(ue),n=e.substring(Z,ue);if(n===te&&Y.test(s)){var i=s.match(Y);t=i[1],s=s.substring(i[0].length)}var r=me(s);switch(n){case ee:return r;case te:return c([r],{type:t});case se:return new Int8Array(r);case ne:return new Uint8Array(r);case ie:return new Uint8ClampedArray(r);case re:return new Int16Array(r);case ae:return new Uint16Array(r);case oe:return new Int32Array(r);case ce:return new Uint32Array(r);case le:return new Float32Array(r);case de:return new Float64Array(r);default:throw new Error("Unkown type: "+n)}}var ve={serialize:pe,deserialize:fe,stringToBuffer:me,bufferToString:ge};function _e(e,t,s,n){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],s,n)}function be(e){var t=this,s={db:null};if(e)for(var n in e)s[n]="string"!=typeof e[n]?e[n].toString():e[n];var i=new l((function(e,n){try{s.db=openDatabase(s.name,String(s.version),s.description,s.size)}catch(e){return n(e)}s.db.transaction((function(i){_e(i,s,(function(){t._dbInfo=s,e()}),(function(e,t){n(t)}))}),n)}));return s.serializer=ve,i}function ye(e,t,s,n,i,r){e.executeSql(s,n,i,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,a){a.rows.length?r(e,o):_e(e,t,(function(){e.executeSql(s,n,i,r)}),r)}),r):r(e,o)}),r)}function we(e,t){var s=this;e=h(e);var n=new l((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ye(s,i,"SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,s){var n=s.rows.length?s.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,t),n}function Se(e,t){var s=this,n=new l((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ye(s,i,"SELECT * FROM "+i.storeName,[],(function(s,n){for(var r=n.rows,o=r.length,a=0;a<o;a++){var c=r.item(a),l=c.value;if(l&&(l=i.serializer.deserialize(l)),void 0!==(l=e(l,c.key,a+1)))return void t(l)}t()}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,t),n}function Ae(e,t,s,n){var i=this;e=h(e);var r=new l((function(r,o){i.ready().then((function(){void 0===t&&(t=null);var a=t,c=i._dbInfo;c.serializer.serialize(t,(function(t,l){l?o(l):c.db.transaction((function(s){ye(s,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){r(a)}),(function(e,t){o(t)}))}),(function(t){if(t.code===t.QUOTA_ERR){if(n>0)return void r(Ae.apply(i,[e,a,s,n-1]));o(t)}}))}))})).catch(o)}));return d(r,s),r}function xe(e,t,s){return Ae.apply(this,[e,t,s,1])}function Ee(e,t){var s=this;e=h(e);var n=new l((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ye(s,i,"DELETE FROM "+i.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,t),n}function $e(e){var t=this,s=new l((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){ye(t,n,"DELETE FROM "+n.storeName,[],(function(){e()}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,e),s}function Ce(e){var t=this,s=new l((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){ye(t,n,"SELECT COUNT(key) as c FROM "+n.storeName,[],(function(t,s){var n=s.rows.item(0).c;e(n)}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,e),s}function ke(e,t){var s=this,n=new l((function(t,n){s.ready().then((function(){var i=s._dbInfo;i.db.transaction((function(s){ye(s,i,"SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,s){var n=s.rows.length?s.rows.item(0).key:null;t(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return d(n,t),n}function je(e){var t=this,s=new l((function(e,s){t.ready().then((function(){var n=t._dbInfo;n.db.transaction((function(t){ye(t,n,"SELECT key FROM "+n.storeName,[],(function(t,s){for(var n=[],i=0;i<s.rows.length;i++)n.push(s.rows.item(i).key);e(n)}),(function(e,t){s(t)}))}))})).catch(s)}));return d(s,e),s}function Te(e){return new l((function(t,s){e.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(s,n){for(var i=[],r=0;r<n.rows.length;r++)i.push(n.rows.item(r).name);t({db:e,storeNames:i})}),(function(e,t){s(t)}))}),(function(e){s(e)}))}))}function Oe(e,t){t=m.apply(this,arguments);var s=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||s.name,e.storeName=e.storeName||s.storeName);var n,i=this;return d(n=e.name?new l((function(t){var n;n=e.name===s.name?i._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:n,storeNames:[e.storeName]}):t(Te(n))})).then((function(e){return new l((function(t,s){e.db.transaction((function(n){function i(e){return new l((function(t,s){n.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){s(t)}))}))}for(var r=[],o=0,a=e.storeNames.length;o<a;o++)r.push(i(e.storeNames[o]));l.all(r).then((function(){t()})).catch((function(e){s(e)}))}),(function(e){s(e)}))}))})):l.reject("Invalid arguments"),t),n}var Ne={_driver:"webSQLStorage",_initStorage:be,_support:Q(),iterate:Se,getItem:we,setItem:xe,removeItem:Ee,clear:$e,length:Ce,key:ke,keys:je,dropInstance:Oe};function Ie(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Me(e,t){var s=e.name+"/";return e.storeName!==t.storeName&&(s+=e.storeName+"/"),s}function Re(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(e){return!0}}function De(){return!Re()||localStorage.length>0}function ze(e){var t=this,s={};if(e)for(var n in e)s[n]=e[n];return s.keyPrefix=Me(e,t._defaultConfig),De()?(t._dbInfo=s,s.serializer=ve,l.resolve()):l.reject()}function Le(e){var t=this,s=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,s=localStorage.length-1;s>=0;s--){var n=localStorage.key(s);0===n.indexOf(e)&&localStorage.removeItem(n)}}));return d(s,e),s}function Pe(e,t){var s=this;e=h(e);var n=s.ready().then((function(){var t=s._dbInfo,n=localStorage.getItem(t.keyPrefix+e);return n&&(n=t.serializer.deserialize(n)),n}));return d(n,t),n}function Fe(e,t){var s=this,n=s.ready().then((function(){for(var t=s._dbInfo,n=t.keyPrefix,i=n.length,r=localStorage.length,o=1,a=0;a<r;a++){var c=localStorage.key(a);if(0===c.indexOf(n)){var l=localStorage.getItem(c);if(l&&(l=t.serializer.deserialize(l)),void 0!==(l=e(l,c.substring(i),o++)))return l}}}));return d(n,t),n}function Ue(e,t){var s=this,n=s.ready().then((function(){var t,n=s._dbInfo;try{t=localStorage.key(e)}catch(e){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t}));return d(n,t),n}function Be(e){var t=this,s=t.ready().then((function(){for(var e=t._dbInfo,s=localStorage.length,n=[],i=0;i<s;i++){var r=localStorage.key(i);0===r.indexOf(e.keyPrefix)&&n.push(r.substring(e.keyPrefix.length))}return n}));return d(s,e),s}function qe(e){var t=this.keys().then((function(e){return e.length}));return d(t,e),t}function He(e,t){var s=this;e=h(e);var n=s.ready().then((function(){var t=s._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return d(n,t),n}function Ge(e,t,s){var n=this;e=h(e);var i=n.ready().then((function(){void 0===t&&(t=null);var s=t;return new l((function(i,r){var o=n._dbInfo;o.serializer.serialize(t,(function(t,n){if(n)r(n);else try{localStorage.setItem(o.keyPrefix+e,t),i(s)}catch(e){"QuotaExceededError"!==e.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==e.name||r(e),r(e)}}))}))}));return d(i,s),i}function We(e,t){if(t=m.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var s=this.config();e.name=e.name||s.name,e.storeName=e.storeName||s.storeName}var n,i=this;return n=e.name?new l((function(t){e.storeName?t(Me(e,i._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;t>=0;t--){var s=localStorage.key(t);0===s.indexOf(e)&&localStorage.removeItem(s)}})):l.reject("Invalid arguments"),d(n,t),n}var Ve={_driver:"localStorageWrapper",_initStorage:ze,_support:Ie(),iterate:Fe,getItem:Pe,setItem:Ge,removeItem:He,clear:Le,length:qe,key:Ue,keys:Be,dropInstance:We},Qe=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Ke=function(e,t){for(var s=e.length,n=0;n<s;){if(Qe(e[n],t))return!0;n++}return!1},Je=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Ye={},Xe={},Ze={INDEXEDDB:V,WEBSQL:Ne,LOCALSTORAGE:Ve},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],st=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),nt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function it(e,t){e[t]=function(){var s=arguments;return e.ready().then((function(){return e[t].apply(e,s)}))}}function rt(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var s in t)t.hasOwnProperty(s)&&(Je(t[s])?arguments[0][s]=t[s].slice():arguments[0][s]=t[s])}return arguments[0]}var ot=function(){function e(t){for(var s in i(this,e),Ze)if(Ze.hasOwnProperty(s)){var n=Ze[s],r=n._driver;this[s]=r,Ye[r]||this.defineDriver(n)}this._defaultConfig=rt({},nt),this._config=rt({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":n(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,s){var n=new l((function(t,s){try{var n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void s(i);for(var r=st.concat("_initStorage"),o=0,a=r.length;o<a;o++){var c=r[o];if((!Ke(tt,c)||e[c])&&"function"!=typeof e[c])return void s(i)}var u=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),s=l.reject(t);return d(s,arguments[arguments.length-1]),s}},s=0,n=tt.length;s<n;s++){var i=tt[s];e[i]||(e[i]=t(i))}};u();var h=function(s){Ye[n]&&console.info("Redefining LocalForage driver: "+n),Ye[n]=e,Xe[n]=s,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(h,s):h(!!e._support):h(!0)}catch(e){s(e)}}));return u(n,t,s),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,s){var n=Ye[e]?l.resolve(Ye[e]):l.reject(new Error("Driver not found."));return u(n,t,s),n},e.prototype.getSerializer=function(e){var t=l.resolve(ve);return u(t,e),t},e.prototype.ready=function(e){var t=this,s=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return u(s,e,e),s},e.prototype.setDriver=function(e,t,s){var n=this;Je(e)||(e=[e]);var i=this._getSupportedDrivers(e);function r(){n._config.driver=n.driver()}function o(e){return n._extend(e),r(),n._ready=n._initStorage(n._config),n._ready}function a(e){return function(){var t=0;function s(){for(;t<e.length;){var i=e[t];return t++,n._dbInfo=null,n._ready=null,n.getDriver(i).then(o).catch(s)}r();var a=new Error("No available storage method found.");return n._driverSet=l.reject(a),n._driverSet}return s()}}var c=null!==this._driverSet?this._driverSet.catch((function(){return l.resolve()})):l.resolve();return this._driverSet=c.then((function(){var e=i[0];return n._dbInfo=null,n._ready=null,n.getDriver(e).then((function(e){n._driver=e._driver,r(),n._wrapLibraryMethodsWithReady(),n._initDriver=a(i)}))})).catch((function(){r();var e=new Error("No available storage method found.");return n._driverSet=l.reject(e),n._driverSet})),u(this._driverSet,t,s),this._driverSet},e.prototype.supports=function(e){return!!Xe[e]},e.prototype._extend=function(e){rt(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],s=0,n=e.length;s<n;s++){var i=e[s];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=st.length;e<t;e++)it(this,st[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),at=new ot;t.exports=at},{3:3}]},{},[4])(4)},4360:(e,t,s)=>{var n;!function(i){var r,o,a,c,l,d,u,h,m,g,p,f,v,_,b,y,w,S,A,x="sizzle"+1*new Date,E=i.document,$=0,C=0,k=he(),j=he(),T=he(),O=he(),N=function(e,t){return e===t&&(p=!0),0},I={}.hasOwnProperty,M=[],R=M.pop,D=M.push,z=M.push,L=M.slice,P=function(e,t){for(var s=0,n=e.length;s<n;s++)if(e[s]===t)return s;return-1},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",U="[\\x20\\t\\r\\n\\f]",B="(?:\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",q="\\["+U+"*("+B+")(?:"+U+"*([*^$|!~]?=)"+U+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+U+"*\\]",H=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+q+")*)|.*)\\)|)",G=new RegExp(U+"+","g"),W=new RegExp("^"+U+"+|((?:^|[^\\\\])(?:\\\\.)*)"+U+"+$","g"),V=new RegExp("^"+U+"*,"+U+"*"),Q=new RegExp("^"+U+"*([>+~]|"+U+")"+U+"*"),K=new RegExp(U+"|>"),J=new RegExp(H),Y=new RegExp("^"+B+"$"),X={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+H),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+U+"*(even|odd|(([+-]|)(\\d*)n|)"+U+"*(?:([+-]|)"+U+"*(\\d+)|))"+U+"*\\)|)","i"),bool:new RegExp("^(?:"+F+")$","i"),needsContext:new RegExp("^"+U+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+U+"*((?:-\\d)?\\d*)"+U+"*\\)|)(?=[^-]|$)","i")},Z=/HTML$/i,ee=/^(?:input|select|textarea|button)$/i,te=/^h\d$/i,se=/^[^{]+\{\s*\[native \w/,ne=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ie=/[+~]/,re=new RegExp("\\\\[\\da-fA-F]{1,6}"+U+"?|\\\\([^\\r\\n\\f])","g"),oe=function(e,t){var s="0x"+e.slice(1)-65536;return t||(s<0?String.fromCharCode(s+65536):String.fromCharCode(s>>10|55296,1023&s|56320))},ae=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ce=function(e,t){return t?"\0"===e?"�":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},le=function(){f()},de=xe((function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()}),{dir:"parentNode",next:"legend"});try{z.apply(M=L.call(E.childNodes),E.childNodes),M[E.childNodes.length].nodeType}catch(e){z={apply:M.length?function(e,t){D.apply(e,L.call(t))}:function(e,t){for(var s=e.length,n=0;e[s++]=t[n++];);e.length=s-1}}}function ue(e,t,s,n){var i,r,a,c,l,u,m,g=t&&t.ownerDocument,p=t?t.nodeType:9;if(s=s||[],"string"!=typeof e||!e||1!==p&&9!==p&&11!==p)return s;if(!n&&(f(t),t=t||v,b)){if(11!==p&&(l=ne.exec(e)))if(i=l[1]){if(9===p){if(!(a=t.getElementById(i)))return s;if(a.id===i)return s.push(a),s}else if(g&&(a=g.getElementById(i))&&A(t,a)&&a.id===i)return s.push(a),s}else{if(l[2])return z.apply(s,t.getElementsByTagName(e)),s;if((i=l[3])&&o.getElementsByClassName&&t.getElementsByClassName)return z.apply(s,t.getElementsByClassName(i)),s}if(o.qsa&&!O[e+" "]&&(!y||!y.test(e))&&(1!==p||"object"!==t.nodeName.toLowerCase())){if(m=e,g=t,1===p&&(K.test(e)||Q.test(e))){for((g=ie.test(e)&&we(t.parentNode)||t)===t&&o.scope||((c=t.getAttribute("id"))?c=c.replace(ae,ce):t.setAttribute("id",c=x)),r=(u=d(e)).length;r--;)u[r]=(c?"#"+c:":scope")+" "+Ae(u[r]);m=u.join(",")}try{return z.apply(s,g.querySelectorAll(m)),s}catch(t){O(e,!0)}finally{c===x&&t.removeAttribute("id")}}}return h(e.replace(W,"$1"),t,s,n)}function he(){var e=[];return function t(s,n){return e.push(s+" ")>a.cacheLength&&delete t[e.shift()],t[s+" "]=n}}function me(e){return e[x]=!0,e}function ge(e){var t=v.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function pe(e,t){for(var s=e.split("|"),n=s.length;n--;)a.attrHandle[s[n]]=t}function fe(e,t){var s=t&&e,n=s&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(n)return n;if(s)for(;s=s.nextSibling;)if(s===t)return-1;return e?1:-1}function ve(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function _e(e){return function(t){var s=t.nodeName.toLowerCase();return("input"===s||"button"===s)&&t.type===e}}function be(e){return function(t){return"form"in t?t.parentNode&&!1===t.disabled?"label"in t?"label"in t.parentNode?t.parentNode.disabled===e:t.disabled===e:t.isDisabled===e||t.isDisabled!==!e&&de(t)===e:t.disabled===e:"label"in t&&t.disabled===e}}function ye(e){return me((function(t){return t=+t,me((function(s,n){for(var i,r=e([],s.length,t),o=r.length;o--;)s[i=r[o]]&&(s[i]=!(n[i]=s[i]))}))}))}function we(e){return e&&void 0!==e.getElementsByTagName&&e}for(r in o=ue.support={},l=ue.isXML=function(e){var t=e&&e.namespaceURI,s=e&&(e.ownerDocument||e).documentElement;return!Z.test(t||s&&s.nodeName||"HTML")},f=ue.setDocument=function(e){var t,s,n=e?e.ownerDocument||e:E;return n!=v&&9===n.nodeType&&n.documentElement?(_=(v=n).documentElement,b=!l(v),E!=v&&(s=v.defaultView)&&s.top!==s&&(s.addEventListener?s.addEventListener("unload",le,!1):s.attachEvent&&s.attachEvent("onunload",le)),o.scope=ge((function(e){return _.appendChild(e).appendChild(v.createElement("div")),void 0!==e.querySelectorAll&&!e.querySelectorAll(":scope fieldset div").length})),o.cssHas=ge((function(){try{return v.querySelector(":has(*,:jqfake)"),!1}catch(e){return!0}})),o.attributes=ge((function(e){return e.className="i",!e.getAttribute("className")})),o.getElementsByTagName=ge((function(e){return e.appendChild(v.createComment("")),!e.getElementsByTagName("*").length})),o.getElementsByClassName=se.test(v.getElementsByClassName),o.getById=ge((function(e){return _.appendChild(e).id=x,!v.getElementsByName||!v.getElementsByName(x).length})),o.getById?(a.filter.ID=function(e){var t=e.replace(re,oe);return function(e){return e.getAttribute("id")===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&b){var s=t.getElementById(e);return s?[s]:[]}}):(a.filter.ID=function(e){var t=e.replace(re,oe);return function(e){var s=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return s&&s.value===t}},a.find.ID=function(e,t){if(void 0!==t.getElementById&&b){var s,n,i,r=t.getElementById(e);if(r){if((s=r.getAttributeNode("id"))&&s.value===e)return[r];for(i=t.getElementsByName(e),n=0;r=i[n++];)if((s=r.getAttributeNode("id"))&&s.value===e)return[r]}return[]}}),a.find.TAG=o.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):o.qsa?t.querySelectorAll(e):void 0}:function(e,t){var s,n=[],i=0,r=t.getElementsByTagName(e);if("*"===e){for(;s=r[i++];)1===s.nodeType&&n.push(s);return n}return r},a.find.CLASS=o.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&b)return t.getElementsByClassName(e)},w=[],y=[],(o.qsa=se.test(v.querySelectorAll))&&(ge((function(e){var t;_.appendChild(e).innerHTML="<a id='"+x+"'></a><select id='"+x+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&y.push("[*^$]="+U+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||y.push("\\["+U+"*(?:value|"+F+")"),e.querySelectorAll("[id~="+x+"-]").length||y.push("~="),(t=v.createElement("input")).setAttribute("name",""),e.appendChild(t),e.querySelectorAll("[name='']").length||y.push("\\["+U+"*name"+U+"*="+U+"*(?:''|\"\")"),e.querySelectorAll(":checked").length||y.push(":checked"),e.querySelectorAll("a#"+x+"+*").length||y.push(".#.+[+~]"),e.querySelectorAll("\\\f"),y.push("[\\r\\n\\f]")})),ge((function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=v.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&y.push("name"+U+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&y.push(":enabled",":disabled"),_.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&y.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),y.push(",.*:")}))),(o.matchesSelector=se.test(S=_.matches||_.webkitMatchesSelector||_.mozMatchesSelector||_.oMatchesSelector||_.msMatchesSelector))&&ge((function(e){o.disconnectedMatch=S.call(e,"*"),S.call(e,"[s!='']:x"),w.push("!=",H)})),o.cssHas||y.push(":has"),y=y.length&&new RegExp(y.join("|")),w=w.length&&new RegExp(w.join("|")),t=se.test(_.compareDocumentPosition),A=t||se.test(_.contains)?function(e,t){var s=9===e.nodeType&&e.documentElement||e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(s.contains?s.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},N=t?function(e,t){if(e===t)return p=!0,0;var s=!e.compareDocumentPosition-!t.compareDocumentPosition;return s||(1&(s=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!o.sortDetached&&t.compareDocumentPosition(e)===s?e==v||e.ownerDocument==E&&A(E,e)?-1:t==v||t.ownerDocument==E&&A(E,t)?1:g?P(g,e)-P(g,t):0:4&s?-1:1)}:function(e,t){if(e===t)return p=!0,0;var s,n=0,i=e.parentNode,r=t.parentNode,o=[e],a=[t];if(!i||!r)return e==v?-1:t==v?1:i?-1:r?1:g?P(g,e)-P(g,t):0;if(i===r)return fe(e,t);for(s=e;s=s.parentNode;)o.unshift(s);for(s=t;s=s.parentNode;)a.unshift(s);for(;o[n]===a[n];)n++;return n?fe(o[n],a[n]):o[n]==E?-1:a[n]==E?1:0},v):v},ue.matches=function(e,t){return ue(e,null,null,t)},ue.matchesSelector=function(e,t){if(f(e),o.matchesSelector&&b&&!O[t+" "]&&(!w||!w.test(t))&&(!y||!y.test(t)))try{var s=S.call(e,t);if(s||o.disconnectedMatch||e.document&&11!==e.document.nodeType)return s}catch(e){O(t,!0)}return ue(t,v,null,[e]).length>0},ue.contains=function(e,t){return(e.ownerDocument||e)!=v&&f(e),A(e,t)},ue.attr=function(e,t){(e.ownerDocument||e)!=v&&f(e);var s=a.attrHandle[t.toLowerCase()],n=s&&I.call(a.attrHandle,t.toLowerCase())?s(e,t,!b):void 0;return void 0!==n?n:o.attributes||!b?e.getAttribute(t):(n=e.getAttributeNode(t))&&n.specified?n.value:null},ue.escape=function(e){return(e+"").replace(ae,ce)},ue.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ue.uniqueSort=function(e){var t,s=[],n=0,i=0;if(p=!o.detectDuplicates,g=!o.sortStable&&e.slice(0),e.sort(N),p){for(;t=e[i++];)t===e[i]&&(n=s.push(i));for(;n--;)e.splice(s[n],1)}return g=null,e},c=ue.getText=function(e){var t,s="",n=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)s+=c(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[n++];)s+=c(t);return s},a=ue.selectors={cacheLength:50,createPseudo:me,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(re,oe),e[3]=(e[3]||e[4]||e[5]||"").replace(re,oe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ue.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ue.error(e[0]),e},PSEUDO:function(e){var t,s=!e[6]&&e[2];return X.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":s&&J.test(s)&&(t=d(s,!0))&&(t=s.indexOf(")",s.length-t)-s.length)&&(e[0]=e[0].slice(0,t),e[2]=s.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(re,oe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=k[e+" "];return t||(t=new RegExp("(^|"+U+")"+e+"("+U+"|$)"))&&k(e,(function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")}))},ATTR:function(e,t,s){return function(n){var i=ue.attr(n,e);return null==i?"!="===t:!t||(i+="","="===t?i===s:"!="===t?i!==s:"^="===t?s&&0===i.indexOf(s):"*="===t?s&&i.indexOf(s)>-1:"$="===t?s&&i.slice(-s.length)===s:"~="===t?(" "+i.replace(G," ")+" ").indexOf(s)>-1:"|="===t&&(i===s||i.slice(0,s.length+1)===s+"-"))}},CHILD:function(e,t,s,n,i){var r="nth"!==e.slice(0,3),o="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===i?function(e){return!!e.parentNode}:function(t,s,c){var l,d,u,h,m,g,p=r!==o?"nextSibling":"previousSibling",f=t.parentNode,v=a&&t.nodeName.toLowerCase(),_=!c&&!a,b=!1;if(f){if(r){for(;p;){for(h=t;h=h[p];)if(a?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;g=p="only"===e&&!g&&"nextSibling"}return!0}if(g=[o?f.firstChild:f.lastChild],o&&_){for(b=(m=(l=(d=(u=(h=f)[x]||(h[x]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===$&&l[1])&&l[2],h=m&&f.childNodes[m];h=++m&&h&&h[p]||(b=m=0)||g.pop();)if(1===h.nodeType&&++b&&h===t){d[e]=[$,m,b];break}}else if(_&&(b=m=(l=(d=(u=(h=t)[x]||(h[x]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]||[])[0]===$&&l[1]),!1===b)for(;(h=++m&&h&&h[p]||(b=m=0)||g.pop())&&((a?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++b||(_&&((d=(u=h[x]||(h[x]={}))[h.uniqueID]||(u[h.uniqueID]={}))[e]=[$,b]),h!==t)););return(b-=i)===n||b%n==0&&b/n>=0}}},PSEUDO:function(e,t){var s,n=a.pseudos[e]||a.setFilters[e.toLowerCase()]||ue.error("unsupported pseudo: "+e);return n[x]?n(t):n.length>1?(s=[e,e,"",t],a.setFilters.hasOwnProperty(e.toLowerCase())?me((function(e,s){for(var i,r=n(e,t),o=r.length;o--;)e[i=P(e,r[o])]=!(s[i]=r[o])})):function(e){return n(e,0,s)}):n}},pseudos:{not:me((function(e){var t=[],s=[],n=u(e.replace(W,"$1"));return n[x]?me((function(e,t,s,i){for(var r,o=n(e,null,i,[]),a=e.length;a--;)(r=o[a])&&(e[a]=!(t[a]=r))})):function(e,i,r){return t[0]=e,n(t,null,r,s),t[0]=null,!s.pop()}})),has:me((function(e){return function(t){return ue(e,t).length>0}})),contains:me((function(e){return e=e.replace(re,oe),function(t){return(t.textContent||c(t)).indexOf(e)>-1}})),lang:me((function(e){return Y.test(e||"")||ue.error("unsupported lang: "+e),e=e.replace(re,oe).toLowerCase(),function(t){var s;do{if(s=b?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(s=s.toLowerCase())===e||0===s.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}})),target:function(e){var t=i.location&&i.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===_},focus:function(e){return e===v.activeElement&&(!v.hasFocus||v.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:be(!1),disabled:be(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!a.pseudos.empty(e)},header:function(e){return te.test(e.nodeName)},input:function(e){return ee.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ye((function(){return[0]})),last:ye((function(e,t){return[t-1]})),eq:ye((function(e,t,s){return[s<0?s+t:s]})),even:ye((function(e,t){for(var s=0;s<t;s+=2)e.push(s);return e})),odd:ye((function(e,t){for(var s=1;s<t;s+=2)e.push(s);return e})),lt:ye((function(e,t,s){for(var n=s<0?s+t:s>t?t:s;--n>=0;)e.push(n);return e})),gt:ye((function(e,t,s){for(var n=s<0?s+t:s;++n<t;)e.push(n);return e}))}},a.pseudos.nth=a.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})a.pseudos[r]=ve(r);for(r in{submit:!0,reset:!0})a.pseudos[r]=_e(r);function Se(){}function Ae(e){for(var t=0,s=e.length,n="";t<s;t++)n+=e[t].value;return n}function xe(e,t,s){var n=t.dir,i=t.next,r=i||n,o=s&&"parentNode"===r,a=C++;return t.first?function(t,s,i){for(;t=t[n];)if(1===t.nodeType||o)return e(t,s,i);return!1}:function(t,s,c){var l,d,u,h=[$,a];if(c){for(;t=t[n];)if((1===t.nodeType||o)&&e(t,s,c))return!0}else for(;t=t[n];)if(1===t.nodeType||o)if(d=(u=t[x]||(t[x]={}))[t.uniqueID]||(u[t.uniqueID]={}),i&&i===t.nodeName.toLowerCase())t=t[n]||t;else{if((l=d[r])&&l[0]===$&&l[1]===a)return h[2]=l[2];if(d[r]=h,h[2]=e(t,s,c))return!0}return!1}}function Ee(e){return e.length>1?function(t,s,n){for(var i=e.length;i--;)if(!e[i](t,s,n))return!1;return!0}:e[0]}function $e(e,t,s,n,i){for(var r,o=[],a=0,c=e.length,l=null!=t;a<c;a++)(r=e[a])&&(s&&!s(r,n,i)||(o.push(r),l&&t.push(a)));return o}function Ce(e,t,s,n,i,r){return n&&!n[x]&&(n=Ce(n)),i&&!i[x]&&(i=Ce(i,r)),me((function(r,o,a,c){var l,d,u,h=[],m=[],g=o.length,p=r||function(e,t,s){for(var n=0,i=t.length;n<i;n++)ue(e,t[n],s);return s}(t||"*",a.nodeType?[a]:a,[]),f=!e||!r&&t?p:$e(p,h,e,a,c),v=s?i||(r?e:g||n)?[]:o:f;if(s&&s(f,v,a,c),n)for(l=$e(v,m),n(l,[],a,c),d=l.length;d--;)(u=l[d])&&(v[m[d]]=!(f[m[d]]=u));if(r){if(i||e){if(i){for(l=[],d=v.length;d--;)(u=v[d])&&l.push(f[d]=u);i(null,v=[],l,c)}for(d=v.length;d--;)(u=v[d])&&(l=i?P(r,u):h[d])>-1&&(r[l]=!(o[l]=u))}}else v=$e(v===o?v.splice(g,v.length):v),i?i(null,o,v,c):z.apply(o,v)}))}function ke(e){for(var t,s,n,i=e.length,r=a.relative[e[0].type],o=r||a.relative[" "],c=r?1:0,l=xe((function(e){return e===t}),o,!0),d=xe((function(e){return P(t,e)>-1}),o,!0),u=[function(e,s,n){var i=!r&&(n||s!==m)||((t=s).nodeType?l(e,s,n):d(e,s,n));return t=null,i}];c<i;c++)if(s=a.relative[e[c].type])u=[xe(Ee(u),s)];else{if((s=a.filter[e[c].type].apply(null,e[c].matches))[x]){for(n=++c;n<i&&!a.relative[e[n].type];n++);return Ce(c>1&&Ee(u),c>1&&Ae(e.slice(0,c-1).concat({value:" "===e[c-2].type?"*":""})).replace(W,"$1"),s,c<n&&ke(e.slice(c,n)),n<i&&ke(e=e.slice(n)),n<i&&Ae(e))}u.push(s)}return Ee(u)}Se.prototype=a.filters=a.pseudos,a.setFilters=new Se,d=ue.tokenize=function(e,t){var s,n,i,r,o,c,l,d=j[e+" "];if(d)return t?0:d.slice(0);for(o=e,c=[],l=a.preFilter;o;){for(r in s&&!(n=V.exec(o))||(n&&(o=o.slice(n[0].length)||o),c.push(i=[])),s=!1,(n=Q.exec(o))&&(s=n.shift(),i.push({value:s,type:n[0].replace(W," ")}),o=o.slice(s.length)),a.filter)!(n=X[r].exec(o))||l[r]&&!(n=l[r](n))||(s=n.shift(),i.push({value:s,type:r,matches:n}),o=o.slice(s.length));if(!s)break}return t?o.length:o?ue.error(e):j(e,c).slice(0)},u=ue.compile=function(e,t){var s,n=[],i=[],r=T[e+" "];if(!r){for(t||(t=d(e)),s=t.length;s--;)(r=ke(t[s]))[x]?n.push(r):i.push(r);r=T(e,function(e,t){var s=t.length>0,n=e.length>0,i=function(i,r,o,c,l){var d,u,h,g=0,p="0",_=i&&[],y=[],w=m,S=i||n&&a.find.TAG("*",l),A=$+=null==w?1:Math.random()||.1,x=S.length;for(l&&(m=r==v||r||l);p!==x&&null!=(d=S[p]);p++){if(n&&d){for(u=0,r||d.ownerDocument==v||(f(d),o=!b);h=e[u++];)if(h(d,r||v,o)){c.push(d);break}l&&($=A)}s&&((d=!h&&d)&&g--,i&&_.push(d))}if(g+=p,s&&p!==g){for(u=0;h=t[u++];)h(_,y,r,o);if(i){if(g>0)for(;p--;)_[p]||y[p]||(y[p]=R.call(c));y=$e(y)}z.apply(c,y),l&&!i&&y.length>0&&g+t.length>1&&ue.uniqueSort(c)}return l&&($=A,m=w),_};return s?me(i):i}(i,n)),r.selector=e}return r},h=ue.select=function(e,t,s,n){var i,r,o,c,l,h="function"==typeof e&&e,m=!n&&d(e=h.selector||e);if(s=s||[],1===m.length){if((r=m[0]=m[0].slice(0)).length>2&&"ID"===(o=r[0]).type&&9===t.nodeType&&b&&a.relative[r[1].type]){if(!(t=(a.find.ID(o.matches[0].replace(re,oe),t)||[])[0]))return s;h&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(i=X.needsContext.test(e)?0:r.length;i--&&(o=r[i],!a.relative[c=o.type]);)if((l=a.find[c])&&(n=l(o.matches[0].replace(re,oe),ie.test(r[0].type)&&we(t.parentNode)||t))){if(r.splice(i,1),!(e=n.length&&Ae(r)))return z.apply(s,n),s;break}}return(h||u(e,m))(n,t,!b,s,!t||ie.test(e)&&we(t.parentNode)||t),s},o.sortStable=x.split("").sort(N).join("")===x,o.detectDuplicates=!!p,f(),o.sortDetached=ge((function(e){return 1&e.compareDocumentPosition(v.createElement("fieldset"))})),ge((function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")}))||pe("type|href|height|width",(function(e,t,s){if(!s)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)})),o.attributes&&ge((function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")}))||pe("value",(function(e,t,s){if(!s&&"input"===e.nodeName.toLowerCase())return e.defaultValue})),ge((function(e){return null==e.getAttribute("disabled")}))||pe(F,(function(e,t,s){var n;if(!s)return!0===e[t]?t.toLowerCase():(n=e.getAttributeNode(t))&&n.specified?n.value:null}));var je=i.Sizzle;ue.noConflict=function(){return i.Sizzle===ue&&(i.Sizzle=je),ue},void 0===(n=function(){return ue}.call(t,s,t,e))||(e.exports=n)}(window)},5072:e=>{"use strict";var t=[];function s(e){for(var s=-1,n=0;n<t.length;n++)if(t[n].identifier===e){s=n;break}return s}function n(e,n){for(var r={},o=[],a=0;a<e.length;a++){var c=e[a],l=n.base?c[0]+n.base:c[0],d=r[l]||0,u="".concat(l," ").concat(d);r[l]=d+1;var h=s(u),m={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==h)t[h].references++,t[h].updater(m);else{var g=i(m,n);n.byIndex=a,t.splice(a,0,{identifier:u,updater:g,references:1})}o.push(u)}return o}function i(e,t){var s=t.domAPI(t);s.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,i){var r=n(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var a=s(r[o]);t[a].references--}for(var c=n(e,i),l=0;l<r.length;l++){var d=s(r[l]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=c}}},7659:e=>{"use strict";var t={};e.exports=function(e,s){var n=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(s)}},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},5056:(e,t,s)=>{"use strict";e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},7825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var n="";s.supports&&(n+="@supports (".concat(s.supports,") {")),s.media&&(n+="@media ".concat(s.media," {"));var i=void 0!==s.layer;i&&(n+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),n+=s.css,i&&(n+="}"),s.media&&(n+="}"),s.supports&&(n+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},1113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},3883:(e,t,s)=>{var n={"./af/LC_MESSAGES/converse.po":[5544,4267],"./ar/LC_MESSAGES/converse.po":[788,5743],"./be/LC_MESSAGES/converse.po":[9174,1437],"./bg/LC_MESSAGES/converse.po":[9088,6179],"./ca/LC_MESSAGES/converse.po":[6929,962],"./cs/LC_MESSAGES/converse.po":[4359,8252],"./da/LC_MESSAGES/converse.po":[1712,6963],"./de/LC_MESSAGES/converse.po":[7532,6311],"./el/LC_MESSAGES/converse.po":[6202,345],"./eo/LC_MESSAGES/converse.po":[7653,7494],"./es/LC_MESSAGES/converse.po":[8209,4202],"./eu/LC_MESSAGES/converse.po":[4147,2168],"./fa/LC_MESSAGES/converse.po":[4750,453],"./fi/LC_MESSAGES/converse.po":[6742,3613],"./fr/LC_MESSAGES/converse.po":[2889,3698],"./gl/LC_MESSAGES/converse.po":[2504,2787],"./he/LC_MESSAGES/converse.po":[5424,8227],"./hi/LC_MESSAGES/converse.po":[7140,799],"./hu/LC_MESSAGES/converse.po":[1520,9139],"./id/LC_MESSAGES/converse.po":[4326,4749],"./it/LC_MESSAGES/converse.po":[8854,6109],"./ja/LC_MESSAGES/converse.po":[762,3881],"./ko/LC_MESSAGES/converse.po":[6227,528],"./lt/LC_MESSAGES/converse.po":[8261,1462],"./mr/LC_MESSAGES/converse.po":[4632,507],"./nb/LC_MESSAGES/converse.po":[6529,9562],"./nl/LC_MESSAGES/converse.po":[347,4336],"./nl_BE/LC_MESSAGES/converse.po":[2361,290],"./oc/LC_MESSAGES/converse.po":[107,7576],"./pl/LC_MESSAGES/converse.po":[2993,7370],"./pt/LC_MESSAGES/converse.po":[3385,2546],"./pt_BR/LC_MESSAGES/converse.po":[3096,4315],"./ro/LC_MESSAGES/converse.po":[9576,1963],"./ru/LC_MESSAGES/converse.po":[6166,6733],"./si/LC_MESSAGES/converse.po":[8553,8714],"./sq/LC_MESSAGES/converse.po":[8785,4146],"./sv/LC_MESSAGES/converse.po":[6850,6345],"./ta/LC_MESSAGES/converse.po":[2608,5283],"./th/LC_MESSAGES/converse.po":[3161,3330],"./tr/LC_MESSAGES/converse.po":[9815,548],"./ug/LC_MESSAGES/converse.po":[1661,2894],"./uk/LC_MESSAGES/converse.po":[3689,8898],"./vi/LC_MESSAGES/converse.po":[358,221],"./zh_CN/LC_MESSAGES/converse.po":[5645,6550],"./zh_TW/LC_MESSAGES/converse.po":[5097,8986]};function i(e){if(!s.o(n,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return s.e(t[1]).then((()=>s.t(i,19)))}i.keys=()=>Object.keys(n),i.id=3883,e.exports=i},6597:e=>{function t(e,t,s,n,i,r,o){try{var a=e[r](o),c=a.value}catch(e){return void s(e)}a.done?t(c):Promise.resolve(c).then(n,i)}e.exports=function(e){return function(){var s=this,n=arguments;return new Promise((function(i,r){var o=e.apply(s,n);function a(e){t(o,i,r,a,c,"next",e)}function c(e){t(o,i,r,a,c,"throw",e)}a(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},2485:(e,t,s)=>{var n=s(1344);e.exports=function(e,t,s){return(t=n(t))in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e},e.exports.__esModule=!0,e.exports.default=e.exports},4602:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},2081:(e,t,s)=>{var n=s(5410).default;function i(){"use strict";e.exports=i=function(){return s},e.exports.__esModule=!0,e.exports.default=e.exports;var t,s={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(e,t,s){e[t]=s.value},c="function"==typeof Symbol?Symbol:{},l=c.iterator||"@@iterator",d=c.asyncIterator||"@@asyncIterator",u=c.toStringTag||"@@toStringTag";function h(e,t,s){return Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(t){h=function(e,t,s){return e[t]=s}}function m(e,t,s,n){var i=t&&t.prototype instanceof y?t:y,r=Object.create(i.prototype),o=new I(n||[]);return a(r,"_invoke",{value:j(e,s,o)}),r}function g(e,t,s){try{return{type:"normal",arg:e.call(t,s)}}catch(e){return{type:"throw",arg:e}}}s.wrap=m;var p="suspendedStart",f="suspendedYield",v="executing",_="completed",b={};function y(){}function w(){}function S(){}var A={};h(A,l,(function(){return this}));var x=Object.getPrototypeOf,E=x&&x(x(M([])));E&&E!==r&&o.call(E,l)&&(A=E);var $=S.prototype=y.prototype=Object.create(A);function C(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function s(i,r,a,c){var l=g(e[i],e,r);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==n(u)&&o.call(u,"__await")?t.resolve(u.__await).then((function(e){s("next",e,a,c)}),(function(e){s("throw",e,a,c)})):t.resolve(u).then((function(e){d.value=e,a(d)}),(function(e){return s("throw",e,a,c)}))}c(l.arg)}var i;a(this,"_invoke",{value:function(e,n){function r(){return new t((function(t,i){s(e,n,t,i)}))}return i=i?i.then(r,r):r()}})}function j(e,s,n){var i=p;return function(r,o){if(i===v)throw Error("Generator is already running");if(i===_){if("throw"===r)throw o;return{value:t,done:!0}}for(n.method=r,n.arg=o;;){var a=n.delegate;if(a){var c=T(a,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===p)throw i=_,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var l=g(e,s,n);if("normal"===l.type){if(i=n.done?_:f,l.arg===b)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=_,n.method="throw",n.arg=l.arg)}}}function T(e,s){var n=s.method,i=e.iterator[n];if(i===t)return s.delegate=null,"throw"===n&&e.iterator.return&&(s.method="return",s.arg=t,T(e,s),"throw"===s.method)||"return"!==n&&(s.method="throw",s.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var r=g(i,e.iterator,s.arg);if("throw"===r.type)return s.method="throw",s.arg=r.arg,s.delegate=null,b;var o=r.arg;return o?o.done?(s[e.resultName]=o.value,s.next=e.nextLoc,"return"!==s.method&&(s.method="next",s.arg=t),s.delegate=null,b):o:(s.method="throw",s.arg=new TypeError("iterator result is not an object"),s.delegate=null,b)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function N(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function M(e){if(e||""===e){var s=e[l];if(s)return s.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function s(){for(;++i<e.length;)if(o.call(e,i))return s.value=e[i],s.done=!1,s;return s.value=t,s.done=!0,s};return r.next=r}}throw new TypeError(n(e)+" is not iterable")}return w.prototype=S,a($,"constructor",{value:S,configurable:!0}),a(S,"constructor",{value:w,configurable:!0}),w.displayName=h(S,u,"GeneratorFunction"),s.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},s.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,h(e,u,"GeneratorFunction")),e.prototype=Object.create($),e},s.awrap=function(e){return{__await:e}},C(k.prototype),h(k.prototype,d,(function(){return this})),s.AsyncIterator=k,s.async=function(e,t,n,i,r){void 0===r&&(r=Promise);var o=new k(m(e,t,n,i),r);return s.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},C($),h($,u,"Generator"),h($,l,(function(){return this})),h($,"toString",(function(){return"[object Generator]"})),s.keys=function(e){var t=Object(e),s=[];for(var n in t)s.push(n);return s.reverse(),function e(){for(;s.length;){var n=s.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},s.values=M,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var s in this)"t"===s.charAt(0)&&o.call(this,s)&&!isNaN(+s.slice(1))&&(this[s]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var s=this;function n(n,i){return a.type="throw",a.arg=e,s.next=n,i&&(s.method="next",s.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],a=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var c=o.call(r,"catchLoc"),l=o.call(r,"finallyLoc");if(c&&l){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(c){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(e,t){for(var s=this.tryEntries.length-1;s>=0;--s){var n=this.tryEntries[s];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.finallyLoc===e)return this.complete(s.completion,s.afterLoc),N(s),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var s=this.tryEntries[t];if(s.tryLoc===e){var n=s.completion;if("throw"===n.type){var i=n.arg;N(s)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,s,n){return this.delegate={iterator:M(e),resultName:s,nextLoc:n},"next"===this.method&&(this.arg=t),b}},s}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},3517:(e,t,s)=>{var n=s(5410).default;e.exports=function(e,t){if("object"!=n(e)||!e)return e;var s=e[Symbol.toPrimitive];if(void 0!==s){var i=s.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},1344:(e,t,s)=>{var n=s(5410).default,i=s(3517);e.exports=function(e){var t=i(e,"string");return"symbol"==n(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},5410:e=>{function t(s){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(s)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},460:(e,t,s)=>{var n=s(2081)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var s=r[e]={id:e,loaded:!1,exports:{}};return i[e].call(s.exports,s,s.exports,o),s.loaded=!0,s.exports}o.m=i,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(s,n){if(1&n&&(s=this(s)),8&n)return s;if("object"==typeof s&&s){if(4&n&&s.__esModule)return s;if(16&n&&"function"==typeof s.then)return s}var i=Object.create(null);o.r(i);var r={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&s;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>r[e]=()=>s[e]));return r.default=()=>s,o.d(i,r),i},o.d=(e,t)=>{for(var s in t)o.o(t,s)&&!o.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,s)=>(o.f[s](e,t),t)),[])),o.u=e=>({7:"locales/dayjs/nb-js",131:"locales/dayjs/ar-sa-js",138:"locales/dayjs/tzm-latn-js",221:"locales/vi-LC_MESSAGES-converse-po",290:"locales/nl_BE-LC_MESSAGES-converse-po",345:"locales/el-LC_MESSAGES-converse-po",385:"locales/dayjs/et-js",422:"locales/dayjs/tk-js",453:"locales/fa-LC_MESSAGES-converse-po",507:"locales/mr-LC_MESSAGES-converse-po",528:"locales/ko-LC_MESSAGES-converse-po",548:"locales/tr-LC_MESSAGES-converse-po",561:"locales/dayjs/my-js",591:"locales/dayjs/es-mx-js",598:"locales/dayjs/fa-js",687:"locales/dayjs/ku-js",799:"locales/hi-LC_MESSAGES-converse-po",832:"locales/dayjs/ta-js",861:"locales/dayjs/ar-kw-js",933:"locales/dayjs/eu-js",948:"locales/dayjs/uz-js",962:"locales/ca-LC_MESSAGES-converse-po",1056:"locales/dayjs/mn-js",1072:"locales/dayjs/bg-js",1116:"locales/dayjs/bs-js",1275:"locales/dayjs/nn-js",1373:"locales/dayjs/lb-js",1388:"locales/dayjs/ur-js",1437:"locales/be-LC_MESSAGES-converse-po",1462:"locales/lt-LC_MESSAGES-converse-po",1464:"locales/dayjs/bo-js",1665:"locales/dayjs/en-ie-js",1696:"locales/dayjs/ar-ly-js",1712:"locales/dayjs/hu-js",1719:"locales/dayjs/oc-lnc-js",1827:"locales/dayjs/es-js",1938:"locales/dayjs/bi-js",1963:"locales/ro-LC_MESSAGES-converse-po",1982:"locales/dayjs/sv-js",2014:"locales/dayjs/pt-br-js",2091:"locales/dayjs/ms-js",2168:"locales/eu-LC_MESSAGES-converse-po",2241:"locales/dayjs/hr-js",2366:"locales/dayjs/be-js",2384:"locales/dayjs/he-js",2389:"locales/dayjs/sw-js",2546:"locales/pt-LC_MESSAGES-converse-po",2643:"locales/dayjs/br-js",2664:"locales/dayjs/pa-in-js",2766:"locales/dayjs/cv-js",2769:"locales/dayjs/ss-js",2787:"locales/gl-LC_MESSAGES-converse-po",2856:"locales/dayjs/es-pr-js",2894:"locales/ug-LC_MESSAGES-converse-po",2974:"emojis",2993:"locales/dayjs/dv-js",3014:"locales/dayjs/mt-js",3166:"locales/dayjs/fi-js",3287:"locales/dayjs/km-js",3330:"locales/th-LC_MESSAGES-converse-po",3341:"locales/dayjs/en-sg-js",3359:"locales/dayjs/is-js",3519:"locales/dayjs/rn-js",3613:"locales/fi-LC_MESSAGES-converse-po",3664:"locales/dayjs/sd-js",3683:"locales/dayjs/tzl-js",3698:"locales/fr-LC_MESSAGES-converse-po",3729:"locales/dayjs/mi-js",3731:"locales/dayjs/ug-cn-js",3741:"locales/dayjs/ar-dz-js",3774:"locales/dayjs/vi-js",3881:"locales/ja-LC_MESSAGES-converse-po",4034:"locales/dayjs/it-js",4094:"locales/dayjs/en-gb-js",4107:"locales/dayjs/uk-js",4146:"locales/sq-LC_MESSAGES-converse-po",4182:"locales/dayjs/es-us-js",4202:"locales/es-LC_MESSAGES-converse-po",4260:"locales/dayjs/mr-js",4267:"locales/af-LC_MESSAGES-converse-po",4315:"locales/pt_BR-LC_MESSAGES-converse-po",4333:"locales/dayjs/me-js",4336:"locales/nl-LC_MESSAGES-converse-po",4385:"locales/dayjs/zh-cn-js",4434:"locales/dayjs/ja-js",4497:"locales/dayjs/zh-js",4512:"locales/dayjs/ms-my-js",4523:"locales/dayjs/ka-js",4584:"locales/dayjs/ro-js",4636:"locales/dayjs/te-js",4718:"locales/dayjs/it-ch-js",4749:"locales/id-LC_MESSAGES-converse-po",4770:"locales/dayjs/id-js",4852:"locales/dayjs/hi-js",4858:"locales/dayjs/sr-js",4859:"locales/dayjs/lt-js",4974:"locales/dayjs/kn-js",5036:"locales/dayjs/de-js",5059:"locales/dayjs/mk-js",5283:"locales/ta-LC_MESSAGES-converse-po",5284:"locales/dayjs/gd-js",5534:"locales/dayjs/de-at-js",5611:"locales/dayjs/en-ca-js",5628:"locales/dayjs/af-js",5724:"locales/dayjs/gl-js",5743:"locales/ar-LC_MESSAGES-converse-po",5790:"locales/dayjs/x-pseudo-js",5825:"locales/dayjs/cs-js",5946:"locales/dayjs/ne-js",5970:"locales/dayjs/uz-latn-js",5998:"locales/dayjs/ml-js",6007:"locales/dayjs/ht-js",6042:"locales/dayjs/lo-js",6064:"locales/dayjs/de-ch-js",6109:"locales/it-LC_MESSAGES-converse-po",6121:"locales/dayjs/en-au-js",6124:"locales/dayjs/bn-bd-js",6179:"locales/bg-LC_MESSAGES-converse-po",6191:"locales/dayjs/pt-js",6208:"locales/dayjs/da-js",6311:"locales/de-LC_MESSAGES-converse-po",6343:"locales/dayjs/pl-js",6345:"locales/sv-LC_MESSAGES-converse-po",6486:"locales/dayjs/bm-js",6537:"locales/dayjs/sk-js",6550:"locales/zh_CN-LC_MESSAGES-converse-po",6605:"locales/dayjs/ar-iq-js",6641:"locales/dayjs/kk-js",6655:"locales/dayjs/th-js",6660:"locales/dayjs/sv-fi-js",6733:"locales/ru-LC_MESSAGES-converse-po",6803:"locales/dayjs/yo-js",6824:"locales/dayjs/en-js",6963:"locales/da-LC_MESSAGES-converse-po",7003:"locales/dayjs/cy-js",7013:"locales/dayjs/zh-hk-js",7028:"locales/dayjs/en-in-js",7370:"locales/pl-LC_MESSAGES-converse-po",7385:"locales/dayjs/ar-ma-js",7491:"locales/dayjs/ky-js",7494:"locales/eo-LC_MESSAGES-converse-po",7497:"locales/dayjs/nl-js",7576:"locales/oc-LC_MESSAGES-converse-po",7596:"locales/dayjs/fo-js",7627:"locales/dayjs/en-tt-js",7743:"locales/dayjs/ga-js",7801:"locales/dayjs/ar-tn-js",7806:"locales/dayjs/ru-js",7962:"locales/dayjs/tg-js",7981:"locales/dayjs/zh-tw-js",8022:"locales/dayjs/tl-ph-js",8031:"locales/dayjs/eo-js",8176:"locales/dayjs/rw-js",8178:"locales/dayjs/en-il-js",8227:"locales/he-LC_MESSAGES-converse-po",8232:"locales/dayjs/sl-js",8252:"locales/cs-LC_MESSAGES-converse-po",8343:"locales/dayjs/en-nz-js",8431:"locales/dayjs/fr-js",8443:"locales/dayjs/gu-js",8489:"locales/dayjs/am-js",8592:"locales/dayjs/tet-js",8630:"locales/dayjs/gom-latn-js",8714:"locales/si-LC_MESSAGES-converse-po",8789:"locales/dayjs/ko-js",8880:"locales/dayjs/ar-js",8898:"locales/uk-LC_MESSAGES-converse-po",8945:"locales/dayjs/tlh-js",8986:"locales/zh_TW-LC_MESSAGES-converse-po",9007:"locales/dayjs/jv-js",9052:"locales/dayjs/tzm-js",9080:"locales/dayjs/az-js",9101:"locales/dayjs/fr-ch-js",9109:"locales/dayjs/nl-be-js",9139:"locales/hu-LC_MESSAGES-converse-po",9271:"locales/dayjs/es-do-js",9331:"locales/dayjs/sr-cyrl-js",9395:"locales/dayjs/ca-js",9411:"locales/dayjs/sq-js",9423:"locales/dayjs/bn-js",9547:"locales/dayjs/si-js",9557:"locales/dayjs/tr-js",9562:"locales/nb-LC_MESSAGES-converse-po",9589:"locales/dayjs/hy-am-js",9593:"locales/dayjs/lv-js",9710:"locales/dayjs/fy-js",9782:"locales/dayjs/el-js",9870:"locales/dayjs/fr-ca-js",9975:"locales/dayjs/se-js"}[e]+".js"),o.miniCssF=e=>{},o.miniCssF=e=>{},o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s={},n="converse.js:",o.l=(e,t,i,r)=>{if(s[e])s[e].push(t);else{var a,c;if(void 0!==i)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==e||u.getAttribute("data-webpack")==n+i){a=u;break}}a||(c=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",n+i),a.src=e),s[e]=[t];var h=(t,n)=>{a.onerror=a.onload=null,clearTimeout(m);var i=s[e];if(delete s[e],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(n))),t)return t(n)},m=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),c&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.p="/dist/",(()=>{var e={50:0,6968:0};o.f.j=(t,s)=>{var n=o.o(e,t)?e[t]:void 0;if(0!==n)if(n)s.push(n[2]);else{var i=new Promise(((s,i)=>n=e[t]=[s,i]));s.push(n[2]=i);var r=o.p+o.u(t),a=new Error;o.l(r,(s=>{if(o.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var i=s&&("load"===s.type?"missing":s.type),r=s&&s.target&&s.target.src;a.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",a.name="ChunkLoadError",a.type=i,a.request=r,n[1](a)}}),"chunk-"+t,t)}};var t=(t,s)=>{var n,i,[r,a,c]=s,l=0;if(r.some((t=>0!==e[t]))){for(n in a)o.o(a,n)&&(o.m[n]=a[n]);if(c)c(o)}for(t&&t(s);l<r.length;l++)i=r[l],o.o(e,i)&&e[i]&&e[i][0](),e[i]=0},s=self.webpackChunkconverse_js=self.webpackChunkconverse_js||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})(),o.nc=void 0,(()=>{"use strict";const e={},t={plugins:{add(t,s){if(void 0!==e[t])throw new TypeError(`Error: plugin with name "${t}" has already been registered!`);e[t]=s}},initialize:(e={})=>t.load(e).initialize(e),load:(s={})=>(s.assets_path&&(o.p=s.assets_path),o(3086),Object.keys(e).forEach((s=>t.plugins.add(s,e[s]))),t)};window.converse=t;const s=new CustomEvent("converse-loaded",{detail:{converse:t}});window.dispatchEvent(s)})()})();
//# sourceMappingURL=converse.min.js.map